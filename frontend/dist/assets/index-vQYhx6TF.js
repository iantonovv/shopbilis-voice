(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var Td={exports:{}},Es={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cv;function Vk(){if(cv)return Es;cv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,o,l){var u=null;if(l!==void 0&&(u=""+l),o.key!==void 0&&(u=""+o.key),"key"in o){l={};for(var d in o)d!=="key"&&(l[d]=o[d])}else l=o;return o=l.ref,{$$typeof:i,type:r,key:u,ref:o!==void 0?o:null,props:l}}return Es.Fragment=e,Es.jsx=n,Es.jsxs=n,Es}var lv;function Hk(){return lv||(lv=1,Td.exports=Vk()),Td.exports}var xe=Hk(),kd={exports:{}},ge={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uv;function Gk(){if(uv)return ge;uv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function b(A){return A===null||typeof A!="object"?null:(A=y&&A[y]||A["@@iterator"],typeof A=="function"?A:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,k={};function O(A,Z,ae){this.props=A,this.context=Z,this.refs=k,this.updater=ae||T}O.prototype.isReactComponent={},O.prototype.setState=function(A,Z){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,Z,"setState")},O.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function _(){}_.prototype=O.prototype;function B(A,Z,ae){this.props=A,this.context=Z,this.refs=k,this.updater=ae||T}var q=B.prototype=new _;q.constructor=B,C(q,O.prototype),q.isPureReactComponent=!0;var P=Array.isArray,E={H:null,A:null,T:null,S:null,V:null},z=Object.prototype.hasOwnProperty;function J(A,Z,ae,ie,de,Ce){return ae=Ce.ref,{$$typeof:i,type:A,key:Z,ref:ae!==void 0?ae:null,props:Ce}}function ne(A,Z){return J(A.type,Z,void 0,void 0,void 0,A.props)}function oe(A){return typeof A=="object"&&A!==null&&A.$$typeof===i}function se(A){var Z={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(ae){return Z[ae]})}var $=/\/+/g;function re(A,Z){return typeof A=="object"&&A!==null&&A.key!=null?se(""+A.key):Z.toString(36)}function Ue(){}function Le(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(Ue,Ue):(A.status="pending",A.then(function(Z){A.status==="pending"&&(A.status="fulfilled",A.value=Z)},function(Z){A.status==="pending"&&(A.status="rejected",A.reason=Z)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function Ke(A,Z,ae,ie,de){var Ce=typeof A;(Ce==="undefined"||Ce==="boolean")&&(A=null);var me=!1;if(A===null)me=!0;else switch(Ce){case"bigint":case"string":case"number":me=!0;break;case"object":switch(A.$$typeof){case i:case e:me=!0;break;case g:return me=A._init,Ke(me(A._payload),Z,ae,ie,de)}}if(me)return de=de(A),me=ie===""?"."+re(A,0):ie,P(de)?(ae="",me!=null&&(ae=me.replace($,"$&/")+"/"),Ke(de,Z,ae,"",function(_t){return _t})):de!=null&&(oe(de)&&(de=ne(de,ae+(de.key==null||A&&A.key===de.key?"":(""+de.key).replace($,"$&/")+"/")+me)),Z.push(de)),1;me=0;var we=ie===""?".":ie+":";if(P(A))for(var Oe=0;Oe<A.length;Oe++)ie=A[Oe],Ce=we+re(ie,Oe),me+=Ke(ie,Z,ae,Ce,de);else if(Oe=b(A),typeof Oe=="function")for(A=Oe.call(A),Oe=0;!(ie=A.next()).done;)ie=ie.value,Ce=we+re(ie,Oe++),me+=Ke(ie,Z,ae,Ce,de);else if(Ce==="object"){if(typeof A.then=="function")return Ke(Le(A),Z,ae,ie,de);throw Z=String(A),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return me}function V(A,Z,ae){if(A==null)return A;var ie=[],de=0;return Ke(A,ie,"","",function(Ce){return Z.call(ae,Ce,de++)}),ie}function ee(A){if(A._status===-1){var Z=A._result;Z=Z(),Z.then(function(ae){(A._status===0||A._status===-1)&&(A._status=1,A._result=ae)},function(ae){(A._status===0||A._status===-1)&&(A._status=2,A._result=ae)}),A._status===-1&&(A._status=0,A._result=Z)}if(A._status===1)return A._result.default;throw A._result}var le=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function ye(){}return ge.Children={map:V,forEach:function(A,Z,ae){V(A,function(){Z.apply(this,arguments)},ae)},count:function(A){var Z=0;return V(A,function(){Z++}),Z},toArray:function(A){return V(A,function(Z){return Z})||[]},only:function(A){if(!oe(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},ge.Component=O,ge.Fragment=n,ge.Profiler=o,ge.PureComponent=B,ge.StrictMode=r,ge.Suspense=h,ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=E,ge.__COMPILER_RUNTIME={__proto__:null,c:function(A){return E.H.useMemoCache(A)}},ge.cache=function(A){return function(){return A.apply(null,arguments)}},ge.cloneElement=function(A,Z,ae){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var ie=C({},A.props),de=A.key,Ce=void 0;if(Z!=null)for(me in Z.ref!==void 0&&(Ce=void 0),Z.key!==void 0&&(de=""+Z.key),Z)!z.call(Z,me)||me==="key"||me==="__self"||me==="__source"||me==="ref"&&Z.ref===void 0||(ie[me]=Z[me]);var me=arguments.length-2;if(me===1)ie.children=ae;else if(1<me){for(var we=Array(me),Oe=0;Oe<me;Oe++)we[Oe]=arguments[Oe+2];ie.children=we}return J(A.type,de,void 0,void 0,Ce,ie)},ge.createContext=function(A){return A={$$typeof:u,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:l,_context:A},A},ge.createElement=function(A,Z,ae){var ie,de={},Ce=null;if(Z!=null)for(ie in Z.key!==void 0&&(Ce=""+Z.key),Z)z.call(Z,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(de[ie]=Z[ie]);var me=arguments.length-2;if(me===1)de.children=ae;else if(1<me){for(var we=Array(me),Oe=0;Oe<me;Oe++)we[Oe]=arguments[Oe+2];de.children=we}if(A&&A.defaultProps)for(ie in me=A.defaultProps,me)de[ie]===void 0&&(de[ie]=me[ie]);return J(A,Ce,void 0,void 0,null,de)},ge.createRef=function(){return{current:null}},ge.forwardRef=function(A){return{$$typeof:d,render:A}},ge.isValidElement=oe,ge.lazy=function(A){return{$$typeof:g,_payload:{_status:-1,_result:A},_init:ee}},ge.memo=function(A,Z){return{$$typeof:m,type:A,compare:Z===void 0?null:Z}},ge.startTransition=function(A){var Z=E.T,ae={};E.T=ae;try{var ie=A(),de=E.S;de!==null&&de(ae,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(ye,le)}catch(Ce){le(Ce)}finally{E.T=Z}},ge.unstable_useCacheRefresh=function(){return E.H.useCacheRefresh()},ge.use=function(A){return E.H.use(A)},ge.useActionState=function(A,Z,ae){return E.H.useActionState(A,Z,ae)},ge.useCallback=function(A,Z){return E.H.useCallback(A,Z)},ge.useContext=function(A){return E.H.useContext(A)},ge.useDebugValue=function(){},ge.useDeferredValue=function(A,Z){return E.H.useDeferredValue(A,Z)},ge.useEffect=function(A,Z,ae){var ie=E.H;if(typeof ae=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(A,Z)},ge.useId=function(){return E.H.useId()},ge.useImperativeHandle=function(A,Z,ae){return E.H.useImperativeHandle(A,Z,ae)},ge.useInsertionEffect=function(A,Z){return E.H.useInsertionEffect(A,Z)},ge.useLayoutEffect=function(A,Z){return E.H.useLayoutEffect(A,Z)},ge.useMemo=function(A,Z){return E.H.useMemo(A,Z)},ge.useOptimistic=function(A,Z){return E.H.useOptimistic(A,Z)},ge.useReducer=function(A,Z,ae){return E.H.useReducer(A,Z,ae)},ge.useRef=function(A){return E.H.useRef(A)},ge.useState=function(A){return E.H.useState(A)},ge.useSyncExternalStore=function(A,Z,ae){return E.H.useSyncExternalStore(A,Z,ae)},ge.useTransition=function(){return E.H.useTransition()},ge.version="19.1.0",ge}var dv;function Bf(){return dv||(dv=1,kd.exports=Gk()),kd.exports}var M=Bf(),Cd={exports:{}},Rs={},Ed={exports:{}},Rd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fv;function Fk(){return fv||(fv=1,function(i){function e(V,ee){var le=V.length;V.push(ee);e:for(;0<le;){var ye=le-1>>>1,A=V[ye];if(0<o(A,ee))V[ye]=ee,V[le]=A,le=ye;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var ee=V[0],le=V.pop();if(le!==ee){V[0]=le;e:for(var ye=0,A=V.length,Z=A>>>1;ye<Z;){var ae=2*(ye+1)-1,ie=V[ae],de=ae+1,Ce=V[de];if(0>o(ie,le))de<A&&0>o(Ce,ie)?(V[ye]=Ce,V[de]=le,ye=de):(V[ye]=ie,V[ae]=le,ye=ae);else if(de<A&&0>o(Ce,le))V[ye]=Ce,V[de]=le,ye=de;else break e}}return ee}function o(V,ee){var le=V.sortIndex-ee.sortIndex;return le!==0?le:V.id-ee.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;i.unstable_now=function(){return l.now()}}else{var u=Date,d=u.now();i.unstable_now=function(){return u.now()-d}}var h=[],m=[],g=1,y=null,b=3,T=!1,C=!1,k=!1,O=!1,_=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;function P(V){for(var ee=n(m);ee!==null;){if(ee.callback===null)r(m);else if(ee.startTime<=V)r(m),ee.sortIndex=ee.expirationTime,e(h,ee);else break;ee=n(m)}}function E(V){if(k=!1,P(V),!C)if(n(h)!==null)C=!0,z||(z=!0,re());else{var ee=n(m);ee!==null&&Ke(E,ee.startTime-V)}}var z=!1,J=-1,ne=5,oe=-1;function se(){return O?!0:!(i.unstable_now()-oe<ne)}function $(){if(O=!1,z){var V=i.unstable_now();oe=V;var ee=!0;try{e:{C=!1,k&&(k=!1,B(J),J=-1),T=!0;var le=b;try{t:{for(P(V),y=n(h);y!==null&&!(y.expirationTime>V&&se());){var ye=y.callback;if(typeof ye=="function"){y.callback=null,b=y.priorityLevel;var A=ye(y.expirationTime<=V);if(V=i.unstable_now(),typeof A=="function"){y.callback=A,P(V),ee=!0;break t}y===n(h)&&r(h),P(V)}else r(h);y=n(h)}if(y!==null)ee=!0;else{var Z=n(m);Z!==null&&Ke(E,Z.startTime-V),ee=!1}}break e}finally{y=null,b=le,T=!1}ee=void 0}}finally{ee?re():z=!1}}}var re;if(typeof q=="function")re=function(){q($)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,Le=Ue.port2;Ue.port1.onmessage=$,re=function(){Le.postMessage(null)}}else re=function(){_($,0)};function Ke(V,ee){J=_(function(){V(i.unstable_now())},ee)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(V){V.callback=null},i.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<V?Math.floor(1e3/V):5},i.unstable_getCurrentPriorityLevel=function(){return b},i.unstable_next=function(V){switch(b){case 1:case 2:case 3:var ee=3;break;default:ee=b}var le=b;b=ee;try{return V()}finally{b=le}},i.unstable_requestPaint=function(){O=!0},i.unstable_runWithPriority=function(V,ee){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var le=b;b=V;try{return ee()}finally{b=le}},i.unstable_scheduleCallback=function(V,ee,le){var ye=i.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?ye+le:ye):le=ye,V){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=le+A,V={id:g++,callback:ee,priorityLevel:V,startTime:le,expirationTime:A,sortIndex:-1},le>ye?(V.sortIndex=le,e(m,V),n(h)===null&&V===n(m)&&(k?(B(J),J=-1):k=!0,Ke(E,le-ye))):(V.sortIndex=A,e(h,V),C||T||(C=!0,z||(z=!0,re()))),V},i.unstable_shouldYield=se,i.unstable_wrapCallback=function(V){var ee=b;return function(){var le=b;b=ee;try{return V.apply(this,arguments)}finally{b=le}}}}(Rd)),Rd}var hv;function Yk(){return hv||(hv=1,Ed.exports=Fk()),Ed.exports}var _d={exports:{}},Et={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mv;function Kk(){if(mv)return Et;mv=1;var i=Bf();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},o=Symbol.for("react.portal");function l(h,m,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:y==null?null:""+y,children:h,containerInfo:m,implementation:g}}var u=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Et.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Et.createPortal=function(h,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return l(h,m,null,g)},Et.flushSync=function(h){var m=u.T,g=r.p;try{if(u.T=null,r.p=2,h)return h()}finally{u.T=m,r.p=g,r.d.f()}},Et.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Et.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Et.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var g=m.as,y=d(g,m.crossOrigin),b=typeof m.integrity=="string"?m.integrity:void 0,T=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:y,integrity:b,fetchPriority:T}):g==="script"&&r.d.X(h,{crossOrigin:y,integrity:b,fetchPriority:T,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Et.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Et.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,y=d(g,m.crossOrigin);r.d.L(h,g,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Et.preloadModule=function(h,m){if(typeof h=="string")if(m){var g=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Et.requestFormReset=function(h){r.d.r(h)},Et.unstable_batchedUpdates=function(h,m){return h(m)},Et.useFormState=function(h,m,g){return u.H.useFormState(h,m,g)},Et.useFormStatus=function(){return u.H.useHostTransitionStatus()},Et.version="19.1.0",Et}var pv;function Qk(){if(pv)return _d.exports;pv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),_d.exports=Kk(),_d.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gv;function Xk(){if(gv)return Rs;gv=1;var i=Yk(),e=Bf(),n=Qk();function r(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function l(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function u(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function d(t){if(l(t)!==t)throw Error(r(188))}function h(t){var a=t.alternate;if(!a){if(a=l(t),a===null)throw Error(r(188));return a!==t?null:t}for(var s=t,c=a;;){var f=s.return;if(f===null)break;var p=f.alternate;if(p===null){if(c=f.return,c!==null){s=c;continue}break}if(f.child===p.child){for(p=f.child;p;){if(p===s)return d(f),t;if(p===c)return d(f),a;p=p.sibling}throw Error(r(188))}if(s.return!==c.return)s=f,c=p;else{for(var v=!1,S=f.child;S;){if(S===s){v=!0,s=f,c=p;break}if(S===c){v=!0,c=f,s=p;break}S=S.sibling}if(!v){for(S=p.child;S;){if(S===s){v=!0,s=p,c=f;break}if(S===c){v=!0,c=p,s=f;break}S=S.sibling}if(!v)throw Error(r(189))}}if(s.alternate!==c)throw Error(r(190))}if(s.tag!==3)throw Error(r(188));return s.stateNode.current===s?t:a}function m(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=m(t),a!==null)return a;t=t.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),B=Symbol.for("react.consumer"),q=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),oe=Symbol.for("react.activity"),se=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function re(t){return t===null||typeof t!="object"?null:(t=$&&t[$]||t["@@iterator"],typeof t=="function"?t:null)}var Ue=Symbol.for("react.client.reference");function Le(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===Ue?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case C:return"Fragment";case O:return"Profiler";case k:return"StrictMode";case E:return"Suspense";case z:return"SuspenseList";case oe:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case T:return"Portal";case q:return(t.displayName||"Context")+".Provider";case B:return(t._context.displayName||"Context")+".Consumer";case P:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case J:return a=t.displayName||null,a!==null?a:Le(t.type)||"Memo";case ne:a=t._payload,t=t._init;try{return Le(t(a))}catch{}}return null}var Ke=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},ye=[],A=-1;function Z(t){return{current:t}}function ae(t){0>A||(t.current=ye[A],ye[A]=null,A--)}function ie(t,a){A++,ye[A]=t.current,t.current=a}var de=Z(null),Ce=Z(null),me=Z(null),we=Z(null);function Oe(t,a){switch(ie(me,a),ie(Ce,t),ie(de,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Lg(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Lg(a),t=Ig(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}ae(de),ie(de,t)}function _t(){ae(de),ae(Ce),ae(me)}function ya(t){t.memoizedState!==null&&ie(we,t);var a=de.current,s=Ig(a,t.type);a!==s&&(ie(Ce,t),ie(de,s))}function Ks(t){Ce.current===t&&(ae(de),ae(Ce)),we.current===t&&(ae(we),bs._currentValue=le)}var ol=Object.prototype.hasOwnProperty,cl=i.unstable_scheduleCallback,ll=i.unstable_cancelCallback,SS=i.unstable_shouldYield,TS=i.unstable_requestPaint,bn=i.unstable_now,kS=i.unstable_getCurrentPriorityLevel,gh=i.unstable_ImmediatePriority,vh=i.unstable_UserBlockingPriority,Qs=i.unstable_NormalPriority,CS=i.unstable_LowPriority,yh=i.unstable_IdlePriority,ES=i.log,RS=i.unstable_setDisableYieldValue,wr=null,It=null;function ii(t){if(typeof ES=="function"&&RS(t),It&&typeof It.setStrictMode=="function")try{It.setStrictMode(wr,t)}catch{}}var jt=Math.clz32?Math.clz32:OS,_S=Math.log,wS=Math.LN2;function OS(t){return t>>>=0,t===0?32:31-(_S(t)/wS|0)|0}var Xs=256,Zs=4194304;function zi(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Js(t,a,s){var c=t.pendingLanes;if(c===0)return 0;var f=0,p=t.suspendedLanes,v=t.pingedLanes;t=t.warmLanes;var S=c&134217727;return S!==0?(c=S&~p,c!==0?f=zi(c):(v&=S,v!==0?f=zi(v):s||(s=S&~t,s!==0&&(f=zi(s))))):(S=c&~p,S!==0?f=zi(S):v!==0?f=zi(v):s||(s=c&~t,s!==0&&(f=zi(s)))),f===0?0:a!==0&&a!==f&&(a&p)===0&&(p=f&-f,s=a&-a,p>=s||p===32&&(s&4194048)!==0)?a:f}function Or(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function AS(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bh(){var t=Xs;return Xs<<=1,(Xs&4194048)===0&&(Xs=256),t}function Sh(){var t=Zs;return Zs<<=1,(Zs&62914560)===0&&(Zs=4194304),t}function ul(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function Ar(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function DS(t,a,s,c,f,p){var v=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var S=t.entanglements,R=t.expirationTimes,U=t.hiddenUpdates;for(s=v&~s;0<s;){var F=31-jt(s),K=1<<F;S[F]=0,R[F]=-1;var L=U[F];if(L!==null)for(U[F]=null,F=0;F<L.length;F++){var I=L[F];I!==null&&(I.lane&=-536870913)}s&=~K}c!==0&&Th(t,c,0),p!==0&&f===0&&t.tag!==0&&(t.suspendedLanes|=p&~(v&~a))}function Th(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var c=31-jt(a);t.entangledLanes|=a,t.entanglements[c]=t.entanglements[c]|1073741824|s&4194090}function kh(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var c=31-jt(s),f=1<<c;f&a|t[c]&a&&(t[c]|=a),s&=~f}}function dl(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function fl(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Ch(){var t=ee.p;return t!==0?t:(t=window.event,t===void 0?32:nv(t.type))}function MS(t,a){var s=ee.p;try{return ee.p=t,a()}finally{ee.p=s}}var ai=Math.random().toString(36).slice(2),kt="__reactFiber$"+ai,wt="__reactProps$"+ai,ba="__reactContainer$"+ai,hl="__reactEvents$"+ai,xS="__reactListeners$"+ai,PS="__reactHandles$"+ai,Eh="__reactResources$"+ai,Dr="__reactMarker$"+ai;function ml(t){delete t[kt],delete t[wt],delete t[hl],delete t[xS],delete t[PS]}function Sa(t){var a=t[kt];if(a)return a;for(var s=t.parentNode;s;){if(a=s[ba]||s[kt]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=qg(t);t!==null;){if(s=t[kt])return s;t=qg(t)}return a}t=s,s=t.parentNode}return null}function Ta(t){if(t=t[kt]||t[ba]){var a=t.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return t}return null}function Mr(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(r(33))}function ka(t){var a=t[Eh];return a||(a=t[Eh]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function ft(t){t[Dr]=!0}var Rh=new Set,_h={};function qi(t,a){Ca(t,a),Ca(t+"Capture",a)}function Ca(t,a){for(_h[t]=a,t=0;t<a.length;t++)Rh.add(a[t])}var NS=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wh={},Oh={};function US(t){return ol.call(Oh,t)?!0:ol.call(wh,t)?!1:NS.test(t)?Oh[t]=!0:(wh[t]=!0,!1)}function Ws(t,a,s){if(US(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var c=a.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function $s(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function Un(t,a,s,c){if(c===null)t.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+c)}}var pl,Ah;function Ea(t){if(pl===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);pl=a&&a[1]||"",Ah=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+pl+t+Ah}var gl=!1;function vl(t,a){if(!t||gl)return"";gl=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(a){var K=function(){throw Error()};if(Object.defineProperty(K.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(K,[])}catch(I){var L=I}Reflect.construct(t,[],K)}else{try{K.call()}catch(I){L=I}t.call(K.prototype)}}else{try{throw Error()}catch(I){L=I}(K=t())&&typeof K.catch=="function"&&K.catch(function(){})}}catch(I){if(I&&L&&typeof I.stack=="string")return[I.stack,L.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var f=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");f&&f.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=c.DetermineComponentFrameRoot(),v=p[0],S=p[1];if(v&&S){var R=v.split(`
`),U=S.split(`
`);for(f=c=0;c<R.length&&!R[c].includes("DetermineComponentFrameRoot");)c++;for(;f<U.length&&!U[f].includes("DetermineComponentFrameRoot");)f++;if(c===R.length||f===U.length)for(c=R.length-1,f=U.length-1;1<=c&&0<=f&&R[c]!==U[f];)f--;for(;1<=c&&0<=f;c--,f--)if(R[c]!==U[f]){if(c!==1||f!==1)do if(c--,f--,0>f||R[c]!==U[f]){var F=`
`+R[c].replace(" at new "," at ");return t.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",t.displayName)),F}while(1<=c&&0<=f);break}}}finally{gl=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?Ea(s):""}function LS(t){switch(t.tag){case 26:case 27:case 5:return Ea(t.type);case 16:return Ea("Lazy");case 13:return Ea("Suspense");case 19:return Ea("SuspenseList");case 0:case 15:return vl(t.type,!1);case 11:return vl(t.type.render,!1);case 1:return vl(t.type,!0);case 31:return Ea("Activity");default:return""}}function Dh(t){try{var a="";do a+=LS(t),t=t.return;while(t);return a}catch(s){return`
Error generating stack: `+s.message+`
`+s.stack}}function Xt(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Mh(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function IS(t){var a=Mh(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,a),c=""+t[a];if(!t.hasOwnProperty(a)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var f=s.get,p=s.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return f.call(this)},set:function(v){c=""+v,p.call(this,v)}}),Object.defineProperty(t,a,{enumerable:s.enumerable}),{getValue:function(){return c},setValue:function(v){c=""+v},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function eo(t){t._valueTracker||(t._valueTracker=IS(t))}function xh(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),c="";return t&&(c=Mh(t)?t.checked?"true":"false":t.value),t=c,t!==s?(a.setValue(t),!0):!1}function to(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var jS=/[\n"\\]/g;function Zt(t){return t.replace(jS,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function yl(t,a,s,c,f,p,v,S){t.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?t.type=v:t.removeAttribute("type"),a!=null?v==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+Xt(a)):t.value!==""+Xt(a)&&(t.value=""+Xt(a)):v!=="submit"&&v!=="reset"||t.removeAttribute("value"),a!=null?bl(t,v,Xt(a)):s!=null?bl(t,v,Xt(s)):c!=null&&t.removeAttribute("value"),f==null&&p!=null&&(t.defaultChecked=!!p),f!=null&&(t.checked=f&&typeof f!="function"&&typeof f!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?t.name=""+Xt(S):t.removeAttribute("name")}function Ph(t,a,s,c,f,p,v,S){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(t.type=p),a!=null||s!=null){if(!(p!=="submit"&&p!=="reset"||a!=null))return;s=s!=null?""+Xt(s):"",a=a!=null?""+Xt(a):s,S||a===t.value||(t.value=a),t.defaultValue=a}c=c??f,c=typeof c!="function"&&typeof c!="symbol"&&!!c,t.checked=S?t.checked:!!c,t.defaultChecked=!!c,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(t.name=v)}function bl(t,a,s){a==="number"&&to(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Ra(t,a,s,c){if(t=t.options,a){a={};for(var f=0;f<s.length;f++)a["$"+s[f]]=!0;for(s=0;s<t.length;s++)f=a.hasOwnProperty("$"+t[s].value),t[s].selected!==f&&(t[s].selected=f),f&&c&&(t[s].defaultSelected=!0)}else{for(s=""+Xt(s),a=null,f=0;f<t.length;f++){if(t[f].value===s){t[f].selected=!0,c&&(t[f].defaultSelected=!0);return}a!==null||t[f].disabled||(a=t[f])}a!==null&&(a.selected=!0)}}function Nh(t,a,s){if(a!=null&&(a=""+Xt(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+Xt(s):""}function Uh(t,a,s,c){if(a==null){if(c!=null){if(s!=null)throw Error(r(92));if(Ke(c)){if(1<c.length)throw Error(r(93));c=c[0]}s=c}s==null&&(s=""),a=s}s=Xt(a),t.defaultValue=s,c=t.textContent,c===s&&c!==""&&c!==null&&(t.value=c)}function _a(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var BS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Lh(t,a,s){var c=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?c?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":c?t.setProperty(a,s):typeof s!="number"||s===0||BS.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function Ih(t,a,s){if(a!=null&&typeof a!="object")throw Error(r(62));if(t=t.style,s!=null){for(var c in s)!s.hasOwnProperty(c)||a!=null&&a.hasOwnProperty(c)||(c.indexOf("--")===0?t.setProperty(c,""):c==="float"?t.cssFloat="":t[c]="");for(var f in a)c=a[f],a.hasOwnProperty(f)&&s[f]!==c&&Lh(t,f,c)}else for(var p in a)a.hasOwnProperty(p)&&Lh(t,p,a[p])}function Sl(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function no(t){return qS.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var Tl=null;function kl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var wa=null,Oa=null;function jh(t){var a=Ta(t);if(a&&(t=a.stateNode)){var s=t[wt]||null;e:switch(t=a.stateNode,a.type){case"input":if(yl(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Zt(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var c=s[a];if(c!==t&&c.form===t.form){var f=c[wt]||null;if(!f)throw Error(r(90));yl(c,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name)}}for(a=0;a<s.length;a++)c=s[a],c.form===t.form&&xh(c)}break e;case"textarea":Nh(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&Ra(t,!!s.multiple,a,!1)}}}var Cl=!1;function Bh(t,a,s){if(Cl)return t(a,s);Cl=!0;try{var c=t(a);return c}finally{if(Cl=!1,(wa!==null||Oa!==null)&&(Vo(),wa&&(a=wa,t=Oa,Oa=wa=null,jh(a),t)))for(a=0;a<t.length;a++)jh(t[a])}}function xr(t,a){var s=t.stateNode;if(s===null)return null;var c=s[wt]||null;if(c===null)return null;s=c[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(r(231,a,typeof s));return s}var Ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),El=!1;if(Ln)try{var Pr={};Object.defineProperty(Pr,"passive",{get:function(){El=!0}}),window.addEventListener("test",Pr,Pr),window.removeEventListener("test",Pr,Pr)}catch{El=!1}var ri=null,Rl=null,io=null;function zh(){if(io)return io;var t,a=Rl,s=a.length,c,f="value"in ri?ri.value:ri.textContent,p=f.length;for(t=0;t<s&&a[t]===f[t];t++);var v=s-t;for(c=1;c<=v&&a[s-c]===f[p-c];c++);return io=f.slice(t,1<c?1-c:void 0)}function ao(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function ro(){return!0}function qh(){return!1}function Ot(t){function a(s,c,f,p,v){this._reactName=s,this._targetInst=f,this.type=c,this.nativeEvent=p,this.target=v,this.currentTarget=null;for(var S in t)t.hasOwnProperty(S)&&(s=t[S],this[S]=s?s(p):p[S]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?ro:qh,this.isPropagationStopped=qh,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=ro)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=ro)},persist:function(){},isPersistent:ro}),a}var Vi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},so=Ot(Vi),Nr=g({},Vi,{view:0,detail:0}),VS=Ot(Nr),_l,wl,Ur,oo=g({},Nr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Al,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ur&&(Ur&&t.type==="mousemove"?(_l=t.screenX-Ur.screenX,wl=t.screenY-Ur.screenY):wl=_l=0,Ur=t),_l)},movementY:function(t){return"movementY"in t?t.movementY:wl}}),Vh=Ot(oo),HS=g({},oo,{dataTransfer:0}),GS=Ot(HS),FS=g({},Nr,{relatedTarget:0}),Ol=Ot(FS),YS=g({},Vi,{animationName:0,elapsedTime:0,pseudoElement:0}),KS=Ot(YS),QS=g({},Vi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),XS=Ot(QS),ZS=g({},Vi,{data:0}),Hh=Ot(ZS),JS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},WS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$S={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eT(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=$S[t])?!!a[t]:!1}function Al(){return eT}var tT=g({},Nr,{key:function(t){if(t.key){var a=JS[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=ao(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?WS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Al,charCode:function(t){return t.type==="keypress"?ao(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ao(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),nT=Ot(tT),iT=g({},oo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gh=Ot(iT),aT=g({},Nr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Al}),rT=Ot(aT),sT=g({},Vi,{propertyName:0,elapsedTime:0,pseudoElement:0}),oT=Ot(sT),cT=g({},oo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),lT=Ot(cT),uT=g({},Vi,{newState:0,oldState:0}),dT=Ot(uT),fT=[9,13,27,32],Dl=Ln&&"CompositionEvent"in window,Lr=null;Ln&&"documentMode"in document&&(Lr=document.documentMode);var hT=Ln&&"TextEvent"in window&&!Lr,Fh=Ln&&(!Dl||Lr&&8<Lr&&11>=Lr),Yh=" ",Kh=!1;function Qh(t,a){switch(t){case"keyup":return fT.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xh(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Aa=!1;function mT(t,a){switch(t){case"compositionend":return Xh(a);case"keypress":return a.which!==32?null:(Kh=!0,Yh);case"textInput":return t=a.data,t===Yh&&Kh?null:t;default:return null}}function pT(t,a){if(Aa)return t==="compositionend"||!Dl&&Qh(t,a)?(t=zh(),io=Rl=ri=null,Aa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Fh&&a.locale!=="ko"?null:a.data;default:return null}}var gT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zh(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!gT[t.type]:a==="textarea"}function Jh(t,a,s,c){wa?Oa?Oa.push(c):Oa=[c]:wa=c,a=Qo(a,"onChange"),0<a.length&&(s=new so("onChange","change",null,s,c),t.push({event:s,listeners:a}))}var Ir=null,jr=null;function vT(t){Mg(t,0)}function co(t){var a=Mr(t);if(xh(a))return t}function Wh(t,a){if(t==="change")return a}var $h=!1;if(Ln){var Ml;if(Ln){var xl="oninput"in document;if(!xl){var em=document.createElement("div");em.setAttribute("oninput","return;"),xl=typeof em.oninput=="function"}Ml=xl}else Ml=!1;$h=Ml&&(!document.documentMode||9<document.documentMode)}function tm(){Ir&&(Ir.detachEvent("onpropertychange",nm),jr=Ir=null)}function nm(t){if(t.propertyName==="value"&&co(jr)){var a=[];Jh(a,jr,t,kl(t)),Bh(vT,a)}}function yT(t,a,s){t==="focusin"?(tm(),Ir=a,jr=s,Ir.attachEvent("onpropertychange",nm)):t==="focusout"&&tm()}function bT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return co(jr)}function ST(t,a){if(t==="click")return co(a)}function TT(t,a){if(t==="input"||t==="change")return co(a)}function kT(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var Bt=typeof Object.is=="function"?Object.is:kT;function Br(t,a){if(Bt(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),c=Object.keys(a);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var f=s[c];if(!ol.call(a,f)||!Bt(t[f],a[f]))return!1}return!0}function im(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function am(t,a){var s=im(t);t=0;for(var c;s;){if(s.nodeType===3){if(c=t+s.textContent.length,t<=a&&c>=a)return{node:s,offset:a-t};t=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=im(s)}}function rm(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?rm(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function sm(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=to(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=to(t.document)}return a}function Pl(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var CT=Ln&&"documentMode"in document&&11>=document.documentMode,Da=null,Nl=null,zr=null,Ul=!1;function om(t,a,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Ul||Da==null||Da!==to(c)||(c=Da,"selectionStart"in c&&Pl(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),zr&&Br(zr,c)||(zr=c,c=Qo(Nl,"onSelect"),0<c.length&&(a=new so("onSelect","select",null,a,s),t.push({event:a,listeners:c}),a.target=Da)))}function Hi(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var Ma={animationend:Hi("Animation","AnimationEnd"),animationiteration:Hi("Animation","AnimationIteration"),animationstart:Hi("Animation","AnimationStart"),transitionrun:Hi("Transition","TransitionRun"),transitionstart:Hi("Transition","TransitionStart"),transitioncancel:Hi("Transition","TransitionCancel"),transitionend:Hi("Transition","TransitionEnd")},Ll={},cm={};Ln&&(cm=document.createElement("div").style,"AnimationEvent"in window||(delete Ma.animationend.animation,delete Ma.animationiteration.animation,delete Ma.animationstart.animation),"TransitionEvent"in window||delete Ma.transitionend.transition);function Gi(t){if(Ll[t])return Ll[t];if(!Ma[t])return t;var a=Ma[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in cm)return Ll[t]=a[s];return t}var lm=Gi("animationend"),um=Gi("animationiteration"),dm=Gi("animationstart"),ET=Gi("transitionrun"),RT=Gi("transitionstart"),_T=Gi("transitioncancel"),fm=Gi("transitionend"),hm=new Map,Il="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Il.push("scrollEnd");function sn(t,a){hm.set(t,a),qi(a,[t])}var mm=new WeakMap;function Jt(t,a){if(typeof t=="object"&&t!==null){var s=mm.get(t);return s!==void 0?s:(a={value:t,source:a,stack:Dh(a)},mm.set(t,a),a)}return{value:t,source:a,stack:Dh(a)}}var Wt=[],xa=0,jl=0;function lo(){for(var t=xa,a=jl=xa=0;a<t;){var s=Wt[a];Wt[a++]=null;var c=Wt[a];Wt[a++]=null;var f=Wt[a];Wt[a++]=null;var p=Wt[a];if(Wt[a++]=null,c!==null&&f!==null){var v=c.pending;v===null?f.next=f:(f.next=v.next,v.next=f),c.pending=f}p!==0&&pm(s,f,p)}}function uo(t,a,s,c){Wt[xa++]=t,Wt[xa++]=a,Wt[xa++]=s,Wt[xa++]=c,jl|=c,t.lanes|=c,t=t.alternate,t!==null&&(t.lanes|=c)}function Bl(t,a,s,c){return uo(t,a,s,c),fo(t)}function Pa(t,a){return uo(t,null,null,a),fo(t)}function pm(t,a,s){t.lanes|=s;var c=t.alternate;c!==null&&(c.lanes|=s);for(var f=!1,p=t.return;p!==null;)p.childLanes|=s,c=p.alternate,c!==null&&(c.childLanes|=s),p.tag===22&&(t=p.stateNode,t===null||t._visibility&1||(f=!0)),t=p,p=p.return;return t.tag===3?(p=t.stateNode,f&&a!==null&&(f=31-jt(s),t=p.hiddenUpdates,c=t[f],c===null?t[f]=[a]:c.push(a),a.lane=s|536870912),p):null}function fo(t){if(50<ds)throw ds=0,Fu=null,Error(r(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var Na={};function wT(t,a,s,c){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zt(t,a,s,c){return new wT(t,a,s,c)}function zl(t){return t=t.prototype,!(!t||!t.isReactComponent)}function In(t,a){var s=t.alternate;return s===null?(s=zt(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function gm(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function ho(t,a,s,c,f,p){var v=0;if(c=t,typeof t=="function")zl(t)&&(v=1);else if(typeof t=="string")v=Ak(t,s,de.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case oe:return t=zt(31,s,a,f),t.elementType=oe,t.lanes=p,t;case C:return Fi(s.children,f,p,a);case k:v=8,f|=24;break;case O:return t=zt(12,s,a,f|2),t.elementType=O,t.lanes=p,t;case E:return t=zt(13,s,a,f),t.elementType=E,t.lanes=p,t;case z:return t=zt(19,s,a,f),t.elementType=z,t.lanes=p,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case _:case q:v=10;break e;case B:v=9;break e;case P:v=11;break e;case J:v=14;break e;case ne:v=16,c=null;break e}v=29,s=Error(r(130,t===null?"null":typeof t,"")),c=null}return a=zt(v,s,a,f),a.elementType=t,a.type=c,a.lanes=p,a}function Fi(t,a,s,c){return t=zt(7,t,c,a),t.lanes=s,t}function ql(t,a,s){return t=zt(6,t,null,a),t.lanes=s,t}function Vl(t,a,s){return a=zt(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var Ua=[],La=0,mo=null,po=0,$t=[],en=0,Yi=null,jn=1,Bn="";function Ki(t,a){Ua[La++]=po,Ua[La++]=mo,mo=t,po=a}function vm(t,a,s){$t[en++]=jn,$t[en++]=Bn,$t[en++]=Yi,Yi=t;var c=jn;t=Bn;var f=32-jt(c)-1;c&=~(1<<f),s+=1;var p=32-jt(a)+f;if(30<p){var v=f-f%5;p=(c&(1<<v)-1).toString(32),c>>=v,f-=v,jn=1<<32-jt(a)+f|s<<f|c,Bn=p+t}else jn=1<<p|s<<f|c,Bn=t}function Hl(t){t.return!==null&&(Ki(t,1),vm(t,1,0))}function Gl(t){for(;t===mo;)mo=Ua[--La],Ua[La]=null,po=Ua[--La],Ua[La]=null;for(;t===Yi;)Yi=$t[--en],$t[en]=null,Bn=$t[--en],$t[en]=null,jn=$t[--en],$t[en]=null}var Rt=null,Je=null,Me=!1,Qi=null,Sn=!1,Fl=Error(r(519));function Xi(t){var a=Error(r(418,""));throw Hr(Jt(a,t)),Fl}function ym(t){var a=t.stateNode,s=t.type,c=t.memoizedProps;switch(a[kt]=t,a[wt]=c,s){case"dialog":Te("cancel",a),Te("close",a);break;case"iframe":case"object":case"embed":Te("load",a);break;case"video":case"audio":for(s=0;s<hs.length;s++)Te(hs[s],a);break;case"source":Te("error",a);break;case"img":case"image":case"link":Te("error",a),Te("load",a);break;case"details":Te("toggle",a);break;case"input":Te("invalid",a),Ph(a,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),eo(a);break;case"select":Te("invalid",a);break;case"textarea":Te("invalid",a),Uh(a,c.value,c.defaultValue,c.children),eo(a)}s=c.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||c.suppressHydrationWarning===!0||Ug(a.textContent,s)?(c.popover!=null&&(Te("beforetoggle",a),Te("toggle",a)),c.onScroll!=null&&Te("scroll",a),c.onScrollEnd!=null&&Te("scrollend",a),c.onClick!=null&&(a.onclick=Xo),a=!0):a=!1,a||Xi(t)}function bm(t){for(Rt=t.return;Rt;)switch(Rt.tag){case 5:case 13:Sn=!1;return;case 27:case 3:Sn=!0;return;default:Rt=Rt.return}}function qr(t){if(t!==Rt)return!1;if(!Me)return bm(t),Me=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||od(t.type,t.memoizedProps)),s=!s),s&&Je&&Xi(t),bm(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(r(317));e:{for(t=t.nextSibling,a=0;t;){if(t.nodeType===8)if(s=t.data,s==="/$"){if(a===0){Je=cn(t.nextSibling);break e}a--}else s!=="$"&&s!=="$!"&&s!=="$?"||a++;t=t.nextSibling}Je=null}}else a===27?(a=Je,Ti(t.type)?(t=dd,dd=null,Je=t):Je=a):Je=Rt?cn(t.stateNode.nextSibling):null;return!0}function Vr(){Je=Rt=null,Me=!1}function Sm(){var t=Qi;return t!==null&&(Mt===null?Mt=t:Mt.push.apply(Mt,t),Qi=null),t}function Hr(t){Qi===null?Qi=[t]:Qi.push(t)}var Yl=Z(null),Zi=null,zn=null;function si(t,a,s){ie(Yl,a._currentValue),a._currentValue=s}function qn(t){t._currentValue=Yl.current,ae(Yl)}function Kl(t,a,s){for(;t!==null;){var c=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,c!==null&&(c.childLanes|=a)):c!==null&&(c.childLanes&a)!==a&&(c.childLanes|=a),t===s)break;t=t.return}}function Ql(t,a,s,c){var f=t.child;for(f!==null&&(f.return=t);f!==null;){var p=f.dependencies;if(p!==null){var v=f.child;p=p.firstContext;e:for(;p!==null;){var S=p;p=f;for(var R=0;R<a.length;R++)if(S.context===a[R]){p.lanes|=s,S=p.alternate,S!==null&&(S.lanes|=s),Kl(p.return,s,t),c||(v=null);break e}p=S.next}}else if(f.tag===18){if(v=f.return,v===null)throw Error(r(341));v.lanes|=s,p=v.alternate,p!==null&&(p.lanes|=s),Kl(v,s,t),v=null}else v=f.child;if(v!==null)v.return=f;else for(v=f;v!==null;){if(v===t){v=null;break}if(f=v.sibling,f!==null){f.return=v.return,v=f;break}v=v.return}f=v}}function Gr(t,a,s,c){t=null;for(var f=a,p=!1;f!==null;){if(!p){if((f.flags&524288)!==0)p=!0;else if((f.flags&262144)!==0)break}if(f.tag===10){var v=f.alternate;if(v===null)throw Error(r(387));if(v=v.memoizedProps,v!==null){var S=f.type;Bt(f.pendingProps.value,v.value)||(t!==null?t.push(S):t=[S])}}else if(f===we.current){if(v=f.alternate,v===null)throw Error(r(387));v.memoizedState.memoizedState!==f.memoizedState.memoizedState&&(t!==null?t.push(bs):t=[bs])}f=f.return}t!==null&&Ql(a,t,s,c),a.flags|=262144}function go(t){for(t=t.firstContext;t!==null;){if(!Bt(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Ji(t){Zi=t,zn=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Ct(t){return Tm(Zi,t)}function vo(t,a){return Zi===null&&Ji(t),Tm(t,a)}function Tm(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},zn===null){if(t===null)throw Error(r(308));zn=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else zn=zn.next=a;return s}var OT=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,c){t.push(c)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},AT=i.unstable_scheduleCallback,DT=i.unstable_NormalPriority,ct={$$typeof:q,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xl(){return{controller:new OT,data:new Map,refCount:0}}function Fr(t){t.refCount--,t.refCount===0&&AT(DT,function(){t.controller.abort()})}var Yr=null,Zl=0,Ia=0,ja=null;function MT(t,a){if(Yr===null){var s=Yr=[];Zl=0,Ia=Wu(),ja={status:"pending",value:void 0,then:function(c){s.push(c)}}}return Zl++,a.then(km,km),a}function km(){if(--Zl===0&&Yr!==null){ja!==null&&(ja.status="fulfilled");var t=Yr;Yr=null,Ia=0,ja=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function xT(t,a){var s=[],c={status:"pending",value:null,reason:null,then:function(f){s.push(f)}};return t.then(function(){c.status="fulfilled",c.value=a;for(var f=0;f<s.length;f++)(0,s[f])(a)},function(f){for(c.status="rejected",c.reason=f,f=0;f<s.length;f++)(0,s[f])(void 0)}),c}var Cm=V.S;V.S=function(t,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&MT(t,a),Cm!==null&&Cm(t,a)};var Wi=Z(null);function Jl(){var t=Wi.current;return t!==null?t:Fe.pooledCache}function yo(t,a){a===null?ie(Wi,Wi.current):ie(Wi,a.pool)}function Em(){var t=Jl();return t===null?null:{parent:ct._currentValue,pool:t}}var Kr=Error(r(460)),Rm=Error(r(474)),bo=Error(r(542)),Wl={then:function(){}};function _m(t){return t=t.status,t==="fulfilled"||t==="rejected"}function So(){}function wm(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(So,So),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Am(t),t;default:if(typeof a.status=="string")a.then(So,So);else{if(t=Fe,t!==null&&100<t.shellSuspendCounter)throw Error(r(482));t=a,t.status="pending",t.then(function(c){if(a.status==="pending"){var f=a;f.status="fulfilled",f.value=c}},function(c){if(a.status==="pending"){var f=a;f.status="rejected",f.reason=c}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Am(t),t}throw Qr=a,Kr}}var Qr=null;function Om(){if(Qr===null)throw Error(r(459));var t=Qr;return Qr=null,t}function Am(t){if(t===Kr||t===bo)throw Error(r(483))}var oi=!1;function $l(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function eu(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ci(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function li(t,a,s){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,(Ie&2)!==0){var f=c.pending;return f===null?a.next=a:(a.next=f.next,f.next=a),c.pending=a,a=fo(t),pm(t,null,s),a}return uo(t,c,a,s),fo(t)}function Xr(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var c=a.lanes;c&=t.pendingLanes,s|=c,a.lanes=s,kh(t,s)}}function tu(t,a){var s=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var f=null,p=null;if(s=s.firstBaseUpdate,s!==null){do{var v={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};p===null?f=p=v:p=p.next=v,s=s.next}while(s!==null);p===null?f=p=a:p=p.next=a}else f=p=a;s={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:p,shared:c.shared,callbacks:c.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var nu=!1;function Zr(){if(nu){var t=ja;if(t!==null)throw t}}function Jr(t,a,s,c){nu=!1;var f=t.updateQueue;oi=!1;var p=f.firstBaseUpdate,v=f.lastBaseUpdate,S=f.shared.pending;if(S!==null){f.shared.pending=null;var R=S,U=R.next;R.next=null,v===null?p=U:v.next=U,v=R;var F=t.alternate;F!==null&&(F=F.updateQueue,S=F.lastBaseUpdate,S!==v&&(S===null?F.firstBaseUpdate=U:S.next=U,F.lastBaseUpdate=R))}if(p!==null){var K=f.baseState;v=0,F=U=R=null,S=p;do{var L=S.lane&-536870913,I=L!==S.lane;if(I?(Ee&L)===L:(c&L)===L){L!==0&&L===Ia&&(nu=!0),F!==null&&(F=F.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var pe=t,fe=S;L=a;var qe=s;switch(fe.tag){case 1:if(pe=fe.payload,typeof pe=="function"){K=pe.call(qe,K,L);break e}K=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=fe.payload,L=typeof pe=="function"?pe.call(qe,K,L):pe,L==null)break e;K=g({},K,L);break e;case 2:oi=!0}}L=S.callback,L!==null&&(t.flags|=64,I&&(t.flags|=8192),I=f.callbacks,I===null?f.callbacks=[L]:I.push(L))}else I={lane:L,tag:S.tag,payload:S.payload,callback:S.callback,next:null},F===null?(U=F=I,R=K):F=F.next=I,v|=L;if(S=S.next,S===null){if(S=f.shared.pending,S===null)break;I=S,S=I.next,I.next=null,f.lastBaseUpdate=I,f.shared.pending=null}}while(!0);F===null&&(R=K),f.baseState=R,f.firstBaseUpdate=U,f.lastBaseUpdate=F,p===null&&(f.shared.lanes=0),vi|=v,t.lanes=v,t.memoizedState=K}}function Dm(t,a){if(typeof t!="function")throw Error(r(191,t));t.call(a)}function Mm(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)Dm(s[t],a)}var Ba=Z(null),To=Z(0);function xm(t,a){t=Qn,ie(To,t),ie(Ba,a),Qn=t|a.baseLanes}function iu(){ie(To,Qn),ie(Ba,Ba.current)}function au(){Qn=To.current,ae(Ba),ae(To)}var ui=0,ve=null,Be=null,rt=null,ko=!1,za=!1,$i=!1,Co=0,Wr=0,qa=null,PT=0;function nt(){throw Error(r(321))}function ru(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!Bt(t[s],a[s]))return!1;return!0}function su(t,a,s,c,f,p){return ui=p,ve=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,V.H=t===null||t.memoizedState===null?pp:gp,$i=!1,p=s(c,f),$i=!1,za&&(p=Nm(a,s,c,f)),Pm(t),p}function Pm(t){V.H=Ao;var a=Be!==null&&Be.next!==null;if(ui=0,rt=Be=ve=null,ko=!1,Wr=0,qa=null,a)throw Error(r(300));t===null||ht||(t=t.dependencies,t!==null&&go(t)&&(ht=!0))}function Nm(t,a,s,c){ve=t;var f=0;do{if(za&&(qa=null),Wr=0,za=!1,25<=f)throw Error(r(301));if(f+=1,rt=Be=null,t.updateQueue!=null){var p=t.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}V.H=zT,p=a(s,c)}while(za);return p}function NT(){var t=V.H,a=t.useState()[0];return a=typeof a.then=="function"?$r(a):a,t=t.useState()[0],(Be!==null?Be.memoizedState:null)!==t&&(ve.flags|=1024),a}function ou(){var t=Co!==0;return Co=0,t}function cu(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function lu(t){if(ko){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}ko=!1}ui=0,rt=Be=ve=null,za=!1,Wr=Co=0,qa=null}function At(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rt===null?ve.memoizedState=rt=t:rt=rt.next=t,rt}function st(){if(Be===null){var t=ve.alternate;t=t!==null?t.memoizedState:null}else t=Be.next;var a=rt===null?ve.memoizedState:rt.next;if(a!==null)rt=a,Be=t;else{if(t===null)throw ve.alternate===null?Error(r(467)):Error(r(310));Be=t,t={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},rt===null?ve.memoizedState=rt=t:rt=rt.next=t}return rt}function uu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $r(t){var a=Wr;return Wr+=1,qa===null&&(qa=[]),t=wm(qa,t,a),a=ve,(rt===null?a.memoizedState:rt.next)===null&&(a=a.alternate,V.H=a===null||a.memoizedState===null?pp:gp),t}function Eo(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return $r(t);if(t.$$typeof===q)return Ct(t)}throw Error(r(438,String(t)))}function du(t){var a=null,s=ve.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var c=ve.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(a={data:c.data.map(function(f){return f.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=uu(),ve.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),c=0;c<t;c++)s[c]=se;return a.index++,s}function Vn(t,a){return typeof a=="function"?a(t):a}function Ro(t){var a=st();return fu(a,Be,t)}function fu(t,a,s){var c=t.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var f=t.baseQueue,p=c.pending;if(p!==null){if(f!==null){var v=f.next;f.next=p.next,p.next=v}a.baseQueue=f=p,c.pending=null}if(p=t.baseState,f===null)t.memoizedState=p;else{a=f.next;var S=v=null,R=null,U=a,F=!1;do{var K=U.lane&-536870913;if(K!==U.lane?(Ee&K)===K:(ui&K)===K){var L=U.revertLane;if(L===0)R!==null&&(R=R.next={lane:0,revertLane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),K===Ia&&(F=!0);else if((ui&L)===L){U=U.next,L===Ia&&(F=!0);continue}else K={lane:0,revertLane:U.revertLane,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null},R===null?(S=R=K,v=p):R=R.next=K,ve.lanes|=L,vi|=L;K=U.action,$i&&s(p,K),p=U.hasEagerState?U.eagerState:s(p,K)}else L={lane:K,revertLane:U.revertLane,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null},R===null?(S=R=L,v=p):R=R.next=L,ve.lanes|=K,vi|=K;U=U.next}while(U!==null&&U!==a);if(R===null?v=p:R.next=S,!Bt(p,t.memoizedState)&&(ht=!0,F&&(s=ja,s!==null)))throw s;t.memoizedState=p,t.baseState=v,t.baseQueue=R,c.lastRenderedState=p}return f===null&&(c.lanes=0),[t.memoizedState,c.dispatch]}function hu(t){var a=st(),s=a.queue;if(s===null)throw Error(r(311));s.lastRenderedReducer=t;var c=s.dispatch,f=s.pending,p=a.memoizedState;if(f!==null){s.pending=null;var v=f=f.next;do p=t(p,v.action),v=v.next;while(v!==f);Bt(p,a.memoizedState)||(ht=!0),a.memoizedState=p,a.baseQueue===null&&(a.baseState=p),s.lastRenderedState=p}return[p,c]}function Um(t,a,s){var c=ve,f=st(),p=Me;if(p){if(s===void 0)throw Error(r(407));s=s()}else s=a();var v=!Bt((Be||f).memoizedState,s);v&&(f.memoizedState=s,ht=!0),f=f.queue;var S=jm.bind(null,c,f,t);if(es(2048,8,S,[t]),f.getSnapshot!==a||v||rt!==null&&rt.memoizedState.tag&1){if(c.flags|=2048,Va(9,_o(),Im.bind(null,c,f,s,a),null),Fe===null)throw Error(r(349));p||(ui&124)!==0||Lm(c,a,s)}return s}function Lm(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=ve.updateQueue,a===null?(a=uu(),ve.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Im(t,a,s,c){a.value=s,a.getSnapshot=c,Bm(a)&&zm(t)}function jm(t,a,s){return s(function(){Bm(a)&&zm(t)})}function Bm(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!Bt(t,s)}catch{return!0}}function zm(t){var a=Pa(t,2);a!==null&&Ft(a,t,2)}function mu(t){var a=At();if(typeof t=="function"){var s=t;if(t=s(),$i){ii(!0);try{s()}finally{ii(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vn,lastRenderedState:t},a}function qm(t,a,s,c){return t.baseState=s,fu(t,Be,typeof c=="function"?c:Vn)}function UT(t,a,s,c,f){if(Oo(t))throw Error(r(485));if(t=a.action,t!==null){var p={payload:f,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){p.listeners.push(v)}};V.T!==null?s(!0):p.isTransition=!1,c(p),s=a.pending,s===null?(p.next=a.pending=p,Vm(a,p)):(p.next=s.next,a.pending=s.next=p)}}function Vm(t,a){var s=a.action,c=a.payload,f=t.state;if(a.isTransition){var p=V.T,v={};V.T=v;try{var S=s(f,c),R=V.S;R!==null&&R(v,S),Hm(t,a,S)}catch(U){pu(t,a,U)}finally{V.T=p}}else try{p=s(f,c),Hm(t,a,p)}catch(U){pu(t,a,U)}}function Hm(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(c){Gm(t,a,c)},function(c){return pu(t,a,c)}):Gm(t,a,s)}function Gm(t,a,s){a.status="fulfilled",a.value=s,Fm(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,Vm(t,s)))}function pu(t,a,s){var c=t.pending;if(t.pending=null,c!==null){c=c.next;do a.status="rejected",a.reason=s,Fm(a),a=a.next;while(a!==c)}t.action=null}function Fm(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function Ym(t,a){return a}function Km(t,a){if(Me){var s=Fe.formState;if(s!==null){e:{var c=ve;if(Me){if(Je){t:{for(var f=Je,p=Sn;f.nodeType!==8;){if(!p){f=null;break t}if(f=cn(f.nextSibling),f===null){f=null;break t}}p=f.data,f=p==="F!"||p==="F"?f:null}if(f){Je=cn(f.nextSibling),c=f.data==="F!";break e}}Xi(c)}c=!1}c&&(a=s[0])}}return s=At(),s.memoizedState=s.baseState=a,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ym,lastRenderedState:a},s.queue=c,s=fp.bind(null,ve,c),c.dispatch=s,c=mu(!1),p=Su.bind(null,ve,!1,c.queue),c=At(),f={state:a,dispatch:null,action:t,pending:null},c.queue=f,s=UT.bind(null,ve,f,p,s),f.dispatch=s,c.memoizedState=t,[a,s,!1]}function Qm(t){var a=st();return Xm(a,Be,t)}function Xm(t,a,s){if(a=fu(t,a,Ym)[0],t=Ro(Vn)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var c=$r(a)}catch(v){throw v===Kr?bo:v}else c=a;a=st();var f=a.queue,p=f.dispatch;return s!==a.memoizedState&&(ve.flags|=2048,Va(9,_o(),LT.bind(null,f,s),null)),[c,p,t]}function LT(t,a){t.action=a}function Zm(t){var a=st(),s=Be;if(s!==null)return Xm(a,s,t);st(),a=a.memoizedState,s=st();var c=s.queue.dispatch;return s.memoizedState=t,[a,c,!1]}function Va(t,a,s,c){return t={tag:t,create:s,deps:c,inst:a,next:null},a=ve.updateQueue,a===null&&(a=uu(),ve.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(c=s.next,s.next=t,t.next=c,a.lastEffect=t),t}function _o(){return{destroy:void 0,resource:void 0}}function Jm(){return st().memoizedState}function wo(t,a,s,c){var f=At();c=c===void 0?null:c,ve.flags|=t,f.memoizedState=Va(1|a,_o(),s,c)}function es(t,a,s,c){var f=st();c=c===void 0?null:c;var p=f.memoizedState.inst;Be!==null&&c!==null&&ru(c,Be.memoizedState.deps)?f.memoizedState=Va(a,p,s,c):(ve.flags|=t,f.memoizedState=Va(1|a,p,s,c))}function Wm(t,a){wo(8390656,8,t,a)}function $m(t,a){es(2048,8,t,a)}function ep(t,a){return es(4,2,t,a)}function tp(t,a){return es(4,4,t,a)}function np(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function ip(t,a,s){s=s!=null?s.concat([t]):null,es(4,4,np.bind(null,a,t),s)}function gu(){}function ap(t,a){var s=st();a=a===void 0?null:a;var c=s.memoizedState;return a!==null&&ru(a,c[1])?c[0]:(s.memoizedState=[t,a],t)}function rp(t,a){var s=st();a=a===void 0?null:a;var c=s.memoizedState;if(a!==null&&ru(a,c[1]))return c[0];if(c=t(),$i){ii(!0);try{t()}finally{ii(!1)}}return s.memoizedState=[c,a],c}function vu(t,a,s){return s===void 0||(ui&1073741824)!==0?t.memoizedState=a:(t.memoizedState=s,t=cg(),ve.lanes|=t,vi|=t,s)}function sp(t,a,s,c){return Bt(s,a)?s:Ba.current!==null?(t=vu(t,s,c),Bt(t,a)||(ht=!0),t):(ui&42)===0?(ht=!0,t.memoizedState=s):(t=cg(),ve.lanes|=t,vi|=t,a)}function op(t,a,s,c,f){var p=ee.p;ee.p=p!==0&&8>p?p:8;var v=V.T,S={};V.T=S,Su(t,!1,a,s);try{var R=f(),U=V.S;if(U!==null&&U(S,R),R!==null&&typeof R=="object"&&typeof R.then=="function"){var F=xT(R,c);ts(t,a,F,Gt(t))}else ts(t,a,c,Gt(t))}catch(K){ts(t,a,{then:function(){},status:"rejected",reason:K},Gt())}finally{ee.p=p,V.T=v}}function IT(){}function yu(t,a,s,c){if(t.tag!==5)throw Error(r(476));var f=cp(t).queue;op(t,f,a,le,s===null?IT:function(){return lp(t),s(c)})}function cp(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vn,lastRenderedState:le},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vn,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function lp(t){var a=cp(t).next.queue;ts(t,a,{},Gt())}function bu(){return Ct(bs)}function up(){return st().memoizedState}function dp(){return st().memoizedState}function jT(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=Gt();t=ci(s);var c=li(a,t,s);c!==null&&(Ft(c,a,s),Xr(c,a,s)),a={cache:Xl()},t.payload=a;return}a=a.return}}function BT(t,a,s){var c=Gt();s={lane:c,revertLane:0,action:s,hasEagerState:!1,eagerState:null,next:null},Oo(t)?hp(a,s):(s=Bl(t,a,s,c),s!==null&&(Ft(s,t,c),mp(s,a,c)))}function fp(t,a,s){var c=Gt();ts(t,a,s,c)}function ts(t,a,s,c){var f={lane:c,revertLane:0,action:s,hasEagerState:!1,eagerState:null,next:null};if(Oo(t))hp(a,f);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=a.lastRenderedReducer,p!==null))try{var v=a.lastRenderedState,S=p(v,s);if(f.hasEagerState=!0,f.eagerState=S,Bt(S,v))return uo(t,a,f,0),Fe===null&&lo(),!1}catch{}finally{}if(s=Bl(t,a,f,c),s!==null)return Ft(s,t,c),mp(s,a,c),!0}return!1}function Su(t,a,s,c){if(c={lane:2,revertLane:Wu(),action:c,hasEagerState:!1,eagerState:null,next:null},Oo(t)){if(a)throw Error(r(479))}else a=Bl(t,s,c,2),a!==null&&Ft(a,t,2)}function Oo(t){var a=t.alternate;return t===ve||a!==null&&a===ve}function hp(t,a){za=ko=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function mp(t,a,s){if((s&4194048)!==0){var c=a.lanes;c&=t.pendingLanes,s|=c,a.lanes=s,kh(t,s)}}var Ao={readContext:Ct,use:Eo,useCallback:nt,useContext:nt,useEffect:nt,useImperativeHandle:nt,useLayoutEffect:nt,useInsertionEffect:nt,useMemo:nt,useReducer:nt,useRef:nt,useState:nt,useDebugValue:nt,useDeferredValue:nt,useTransition:nt,useSyncExternalStore:nt,useId:nt,useHostTransitionStatus:nt,useFormState:nt,useActionState:nt,useOptimistic:nt,useMemoCache:nt,useCacheRefresh:nt},pp={readContext:Ct,use:Eo,useCallback:function(t,a){return At().memoizedState=[t,a===void 0?null:a],t},useContext:Ct,useEffect:Wm,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,wo(4194308,4,np.bind(null,a,t),s)},useLayoutEffect:function(t,a){return wo(4194308,4,t,a)},useInsertionEffect:function(t,a){wo(4,2,t,a)},useMemo:function(t,a){var s=At();a=a===void 0?null:a;var c=t();if($i){ii(!0);try{t()}finally{ii(!1)}}return s.memoizedState=[c,a],c},useReducer:function(t,a,s){var c=At();if(s!==void 0){var f=s(a);if($i){ii(!0);try{s(a)}finally{ii(!1)}}}else f=a;return c.memoizedState=c.baseState=f,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:f},c.queue=t,t=t.dispatch=BT.bind(null,ve,t),[c.memoizedState,t]},useRef:function(t){var a=At();return t={current:t},a.memoizedState=t},useState:function(t){t=mu(t);var a=t.queue,s=fp.bind(null,ve,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:gu,useDeferredValue:function(t,a){var s=At();return vu(s,t,a)},useTransition:function(){var t=mu(!1);return t=op.bind(null,ve,t.queue,!0,!1),At().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var c=ve,f=At();if(Me){if(s===void 0)throw Error(r(407));s=s()}else{if(s=a(),Fe===null)throw Error(r(349));(Ee&124)!==0||Lm(c,a,s)}f.memoizedState=s;var p={value:s,getSnapshot:a};return f.queue=p,Wm(jm.bind(null,c,p,t),[t]),c.flags|=2048,Va(9,_o(),Im.bind(null,c,p,s,a),null),s},useId:function(){var t=At(),a=Fe.identifierPrefix;if(Me){var s=Bn,c=jn;s=(c&~(1<<32-jt(c)-1)).toString(32)+s,a="«"+a+"R"+s,s=Co++,0<s&&(a+="H"+s.toString(32)),a+="»"}else s=PT++,a="«"+a+"r"+s.toString(32)+"»";return t.memoizedState=a},useHostTransitionStatus:bu,useFormState:Km,useActionState:Km,useOptimistic:function(t){var a=At();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=Su.bind(null,ve,!0,s),s.dispatch=a,[t,a]},useMemoCache:du,useCacheRefresh:function(){return At().memoizedState=jT.bind(null,ve)}},gp={readContext:Ct,use:Eo,useCallback:ap,useContext:Ct,useEffect:$m,useImperativeHandle:ip,useInsertionEffect:ep,useLayoutEffect:tp,useMemo:rp,useReducer:Ro,useRef:Jm,useState:function(){return Ro(Vn)},useDebugValue:gu,useDeferredValue:function(t,a){var s=st();return sp(s,Be.memoizedState,t,a)},useTransition:function(){var t=Ro(Vn)[0],a=st().memoizedState;return[typeof t=="boolean"?t:$r(t),a]},useSyncExternalStore:Um,useId:up,useHostTransitionStatus:bu,useFormState:Qm,useActionState:Qm,useOptimistic:function(t,a){var s=st();return qm(s,Be,t,a)},useMemoCache:du,useCacheRefresh:dp},zT={readContext:Ct,use:Eo,useCallback:ap,useContext:Ct,useEffect:$m,useImperativeHandle:ip,useInsertionEffect:ep,useLayoutEffect:tp,useMemo:rp,useReducer:hu,useRef:Jm,useState:function(){return hu(Vn)},useDebugValue:gu,useDeferredValue:function(t,a){var s=st();return Be===null?vu(s,t,a):sp(s,Be.memoizedState,t,a)},useTransition:function(){var t=hu(Vn)[0],a=st().memoizedState;return[typeof t=="boolean"?t:$r(t),a]},useSyncExternalStore:Um,useId:up,useHostTransitionStatus:bu,useFormState:Zm,useActionState:Zm,useOptimistic:function(t,a){var s=st();return Be!==null?qm(s,Be,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:du,useCacheRefresh:dp},Ha=null,ns=0;function Do(t){var a=ns;return ns+=1,Ha===null&&(Ha=[]),wm(Ha,t,a)}function is(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Mo(t,a){throw a.$$typeof===y?Error(r(525)):(t=Object.prototype.toString.call(a),Error(r(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function vp(t){var a=t._init;return a(t._payload)}function yp(t){function a(x,D){if(t){var N=x.deletions;N===null?(x.deletions=[D],x.flags|=16):N.push(D)}}function s(x,D){if(!t)return null;for(;D!==null;)a(x,D),D=D.sibling;return null}function c(x){for(var D=new Map;x!==null;)x.key!==null?D.set(x.key,x):D.set(x.index,x),x=x.sibling;return D}function f(x,D){return x=In(x,D),x.index=0,x.sibling=null,x}function p(x,D,N){return x.index=N,t?(N=x.alternate,N!==null?(N=N.index,N<D?(x.flags|=67108866,D):N):(x.flags|=67108866,D)):(x.flags|=1048576,D)}function v(x){return t&&x.alternate===null&&(x.flags|=67108866),x}function S(x,D,N,Y){return D===null||D.tag!==6?(D=ql(N,x.mode,Y),D.return=x,D):(D=f(D,N),D.return=x,D)}function R(x,D,N,Y){var ce=N.type;return ce===C?F(x,D,N.props.children,Y,N.key):D!==null&&(D.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===ne&&vp(ce)===D.type)?(D=f(D,N.props),is(D,N),D.return=x,D):(D=ho(N.type,N.key,N.props,null,x.mode,Y),is(D,N),D.return=x,D)}function U(x,D,N,Y){return D===null||D.tag!==4||D.stateNode.containerInfo!==N.containerInfo||D.stateNode.implementation!==N.implementation?(D=Vl(N,x.mode,Y),D.return=x,D):(D=f(D,N.children||[]),D.return=x,D)}function F(x,D,N,Y,ce){return D===null||D.tag!==7?(D=Fi(N,x.mode,Y,ce),D.return=x,D):(D=f(D,N),D.return=x,D)}function K(x,D,N){if(typeof D=="string"&&D!==""||typeof D=="number"||typeof D=="bigint")return D=ql(""+D,x.mode,N),D.return=x,D;if(typeof D=="object"&&D!==null){switch(D.$$typeof){case b:return N=ho(D.type,D.key,D.props,null,x.mode,N),is(N,D),N.return=x,N;case T:return D=Vl(D,x.mode,N),D.return=x,D;case ne:var Y=D._init;return D=Y(D._payload),K(x,D,N)}if(Ke(D)||re(D))return D=Fi(D,x.mode,N,null),D.return=x,D;if(typeof D.then=="function")return K(x,Do(D),N);if(D.$$typeof===q)return K(x,vo(x,D),N);Mo(x,D)}return null}function L(x,D,N,Y){var ce=D!==null?D.key:null;if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return ce!==null?null:S(x,D,""+N,Y);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case b:return N.key===ce?R(x,D,N,Y):null;case T:return N.key===ce?U(x,D,N,Y):null;case ne:return ce=N._init,N=ce(N._payload),L(x,D,N,Y)}if(Ke(N)||re(N))return ce!==null?null:F(x,D,N,Y,null);if(typeof N.then=="function")return L(x,D,Do(N),Y);if(N.$$typeof===q)return L(x,D,vo(x,N),Y);Mo(x,N)}return null}function I(x,D,N,Y,ce){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return x=x.get(N)||null,S(D,x,""+Y,ce);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case b:return x=x.get(Y.key===null?N:Y.key)||null,R(D,x,Y,ce);case T:return x=x.get(Y.key===null?N:Y.key)||null,U(D,x,Y,ce);case ne:var be=Y._init;return Y=be(Y._payload),I(x,D,N,Y,ce)}if(Ke(Y)||re(Y))return x=x.get(N)||null,F(D,x,Y,ce,null);if(typeof Y.then=="function")return I(x,D,N,Do(Y),ce);if(Y.$$typeof===q)return I(x,D,N,vo(D,Y),ce);Mo(D,Y)}return null}function pe(x,D,N,Y){for(var ce=null,be=null,ue=D,he=D=0,pt=null;ue!==null&&he<N.length;he++){ue.index>he?(pt=ue,ue=null):pt=ue.sibling;var De=L(x,ue,N[he],Y);if(De===null){ue===null&&(ue=pt);break}t&&ue&&De.alternate===null&&a(x,ue),D=p(De,D,he),be===null?ce=De:be.sibling=De,be=De,ue=pt}if(he===N.length)return s(x,ue),Me&&Ki(x,he),ce;if(ue===null){for(;he<N.length;he++)ue=K(x,N[he],Y),ue!==null&&(D=p(ue,D,he),be===null?ce=ue:be.sibling=ue,be=ue);return Me&&Ki(x,he),ce}for(ue=c(ue);he<N.length;he++)pt=I(ue,x,he,N[he],Y),pt!==null&&(t&&pt.alternate!==null&&ue.delete(pt.key===null?he:pt.key),D=p(pt,D,he),be===null?ce=pt:be.sibling=pt,be=pt);return t&&ue.forEach(function(_i){return a(x,_i)}),Me&&Ki(x,he),ce}function fe(x,D,N,Y){if(N==null)throw Error(r(151));for(var ce=null,be=null,ue=D,he=D=0,pt=null,De=N.next();ue!==null&&!De.done;he++,De=N.next()){ue.index>he?(pt=ue,ue=null):pt=ue.sibling;var _i=L(x,ue,De.value,Y);if(_i===null){ue===null&&(ue=pt);break}t&&ue&&_i.alternate===null&&a(x,ue),D=p(_i,D,he),be===null?ce=_i:be.sibling=_i,be=_i,ue=pt}if(De.done)return s(x,ue),Me&&Ki(x,he),ce;if(ue===null){for(;!De.done;he++,De=N.next())De=K(x,De.value,Y),De!==null&&(D=p(De,D,he),be===null?ce=De:be.sibling=De,be=De);return Me&&Ki(x,he),ce}for(ue=c(ue);!De.done;he++,De=N.next())De=I(ue,x,he,De.value,Y),De!==null&&(t&&De.alternate!==null&&ue.delete(De.key===null?he:De.key),D=p(De,D,he),be===null?ce=De:be.sibling=De,be=De);return t&&ue.forEach(function(qk){return a(x,qk)}),Me&&Ki(x,he),ce}function qe(x,D,N,Y){if(typeof N=="object"&&N!==null&&N.type===C&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case b:e:{for(var ce=N.key;D!==null;){if(D.key===ce){if(ce=N.type,ce===C){if(D.tag===7){s(x,D.sibling),Y=f(D,N.props.children),Y.return=x,x=Y;break e}}else if(D.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===ne&&vp(ce)===D.type){s(x,D.sibling),Y=f(D,N.props),is(Y,N),Y.return=x,x=Y;break e}s(x,D);break}else a(x,D);D=D.sibling}N.type===C?(Y=Fi(N.props.children,x.mode,Y,N.key),Y.return=x,x=Y):(Y=ho(N.type,N.key,N.props,null,x.mode,Y),is(Y,N),Y.return=x,x=Y)}return v(x);case T:e:{for(ce=N.key;D!==null;){if(D.key===ce)if(D.tag===4&&D.stateNode.containerInfo===N.containerInfo&&D.stateNode.implementation===N.implementation){s(x,D.sibling),Y=f(D,N.children||[]),Y.return=x,x=Y;break e}else{s(x,D);break}else a(x,D);D=D.sibling}Y=Vl(N,x.mode,Y),Y.return=x,x=Y}return v(x);case ne:return ce=N._init,N=ce(N._payload),qe(x,D,N,Y)}if(Ke(N))return pe(x,D,N,Y);if(re(N)){if(ce=re(N),typeof ce!="function")throw Error(r(150));return N=ce.call(N),fe(x,D,N,Y)}if(typeof N.then=="function")return qe(x,D,Do(N),Y);if(N.$$typeof===q)return qe(x,D,vo(x,N),Y);Mo(x,N)}return typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint"?(N=""+N,D!==null&&D.tag===6?(s(x,D.sibling),Y=f(D,N),Y.return=x,x=Y):(s(x,D),Y=ql(N,x.mode,Y),Y.return=x,x=Y),v(x)):s(x,D)}return function(x,D,N,Y){try{ns=0;var ce=qe(x,D,N,Y);return Ha=null,ce}catch(ue){if(ue===Kr||ue===bo)throw ue;var be=zt(29,ue,null,x.mode);return be.lanes=Y,be.return=x,be}finally{}}}var Ga=yp(!0),bp=yp(!1),tn=Z(null),Tn=null;function di(t){var a=t.alternate;ie(lt,lt.current&1),ie(tn,t),Tn===null&&(a===null||Ba.current!==null||a.memoizedState!==null)&&(Tn=t)}function Sp(t){if(t.tag===22){if(ie(lt,lt.current),ie(tn,t),Tn===null){var a=t.alternate;a!==null&&a.memoizedState!==null&&(Tn=t)}}else fi()}function fi(){ie(lt,lt.current),ie(tn,tn.current)}function Hn(t){ae(tn),Tn===t&&(Tn=null),ae(lt)}var lt=Z(0);function xo(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||ud(s)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function Tu(t,a,s,c){a=t.memoizedState,s=s(c,a),s=s==null?a:g({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var ku={enqueueSetState:function(t,a,s){t=t._reactInternals;var c=Gt(),f=ci(c);f.payload=a,s!=null&&(f.callback=s),a=li(t,f,c),a!==null&&(Ft(a,t,c),Xr(a,t,c))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var c=Gt(),f=ci(c);f.tag=1,f.payload=a,s!=null&&(f.callback=s),a=li(t,f,c),a!==null&&(Ft(a,t,c),Xr(a,t,c))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=Gt(),c=ci(s);c.tag=2,a!=null&&(c.callback=a),a=li(t,c,s),a!==null&&(Ft(a,t,s),Xr(a,t,s))}};function Tp(t,a,s,c,f,p,v){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,p,v):a.prototype&&a.prototype.isPureReactComponent?!Br(s,c)||!Br(f,p):!0}function kp(t,a,s,c){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,c),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,c),a.state!==t&&ku.enqueueReplaceState(a,a.state,null)}function ea(t,a){var s=a;if("ref"in a){s={};for(var c in a)c!=="ref"&&(s[c]=a[c])}if(t=t.defaultProps){s===a&&(s=g({},s));for(var f in t)s[f]===void 0&&(s[f]=t[f])}return s}var Po=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Cp(t){Po(t)}function Ep(t){console.error(t)}function Rp(t){Po(t)}function No(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(c){setTimeout(function(){throw c})}}function _p(t,a,s){try{var c=t.onCaughtError;c(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(f){setTimeout(function(){throw f})}}function Cu(t,a,s){return s=ci(s),s.tag=3,s.payload={element:null},s.callback=function(){No(t,a)},s}function wp(t){return t=ci(t),t.tag=3,t}function Op(t,a,s,c){var f=s.type.getDerivedStateFromError;if(typeof f=="function"){var p=c.value;t.payload=function(){return f(p)},t.callback=function(){_p(a,s,c)}}var v=s.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(t.callback=function(){_p(a,s,c),typeof f!="function"&&(yi===null?yi=new Set([this]):yi.add(this));var S=c.stack;this.componentDidCatch(c.value,{componentStack:S!==null?S:""})})}function qT(t,a,s,c,f){if(s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(a=s.alternate,a!==null&&Gr(a,s,f,!0),s=tn.current,s!==null){switch(s.tag){case 13:return Tn===null?Ku():s.alternate===null&&We===0&&(We=3),s.flags&=-257,s.flags|=65536,s.lanes=f,c===Wl?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([c]):a.add(c),Xu(t,c,f)),!1;case 22:return s.flags|=65536,c===Wl?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([c])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([c]):s.add(c)),Xu(t,c,f)),!1}throw Error(r(435,s.tag))}return Xu(t,c,f),Ku(),!1}if(Me)return a=tn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=f,c!==Fl&&(t=Error(r(422),{cause:c}),Hr(Jt(t,s)))):(c!==Fl&&(a=Error(r(423),{cause:c}),Hr(Jt(a,s))),t=t.current.alternate,t.flags|=65536,f&=-f,t.lanes|=f,c=Jt(c,s),f=Cu(t.stateNode,c,f),tu(t,f),We!==4&&(We=2)),!1;var p=Error(r(520),{cause:c});if(p=Jt(p,s),us===null?us=[p]:us.push(p),We!==4&&(We=2),a===null)return!0;c=Jt(c,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=f&-f,s.lanes|=t,t=Cu(s.stateNode,c,t),tu(s,t),!1;case 1:if(a=s.type,p=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(yi===null||!yi.has(p))))return s.flags|=65536,f&=-f,s.lanes|=f,f=wp(f),Op(f,t,s,c),tu(s,f),!1}s=s.return}while(s!==null);return!1}var Ap=Error(r(461)),ht=!1;function yt(t,a,s,c){a.child=t===null?bp(a,null,s,c):Ga(a,t.child,s,c)}function Dp(t,a,s,c,f){s=s.render;var p=a.ref;if("ref"in c){var v={};for(var S in c)S!=="ref"&&(v[S]=c[S])}else v=c;return Ji(a),c=su(t,a,s,v,p,f),S=ou(),t!==null&&!ht?(cu(t,a,f),Gn(t,a,f)):(Me&&S&&Hl(a),a.flags|=1,yt(t,a,c,f),a.child)}function Mp(t,a,s,c,f){if(t===null){var p=s.type;return typeof p=="function"&&!zl(p)&&p.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=p,xp(t,a,p,c,f)):(t=ho(s.type,null,c,a,a.mode,f),t.ref=a.ref,t.return=a,a.child=t)}if(p=t.child,!Mu(t,f)){var v=p.memoizedProps;if(s=s.compare,s=s!==null?s:Br,s(v,c)&&t.ref===a.ref)return Gn(t,a,f)}return a.flags|=1,t=In(p,c),t.ref=a.ref,t.return=a,a.child=t}function xp(t,a,s,c,f){if(t!==null){var p=t.memoizedProps;if(Br(p,c)&&t.ref===a.ref)if(ht=!1,a.pendingProps=c=p,Mu(t,f))(t.flags&131072)!==0&&(ht=!0);else return a.lanes=t.lanes,Gn(t,a,f)}return Eu(t,a,s,c,f)}function Pp(t,a,s){var c=a.pendingProps,f=c.children,p=t!==null?t.memoizedState:null;if(c.mode==="hidden"){if((a.flags&128)!==0){if(c=p!==null?p.baseLanes|s:s,t!==null){for(f=a.child=t.child,p=0;f!==null;)p=p|f.lanes|f.childLanes,f=f.sibling;a.childLanes=p&~c}else a.childLanes=0,a.child=null;return Np(t,a,c,s)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&yo(a,p!==null?p.cachePool:null),p!==null?xm(a,p):iu(),Sp(a);else return a.lanes=a.childLanes=536870912,Np(t,a,p!==null?p.baseLanes|s:s,s)}else p!==null?(yo(a,p.cachePool),xm(a,p),fi(),a.memoizedState=null):(t!==null&&yo(a,null),iu(),fi());return yt(t,a,f,s),a.child}function Np(t,a,s,c){var f=Jl();return f=f===null?null:{parent:ct._currentValue,pool:f},a.memoizedState={baseLanes:s,cachePool:f},t!==null&&yo(a,null),iu(),Sp(a),t!==null&&Gr(t,a,c,!0),null}function Uo(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(r(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function Eu(t,a,s,c,f){return Ji(a),s=su(t,a,s,c,void 0,f),c=ou(),t!==null&&!ht?(cu(t,a,f),Gn(t,a,f)):(Me&&c&&Hl(a),a.flags|=1,yt(t,a,s,f),a.child)}function Up(t,a,s,c,f,p){return Ji(a),a.updateQueue=null,s=Nm(a,c,s,f),Pm(t),c=ou(),t!==null&&!ht?(cu(t,a,p),Gn(t,a,p)):(Me&&c&&Hl(a),a.flags|=1,yt(t,a,s,p),a.child)}function Lp(t,a,s,c,f){if(Ji(a),a.stateNode===null){var p=Na,v=s.contextType;typeof v=="object"&&v!==null&&(p=Ct(v)),p=new s(c,p),a.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=ku,a.stateNode=p,p._reactInternals=a,p=a.stateNode,p.props=c,p.state=a.memoizedState,p.refs={},$l(a),v=s.contextType,p.context=typeof v=="object"&&v!==null?Ct(v):Na,p.state=a.memoizedState,v=s.getDerivedStateFromProps,typeof v=="function"&&(Tu(a,s,v,c),p.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(v=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),v!==p.state&&ku.enqueueReplaceState(p,p.state,null),Jr(a,c,p,f),Zr(),p.state=a.memoizedState),typeof p.componentDidMount=="function"&&(a.flags|=4194308),c=!0}else if(t===null){p=a.stateNode;var S=a.memoizedProps,R=ea(s,S);p.props=R;var U=p.context,F=s.contextType;v=Na,typeof F=="object"&&F!==null&&(v=Ct(F));var K=s.getDerivedStateFromProps;F=typeof K=="function"||typeof p.getSnapshotBeforeUpdate=="function",S=a.pendingProps!==S,F||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(S||U!==v)&&kp(a,p,c,v),oi=!1;var L=a.memoizedState;p.state=L,Jr(a,c,p,f),Zr(),U=a.memoizedState,S||L!==U||oi?(typeof K=="function"&&(Tu(a,s,K,c),U=a.memoizedState),(R=oi||Tp(a,s,R,c,L,U,v))?(F||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(a.flags|=4194308)):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=c,a.memoizedState=U),p.props=c,p.state=U,p.context=v,c=R):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),c=!1)}else{p=a.stateNode,eu(t,a),v=a.memoizedProps,F=ea(s,v),p.props=F,K=a.pendingProps,L=p.context,U=s.contextType,R=Na,typeof U=="object"&&U!==null&&(R=Ct(U)),S=s.getDerivedStateFromProps,(U=typeof S=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(v!==K||L!==R)&&kp(a,p,c,R),oi=!1,L=a.memoizedState,p.state=L,Jr(a,c,p,f),Zr();var I=a.memoizedState;v!==K||L!==I||oi||t!==null&&t.dependencies!==null&&go(t.dependencies)?(typeof S=="function"&&(Tu(a,s,S,c),I=a.memoizedState),(F=oi||Tp(a,s,F,c,L,I,R)||t!==null&&t.dependencies!==null&&go(t.dependencies))?(U||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(c,I,R),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(c,I,R)),typeof p.componentDidUpdate=="function"&&(a.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof p.componentDidUpdate!="function"||v===t.memoizedProps&&L===t.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||v===t.memoizedProps&&L===t.memoizedState||(a.flags|=1024),a.memoizedProps=c,a.memoizedState=I),p.props=c,p.state=I,p.context=R,c=F):(typeof p.componentDidUpdate!="function"||v===t.memoizedProps&&L===t.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||v===t.memoizedProps&&L===t.memoizedState||(a.flags|=1024),c=!1)}return p=c,Uo(t,a),c=(a.flags&128)!==0,p||c?(p=a.stateNode,s=c&&typeof s.getDerivedStateFromError!="function"?null:p.render(),a.flags|=1,t!==null&&c?(a.child=Ga(a,t.child,null,f),a.child=Ga(a,null,s,f)):yt(t,a,s,f),a.memoizedState=p.state,t=a.child):t=Gn(t,a,f),t}function Ip(t,a,s,c){return Vr(),a.flags|=256,yt(t,a,s,c),a.child}var Ru={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _u(t){return{baseLanes:t,cachePool:Em()}}function wu(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=nn),t}function jp(t,a,s){var c=a.pendingProps,f=!1,p=(a.flags&128)!==0,v;if((v=p)||(v=t!==null&&t.memoizedState===null?!1:(lt.current&2)!==0),v&&(f=!0,a.flags&=-129),v=(a.flags&32)!==0,a.flags&=-33,t===null){if(Me){if(f?di(a):fi(),Me){var S=Je,R;if(R=S){e:{for(R=S,S=Sn;R.nodeType!==8;){if(!S){S=null;break e}if(R=cn(R.nextSibling),R===null){S=null;break e}}S=R}S!==null?(a.memoizedState={dehydrated:S,treeContext:Yi!==null?{id:jn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},R=zt(18,null,null,0),R.stateNode=S,R.return=a,a.child=R,Rt=a,Je=null,R=!0):R=!1}R||Xi(a)}if(S=a.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return ud(S)?a.lanes=32:a.lanes=536870912,null;Hn(a)}return S=c.children,c=c.fallback,f?(fi(),f=a.mode,S=Lo({mode:"hidden",children:S},f),c=Fi(c,f,s,null),S.return=a,c.return=a,S.sibling=c,a.child=S,f=a.child,f.memoizedState=_u(s),f.childLanes=wu(t,v,s),a.memoizedState=Ru,c):(di(a),Ou(a,S))}if(R=t.memoizedState,R!==null&&(S=R.dehydrated,S!==null)){if(p)a.flags&256?(di(a),a.flags&=-257,a=Au(t,a,s)):a.memoizedState!==null?(fi(),a.child=t.child,a.flags|=128,a=null):(fi(),f=c.fallback,S=a.mode,c=Lo({mode:"visible",children:c.children},S),f=Fi(f,S,s,null),f.flags|=2,c.return=a,f.return=a,c.sibling=f,a.child=c,Ga(a,t.child,null,s),c=a.child,c.memoizedState=_u(s),c.childLanes=wu(t,v,s),a.memoizedState=Ru,a=f);else if(di(a),ud(S)){if(v=S.nextSibling&&S.nextSibling.dataset,v)var U=v.dgst;v=U,c=Error(r(419)),c.stack="",c.digest=v,Hr({value:c,source:null,stack:null}),a=Au(t,a,s)}else if(ht||Gr(t,a,s,!1),v=(s&t.childLanes)!==0,ht||v){if(v=Fe,v!==null&&(c=s&-s,c=(c&42)!==0?1:dl(c),c=(c&(v.suspendedLanes|s))!==0?0:c,c!==0&&c!==R.retryLane))throw R.retryLane=c,Pa(t,c),Ft(v,t,c),Ap;S.data==="$?"||Ku(),a=Au(t,a,s)}else S.data==="$?"?(a.flags|=192,a.child=t.child,a=null):(t=R.treeContext,Je=cn(S.nextSibling),Rt=a,Me=!0,Qi=null,Sn=!1,t!==null&&($t[en++]=jn,$t[en++]=Bn,$t[en++]=Yi,jn=t.id,Bn=t.overflow,Yi=a),a=Ou(a,c.children),a.flags|=4096);return a}return f?(fi(),f=c.fallback,S=a.mode,R=t.child,U=R.sibling,c=In(R,{mode:"hidden",children:c.children}),c.subtreeFlags=R.subtreeFlags&65011712,U!==null?f=In(U,f):(f=Fi(f,S,s,null),f.flags|=2),f.return=a,c.return=a,c.sibling=f,a.child=c,c=f,f=a.child,S=t.child.memoizedState,S===null?S=_u(s):(R=S.cachePool,R!==null?(U=ct._currentValue,R=R.parent!==U?{parent:U,pool:U}:R):R=Em(),S={baseLanes:S.baseLanes|s,cachePool:R}),f.memoizedState=S,f.childLanes=wu(t,v,s),a.memoizedState=Ru,c):(di(a),s=t.child,t=s.sibling,s=In(s,{mode:"visible",children:c.children}),s.return=a,s.sibling=null,t!==null&&(v=a.deletions,v===null?(a.deletions=[t],a.flags|=16):v.push(t)),a.child=s,a.memoizedState=null,s)}function Ou(t,a){return a=Lo({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function Lo(t,a){return t=zt(22,t,null,a),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Au(t,a,s){return Ga(a,t.child,null,s),t=Ou(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function Bp(t,a,s){t.lanes|=a;var c=t.alternate;c!==null&&(c.lanes|=a),Kl(t.return,a,s)}function Du(t,a,s,c,f){var p=t.memoizedState;p===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:f}:(p.isBackwards=a,p.rendering=null,p.renderingStartTime=0,p.last=c,p.tail=s,p.tailMode=f)}function zp(t,a,s){var c=a.pendingProps,f=c.revealOrder,p=c.tail;if(yt(t,a,c.children,s),c=lt.current,(c&2)!==0)c=c&1|2,a.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Bp(t,s,a);else if(t.tag===19)Bp(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}switch(ie(lt,c),f){case"forwards":for(s=a.child,f=null;s!==null;)t=s.alternate,t!==null&&xo(t)===null&&(f=s),s=s.sibling;s=f,s===null?(f=a.child,a.child=null):(f=s.sibling,s.sibling=null),Du(a,!1,f,s,p);break;case"backwards":for(s=null,f=a.child,a.child=null;f!==null;){if(t=f.alternate,t!==null&&xo(t)===null){a.child=f;break}t=f.sibling,f.sibling=s,s=f,f=t}Du(a,!0,s,null,p);break;case"together":Du(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Gn(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),vi|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(Gr(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(r(153));if(a.child!==null){for(t=a.child,s=In(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=In(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function Mu(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&go(t)))}function VT(t,a,s){switch(a.tag){case 3:Oe(a,a.stateNode.containerInfo),si(a,ct,t.memoizedState.cache),Vr();break;case 27:case 5:ya(a);break;case 4:Oe(a,a.stateNode.containerInfo);break;case 10:si(a,a.type,a.memoizedProps.value);break;case 13:var c=a.memoizedState;if(c!==null)return c.dehydrated!==null?(di(a),a.flags|=128,null):(s&a.child.childLanes)!==0?jp(t,a,s):(di(a),t=Gn(t,a,s),t!==null?t.sibling:null);di(a);break;case 19:var f=(t.flags&128)!==0;if(c=(s&a.childLanes)!==0,c||(Gr(t,a,s,!1),c=(s&a.childLanes)!==0),f){if(c)return zp(t,a,s);a.flags|=128}if(f=a.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),ie(lt,lt.current),c)break;return null;case 22:case 23:return a.lanes=0,Pp(t,a,s);case 24:si(a,ct,t.memoizedState.cache)}return Gn(t,a,s)}function qp(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)ht=!0;else{if(!Mu(t,s)&&(a.flags&128)===0)return ht=!1,VT(t,a,s);ht=(t.flags&131072)!==0}else ht=!1,Me&&(a.flags&1048576)!==0&&vm(a,po,a.index);switch(a.lanes=0,a.tag){case 16:e:{t=a.pendingProps;var c=a.elementType,f=c._init;if(c=f(c._payload),a.type=c,typeof c=="function")zl(c)?(t=ea(c,t),a.tag=1,a=Lp(null,a,c,t,s)):(a.tag=0,a=Eu(null,a,c,t,s));else{if(c!=null){if(f=c.$$typeof,f===P){a.tag=11,a=Dp(null,a,c,t,s);break e}else if(f===J){a.tag=14,a=Mp(null,a,c,t,s);break e}}throw a=Le(c)||c,Error(r(306,a,""))}}return a;case 0:return Eu(t,a,a.type,a.pendingProps,s);case 1:return c=a.type,f=ea(c,a.pendingProps),Lp(t,a,c,f,s);case 3:e:{if(Oe(a,a.stateNode.containerInfo),t===null)throw Error(r(387));c=a.pendingProps;var p=a.memoizedState;f=p.element,eu(t,a),Jr(a,c,null,s);var v=a.memoizedState;if(c=v.cache,si(a,ct,c),c!==p.cache&&Ql(a,[ct],s,!0),Zr(),c=v.element,p.isDehydrated)if(p={element:c,isDehydrated:!1,cache:v.cache},a.updateQueue.baseState=p,a.memoizedState=p,a.flags&256){a=Ip(t,a,c,s);break e}else if(c!==f){f=Jt(Error(r(424)),a),Hr(f),a=Ip(t,a,c,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Je=cn(t.firstChild),Rt=a,Me=!0,Qi=null,Sn=!0,s=bp(a,null,c,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(Vr(),c===f){a=Gn(t,a,s);break e}yt(t,a,c,s)}a=a.child}return a;case 26:return Uo(t,a),t===null?(s=Fg(a.type,null,a.pendingProps,null))?a.memoizedState=s:Me||(s=a.type,t=a.pendingProps,c=Zo(me.current).createElement(s),c[kt]=a,c[wt]=t,St(c,s,t),ft(c),a.stateNode=c):a.memoizedState=Fg(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return ya(a),t===null&&Me&&(c=a.stateNode=Vg(a.type,a.pendingProps,me.current),Rt=a,Sn=!0,f=Je,Ti(a.type)?(dd=f,Je=cn(c.firstChild)):Je=f),yt(t,a,a.pendingProps.children,s),Uo(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&Me&&((f=c=Je)&&(c=gk(c,a.type,a.pendingProps,Sn),c!==null?(a.stateNode=c,Rt=a,Je=cn(c.firstChild),Sn=!1,f=!0):f=!1),f||Xi(a)),ya(a),f=a.type,p=a.pendingProps,v=t!==null?t.memoizedProps:null,c=p.children,od(f,p)?c=null:v!==null&&od(f,v)&&(a.flags|=32),a.memoizedState!==null&&(f=su(t,a,NT,null,null,s),bs._currentValue=f),Uo(t,a),yt(t,a,c,s),a.child;case 6:return t===null&&Me&&((t=s=Je)&&(s=vk(s,a.pendingProps,Sn),s!==null?(a.stateNode=s,Rt=a,Je=null,t=!0):t=!1),t||Xi(a)),null;case 13:return jp(t,a,s);case 4:return Oe(a,a.stateNode.containerInfo),c=a.pendingProps,t===null?a.child=Ga(a,null,c,s):yt(t,a,c,s),a.child;case 11:return Dp(t,a,a.type,a.pendingProps,s);case 7:return yt(t,a,a.pendingProps,s),a.child;case 8:return yt(t,a,a.pendingProps.children,s),a.child;case 12:return yt(t,a,a.pendingProps.children,s),a.child;case 10:return c=a.pendingProps,si(a,a.type,c.value),yt(t,a,c.children,s),a.child;case 9:return f=a.type._context,c=a.pendingProps.children,Ji(a),f=Ct(f),c=c(f),a.flags|=1,yt(t,a,c,s),a.child;case 14:return Mp(t,a,a.type,a.pendingProps,s);case 15:return xp(t,a,a.type,a.pendingProps,s);case 19:return zp(t,a,s);case 31:return c=a.pendingProps,s=a.mode,c={mode:c.mode,children:c.children},t===null?(s=Lo(c,s),s.ref=a.ref,a.child=s,s.return=a,a=s):(s=In(t.child,c),s.ref=a.ref,a.child=s,s.return=a,a=s),a;case 22:return Pp(t,a,s);case 24:return Ji(a),c=Ct(ct),t===null?(f=Jl(),f===null&&(f=Fe,p=Xl(),f.pooledCache=p,p.refCount++,p!==null&&(f.pooledCacheLanes|=s),f=p),a.memoizedState={parent:c,cache:f},$l(a),si(a,ct,f)):((t.lanes&s)!==0&&(eu(t,a),Jr(a,null,null,s),Zr()),f=t.memoizedState,p=a.memoizedState,f.parent!==c?(f={parent:c,cache:c},a.memoizedState=f,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=f),si(a,ct,c)):(c=p.cache,si(a,ct,c),c!==f.cache&&Ql(a,[ct],s,!0))),yt(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function Fn(t){t.flags|=4}function Vp(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Zg(a)){if(a=tn.current,a!==null&&((Ee&4194048)===Ee?Tn!==null:(Ee&62914560)!==Ee&&(Ee&536870912)===0||a!==Tn))throw Qr=Wl,Rm;t.flags|=8192}}function Io(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?Sh():536870912,t.lanes|=a,Qa|=a)}function as(t,a){if(!Me)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function Ze(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,c=0;if(a)for(var f=t.child;f!==null;)s|=f.lanes|f.childLanes,c|=f.subtreeFlags&65011712,c|=f.flags&65011712,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)s|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=c,t.childLanes=s,a}function HT(t,a,s){var c=a.pendingProps;switch(Gl(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(a),null;case 1:return Ze(a),null;case 3:return s=a.stateNode,c=null,t!==null&&(c=t.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),qn(ct),_t(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(qr(a)?Fn(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Sm())),Ze(a),null;case 26:return s=a.memoizedState,t===null?(Fn(a),s!==null?(Ze(a),Vp(a,s)):(Ze(a),a.flags&=-16777217)):s?s!==t.memoizedState?(Fn(a),Ze(a),Vp(a,s)):(Ze(a),a.flags&=-16777217):(t.memoizedProps!==c&&Fn(a),Ze(a),a.flags&=-16777217),null;case 27:Ks(a),s=me.current;var f=a.type;if(t!==null&&a.stateNode!=null)t.memoizedProps!==c&&Fn(a);else{if(!c){if(a.stateNode===null)throw Error(r(166));return Ze(a),null}t=de.current,qr(a)?ym(a):(t=Vg(f,c,s),a.stateNode=t,Fn(a))}return Ze(a),null;case 5:if(Ks(a),s=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==c&&Fn(a);else{if(!c){if(a.stateNode===null)throw Error(r(166));return Ze(a),null}if(t=de.current,qr(a))ym(a);else{switch(f=Zo(me.current),t){case 1:t=f.createElementNS("http://www.w3.org/2000/svg",s);break;case 2:t=f.createElementNS("http://www.w3.org/1998/Math/MathML",s);break;default:switch(s){case"svg":t=f.createElementNS("http://www.w3.org/2000/svg",s);break;case"math":t=f.createElementNS("http://www.w3.org/1998/Math/MathML",s);break;case"script":t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof c.is=="string"?f.createElement("select",{is:c.is}):f.createElement("select"),c.multiple?t.multiple=!0:c.size&&(t.size=c.size);break;default:t=typeof c.is=="string"?f.createElement(s,{is:c.is}):f.createElement(s)}}t[kt]=a,t[wt]=c;e:for(f=a.child;f!==null;){if(f.tag===5||f.tag===6)t.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===a)break e;for(;f.sibling===null;){if(f.return===null||f.return===a)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}a.stateNode=t;e:switch(St(t,s,c),s){case"button":case"input":case"select":case"textarea":t=!!c.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&Fn(a)}}return Ze(a),a.flags&=-16777217,null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==c&&Fn(a);else{if(typeof c!="string"&&a.stateNode===null)throw Error(r(166));if(t=me.current,qr(a)){if(t=a.stateNode,s=a.memoizedProps,c=null,f=Rt,f!==null)switch(f.tag){case 27:case 5:c=f.memoizedProps}t[kt]=a,t=!!(t.nodeValue===s||c!==null&&c.suppressHydrationWarning===!0||Ug(t.nodeValue,s)),t||Xi(a)}else t=Zo(t).createTextNode(c),t[kt]=a,a.stateNode=t}return Ze(a),null;case 13:if(c=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(f=qr(a),c!==null&&c.dehydrated!==null){if(t===null){if(!f)throw Error(r(318));if(f=a.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(r(317));f[kt]=a}else Vr(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ze(a),f=!1}else f=Sm(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=f),f=!0;if(!f)return a.flags&256?(Hn(a),a):(Hn(a),null)}if(Hn(a),(a.flags&128)!==0)return a.lanes=s,a;if(s=c!==null,t=t!==null&&t.memoizedState!==null,s){c=a.child,f=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(f=c.alternate.memoizedState.cachePool.pool);var p=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048)}return s!==t&&s&&(a.child.flags|=8192),Io(a,a.updateQueue),Ze(a),null;case 4:return _t(),t===null&&nd(a.stateNode.containerInfo),Ze(a),null;case 10:return qn(a.type),Ze(a),null;case 19:if(ae(lt),f=a.memoizedState,f===null)return Ze(a),null;if(c=(a.flags&128)!==0,p=f.rendering,p===null)if(c)as(f,!1);else{if(We!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(p=xo(t),p!==null){for(a.flags|=128,as(f,!1),t=p.updateQueue,a.updateQueue=t,Io(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)gm(s,t),s=s.sibling;return ie(lt,lt.current&1|2),a.child}t=t.sibling}f.tail!==null&&bn()>zo&&(a.flags|=128,c=!0,as(f,!1),a.lanes=4194304)}else{if(!c)if(t=xo(p),t!==null){if(a.flags|=128,c=!0,t=t.updateQueue,a.updateQueue=t,Io(a,t),as(f,!0),f.tail===null&&f.tailMode==="hidden"&&!p.alternate&&!Me)return Ze(a),null}else 2*bn()-f.renderingStartTime>zo&&s!==536870912&&(a.flags|=128,c=!0,as(f,!1),a.lanes=4194304);f.isBackwards?(p.sibling=a.child,a.child=p):(t=f.last,t!==null?t.sibling=p:a.child=p,f.last=p)}return f.tail!==null?(a=f.tail,f.rendering=a,f.tail=a.sibling,f.renderingStartTime=bn(),a.sibling=null,t=lt.current,ie(lt,c?t&1|2:t&1),a):(Ze(a),null);case 22:case 23:return Hn(a),au(),c=a.memoizedState!==null,t!==null?t.memoizedState!==null!==c&&(a.flags|=8192):c&&(a.flags|=8192),c?(s&536870912)!==0&&(a.flags&128)===0&&(Ze(a),a.subtreeFlags&6&&(a.flags|=8192)):Ze(a),s=a.updateQueue,s!==null&&Io(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),c=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),c!==s&&(a.flags|=2048),t!==null&&ae(Wi),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),qn(ct),Ze(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function GT(t,a){switch(Gl(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return qn(ct),_t(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return Ks(a),null;case 13:if(Hn(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(r(340));Vr()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return ae(lt),null;case 4:return _t(),null;case 10:return qn(a.type),null;case 22:case 23:return Hn(a),au(),t!==null&&ae(Wi),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return qn(ct),null;case 25:return null;default:return null}}function Hp(t,a){switch(Gl(a),a.tag){case 3:qn(ct),_t();break;case 26:case 27:case 5:Ks(a);break;case 4:_t();break;case 13:Hn(a);break;case 19:ae(lt);break;case 10:qn(a.type);break;case 22:case 23:Hn(a),au(),t!==null&&ae(Wi);break;case 24:qn(ct)}}function rs(t,a){try{var s=a.updateQueue,c=s!==null?s.lastEffect:null;if(c!==null){var f=c.next;s=f;do{if((s.tag&t)===t){c=void 0;var p=s.create,v=s.inst;c=p(),v.destroy=c}s=s.next}while(s!==f)}}catch(S){He(a,a.return,S)}}function hi(t,a,s){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var p=f.next;c=p;do{if((c.tag&t)===t){var v=c.inst,S=v.destroy;if(S!==void 0){v.destroy=void 0,f=a;var R=s,U=S;try{U()}catch(F){He(f,R,F)}}}c=c.next}while(c!==p)}}catch(F){He(a,a.return,F)}}function Gp(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{Mm(a,s)}catch(c){He(t,t.return,c)}}}function Fp(t,a,s){s.props=ea(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(c){He(t,a,c)}}function ss(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var c=t.stateNode;break;case 30:c=t.stateNode;break;default:c=t.stateNode}typeof s=="function"?t.refCleanup=s(c):s.current=c}}catch(f){He(t,a,f)}}function kn(t,a){var s=t.ref,c=t.refCleanup;if(s!==null)if(typeof c=="function")try{c()}catch(f){He(t,a,f)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(f){He(t,a,f)}else s.current=null}function Yp(t){var a=t.type,s=t.memoizedProps,c=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&c.focus();break e;case"img":s.src?c.src=s.src:s.srcSet&&(c.srcset=s.srcSet)}}catch(f){He(t,t.return,f)}}function xu(t,a,s){try{var c=t.stateNode;dk(c,t.type,s,a),c[wt]=a}catch(f){He(t,t.return,f)}}function Kp(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ti(t.type)||t.tag===4}function Pu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Kp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ti(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Nu(t,a,s){var c=t.tag;if(c===5||c===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=Xo));else if(c!==4&&(c===27&&Ti(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(Nu(t,a,s),t=t.sibling;t!==null;)Nu(t,a,s),t=t.sibling}function jo(t,a,s){var c=t.tag;if(c===5||c===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(c!==4&&(c===27&&Ti(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(jo(t,a,s),t=t.sibling;t!==null;)jo(t,a,s),t=t.sibling}function Qp(t){var a=t.stateNode,s=t.memoizedProps;try{for(var c=t.type,f=a.attributes;f.length;)a.removeAttributeNode(f[0]);St(a,c,s),a[kt]=t,a[wt]=s}catch(p){He(t,t.return,p)}}var Yn=!1,it=!1,Uu=!1,Xp=typeof WeakSet=="function"?WeakSet:Set,mt=null;function FT(t,a){if(t=t.containerInfo,rd=nc,t=sm(t),Pl(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var f=c.anchorOffset,p=c.focusNode;c=c.focusOffset;try{s.nodeType,p.nodeType}catch{s=null;break e}var v=0,S=-1,R=-1,U=0,F=0,K=t,L=null;t:for(;;){for(var I;K!==s||f!==0&&K.nodeType!==3||(S=v+f),K!==p||c!==0&&K.nodeType!==3||(R=v+c),K.nodeType===3&&(v+=K.nodeValue.length),(I=K.firstChild)!==null;)L=K,K=I;for(;;){if(K===t)break t;if(L===s&&++U===f&&(S=v),L===p&&++F===c&&(R=v),(I=K.nextSibling)!==null)break;K=L,L=K.parentNode}K=I}s=S===-1||R===-1?null:{start:S,end:R}}else s=null}s=s||{start:0,end:0}}else s=null;for(sd={focusedElem:t,selectionRange:s},nc=!1,mt=a;mt!==null;)if(a=mt,t=a.child,(a.subtreeFlags&1024)!==0&&t!==null)t.return=a,mt=t;else for(;mt!==null;){switch(a=mt,p=a.alternate,t=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&p!==null){t=void 0,s=a,f=p.memoizedProps,p=p.memoizedState,c=s.stateNode;try{var pe=ea(s.type,f,s.elementType===s.type);t=c.getSnapshotBeforeUpdate(pe,p),c.__reactInternalSnapshotBeforeUpdate=t}catch(fe){He(s,s.return,fe)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)ld(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":ld(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(r(163))}if(t=a.sibling,t!==null){t.return=a.return,mt=t;break}mt=a.return}}function Zp(t,a,s){var c=s.flags;switch(s.tag){case 0:case 11:case 15:mi(t,s),c&4&&rs(5,s);break;case 1:if(mi(t,s),c&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(v){He(s,s.return,v)}else{var f=ea(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(f,a,t.__reactInternalSnapshotBeforeUpdate)}catch(v){He(s,s.return,v)}}c&64&&Gp(s),c&512&&ss(s,s.return);break;case 3:if(mi(t,s),c&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{Mm(t,a)}catch(v){He(s,s.return,v)}}break;case 27:a===null&&c&4&&Qp(s);case 26:case 5:mi(t,s),a===null&&c&4&&Yp(s),c&512&&ss(s,s.return);break;case 12:mi(t,s);break;case 13:mi(t,s),c&4&&$p(t,s),c&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=ek.bind(null,s),yk(t,s))));break;case 22:if(c=s.memoizedState!==null||Yn,!c){a=a!==null&&a.memoizedState!==null||it,f=Yn;var p=it;Yn=c,(it=a)&&!p?pi(t,s,(s.subtreeFlags&8772)!==0):mi(t,s),Yn=f,it=p}break;case 30:break;default:mi(t,s)}}function Jp(t){var a=t.alternate;a!==null&&(t.alternate=null,Jp(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&ml(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Qe=null,Dt=!1;function Kn(t,a,s){for(s=s.child;s!==null;)Wp(t,a,s),s=s.sibling}function Wp(t,a,s){if(It&&typeof It.onCommitFiberUnmount=="function")try{It.onCommitFiberUnmount(wr,s)}catch{}switch(s.tag){case 26:it||kn(s,a),Kn(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:it||kn(s,a);var c=Qe,f=Dt;Ti(s.type)&&(Qe=s.stateNode,Dt=!1),Kn(t,a,s),ps(s.stateNode),Qe=c,Dt=f;break;case 5:it||kn(s,a);case 6:if(c=Qe,f=Dt,Qe=null,Kn(t,a,s),Qe=c,Dt=f,Qe!==null)if(Dt)try{(Qe.nodeType===9?Qe.body:Qe.nodeName==="HTML"?Qe.ownerDocument.body:Qe).removeChild(s.stateNode)}catch(p){He(s,a,p)}else try{Qe.removeChild(s.stateNode)}catch(p){He(s,a,p)}break;case 18:Qe!==null&&(Dt?(t=Qe,zg(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),Cs(t)):zg(Qe,s.stateNode));break;case 4:c=Qe,f=Dt,Qe=s.stateNode.containerInfo,Dt=!0,Kn(t,a,s),Qe=c,Dt=f;break;case 0:case 11:case 14:case 15:it||hi(2,s,a),it||hi(4,s,a),Kn(t,a,s);break;case 1:it||(kn(s,a),c=s.stateNode,typeof c.componentWillUnmount=="function"&&Fp(s,a,c)),Kn(t,a,s);break;case 21:Kn(t,a,s);break;case 22:it=(c=it)||s.memoizedState!==null,Kn(t,a,s),it=c;break;default:Kn(t,a,s)}}function $p(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Cs(t)}catch(s){He(a,a.return,s)}}function YT(t){switch(t.tag){case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Xp),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Xp),a;default:throw Error(r(435,t.tag))}}function Lu(t,a){var s=YT(t);a.forEach(function(c){var f=tk.bind(null,t,c);s.has(c)||(s.add(c),c.then(f,f))})}function qt(t,a){var s=a.deletions;if(s!==null)for(var c=0;c<s.length;c++){var f=s[c],p=t,v=a,S=v;e:for(;S!==null;){switch(S.tag){case 27:if(Ti(S.type)){Qe=S.stateNode,Dt=!1;break e}break;case 5:Qe=S.stateNode,Dt=!1;break e;case 3:case 4:Qe=S.stateNode.containerInfo,Dt=!0;break e}S=S.return}if(Qe===null)throw Error(r(160));Wp(p,v,f),Qe=null,Dt=!1,p=f.alternate,p!==null&&(p.return=null),f.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)eg(a,t),a=a.sibling}var on=null;function eg(t,a){var s=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:qt(a,t),Vt(t),c&4&&(hi(3,t,t.return),rs(3,t),hi(5,t,t.return));break;case 1:qt(a,t),Vt(t),c&512&&(it||s===null||kn(s,s.return)),c&64&&Yn&&(t=t.updateQueue,t!==null&&(c=t.callbacks,c!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?c:s.concat(c))));break;case 26:var f=on;if(qt(a,t),Vt(t),c&512&&(it||s===null||kn(s,s.return)),c&4){var p=s!==null?s.memoizedState:null;if(c=t.memoizedState,s===null)if(c===null)if(t.stateNode===null){e:{c=t.type,s=t.memoizedProps,f=f.ownerDocument||f;t:switch(c){case"title":p=f.getElementsByTagName("title")[0],(!p||p[Dr]||p[kt]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=f.createElement(c),f.head.insertBefore(p,f.querySelector("head > title"))),St(p,c,s),p[kt]=t,ft(p),c=p;break e;case"link":var v=Qg("link","href",f).get(c+(s.href||""));if(v){for(var S=0;S<v.length;S++)if(p=v[S],p.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&p.getAttribute("rel")===(s.rel==null?null:s.rel)&&p.getAttribute("title")===(s.title==null?null:s.title)&&p.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){v.splice(S,1);break t}}p=f.createElement(c),St(p,c,s),f.head.appendChild(p);break;case"meta":if(v=Qg("meta","content",f).get(c+(s.content||""))){for(S=0;S<v.length;S++)if(p=v[S],p.getAttribute("content")===(s.content==null?null:""+s.content)&&p.getAttribute("name")===(s.name==null?null:s.name)&&p.getAttribute("property")===(s.property==null?null:s.property)&&p.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&p.getAttribute("charset")===(s.charSet==null?null:s.charSet)){v.splice(S,1);break t}}p=f.createElement(c),St(p,c,s),f.head.appendChild(p);break;default:throw Error(r(468,c))}p[kt]=t,ft(p),c=p}t.stateNode=c}else Xg(f,t.type,t.stateNode);else t.stateNode=Kg(f,c,t.memoizedProps);else p!==c?(p===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):p.count--,c===null?Xg(f,t.type,t.stateNode):Kg(f,c,t.memoizedProps)):c===null&&t.stateNode!==null&&xu(t,t.memoizedProps,s.memoizedProps)}break;case 27:qt(a,t),Vt(t),c&512&&(it||s===null||kn(s,s.return)),s!==null&&c&4&&xu(t,t.memoizedProps,s.memoizedProps);break;case 5:if(qt(a,t),Vt(t),c&512&&(it||s===null||kn(s,s.return)),t.flags&32){f=t.stateNode;try{_a(f,"")}catch(I){He(t,t.return,I)}}c&4&&t.stateNode!=null&&(f=t.memoizedProps,xu(t,f,s!==null?s.memoizedProps:f)),c&1024&&(Uu=!0);break;case 6:if(qt(a,t),Vt(t),c&4){if(t.stateNode===null)throw Error(r(162));c=t.memoizedProps,s=t.stateNode;try{s.nodeValue=c}catch(I){He(t,t.return,I)}}break;case 3:if($o=null,f=on,on=Jo(a.containerInfo),qt(a,t),on=f,Vt(t),c&4&&s!==null&&s.memoizedState.isDehydrated)try{Cs(a.containerInfo)}catch(I){He(t,t.return,I)}Uu&&(Uu=!1,tg(t));break;case 4:c=on,on=Jo(t.stateNode.containerInfo),qt(a,t),Vt(t),on=c;break;case 12:qt(a,t),Vt(t);break;case 13:qt(a,t),Vt(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(Vu=bn()),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,Lu(t,c)));break;case 22:f=t.memoizedState!==null;var R=s!==null&&s.memoizedState!==null,U=Yn,F=it;if(Yn=U||f,it=F||R,qt(a,t),it=F,Yn=U,Vt(t),c&8192)e:for(a=t.stateNode,a._visibility=f?a._visibility&-2:a._visibility|1,f&&(s===null||R||Yn||it||ta(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){R=s=a;try{if(p=R.stateNode,f)v=p.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{S=R.stateNode;var K=R.memoizedProps.style,L=K!=null&&K.hasOwnProperty("display")?K.display:null;S.style.display=L==null||typeof L=="boolean"?"":(""+L).trim()}}catch(I){He(R,R.return,I)}}}else if(a.tag===6){if(s===null){R=a;try{R.stateNode.nodeValue=f?"":R.memoizedProps}catch(I){He(R,R.return,I)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}c&4&&(c=t.updateQueue,c!==null&&(s=c.retryQueue,s!==null&&(c.retryQueue=null,Lu(t,s))));break;case 19:qt(a,t),Vt(t),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,Lu(t,c)));break;case 30:break;case 21:break;default:qt(a,t),Vt(t)}}function Vt(t){var a=t.flags;if(a&2){try{for(var s,c=t.return;c!==null;){if(Kp(c)){s=c;break}c=c.return}if(s==null)throw Error(r(160));switch(s.tag){case 27:var f=s.stateNode,p=Pu(t);jo(t,p,f);break;case 5:var v=s.stateNode;s.flags&32&&(_a(v,""),s.flags&=-33);var S=Pu(t);jo(t,S,v);break;case 3:case 4:var R=s.stateNode.containerInfo,U=Pu(t);Nu(t,U,R);break;default:throw Error(r(161))}}catch(F){He(t,t.return,F)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function tg(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;tg(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function mi(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Zp(t,a.alternate,a),a=a.sibling}function ta(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:hi(4,a,a.return),ta(a);break;case 1:kn(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&Fp(a,a.return,s),ta(a);break;case 27:ps(a.stateNode);case 26:case 5:kn(a,a.return),ta(a);break;case 22:a.memoizedState===null&&ta(a);break;case 30:ta(a);break;default:ta(a)}t=t.sibling}}function pi(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var c=a.alternate,f=t,p=a,v=p.flags;switch(p.tag){case 0:case 11:case 15:pi(f,p,s),rs(4,p);break;case 1:if(pi(f,p,s),c=p,f=c.stateNode,typeof f.componentDidMount=="function")try{f.componentDidMount()}catch(U){He(c,c.return,U)}if(c=p,f=c.updateQueue,f!==null){var S=c.stateNode;try{var R=f.shared.hiddenCallbacks;if(R!==null)for(f.shared.hiddenCallbacks=null,f=0;f<R.length;f++)Dm(R[f],S)}catch(U){He(c,c.return,U)}}s&&v&64&&Gp(p),ss(p,p.return);break;case 27:Qp(p);case 26:case 5:pi(f,p,s),s&&c===null&&v&4&&Yp(p),ss(p,p.return);break;case 12:pi(f,p,s);break;case 13:pi(f,p,s),s&&v&4&&$p(f,p);break;case 22:p.memoizedState===null&&pi(f,p,s),ss(p,p.return);break;case 30:break;default:pi(f,p,s)}a=a.sibling}}function Iu(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Fr(s))}function ju(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Fr(t))}function Cn(t,a,s,c){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ng(t,a,s,c),a=a.sibling}function ng(t,a,s,c){var f=a.flags;switch(a.tag){case 0:case 11:case 15:Cn(t,a,s,c),f&2048&&rs(9,a);break;case 1:Cn(t,a,s,c);break;case 3:Cn(t,a,s,c),f&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Fr(t)));break;case 12:if(f&2048){Cn(t,a,s,c),t=a.stateNode;try{var p=a.memoizedProps,v=p.id,S=p.onPostCommit;typeof S=="function"&&S(v,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(R){He(a,a.return,R)}}else Cn(t,a,s,c);break;case 13:Cn(t,a,s,c);break;case 23:break;case 22:p=a.stateNode,v=a.alternate,a.memoizedState!==null?p._visibility&2?Cn(t,a,s,c):os(t,a):p._visibility&2?Cn(t,a,s,c):(p._visibility|=2,Fa(t,a,s,c,(a.subtreeFlags&10256)!==0)),f&2048&&Iu(v,a);break;case 24:Cn(t,a,s,c),f&2048&&ju(a.alternate,a);break;default:Cn(t,a,s,c)}}function Fa(t,a,s,c,f){for(f=f&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var p=t,v=a,S=s,R=c,U=v.flags;switch(v.tag){case 0:case 11:case 15:Fa(p,v,S,R,f),rs(8,v);break;case 23:break;case 22:var F=v.stateNode;v.memoizedState!==null?F._visibility&2?Fa(p,v,S,R,f):os(p,v):(F._visibility|=2,Fa(p,v,S,R,f)),f&&U&2048&&Iu(v.alternate,v);break;case 24:Fa(p,v,S,R,f),f&&U&2048&&ju(v.alternate,v);break;default:Fa(p,v,S,R,f)}a=a.sibling}}function os(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,c=a,f=c.flags;switch(c.tag){case 22:os(s,c),f&2048&&Iu(c.alternate,c);break;case 24:os(s,c),f&2048&&ju(c.alternate,c);break;default:os(s,c)}a=a.sibling}}var cs=8192;function Ya(t){if(t.subtreeFlags&cs)for(t=t.child;t!==null;)ig(t),t=t.sibling}function ig(t){switch(t.tag){case 26:Ya(t),t.flags&cs&&t.memoizedState!==null&&Mk(on,t.memoizedState,t.memoizedProps);break;case 5:Ya(t);break;case 3:case 4:var a=on;on=Jo(t.stateNode.containerInfo),Ya(t),on=a;break;case 22:t.memoizedState===null&&(a=t.alternate,a!==null&&a.memoizedState!==null?(a=cs,cs=16777216,Ya(t),cs=a):Ya(t));break;default:Ya(t)}}function ag(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function ls(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var c=a[s];mt=c,sg(c,t)}ag(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)rg(t),t=t.sibling}function rg(t){switch(t.tag){case 0:case 11:case 15:ls(t),t.flags&2048&&hi(9,t,t.return);break;case 3:ls(t);break;case 12:ls(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,Bo(t)):ls(t);break;default:ls(t)}}function Bo(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var c=a[s];mt=c,sg(c,t)}ag(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:hi(8,a,a.return),Bo(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,Bo(a));break;default:Bo(a)}t=t.sibling}}function sg(t,a){for(;mt!==null;){var s=mt;switch(s.tag){case 0:case 11:case 15:hi(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var c=s.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Fr(s.memoizedState.cache)}if(c=s.child,c!==null)c.return=s,mt=c;else e:for(s=t;mt!==null;){c=mt;var f=c.sibling,p=c.return;if(Jp(c),c===s){mt=null;break e}if(f!==null){f.return=p,mt=f;break e}mt=p}}}var KT={getCacheForType:function(t){var a=Ct(ct),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s}},QT=typeof WeakMap=="function"?WeakMap:Map,Ie=0,Fe=null,Se=null,Ee=0,je=0,Ht=null,gi=!1,Ka=!1,Bu=!1,Qn=0,We=0,vi=0,na=0,zu=0,nn=0,Qa=0,us=null,Mt=null,qu=!1,Vu=0,zo=1/0,qo=null,yi=null,bt=0,bi=null,Xa=null,Za=0,Hu=0,Gu=null,og=null,ds=0,Fu=null;function Gt(){if((Ie&2)!==0&&Ee!==0)return Ee&-Ee;if(V.T!==null){var t=Ia;return t!==0?t:Wu()}return Ch()}function cg(){nn===0&&(nn=(Ee&536870912)===0||Me?bh():536870912);var t=tn.current;return t!==null&&(t.flags|=32),nn}function Ft(t,a,s){(t===Fe&&(je===2||je===9)||t.cancelPendingCommit!==null)&&(Ja(t,0),Si(t,Ee,nn,!1)),Ar(t,s),((Ie&2)===0||t!==Fe)&&(t===Fe&&((Ie&2)===0&&(na|=s),We===4&&Si(t,Ee,nn,!1)),En(t))}function lg(t,a,s){if((Ie&6)!==0)throw Error(r(327));var c=!s&&(a&124)===0&&(a&t.expiredLanes)===0||Or(t,a),f=c?JT(t,a):Qu(t,a,!0),p=c;do{if(f===0){Ka&&!c&&Si(t,a,0,!1);break}else{if(s=t.current.alternate,p&&!XT(s)){f=Qu(t,a,!1),p=!1;continue}if(f===2){if(p=a,t.errorRecoveryDisabledLanes&p)var v=0;else v=t.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){a=v;e:{var S=t;f=us;var R=S.current.memoizedState.isDehydrated;if(R&&(Ja(S,v).flags|=256),v=Qu(S,v,!1),v!==2){if(Bu&&!R){S.errorRecoveryDisabledLanes|=p,na|=p,f=4;break e}p=Mt,Mt=f,p!==null&&(Mt===null?Mt=p:Mt.push.apply(Mt,p))}f=v}if(p=!1,f!==2)continue}}if(f===1){Ja(t,0),Si(t,a,0,!0);break}e:{switch(c=t,p=f,p){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Si(c,a,nn,!gi);break e;case 2:Mt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(f=Vu+300-bn(),10<f)){if(Si(c,a,nn,!gi),Js(c,0,!0)!==0)break e;c.timeoutHandle=jg(ug.bind(null,c,s,Mt,qo,qu,a,nn,na,Qa,gi,p,2,-0,0),f);break e}ug(c,s,Mt,qo,qu,a,nn,na,Qa,gi,p,0,-0,0)}}break}while(!0);En(t)}function ug(t,a,s,c,f,p,v,S,R,U,F,K,L,I){if(t.timeoutHandle=-1,K=a.subtreeFlags,(K&8192||(K&16785408)===16785408)&&(ys={stylesheets:null,count:0,unsuspend:Dk},ig(a),K=xk(),K!==null)){t.cancelPendingCommit=K(vg.bind(null,t,a,p,s,c,f,v,S,R,F,1,L,I)),Si(t,p,v,!U);return}vg(t,a,p,s,c,f,v,S,R)}function XT(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var c=0;c<s.length;c++){var f=s[c],p=f.getSnapshot;f=f.value;try{if(!Bt(p(),f))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Si(t,a,s,c){a&=~zu,a&=~na,t.suspendedLanes|=a,t.pingedLanes&=~a,c&&(t.warmLanes|=a),c=t.expirationTimes;for(var f=a;0<f;){var p=31-jt(f),v=1<<p;c[p]=-1,f&=~v}s!==0&&Th(t,s,a)}function Vo(){return(Ie&6)===0?(fs(0),!1):!0}function Yu(){if(Se!==null){if(je===0)var t=Se.return;else t=Se,zn=Zi=null,lu(t),Ha=null,ns=0,t=Se;for(;t!==null;)Hp(t.alternate,t),t=t.return;Se=null}}function Ja(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,hk(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),Yu(),Fe=t,Se=s=In(t.current,null),Ee=a,je=0,Ht=null,gi=!1,Ka=Or(t,a),Bu=!1,Qa=nn=zu=na=vi=We=0,Mt=us=null,qu=!1,(a&8)!==0&&(a|=a&32);var c=t.entangledLanes;if(c!==0)for(t=t.entanglements,c&=a;0<c;){var f=31-jt(c),p=1<<f;a|=t[f],c&=~p}return Qn=a,lo(),s}function dg(t,a){ve=null,V.H=Ao,a===Kr||a===bo?(a=Om(),je=3):a===Rm?(a=Om(),je=4):je=a===Ap?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ht=a,Se===null&&(We=1,No(t,Jt(a,t.current)))}function fg(){var t=V.H;return V.H=Ao,t===null?Ao:t}function hg(){var t=V.A;return V.A=KT,t}function Ku(){We=4,gi||(Ee&4194048)!==Ee&&tn.current!==null||(Ka=!0),(vi&134217727)===0&&(na&134217727)===0||Fe===null||Si(Fe,Ee,nn,!1)}function Qu(t,a,s){var c=Ie;Ie|=2;var f=fg(),p=hg();(Fe!==t||Ee!==a)&&(qo=null,Ja(t,a)),a=!1;var v=We;e:do try{if(je!==0&&Se!==null){var S=Se,R=Ht;switch(je){case 8:Yu(),v=6;break e;case 3:case 2:case 9:case 6:tn.current===null&&(a=!0);var U=je;if(je=0,Ht=null,Wa(t,S,R,U),s&&Ka){v=0;break e}break;default:U=je,je=0,Ht=null,Wa(t,S,R,U)}}ZT(),v=We;break}catch(F){dg(t,F)}while(!0);return a&&t.shellSuspendCounter++,zn=Zi=null,Ie=c,V.H=f,V.A=p,Se===null&&(Fe=null,Ee=0,lo()),v}function ZT(){for(;Se!==null;)mg(Se)}function JT(t,a){var s=Ie;Ie|=2;var c=fg(),f=hg();Fe!==t||Ee!==a?(qo=null,zo=bn()+500,Ja(t,a)):Ka=Or(t,a);e:do try{if(je!==0&&Se!==null){a=Se;var p=Ht;t:switch(je){case 1:je=0,Ht=null,Wa(t,a,p,1);break;case 2:case 9:if(_m(p)){je=0,Ht=null,pg(a);break}a=function(){je!==2&&je!==9||Fe!==t||(je=7),En(t)},p.then(a,a);break e;case 3:je=7;break e;case 4:je=5;break e;case 7:_m(p)?(je=0,Ht=null,pg(a)):(je=0,Ht=null,Wa(t,a,p,7));break;case 5:var v=null;switch(Se.tag){case 26:v=Se.memoizedState;case 5:case 27:var S=Se;if(!v||Zg(v)){je=0,Ht=null;var R=S.sibling;if(R!==null)Se=R;else{var U=S.return;U!==null?(Se=U,Ho(U)):Se=null}break t}}je=0,Ht=null,Wa(t,a,p,5);break;case 6:je=0,Ht=null,Wa(t,a,p,6);break;case 8:Yu(),We=6;break e;default:throw Error(r(462))}}WT();break}catch(F){dg(t,F)}while(!0);return zn=Zi=null,V.H=c,V.A=f,Ie=s,Se!==null?0:(Fe=null,Ee=0,lo(),We)}function WT(){for(;Se!==null&&!SS();)mg(Se)}function mg(t){var a=qp(t.alternate,t,Qn);t.memoizedProps=t.pendingProps,a===null?Ho(t):Se=a}function pg(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=Up(s,a,a.pendingProps,a.type,void 0,Ee);break;case 11:a=Up(s,a,a.pendingProps,a.type.render,a.ref,Ee);break;case 5:lu(a);default:Hp(s,a),a=Se=gm(a,Qn),a=qp(s,a,Qn)}t.memoizedProps=t.pendingProps,a===null?Ho(t):Se=a}function Wa(t,a,s,c){zn=Zi=null,lu(a),Ha=null,ns=0;var f=a.return;try{if(qT(t,f,a,s,Ee)){We=1,No(t,Jt(s,t.current)),Se=null;return}}catch(p){if(f!==null)throw Se=f,p;We=1,No(t,Jt(s,t.current)),Se=null;return}a.flags&32768?(Me||c===1?t=!0:Ka||(Ee&536870912)!==0?t=!1:(gi=t=!0,(c===2||c===9||c===3||c===6)&&(c=tn.current,c!==null&&c.tag===13&&(c.flags|=16384))),gg(a,t)):Ho(a)}function Ho(t){var a=t;do{if((a.flags&32768)!==0){gg(a,gi);return}t=a.return;var s=HT(a.alternate,a,Qn);if(s!==null){Se=s;return}if(a=a.sibling,a!==null){Se=a;return}Se=a=t}while(a!==null);We===0&&(We=5)}function gg(t,a){do{var s=GT(t.alternate,t);if(s!==null){s.flags&=32767,Se=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){Se=t;return}Se=t=s}while(t!==null);We=6,Se=null}function vg(t,a,s,c,f,p,v,S,R){t.cancelPendingCommit=null;do Go();while(bt!==0);if((Ie&6)!==0)throw Error(r(327));if(a!==null){if(a===t.current)throw Error(r(177));if(p=a.lanes|a.childLanes,p|=jl,DS(t,s,p,v,S,R),t===Fe&&(Se=Fe=null,Ee=0),Xa=a,bi=t,Za=s,Hu=p,Gu=f,og=c,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,nk(Qs,function(){return kg(),null})):(t.callbackNode=null,t.callbackPriority=0),c=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||c){c=V.T,V.T=null,f=ee.p,ee.p=2,v=Ie,Ie|=4;try{FT(t,a,s)}finally{Ie=v,ee.p=f,V.T=c}}bt=1,yg(),bg(),Sg()}}function yg(){if(bt===1){bt=0;var t=bi,a=Xa,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=V.T,V.T=null;var c=ee.p;ee.p=2;var f=Ie;Ie|=4;try{eg(a,t);var p=sd,v=sm(t.containerInfo),S=p.focusedElem,R=p.selectionRange;if(v!==S&&S&&S.ownerDocument&&rm(S.ownerDocument.documentElement,S)){if(R!==null&&Pl(S)){var U=R.start,F=R.end;if(F===void 0&&(F=U),"selectionStart"in S)S.selectionStart=U,S.selectionEnd=Math.min(F,S.value.length);else{var K=S.ownerDocument||document,L=K&&K.defaultView||window;if(L.getSelection){var I=L.getSelection(),pe=S.textContent.length,fe=Math.min(R.start,pe),qe=R.end===void 0?fe:Math.min(R.end,pe);!I.extend&&fe>qe&&(v=qe,qe=fe,fe=v);var x=am(S,fe),D=am(S,qe);if(x&&D&&(I.rangeCount!==1||I.anchorNode!==x.node||I.anchorOffset!==x.offset||I.focusNode!==D.node||I.focusOffset!==D.offset)){var N=K.createRange();N.setStart(x.node,x.offset),I.removeAllRanges(),fe>qe?(I.addRange(N),I.extend(D.node,D.offset)):(N.setEnd(D.node,D.offset),I.addRange(N))}}}}for(K=[],I=S;I=I.parentNode;)I.nodeType===1&&K.push({element:I,left:I.scrollLeft,top:I.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<K.length;S++){var Y=K[S];Y.element.scrollLeft=Y.left,Y.element.scrollTop=Y.top}}nc=!!rd,sd=rd=null}finally{Ie=f,ee.p=c,V.T=s}}t.current=a,bt=2}}function bg(){if(bt===2){bt=0;var t=bi,a=Xa,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=V.T,V.T=null;var c=ee.p;ee.p=2;var f=Ie;Ie|=4;try{Zp(t,a.alternate,a)}finally{Ie=f,ee.p=c,V.T=s}}bt=3}}function Sg(){if(bt===4||bt===3){bt=0,TS();var t=bi,a=Xa,s=Za,c=og;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?bt=5:(bt=0,Xa=bi=null,Tg(t,t.pendingLanes));var f=t.pendingLanes;if(f===0&&(yi=null),fl(s),a=a.stateNode,It&&typeof It.onCommitFiberRoot=="function")try{It.onCommitFiberRoot(wr,a,void 0,(a.current.flags&128)===128)}catch{}if(c!==null){a=V.T,f=ee.p,ee.p=2,V.T=null;try{for(var p=t.onRecoverableError,v=0;v<c.length;v++){var S=c[v];p(S.value,{componentStack:S.stack})}}finally{V.T=a,ee.p=f}}(Za&3)!==0&&Go(),En(t),f=t.pendingLanes,(s&4194090)!==0&&(f&42)!==0?t===Fu?ds++:(ds=0,Fu=t):ds=0,fs(0)}}function Tg(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,Fr(a)))}function Go(t){return yg(),bg(),Sg(),kg()}function kg(){if(bt!==5)return!1;var t=bi,a=Hu;Hu=0;var s=fl(Za),c=V.T,f=ee.p;try{ee.p=32>s?32:s,V.T=null,s=Gu,Gu=null;var p=bi,v=Za;if(bt=0,Xa=bi=null,Za=0,(Ie&6)!==0)throw Error(r(331));var S=Ie;if(Ie|=4,rg(p.current),ng(p,p.current,v,s),Ie=S,fs(0,!1),It&&typeof It.onPostCommitFiberRoot=="function")try{It.onPostCommitFiberRoot(wr,p)}catch{}return!0}finally{ee.p=f,V.T=c,Tg(t,a)}}function Cg(t,a,s){a=Jt(s,a),a=Cu(t.stateNode,a,2),t=li(t,a,2),t!==null&&(Ar(t,2),En(t))}function He(t,a,s){if(t.tag===3)Cg(t,t,s);else for(;a!==null;){if(a.tag===3){Cg(a,t,s);break}else if(a.tag===1){var c=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(yi===null||!yi.has(c))){t=Jt(s,t),s=wp(2),c=li(a,s,2),c!==null&&(Op(s,c,a,t),Ar(c,2),En(c));break}}a=a.return}}function Xu(t,a,s){var c=t.pingCache;if(c===null){c=t.pingCache=new QT;var f=new Set;c.set(a,f)}else f=c.get(a),f===void 0&&(f=new Set,c.set(a,f));f.has(s)||(Bu=!0,f.add(s),t=$T.bind(null,t,a,s),a.then(t,t))}function $T(t,a,s){var c=t.pingCache;c!==null&&c.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Fe===t&&(Ee&s)===s&&(We===4||We===3&&(Ee&62914560)===Ee&&300>bn()-Vu?(Ie&2)===0&&Ja(t,0):zu|=s,Qa===Ee&&(Qa=0)),En(t)}function Eg(t,a){a===0&&(a=Sh()),t=Pa(t,a),t!==null&&(Ar(t,a),En(t))}function ek(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),Eg(t,s)}function tk(t,a){var s=0;switch(t.tag){case 13:var c=t.stateNode,f=t.memoizedState;f!==null&&(s=f.retryLane);break;case 19:c=t.stateNode;break;case 22:c=t.stateNode._retryCache;break;default:throw Error(r(314))}c!==null&&c.delete(a),Eg(t,s)}function nk(t,a){return cl(t,a)}var Fo=null,$a=null,Zu=!1,Yo=!1,Ju=!1,ia=0;function En(t){t!==$a&&t.next===null&&($a===null?Fo=$a=t:$a=$a.next=t),Yo=!0,Zu||(Zu=!0,ak())}function fs(t,a){if(!Ju&&Yo){Ju=!0;do for(var s=!1,c=Fo;c!==null;){if(t!==0){var f=c.pendingLanes;if(f===0)var p=0;else{var v=c.suspendedLanes,S=c.pingedLanes;p=(1<<31-jt(42|t)+1)-1,p&=f&~(v&~S),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(s=!0,Og(c,p))}else p=Ee,p=Js(c,c===Fe?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(p&3)===0||Or(c,p)||(s=!0,Og(c,p));c=c.next}while(s);Ju=!1}}function ik(){Rg()}function Rg(){Yo=Zu=!1;var t=0;ia!==0&&(fk()&&(t=ia),ia=0);for(var a=bn(),s=null,c=Fo;c!==null;){var f=c.next,p=_g(c,a);p===0?(c.next=null,s===null?Fo=f:s.next=f,f===null&&($a=s)):(s=c,(t!==0||(p&3)!==0)&&(Yo=!0)),c=f}fs(t)}function _g(t,a){for(var s=t.suspendedLanes,c=t.pingedLanes,f=t.expirationTimes,p=t.pendingLanes&-62914561;0<p;){var v=31-jt(p),S=1<<v,R=f[v];R===-1?((S&s)===0||(S&c)!==0)&&(f[v]=AS(S,a)):R<=a&&(t.expiredLanes|=S),p&=~S}if(a=Fe,s=Ee,s=Js(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c=t.callbackNode,s===0||t===a&&(je===2||je===9)||t.cancelPendingCommit!==null)return c!==null&&c!==null&&ll(c),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||Or(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(c!==null&&ll(c),fl(s)){case 2:case 8:s=vh;break;case 32:s=Qs;break;case 268435456:s=yh;break;default:s=Qs}return c=wg.bind(null,t),s=cl(s,c),t.callbackPriority=a,t.callbackNode=s,a}return c!==null&&c!==null&&ll(c),t.callbackPriority=2,t.callbackNode=null,2}function wg(t,a){if(bt!==0&&bt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(Go()&&t.callbackNode!==s)return null;var c=Ee;return c=Js(t,t===Fe?c:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c===0?null:(lg(t,c,a),_g(t,bn()),t.callbackNode!=null&&t.callbackNode===s?wg.bind(null,t):null)}function Og(t,a){if(Go())return null;lg(t,a,!0)}function ak(){mk(function(){(Ie&6)!==0?cl(gh,ik):Rg()})}function Wu(){return ia===0&&(ia=bh()),ia}function Ag(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:no(""+t)}function Dg(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function rk(t,a,s,c,f){if(a==="submit"&&s&&s.stateNode===f){var p=Ag((f[wt]||null).action),v=c.submitter;v&&(a=(a=v[wt]||null)?Ag(a.formAction):v.getAttribute("formAction"),a!==null&&(p=a,v=null));var S=new so("action","action",null,c,f);t.push({event:S,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(ia!==0){var R=v?Dg(f,v):new FormData(f);yu(s,{pending:!0,data:R,method:f.method,action:p},null,R)}}else typeof p=="function"&&(S.preventDefault(),R=v?Dg(f,v):new FormData(f),yu(s,{pending:!0,data:R,method:f.method,action:p},p,R))},currentTarget:f}]})}}for(var $u=0;$u<Il.length;$u++){var ed=Il[$u],sk=ed.toLowerCase(),ok=ed[0].toUpperCase()+ed.slice(1);sn(sk,"on"+ok)}sn(lm,"onAnimationEnd"),sn(um,"onAnimationIteration"),sn(dm,"onAnimationStart"),sn("dblclick","onDoubleClick"),sn("focusin","onFocus"),sn("focusout","onBlur"),sn(ET,"onTransitionRun"),sn(RT,"onTransitionStart"),sn(_T,"onTransitionCancel"),sn(fm,"onTransitionEnd"),Ca("onMouseEnter",["mouseout","mouseover"]),Ca("onMouseLeave",["mouseout","mouseover"]),Ca("onPointerEnter",["pointerout","pointerover"]),Ca("onPointerLeave",["pointerout","pointerover"]),qi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),qi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),qi("onBeforeInput",["compositionend","keypress","textInput","paste"]),qi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),qi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),qi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ck=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hs));function Mg(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var c=t[s],f=c.event;c=c.listeners;e:{var p=void 0;if(a)for(var v=c.length-1;0<=v;v--){var S=c[v],R=S.instance,U=S.currentTarget;if(S=S.listener,R!==p&&f.isPropagationStopped())break e;p=S,f.currentTarget=U;try{p(f)}catch(F){Po(F)}f.currentTarget=null,p=R}else for(v=0;v<c.length;v++){if(S=c[v],R=S.instance,U=S.currentTarget,S=S.listener,R!==p&&f.isPropagationStopped())break e;p=S,f.currentTarget=U;try{p(f)}catch(F){Po(F)}f.currentTarget=null,p=R}}}}function Te(t,a){var s=a[hl];s===void 0&&(s=a[hl]=new Set);var c=t+"__bubble";s.has(c)||(xg(a,t,2,!1),s.add(c))}function td(t,a,s){var c=0;a&&(c|=4),xg(s,t,c,a)}var Ko="_reactListening"+Math.random().toString(36).slice(2);function nd(t){if(!t[Ko]){t[Ko]=!0,Rh.forEach(function(s){s!=="selectionchange"&&(ck.has(s)||td(s,!1,t),td(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[Ko]||(a[Ko]=!0,td("selectionchange",!1,a))}}function xg(t,a,s,c){switch(nv(a)){case 2:var f=Uk;break;case 8:f=Lk;break;default:f=gd}s=f.bind(null,a,s,t),f=void 0,!El||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(f=!0),c?f!==void 0?t.addEventListener(a,s,{capture:!0,passive:f}):t.addEventListener(a,s,!0):f!==void 0?t.addEventListener(a,s,{passive:f}):t.addEventListener(a,s,!1)}function id(t,a,s,c,f){var p=c;if((a&1)===0&&(a&2)===0&&c!==null)e:for(;;){if(c===null)return;var v=c.tag;if(v===3||v===4){var S=c.stateNode.containerInfo;if(S===f)break;if(v===4)for(v=c.return;v!==null;){var R=v.tag;if((R===3||R===4)&&v.stateNode.containerInfo===f)return;v=v.return}for(;S!==null;){if(v=Sa(S),v===null)return;if(R=v.tag,R===5||R===6||R===26||R===27){c=p=v;continue e}S=S.parentNode}}c=c.return}Bh(function(){var U=p,F=kl(s),K=[];e:{var L=hm.get(t);if(L!==void 0){var I=so,pe=t;switch(t){case"keypress":if(ao(s)===0)break e;case"keydown":case"keyup":I=nT;break;case"focusin":pe="focus",I=Ol;break;case"focusout":pe="blur",I=Ol;break;case"beforeblur":case"afterblur":I=Ol;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":I=Vh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":I=GS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":I=rT;break;case lm:case um:case dm:I=KS;break;case fm:I=oT;break;case"scroll":case"scrollend":I=VS;break;case"wheel":I=lT;break;case"copy":case"cut":case"paste":I=XS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":I=Gh;break;case"toggle":case"beforetoggle":I=dT}var fe=(a&4)!==0,qe=!fe&&(t==="scroll"||t==="scrollend"),x=fe?L!==null?L+"Capture":null:L;fe=[];for(var D=U,N;D!==null;){var Y=D;if(N=Y.stateNode,Y=Y.tag,Y!==5&&Y!==26&&Y!==27||N===null||x===null||(Y=xr(D,x),Y!=null&&fe.push(ms(D,Y,N))),qe)break;D=D.return}0<fe.length&&(L=new I(L,pe,null,s,F),K.push({event:L,listeners:fe}))}}if((a&7)===0){e:{if(L=t==="mouseover"||t==="pointerover",I=t==="mouseout"||t==="pointerout",L&&s!==Tl&&(pe=s.relatedTarget||s.fromElement)&&(Sa(pe)||pe[ba]))break e;if((I||L)&&(L=F.window===F?F:(L=F.ownerDocument)?L.defaultView||L.parentWindow:window,I?(pe=s.relatedTarget||s.toElement,I=U,pe=pe?Sa(pe):null,pe!==null&&(qe=l(pe),fe=pe.tag,pe!==qe||fe!==5&&fe!==27&&fe!==6)&&(pe=null)):(I=null,pe=U),I!==pe)){if(fe=Vh,Y="onMouseLeave",x="onMouseEnter",D="mouse",(t==="pointerout"||t==="pointerover")&&(fe=Gh,Y="onPointerLeave",x="onPointerEnter",D="pointer"),qe=I==null?L:Mr(I),N=pe==null?L:Mr(pe),L=new fe(Y,D+"leave",I,s,F),L.target=qe,L.relatedTarget=N,Y=null,Sa(F)===U&&(fe=new fe(x,D+"enter",pe,s,F),fe.target=N,fe.relatedTarget=qe,Y=fe),qe=Y,I&&pe)t:{for(fe=I,x=pe,D=0,N=fe;N;N=er(N))D++;for(N=0,Y=x;Y;Y=er(Y))N++;for(;0<D-N;)fe=er(fe),D--;for(;0<N-D;)x=er(x),N--;for(;D--;){if(fe===x||x!==null&&fe===x.alternate)break t;fe=er(fe),x=er(x)}fe=null}else fe=null;I!==null&&Pg(K,L,I,fe,!1),pe!==null&&qe!==null&&Pg(K,qe,pe,fe,!0)}}e:{if(L=U?Mr(U):window,I=L.nodeName&&L.nodeName.toLowerCase(),I==="select"||I==="input"&&L.type==="file")var ce=Wh;else if(Zh(L))if($h)ce=TT;else{ce=bT;var be=yT}else I=L.nodeName,!I||I.toLowerCase()!=="input"||L.type!=="checkbox"&&L.type!=="radio"?U&&Sl(U.elementType)&&(ce=Wh):ce=ST;if(ce&&(ce=ce(t,U))){Jh(K,ce,s,F);break e}be&&be(t,L,U),t==="focusout"&&U&&L.type==="number"&&U.memoizedProps.value!=null&&bl(L,"number",L.value)}switch(be=U?Mr(U):window,t){case"focusin":(Zh(be)||be.contentEditable==="true")&&(Da=be,Nl=U,zr=null);break;case"focusout":zr=Nl=Da=null;break;case"mousedown":Ul=!0;break;case"contextmenu":case"mouseup":case"dragend":Ul=!1,om(K,s,F);break;case"selectionchange":if(CT)break;case"keydown":case"keyup":om(K,s,F)}var ue;if(Dl)e:{switch(t){case"compositionstart":var he="onCompositionStart";break e;case"compositionend":he="onCompositionEnd";break e;case"compositionupdate":he="onCompositionUpdate";break e}he=void 0}else Aa?Qh(t,s)&&(he="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(he="onCompositionStart");he&&(Fh&&s.locale!=="ko"&&(Aa||he!=="onCompositionStart"?he==="onCompositionEnd"&&Aa&&(ue=zh()):(ri=F,Rl="value"in ri?ri.value:ri.textContent,Aa=!0)),be=Qo(U,he),0<be.length&&(he=new Hh(he,t,null,s,F),K.push({event:he,listeners:be}),ue?he.data=ue:(ue=Xh(s),ue!==null&&(he.data=ue)))),(ue=hT?mT(t,s):pT(t,s))&&(he=Qo(U,"onBeforeInput"),0<he.length&&(be=new Hh("onBeforeInput","beforeinput",null,s,F),K.push({event:be,listeners:he}),be.data=ue)),rk(K,t,U,s,F)}Mg(K,a)})}function ms(t,a,s){return{instance:t,listener:a,currentTarget:s}}function Qo(t,a){for(var s=a+"Capture",c=[];t!==null;){var f=t,p=f.stateNode;if(f=f.tag,f!==5&&f!==26&&f!==27||p===null||(f=xr(t,s),f!=null&&c.unshift(ms(t,f,p)),f=xr(t,a),f!=null&&c.push(ms(t,f,p))),t.tag===3)return c;t=t.return}return[]}function er(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Pg(t,a,s,c,f){for(var p=a._reactName,v=[];s!==null&&s!==c;){var S=s,R=S.alternate,U=S.stateNode;if(S=S.tag,R!==null&&R===c)break;S!==5&&S!==26&&S!==27||U===null||(R=U,f?(U=xr(s,p),U!=null&&v.unshift(ms(s,U,R))):f||(U=xr(s,p),U!=null&&v.push(ms(s,U,R)))),s=s.return}v.length!==0&&t.push({event:a,listeners:v})}var lk=/\r\n?/g,uk=/\u0000|\uFFFD/g;function Ng(t){return(typeof t=="string"?t:""+t).replace(lk,`
`).replace(uk,"")}function Ug(t,a){return a=Ng(a),Ng(t)===a}function Xo(){}function ze(t,a,s,c,f,p){switch(s){case"children":typeof c=="string"?a==="body"||a==="textarea"&&c===""||_a(t,c):(typeof c=="number"||typeof c=="bigint")&&a!=="body"&&_a(t,""+c);break;case"className":$s(t,"class",c);break;case"tabIndex":$s(t,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":$s(t,s,c);break;case"style":Ih(t,c,p);break;case"data":if(a!=="object"){$s(t,"data",c);break}case"src":case"href":if(c===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(s);break}c=no(""+c),t.setAttribute(s,c);break;case"action":case"formAction":if(typeof c=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(s==="formAction"?(a!=="input"&&ze(t,a,"name",f.name,f,null),ze(t,a,"formEncType",f.formEncType,f,null),ze(t,a,"formMethod",f.formMethod,f,null),ze(t,a,"formTarget",f.formTarget,f,null)):(ze(t,a,"encType",f.encType,f,null),ze(t,a,"method",f.method,f,null),ze(t,a,"target",f.target,f,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(s);break}c=no(""+c),t.setAttribute(s,c);break;case"onClick":c!=null&&(t.onclick=Xo);break;case"onScroll":c!=null&&Te("scroll",t);break;case"onScrollEnd":c!=null&&Te("scrollend",t);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(r(61));if(s=c.__html,s!=null){if(f.children!=null)throw Error(r(60));t.innerHTML=s}}break;case"multiple":t.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":t.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){t.removeAttribute("xlink:href");break}s=no(""+c),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(s,""+c):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":c===!0?t.setAttribute(s,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(s,c):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?t.setAttribute(s,c):t.removeAttribute(s);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?t.removeAttribute(s):t.setAttribute(s,c);break;case"popover":Te("beforetoggle",t),Te("toggle",t),Ws(t,"popover",c);break;case"xlinkActuate":Un(t,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Un(t,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Un(t,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Un(t,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Un(t,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Un(t,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Un(t,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Un(t,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Un(t,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ws(t,"is",c);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=zS.get(s)||s,Ws(t,s,c))}}function ad(t,a,s,c,f,p){switch(s){case"style":Ih(t,c,p);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(r(61));if(s=c.__html,s!=null){if(f.children!=null)throw Error(r(60));t.innerHTML=s}}break;case"children":typeof c=="string"?_a(t,c):(typeof c=="number"||typeof c=="bigint")&&_a(t,""+c);break;case"onScroll":c!=null&&Te("scroll",t);break;case"onScrollEnd":c!=null&&Te("scrollend",t);break;case"onClick":c!=null&&(t.onclick=Xo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_h.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(f=s.endsWith("Capture"),a=s.slice(2,f?s.length-7:void 0),p=t[wt]||null,p=p!=null?p[s]:null,typeof p=="function"&&t.removeEventListener(a,p,f),typeof c=="function")){typeof p!="function"&&p!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,c,f);break e}s in t?t[s]=c:c===!0?t.setAttribute(s,""):Ws(t,s,c)}}}function St(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Te("error",t),Te("load",t);var c=!1,f=!1,p;for(p in s)if(s.hasOwnProperty(p)){var v=s[p];if(v!=null)switch(p){case"src":c=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:ze(t,a,p,v,s,null)}}f&&ze(t,a,"srcSet",s.srcSet,s,null),c&&ze(t,a,"src",s.src,s,null);return;case"input":Te("invalid",t);var S=p=v=f=null,R=null,U=null;for(c in s)if(s.hasOwnProperty(c)){var F=s[c];if(F!=null)switch(c){case"name":f=F;break;case"type":v=F;break;case"checked":R=F;break;case"defaultChecked":U=F;break;case"value":p=F;break;case"defaultValue":S=F;break;case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(r(137,a));break;default:ze(t,a,c,F,s,null)}}Ph(t,p,S,R,U,v,f,!1),eo(t);return;case"select":Te("invalid",t),c=v=p=null;for(f in s)if(s.hasOwnProperty(f)&&(S=s[f],S!=null))switch(f){case"value":p=S;break;case"defaultValue":v=S;break;case"multiple":c=S;default:ze(t,a,f,S,s,null)}a=p,s=v,t.multiple=!!c,a!=null?Ra(t,!!c,a,!1):s!=null&&Ra(t,!!c,s,!0);return;case"textarea":Te("invalid",t),p=f=c=null;for(v in s)if(s.hasOwnProperty(v)&&(S=s[v],S!=null))switch(v){case"value":c=S;break;case"defaultValue":f=S;break;case"children":p=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(r(91));break;default:ze(t,a,v,S,s,null)}Uh(t,c,f,p),eo(t);return;case"option":for(R in s)if(s.hasOwnProperty(R)&&(c=s[R],c!=null))switch(R){case"selected":t.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:ze(t,a,R,c,s,null)}return;case"dialog":Te("beforetoggle",t),Te("toggle",t),Te("cancel",t),Te("close",t);break;case"iframe":case"object":Te("load",t);break;case"video":case"audio":for(c=0;c<hs.length;c++)Te(hs[c],t);break;case"image":Te("error",t),Te("load",t);break;case"details":Te("toggle",t);break;case"embed":case"source":case"link":Te("error",t),Te("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(U in s)if(s.hasOwnProperty(U)&&(c=s[U],c!=null))switch(U){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:ze(t,a,U,c,s,null)}return;default:if(Sl(a)){for(F in s)s.hasOwnProperty(F)&&(c=s[F],c!==void 0&&ad(t,a,F,c,s,void 0));return}}for(S in s)s.hasOwnProperty(S)&&(c=s[S],c!=null&&ze(t,a,S,c,s,null))}function dk(t,a,s,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var f=null,p=null,v=null,S=null,R=null,U=null,F=null;for(I in s){var K=s[I];if(s.hasOwnProperty(I)&&K!=null)switch(I){case"checked":break;case"value":break;case"defaultValue":R=K;default:c.hasOwnProperty(I)||ze(t,a,I,null,c,K)}}for(var L in c){var I=c[L];if(K=s[L],c.hasOwnProperty(L)&&(I!=null||K!=null))switch(L){case"type":p=I;break;case"name":f=I;break;case"checked":U=I;break;case"defaultChecked":F=I;break;case"value":v=I;break;case"defaultValue":S=I;break;case"children":case"dangerouslySetInnerHTML":if(I!=null)throw Error(r(137,a));break;default:I!==K&&ze(t,a,L,I,c,K)}}yl(t,v,S,R,U,F,p,f);return;case"select":I=v=S=L=null;for(p in s)if(R=s[p],s.hasOwnProperty(p)&&R!=null)switch(p){case"value":break;case"multiple":I=R;default:c.hasOwnProperty(p)||ze(t,a,p,null,c,R)}for(f in c)if(p=c[f],R=s[f],c.hasOwnProperty(f)&&(p!=null||R!=null))switch(f){case"value":L=p;break;case"defaultValue":S=p;break;case"multiple":v=p;default:p!==R&&ze(t,a,f,p,c,R)}a=S,s=v,c=I,L!=null?Ra(t,!!s,L,!1):!!c!=!!s&&(a!=null?Ra(t,!!s,a,!0):Ra(t,!!s,s?[]:"",!1));return;case"textarea":I=L=null;for(S in s)if(f=s[S],s.hasOwnProperty(S)&&f!=null&&!c.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:ze(t,a,S,null,c,f)}for(v in c)if(f=c[v],p=s[v],c.hasOwnProperty(v)&&(f!=null||p!=null))switch(v){case"value":L=f;break;case"defaultValue":I=f;break;case"children":break;case"dangerouslySetInnerHTML":if(f!=null)throw Error(r(91));break;default:f!==p&&ze(t,a,v,f,c,p)}Nh(t,L,I);return;case"option":for(var pe in s)if(L=s[pe],s.hasOwnProperty(pe)&&L!=null&&!c.hasOwnProperty(pe))switch(pe){case"selected":t.selected=!1;break;default:ze(t,a,pe,null,c,L)}for(R in c)if(L=c[R],I=s[R],c.hasOwnProperty(R)&&L!==I&&(L!=null||I!=null))switch(R){case"selected":t.selected=L&&typeof L!="function"&&typeof L!="symbol";break;default:ze(t,a,R,L,c,I)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fe in s)L=s[fe],s.hasOwnProperty(fe)&&L!=null&&!c.hasOwnProperty(fe)&&ze(t,a,fe,null,c,L);for(U in c)if(L=c[U],I=s[U],c.hasOwnProperty(U)&&L!==I&&(L!=null||I!=null))switch(U){case"children":case"dangerouslySetInnerHTML":if(L!=null)throw Error(r(137,a));break;default:ze(t,a,U,L,c,I)}return;default:if(Sl(a)){for(var qe in s)L=s[qe],s.hasOwnProperty(qe)&&L!==void 0&&!c.hasOwnProperty(qe)&&ad(t,a,qe,void 0,c,L);for(F in c)L=c[F],I=s[F],!c.hasOwnProperty(F)||L===I||L===void 0&&I===void 0||ad(t,a,F,L,c,I);return}}for(var x in s)L=s[x],s.hasOwnProperty(x)&&L!=null&&!c.hasOwnProperty(x)&&ze(t,a,x,null,c,L);for(K in c)L=c[K],I=s[K],!c.hasOwnProperty(K)||L===I||L==null&&I==null||ze(t,a,K,L,c,I)}var rd=null,sd=null;function Zo(t){return t.nodeType===9?t:t.ownerDocument}function Lg(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ig(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function od(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var cd=null;function fk(){var t=window.event;return t&&t.type==="popstate"?t===cd?!1:(cd=t,!0):(cd=null,!1)}var jg=typeof setTimeout=="function"?setTimeout:void 0,hk=typeof clearTimeout=="function"?clearTimeout:void 0,Bg=typeof Promise=="function"?Promise:void 0,mk=typeof queueMicrotask=="function"?queueMicrotask:typeof Bg<"u"?function(t){return Bg.resolve(null).then(t).catch(pk)}:jg;function pk(t){setTimeout(function(){throw t})}function Ti(t){return t==="head"}function zg(t,a){var s=a,c=0,f=0;do{var p=s.nextSibling;if(t.removeChild(s),p&&p.nodeType===8)if(s=p.data,s==="/$"){if(0<c&&8>c){s=c;var v=t.ownerDocument;if(s&1&&ps(v.documentElement),s&2&&ps(v.body),s&4)for(s=v.head,ps(s),v=s.firstChild;v;){var S=v.nextSibling,R=v.nodeName;v[Dr]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&v.rel.toLowerCase()==="stylesheet"||s.removeChild(v),v=S}}if(f===0){t.removeChild(p),Cs(a);return}f--}else s==="$"||s==="$?"||s==="$!"?f++:c=s.charCodeAt(0)-48;else c=0;s=p}while(s);Cs(a)}function ld(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":ld(s),ml(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function gk(t,a,s,c){for(;t.nodeType===1;){var f=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!c&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(c){if(!t[Dr])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(p=t.getAttribute("rel"),p==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(p!==f.rel||t.getAttribute("href")!==(f.href==null||f.href===""?null:f.href)||t.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin)||t.getAttribute("title")!==(f.title==null?null:f.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(p=t.getAttribute("src"),(p!==(f.src==null?null:f.src)||t.getAttribute("type")!==(f.type==null?null:f.type)||t.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin))&&p&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var p=f.name==null?null:""+f.name;if(f.type==="hidden"&&t.getAttribute("name")===p)return t}else return t;if(t=cn(t.nextSibling),t===null)break}return null}function vk(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=cn(t.nextSibling),t===null))return null;return t}function ud(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function yk(t,a){var s=t.ownerDocument;if(t.data!=="$?"||s.readyState==="complete")a();else{var c=function(){a(),s.removeEventListener("DOMContentLoaded",c)};s.addEventListener("DOMContentLoaded",c),t._reactRetry=c}}function cn(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return t}var dd=null;function qg(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(a===0)return t;a--}else s==="/$"&&a++}t=t.previousSibling}return null}function Vg(t,a,s){switch(a=Zo(s),t){case"html":if(t=a.documentElement,!t)throw Error(r(452));return t;case"head":if(t=a.head,!t)throw Error(r(453));return t;case"body":if(t=a.body,!t)throw Error(r(454));return t;default:throw Error(r(451))}}function ps(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);ml(t)}var an=new Map,Hg=new Set;function Jo(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Xn=ee.d;ee.d={f:bk,r:Sk,D:Tk,C:kk,L:Ck,m:Ek,X:_k,S:Rk,M:wk};function bk(){var t=Xn.f(),a=Vo();return t||a}function Sk(t){var a=Ta(t);a!==null&&a.tag===5&&a.type==="form"?lp(a):Xn.r(t)}var tr=typeof document>"u"?null:document;function Gg(t,a,s){var c=tr;if(c&&typeof a=="string"&&a){var f=Zt(a);f='link[rel="'+t+'"][href="'+f+'"]',typeof s=="string"&&(f+='[crossorigin="'+s+'"]'),Hg.has(f)||(Hg.add(f),t={rel:t,crossOrigin:s,href:a},c.querySelector(f)===null&&(a=c.createElement("link"),St(a,"link",t),ft(a),c.head.appendChild(a)))}}function Tk(t){Xn.D(t),Gg("dns-prefetch",t,null)}function kk(t,a){Xn.C(t,a),Gg("preconnect",t,a)}function Ck(t,a,s){Xn.L(t,a,s);var c=tr;if(c&&t&&a){var f='link[rel="preload"][as="'+Zt(a)+'"]';a==="image"&&s&&s.imageSrcSet?(f+='[imagesrcset="'+Zt(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(f+='[imagesizes="'+Zt(s.imageSizes)+'"]')):f+='[href="'+Zt(t)+'"]';var p=f;switch(a){case"style":p=nr(t);break;case"script":p=ir(t)}an.has(p)||(t=g({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),an.set(p,t),c.querySelector(f)!==null||a==="style"&&c.querySelector(gs(p))||a==="script"&&c.querySelector(vs(p))||(a=c.createElement("link"),St(a,"link",t),ft(a),c.head.appendChild(a)))}}function Ek(t,a){Xn.m(t,a);var s=tr;if(s&&t){var c=a&&typeof a.as=="string"?a.as:"script",f='link[rel="modulepreload"][as="'+Zt(c)+'"][href="'+Zt(t)+'"]',p=f;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=ir(t)}if(!an.has(p)&&(t=g({rel:"modulepreload",href:t},a),an.set(p,t),s.querySelector(f)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(vs(p)))return}c=s.createElement("link"),St(c,"link",t),ft(c),s.head.appendChild(c)}}}function Rk(t,a,s){Xn.S(t,a,s);var c=tr;if(c&&t){var f=ka(c).hoistableStyles,p=nr(t);a=a||"default";var v=f.get(p);if(!v){var S={loading:0,preload:null};if(v=c.querySelector(gs(p)))S.loading=5;else{t=g({rel:"stylesheet",href:t,"data-precedence":a},s),(s=an.get(p))&&fd(t,s);var R=v=c.createElement("link");ft(R),St(R,"link",t),R._p=new Promise(function(U,F){R.onload=U,R.onerror=F}),R.addEventListener("load",function(){S.loading|=1}),R.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Wo(v,a,c)}v={type:"stylesheet",instance:v,count:1,state:S},f.set(p,v)}}}function _k(t,a){Xn.X(t,a);var s=tr;if(s&&t){var c=ka(s).hoistableScripts,f=ir(t),p=c.get(f);p||(p=s.querySelector(vs(f)),p||(t=g({src:t,async:!0},a),(a=an.get(f))&&hd(t,a),p=s.createElement("script"),ft(p),St(p,"link",t),s.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(f,p))}}function wk(t,a){Xn.M(t,a);var s=tr;if(s&&t){var c=ka(s).hoistableScripts,f=ir(t),p=c.get(f);p||(p=s.querySelector(vs(f)),p||(t=g({src:t,async:!0,type:"module"},a),(a=an.get(f))&&hd(t,a),p=s.createElement("script"),ft(p),St(p,"link",t),s.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(f,p))}}function Fg(t,a,s,c){var f=(f=me.current)?Jo(f):null;if(!f)throw Error(r(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=nr(s.href),s=ka(f).hoistableStyles,c=s.get(a),c||(c={type:"style",instance:null,count:0,state:null},s.set(a,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=nr(s.href);var p=ka(f).hoistableStyles,v=p.get(t);if(v||(f=f.ownerDocument||f,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(t,v),(p=f.querySelector(gs(t)))&&!p._p&&(v.instance=p,v.state.loading=5),an.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},an.set(t,s),p||Ok(f,t,s,v.state))),a&&c===null)throw Error(r(528,""));return v}if(a&&c!==null)throw Error(r(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=ir(s),s=ka(f).hoistableScripts,c=s.get(a),c||(c={type:"script",instance:null,count:0,state:null},s.set(a,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,t))}}function nr(t){return'href="'+Zt(t)+'"'}function gs(t){return'link[rel="stylesheet"]['+t+"]"}function Yg(t){return g({},t,{"data-precedence":t.precedence,precedence:null})}function Ok(t,a,s,c){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?c.loading=1:(a=t.createElement("link"),c.preload=a,a.addEventListener("load",function(){return c.loading|=1}),a.addEventListener("error",function(){return c.loading|=2}),St(a,"link",s),ft(a),t.head.appendChild(a))}function ir(t){return'[src="'+Zt(t)+'"]'}function vs(t){return"script[async]"+t}function Kg(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var c=t.querySelector('style[data-href~="'+Zt(s.href)+'"]');if(c)return a.instance=c,ft(c),c;var f=g({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return c=(t.ownerDocument||t).createElement("style"),ft(c),St(c,"style",f),Wo(c,s.precedence,t),a.instance=c;case"stylesheet":f=nr(s.href);var p=t.querySelector(gs(f));if(p)return a.state.loading|=4,a.instance=p,ft(p),p;c=Yg(s),(f=an.get(f))&&fd(c,f),p=(t.ownerDocument||t).createElement("link"),ft(p);var v=p;return v._p=new Promise(function(S,R){v.onload=S,v.onerror=R}),St(p,"link",c),a.state.loading|=4,Wo(p,s.precedence,t),a.instance=p;case"script":return p=ir(s.src),(f=t.querySelector(vs(p)))?(a.instance=f,ft(f),f):(c=s,(f=an.get(p))&&(c=g({},s),hd(c,f)),t=t.ownerDocument||t,f=t.createElement("script"),ft(f),St(f,"link",c),t.head.appendChild(f),a.instance=f);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(c=a.instance,a.state.loading|=4,Wo(c,s.precedence,t));return a.instance}function Wo(t,a,s){for(var c=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),f=c.length?c[c.length-1]:null,p=f,v=0;v<c.length;v++){var S=c[v];if(S.dataset.precedence===a)p=S;else if(p!==f)break}p?p.parentNode.insertBefore(t,p.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function fd(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function hd(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var $o=null;function Qg(t,a,s){if($o===null){var c=new Map,f=$o=new Map;f.set(s,c)}else f=$o,c=f.get(s),c||(c=new Map,f.set(s,c));if(c.has(t))return c;for(c.set(t,null),s=s.getElementsByTagName(t),f=0;f<s.length;f++){var p=s[f];if(!(p[Dr]||p[kt]||t==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var v=p.getAttribute(a)||"";v=t+v;var S=c.get(v);S?S.push(p):c.set(v,[p])}}return c}function Xg(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function Ak(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Zg(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var ys=null;function Dk(){}function Mk(t,a,s){if(ys===null)throw Error(r(475));var c=ys;if(a.type==="stylesheet"&&(typeof s.media!="string"||matchMedia(s.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var f=nr(s.href),p=t.querySelector(gs(f));if(p){t=p._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(c.count++,c=ec.bind(c),t.then(c,c)),a.state.loading|=4,a.instance=p,ft(p);return}p=t.ownerDocument||t,s=Yg(s),(f=an.get(f))&&fd(s,f),p=p.createElement("link"),ft(p);var v=p;v._p=new Promise(function(S,R){v.onload=S,v.onerror=R}),St(p,"link",s),a.instance=p}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(c.count++,a=ec.bind(c),t.addEventListener("load",a),t.addEventListener("error",a))}}function xk(){if(ys===null)throw Error(r(475));var t=ys;return t.stylesheets&&t.count===0&&md(t,t.stylesheets),0<t.count?function(a){var s=setTimeout(function(){if(t.stylesheets&&md(t,t.stylesheets),t.unsuspend){var c=t.unsuspend;t.unsuspend=null,c()}},6e4);return t.unsuspend=a,function(){t.unsuspend=null,clearTimeout(s)}}:null}function ec(){if(this.count--,this.count===0){if(this.stylesheets)md(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var tc=null;function md(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,tc=new Map,a.forEach(Pk,t),tc=null,ec.call(t))}function Pk(t,a){if(!(a.state.loading&4)){var s=tc.get(t);if(s)var c=s.get(null);else{s=new Map,tc.set(t,s);for(var f=t.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<f.length;p++){var v=f[p];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(s.set(v.dataset.precedence,v),c=v)}c&&s.set(null,c)}f=a.instance,v=f.getAttribute("data-precedence"),p=s.get(v)||c,p===c&&s.set(null,f),s.set(v,f),this.count++,c=ec.bind(this),f.addEventListener("load",c),f.addEventListener("error",c),p?p.parentNode.insertBefore(f,p.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(f,t.firstChild)),a.state.loading|=4}}var bs={$$typeof:q,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function Nk(t,a,s,c,f,p,v,S){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ul(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ul(0),this.hiddenUpdates=ul(null),this.identifierPrefix=c,this.onUncaughtError=f,this.onCaughtError=p,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function Jg(t,a,s,c,f,p,v,S,R,U,F,K){return t=new Nk(t,a,s,v,S,R,U,K),a=1,p===!0&&(a|=24),p=zt(3,null,null,a),t.current=p,p.stateNode=t,a=Xl(),a.refCount++,t.pooledCache=a,a.refCount++,p.memoizedState={element:c,isDehydrated:s,cache:a},$l(p),t}function Wg(t){return t?(t=Na,t):Na}function $g(t,a,s,c,f,p){f=Wg(f),c.context===null?c.context=f:c.pendingContext=f,c=ci(a),c.payload={element:s},p=p===void 0?null:p,p!==null&&(c.callback=p),s=li(t,c,a),s!==null&&(Ft(s,t,a),Xr(s,t,a))}function ev(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function pd(t,a){ev(t,a),(t=t.alternate)&&ev(t,a)}function tv(t){if(t.tag===13){var a=Pa(t,67108864);a!==null&&Ft(a,t,67108864),pd(t,67108864)}}var nc=!0;function Uk(t,a,s,c){var f=V.T;V.T=null;var p=ee.p;try{ee.p=2,gd(t,a,s,c)}finally{ee.p=p,V.T=f}}function Lk(t,a,s,c){var f=V.T;V.T=null;var p=ee.p;try{ee.p=8,gd(t,a,s,c)}finally{ee.p=p,V.T=f}}function gd(t,a,s,c){if(nc){var f=vd(c);if(f===null)id(t,a,c,ic,s),iv(t,c);else if(jk(f,t,a,s,c))c.stopPropagation();else if(iv(t,c),a&4&&-1<Ik.indexOf(t)){for(;f!==null;){var p=Ta(f);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var v=zi(p.pendingLanes);if(v!==0){var S=p;for(S.pendingLanes|=2,S.entangledLanes|=2;v;){var R=1<<31-jt(v);S.entanglements[1]|=R,v&=~R}En(p),(Ie&6)===0&&(zo=bn()+500,fs(0))}}break;case 13:S=Pa(p,2),S!==null&&Ft(S,p,2),Vo(),pd(p,2)}if(p=vd(c),p===null&&id(t,a,c,ic,s),p===f)break;f=p}f!==null&&c.stopPropagation()}else id(t,a,c,null,s)}}function vd(t){return t=kl(t),yd(t)}var ic=null;function yd(t){if(ic=null,t=Sa(t),t!==null){var a=l(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=u(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return ic=t,null}function nv(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kS()){case gh:return 2;case vh:return 8;case Qs:case CS:return 32;case yh:return 268435456;default:return 32}default:return 32}}var bd=!1,ki=null,Ci=null,Ei=null,Ss=new Map,Ts=new Map,Ri=[],Ik="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function iv(t,a){switch(t){case"focusin":case"focusout":ki=null;break;case"dragenter":case"dragleave":Ci=null;break;case"mouseover":case"mouseout":Ei=null;break;case"pointerover":case"pointerout":Ss.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ts.delete(a.pointerId)}}function ks(t,a,s,c,f,p){return t===null||t.nativeEvent!==p?(t={blockedOn:a,domEventName:s,eventSystemFlags:c,nativeEvent:p,targetContainers:[f]},a!==null&&(a=Ta(a),a!==null&&tv(a)),t):(t.eventSystemFlags|=c,a=t.targetContainers,f!==null&&a.indexOf(f)===-1&&a.push(f),t)}function jk(t,a,s,c,f){switch(a){case"focusin":return ki=ks(ki,t,a,s,c,f),!0;case"dragenter":return Ci=ks(Ci,t,a,s,c,f),!0;case"mouseover":return Ei=ks(Ei,t,a,s,c,f),!0;case"pointerover":var p=f.pointerId;return Ss.set(p,ks(Ss.get(p)||null,t,a,s,c,f)),!0;case"gotpointercapture":return p=f.pointerId,Ts.set(p,ks(Ts.get(p)||null,t,a,s,c,f)),!0}return!1}function av(t){var a=Sa(t.target);if(a!==null){var s=l(a);if(s!==null){if(a=s.tag,a===13){if(a=u(s),a!==null){t.blockedOn=a,MS(t.priority,function(){if(s.tag===13){var c=Gt();c=dl(c);var f=Pa(s,c);f!==null&&Ft(f,s,c),pd(s,c)}});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ac(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=vd(t.nativeEvent);if(s===null){s=t.nativeEvent;var c=new s.constructor(s.type,s);Tl=c,s.target.dispatchEvent(c),Tl=null}else return a=Ta(s),a!==null&&tv(a),t.blockedOn=s,!1;a.shift()}return!0}function rv(t,a,s){ac(t)&&s.delete(a)}function Bk(){bd=!1,ki!==null&&ac(ki)&&(ki=null),Ci!==null&&ac(Ci)&&(Ci=null),Ei!==null&&ac(Ei)&&(Ei=null),Ss.forEach(rv),Ts.forEach(rv)}function rc(t,a){t.blockedOn===a&&(t.blockedOn=null,bd||(bd=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Bk)))}var sc=null;function sv(t){sc!==t&&(sc=t,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){sc===t&&(sc=null);for(var a=0;a<t.length;a+=3){var s=t[a],c=t[a+1],f=t[a+2];if(typeof c!="function"){if(yd(c||s)===null)continue;break}var p=Ta(s);p!==null&&(t.splice(a,3),a-=3,yu(p,{pending:!0,data:f,method:s.method,action:c},c,f))}}))}function Cs(t){function a(R){return rc(R,t)}ki!==null&&rc(ki,t),Ci!==null&&rc(Ci,t),Ei!==null&&rc(Ei,t),Ss.forEach(a),Ts.forEach(a);for(var s=0;s<Ri.length;s++){var c=Ri[s];c.blockedOn===t&&(c.blockedOn=null)}for(;0<Ri.length&&(s=Ri[0],s.blockedOn===null);)av(s),s.blockedOn===null&&Ri.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(c=0;c<s.length;c+=3){var f=s[c],p=s[c+1],v=f[wt]||null;if(typeof p=="function")v||sv(s);else if(v){var S=null;if(p&&p.hasAttribute("formAction")){if(f=p,v=p[wt]||null)S=v.formAction;else if(yd(f)!==null)continue}else S=v.action;typeof S=="function"?s[c+1]=S:(s.splice(c,3),c-=3),sv(s)}}}function Sd(t){this._internalRoot=t}oc.prototype.render=Sd.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(r(409));var s=a.current,c=Gt();$g(s,c,t,a,null,null)},oc.prototype.unmount=Sd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;$g(t.current,2,null,t,null,null),Vo(),a[ba]=null}};function oc(t){this._internalRoot=t}oc.prototype.unstable_scheduleHydration=function(t){if(t){var a=Ch();t={blockedOn:null,target:t,priority:a};for(var s=0;s<Ri.length&&a!==0&&a<Ri[s].priority;s++);Ri.splice(s,0,t),s===0&&av(t)}};var ov=e.version;if(ov!=="19.1.0")throw Error(r(527,ov,"19.1.0"));ee.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(r(188)):(t=Object.keys(t).join(","),Error(r(268,t)));return t=h(a),t=t!==null?m(t):null,t=t===null?null:t.stateNode,t};var zk={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cc.isDisabled&&cc.supportsFiber)try{wr=cc.inject(zk),It=cc}catch{}}return Rs.createRoot=function(t,a){if(!o(t))throw Error(r(299));var s=!1,c="",f=Cp,p=Ep,v=Rp,S=null;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(f=a.onUncaughtError),a.onCaughtError!==void 0&&(p=a.onCaughtError),a.onRecoverableError!==void 0&&(v=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(S=a.unstable_transitionCallbacks)),a=Jg(t,1,!1,null,null,s,c,f,p,v,S,null),t[ba]=a.current,nd(t),new Sd(a)},Rs.hydrateRoot=function(t,a,s){if(!o(t))throw Error(r(299));var c=!1,f="",p=Cp,v=Ep,S=Rp,R=null,U=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(f=s.identifierPrefix),s.onUncaughtError!==void 0&&(p=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(S=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(R=s.unstable_transitionCallbacks),s.formState!==void 0&&(U=s.formState)),a=Jg(t,1,!0,a,s??null,c,f,p,v,S,R,U),a.context=Wg(null),s=a.current,c=Gt(),c=dl(c),f=ci(c),f.callback=null,li(s,f,c),s=c,a.current.lanes=s,Ar(a,s),En(a),t[ba]=a.current,nd(t),new oc(a)},Rs.version="19.1.0",Rs}var vv;function Zk(){if(vv)return Cd.exports;vv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Cd.exports=Xk(),Cd.exports}var Jk=Zk(),yv={};function Wk(i,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in i)){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(i,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(i)}var $k=Object.defineProperty,eC=(i,e,n)=>e in i?$k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,bv=(i,e,n)=>eC(i,typeof e!="symbol"?e+"":e,n);let Nt=class{constructor(){bv(this,"_locking"),bv(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(o=>e=()=>{this._locks-=1,o()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}};function et(i,e){if(!i)throw new Error(e)}const tC=34028234663852886e22,nC=-34028234663852886e22,iC=4294967295,aC=2147483647,rC=-2147483648;function pc(i){if(typeof i!="number")throw new Error("invalid int 32: "+typeof i);if(!Number.isInteger(i)||i>aC||i<rC)throw new Error("invalid int 32: "+i)}function Zd(i){if(typeof i!="number")throw new Error("invalid uint 32: "+typeof i);if(!Number.isInteger(i)||i>iC||i<0)throw new Error("invalid uint 32: "+i)}function By(i){if(typeof i!="number")throw new Error("invalid float 32: "+typeof i);if(Number.isFinite(i)&&(i>tC||i<nC))throw new Error("invalid float 32: "+i)}const zy=Symbol("@bufbuild/protobuf/enum-type");function sC(i){const e=i[zy];return et(e,"missing enum type on enum object"),e}function qy(i,e,n,r){i[zy]=Vy(e,n.map(o=>({no:o.no,name:o.name,localName:i[o.no]})))}function Vy(i,e,n){const r=Object.create(null),o=Object.create(null),l=[];for(const u of e){const d=Hy(u);l.push(d),r[u.name]=d,o[u.no]=d}return{typeName:i,values:l,findName(u){return r[u]},findNumber(u){return o[u]}}}function oC(i,e,n){const r={};for(const o of e){const l=Hy(o);r[l.localName]=l.no,r[l.no]=l.localName}return qy(r,i,e),r}function Hy(i){return"localName"in i?i:Object.assign(Object.assign({},i),{localName:i.name})}let zf=class{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),o=r.runtime.bin,l=o.makeReadOptions(n);return o.readMessage(this,l.readerFactory(e),e.byteLength,l),this}fromJson(e,n){const r=this.getType(),o=r.runtime.json,l=o.makeReadOptions(n);return o.readMessage(r,e,l,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,o=r.makeWriteOptions(e),l=o.writerFactory();return r.writeMessage(this,l,o),l.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,o=r.makeWriteOptions(e);return r.writeMessage(this,o)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}};function cC(i,e,n,r){var o;const l=(o=r==null?void 0:r.localName)!==null&&o!==void 0?o:e.substring(e.lastIndexOf(".")+1),u={[l]:function(d){i.util.initFields(this),i.util.initPartial(d,this)}}[l];return Object.setPrototypeOf(u.prototype,new zf),Object.assign(u,{runtime:i,typeName:e,fields:i.util.newFieldList(n),fromBinary(d,h){return new u().fromBinary(d,h)},fromJson(d,h){return new u().fromJson(d,h)},fromJsonString(d,h){return new u().fromJsonString(d,h)},equals(d,h){return i.util.equals(u,d,h)}}),u}function lC(){let i=0,e=0;for(let r=0;r<28;r+=7){let o=this.buf[this.pos++];if(i|=(o&127)<<r,(o&128)==0)return this.assertBounds(),[i,e]}let n=this.buf[this.pos++];if(i|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[i,e];for(let r=3;r<=31;r+=7){let o=this.buf[this.pos++];if(e|=(o&127)<<r,(o&128)==0)return this.assertBounds(),[i,e]}throw new Error("invalid varint")}function wd(i,e,n){for(let l=0;l<28;l=l+7){const u=i>>>l,d=!(!(u>>>7)&&e==0),h=(d?u|128:u)&255;if(n.push(h),!d)return}const r=i>>>28&15|(e&7)<<4,o=e>>3!=0;if(n.push((o?r|128:r)&255),!!o){for(let l=3;l<31;l=l+7){const u=e>>>l,d=!!(u>>>7),h=(d?u|128:u)&255;if(n.push(h),!d)return}n.push(e>>>31&1)}}const gc=4294967296;function Sv(i){const e=i[0]==="-";e&&(i=i.slice(1));const n=1e6;let r=0,o=0;function l(u,d){const h=Number(i.slice(u,d));o*=n,r=r*n+h,r>=gc&&(o=o+(r/gc|0),r=r%gc)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),e?Fy(r,o):qf(r,o)}function uC(i,e){let n=qf(i,e);const r=n.hi&2147483648;r&&(n=Fy(n.lo,n.hi));const o=Gy(n.lo,n.hi);return r?"-"+o:o}function Gy(i,e){if({lo:i,hi:e}=dC(i,e),e<=2097151)return String(gc*e+i);const n=i&16777215,r=(i>>>24|e<<8)&16777215,o=e>>16&65535;let l=n+r*6777216+o*6710656,u=r+o*8147497,d=o*2;const h=1e7;return l>=h&&(u+=Math.floor(l/h),l%=h),u>=h&&(d+=Math.floor(u/h),u%=h),d.toString()+Tv(u)+Tv(l)}function dC(i,e){return{lo:i>>>0,hi:e>>>0}}function qf(i,e){return{lo:i|0,hi:e|0}}function Fy(i,e){return e=~e,i?i=~i+1:e+=1,qf(i,e)}const Tv=i=>{const e=String(i);return"0000000".slice(e.length)+e};function kv(i,e){if(i>=0){for(;i>127;)e.push(i&127|128),i=i>>>7;e.push(i)}else{for(let n=0;n<9;n++)e.push(i&127|128),i=i>>7;e.push(1)}}function fC(){let i=this.buf[this.pos++],e=i&127;if((i&128)==0)return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<7,(i&128)==0)return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<14,(i&128)==0)return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<21,(i&128)==0)return this.assertBounds(),e;i=this.buf[this.pos++],e|=(i&15)<<28;for(let n=5;(i&128)!==0&&n<10;n++)i=this.buf[this.pos++];if((i&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function hC(){const i=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof i.getBigInt64=="function"&&typeof i.getBigUint64=="function"&&typeof i.setBigInt64=="function"&&typeof i.setBigUint64=="function"&&(typeof process!="object"||typeof yv!="object"||yv.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),u=BigInt("0"),d=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const m=typeof h=="bigint"?h:BigInt(h);if(m>l||m<o)throw new Error("int64 invalid: ".concat(h));return m},uParse(h){const m=typeof h=="bigint"?h:BigInt(h);if(m>d||m<u)throw new Error("uint64 invalid: ".concat(h));return m},enc(h){return i.setBigInt64(0,this.parse(h),!0),{lo:i.getInt32(0,!0),hi:i.getInt32(4,!0)}},uEnc(h){return i.setBigInt64(0,this.uParse(h),!0),{lo:i.getInt32(0,!0),hi:i.getInt32(4,!0)}},dec(h,m){return i.setInt32(0,h,!0),i.setInt32(4,m,!0),i.getBigInt64(0,!0)},uDec(h,m){return i.setInt32(0,h,!0),i.setInt32(4,m,!0),i.getBigUint64(0,!0)}}}const n=o=>et(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),r=o=>et(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),n(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),r(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),n(o),Sv(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),r(o),Sv(o)},dec(o,l){return uC(o,l)},uDec(o,l){return Gy(o,l)}}}const Xe=hC();var X;(function(i){i[i.DOUBLE=1]="DOUBLE",i[i.FLOAT=2]="FLOAT",i[i.INT64=3]="INT64",i[i.UINT64=4]="UINT64",i[i.INT32=5]="INT32",i[i.FIXED64=6]="FIXED64",i[i.FIXED32=7]="FIXED32",i[i.BOOL=8]="BOOL",i[i.STRING=9]="STRING",i[i.BYTES=12]="BYTES",i[i.UINT32=13]="UINT32",i[i.SFIXED32=15]="SFIXED32",i[i.SFIXED64=16]="SFIXED64",i[i.SINT32=17]="SINT32",i[i.SINT64=18]="SINT64"})(X||(X={}));var Ui;(function(i){i[i.BIGINT=0]="BIGINT",i[i.STRING=1]="STRING"})(Ui||(Ui={}));function wi(i,e,n){if(e===n)return!0;if(i==X.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(i){case X.UINT64:case X.FIXED64:case X.INT64:case X.SFIXED64:case X.SINT64:return e==n}return!1}function vr(i,e){switch(i){case X.BOOL:return!1;case X.UINT64:case X.FIXED64:case X.INT64:case X.SFIXED64:case X.SINT64:return e==0?Xe.zero:"0";case X.DOUBLE:case X.FLOAT:return 0;case X.BYTES:return new Uint8Array(0);case X.STRING:return"";default:return 0}}function Yy(i,e){switch(i){case X.BOOL:return e===!1;case X.STRING:return e==="";case X.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var at;(function(i){i[i.Varint=0]="Varint",i[i.Bit64=1]="Bit64",i[i.LengthDelimited=2]="LengthDelimited",i[i.StartGroup=3]="StartGroup",i[i.EndGroup=4]="EndGroup",i[i.Bit32=5]="Bit32"})(at||(at={}));class mC{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let o=0;o<this.chunks.length;o++)e+=this.chunks[o].length;let n=new Uint8Array(e),r=0;for(let o=0;o<this.chunks.length;o++)n.set(this.chunks[o],r),r+=this.chunks[o].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Zd(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return pc(e),kv(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){By(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Zd(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){pc(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return pc(e),e=(e<<1^e>>31)>>>0,kv(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),o=Xe.enc(e);return r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),o=Xe.uEnc(e);return r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),this.raw(n)}int64(e){let n=Xe.enc(e);return wd(n.lo,n.hi,this.buf),this}sint64(e){let n=Xe.enc(e),r=n.hi>>31,o=n.lo<<1^r,l=(n.hi<<1|n.lo>>>31)^r;return wd(o,l,this.buf),this}uint64(e){let n=Xe.uEnc(e);return wd(n.lo,n.hi,this.buf),this}}class pC{constructor(e,n){this.varint64=lC,this.uint32=fC,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case at.Varint:for(;this.buf[this.pos++]&128;);break;case at.Bit64:this.pos+=4;case at.Bit32:this.pos+=4;break;case at.LengthDelimited:let o=this.uint32();this.pos+=o;break;case at.StartGroup:for(;;){const[l,u]=this.tag();if(u===at.EndGroup){if(n!==void 0&&l!==n)throw new Error("invalid end group tag");break}this.skip(u,l)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Xe.dec(...this.varint64())}uint64(){return Xe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,Xe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Xe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Xe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function gC(i,e,n,r){let o;return{typeName:e,extendee:n,get field(){if(!o){const l=typeof r=="function"?r():r;l.name=e.split(".").pop(),l.jsonName="[".concat(e,"]"),o=i.util.newFieldList([l]).list()[0]}return o},runtime:i}}function Ky(i){const e=i.field.localName,n=Object.create(null);return n[e]=vC(i),[n,()=>n[e]]}function vC(i){const e=i.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return vr(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function yC(i,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=i.length-1;n>=0;--n)if(i[n].no==e.no)return[i[n]];return[]}return i.filter(n=>n.no===e.no)}let Jn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Yc=[];for(let i=0;i<Jn.length;i++)Yc[Jn[i].charCodeAt(0)]=i;Yc[45]=Jn.indexOf("+");Yc[95]=Jn.indexOf("/");const Qy={dec(i){let e=i.length*3/4;i[i.length-2]=="="?e-=2:i[i.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,o=0,l,u=0;for(let d=0;d<i.length;d++){if(l=Yc[i.charCodeAt(d)],l===void 0)switch(i[d]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:u=l,o=1;break;case 1:n[r++]=u<<2|(l&48)>>4,u=l,o=2;break;case 2:n[r++]=(u&15)<<4|(l&60)>>2,u=l,o=3;break;case 3:n[r++]=(u&3)<<6|l,o=0;break}}if(o==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(i){let e="",n=0,r,o=0;for(let l=0;l<i.length;l++)switch(r=i[l],n){case 0:e+=Jn[r>>2],o=(r&3)<<4,n=1;break;case 1:e+=Jn[o|r>>4],o=(r&15)<<2,n=2;break;case 2:e+=Jn[o|r>>6],e+=Jn[r&63],n=0;break}return n&&(e+=Jn[o],e+="=",n==1&&(e+="=")),e}};function bC(i,e,n){Zy(e,i);const r=e.runtime.bin.makeReadOptions(n),o=yC(i.getType().runtime.bin.listUnknownFields(i),e.field),[l,u]=Ky(e);for(const d of o)e.runtime.bin.readField(l,r.readerFactory(d.data),e.field,d.wireType,r);return u()}function SC(i,e,n,r){Zy(e,i);const o=e.runtime.bin.makeReadOptions(r),l=e.runtime.bin.makeWriteOptions(r);if(Xy(i,e)){const m=i.getType().runtime.bin.listUnknownFields(i).filter(g=>g.no!=e.field.no);i.getType().runtime.bin.discardUnknownFields(i);for(const g of m)i.getType().runtime.bin.onUnknownField(i,g.no,g.wireType,g.data)}const u=l.writerFactory();let d=e.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(d,n,u,l);const h=o.readerFactory(u.finish());for(;h.pos<h.len;){const[m,g]=h.tag(),y=h.skip(g,m);i.getType().runtime.bin.onUnknownField(i,m,g,y)}}function Xy(i,e){const n=i.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(i).find(r=>r.no==e.field.no)}function Zy(i,e){et(i.extendee.typeName==e.getType().typeName,"extension ".concat(i.typeName," can only be applied to message ").concat(i.extendee.typeName))}function Jy(i,e){const n=i.localName;if(i.repeated)return e[n].length>0;if(i.oneof)return e[i.oneof.localName].case===n;switch(i.kind){case"enum":case"scalar":return i.opt||i.req?e[n]!==void 0:i.kind=="enum"?e[n]!==i.T.values[0].no:!Yy(i.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Cv(i,e){const n=i.localName,r=!i.opt&&!i.req;if(i.repeated)e[n]=[];else if(i.oneof)e[i.oneof.localName]={case:void 0};else switch(i.kind){case"map":e[n]={};break;case"enum":e[n]=r?i.T.values[0].no:void 0;break;case"scalar":e[n]=r?vr(i.T,i.L):void 0;break;case"message":e[n]=void 0;break}}function sa(i,e){if(i===null||typeof i!="object"||!Object.getOwnPropertyNames(zf.prototype).every(r=>r in i&&typeof i[r]=="function"))return!1;const n=i.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Wy(i,e){return sa(e)||!i.fieldWrapper?e:i.fieldWrapper.wrapField(e)}X.DOUBLE,X.FLOAT,X.INT64,X.UINT64,X.INT32,X.UINT32,X.BOOL,X.STRING,X.BYTES;const Ev={ignoreUnknownFields:!1},Rv={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function TC(i){return i?Object.assign(Object.assign({},Ev),i):Ev}function kC(i){return i?Object.assign(Object.assign({},Rv),i):Rv}const Mc=Symbol(),vc=Symbol();function CC(){return{makeReadOptions:TC,makeWriteOptions:kC,readMessage(i,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(i.typeName," from JSON: ").concat(_n(e)));r=r??new i;const o=new Map,l=n.typeRegistry;for(const[u,d]of Object.entries(e)){const h=i.fields.findJsonName(u);if(h){if(h.oneof){if(d===null&&h.kind=="scalar")continue;const m=o.get(h.oneof);if(m!==void 0)throw new Error("cannot decode message ".concat(i.typeName,' from JSON: multiple keys for oneof "').concat(h.oneof.name,'" present: "').concat(m,'", "').concat(u,'"'));o.set(h.oneof,u)}_v(r,d,h,n,i)}else{let m=!1;if(l!=null&&l.findExtension&&u.startsWith("[")&&u.endsWith("]")){const g=l.findExtension(u.substring(1,u.length-1));if(g&&g.extendee.typeName==i.typeName){m=!0;const[y,b]=Ky(g);_v(y,d,g.field,n,g),SC(r,g,b(),n)}}if(!m&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(i.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return r},writeMessage(i,e){const n=i.getType(),r={};let o;try{for(o of n.fields.byNumber()){if(!Jy(o,i)){if(o.req)throw"required field not set";if(!e.emitDefaultValues||!RC(o))continue}const u=o.oneof?i[o.oneof.localName].value:i[o.localName],d=wv(o,u,e);d!==void 0&&(r[e.useProtoFieldName?o.name:o.jsonName]=d)}const l=e.typeRegistry;if(l!=null&&l.findExtensionFor)for(const u of n.runtime.bin.listUnknownFields(i)){const d=l.findExtensionFor(n.typeName,u.no);if(d&&Xy(i,d)){const h=bC(i,d,e),m=wv(d.field,h,e);m!==void 0&&(r[d.field.jsonName]=m)}}}catch(l){const u=o?"cannot encode field ".concat(n.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),d=l instanceof Error?l.message:String(l);throw new Error(u+(d.length>0?": ".concat(d):""))}return r},readScalar(i,e,n){return Ps(i,e,n??Ui.BIGINT,!0)},writeScalar(i,e,n){if(e!==void 0&&(n||Yy(i,e)))return yc(i,e)},debug:_n}}function _n(i){if(i===null)return"null";switch(typeof i){case"object":return Array.isArray(i)?"array":"object";case"string":return i.length>100?"string":'"'.concat(i.split('"').join('\\"'),'"');default:return String(i)}}function _v(i,e,n,r,o){let l=n.localName;if(n.repeated){if(et(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(e)));const u=i[l];for(const d of e){if(d===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(d)));switch(n.kind){case"message":u.push(n.T.fromJson(d,r));break;case"enum":const h=Od(n.T,d,r.ignoreUnknownFields,!0);h!==vc&&u.push(h);break;case"scalar":try{u.push(Ps(n.T,d,n.L,!0))}catch(m){let g="cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(d));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(e)));const u=i[l];for(const[d,h]of Object.entries(e)){if(h===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: map value null"));let m;try{m=EC(n.K,d)}catch(g){let y="cannot decode map key for field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(e));throw g instanceof Error&&g.message.length>0&&(y+=": ".concat(g.message)),new Error(y)}switch(n.V.kind){case"message":u[m]=n.V.T.fromJson(h,r);break;case"enum":const g=Od(n.V.T,h,r.ignoreUnknownFields,!0);g!==vc&&(u[m]=g);break;case"scalar":try{u[m]=Ps(n.V.T,h,Ui.BIGINT,!0)}catch(y){let b="cannot decode map value for field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(e));throw y instanceof Error&&y.message.length>0&&(b+=": ".concat(y.message)),new Error(b)}break}}}else switch(n.oneof&&(i=i[n.oneof.localName]={case:l},l="value"),n.kind){case"message":const u=n.T;if(e===null&&u.typeName!="google.protobuf.Value")return;let d=i[l];sa(d)?d.fromJson(e,r):(i[l]=d=u.fromJson(e,r),u.fieldWrapper&&!n.oneof&&(i[l]=u.fieldWrapper.unwrapField(d)));break;case"enum":const h=Od(n.T,e,r.ignoreUnknownFields,!1);switch(h){case Mc:Cv(n,i);break;case vc:break;default:i[l]=h;break}break;case"scalar":try{const m=Ps(n.T,e,n.L,!1);switch(m){case Mc:Cv(n,i);break;default:i[l]=m;break}}catch(m){let g="cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(_n(e));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}break}}function EC(i,e){if(i===X.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ps(i,e,Ui.BIGINT,!0).toString()}function Ps(i,e,n,r){if(e===null)return r?vr(i,n):Mc;switch(i){case X.DOUBLE:case X.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const o=Number(e);if(Number.isNaN(o)||!Number.isFinite(o))break;return i==X.FLOAT&&By(o),o;case X.INT32:case X.FIXED32:case X.SFIXED32:case X.SINT32:case X.UINT32:let l;if(typeof e=="number"?l=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(l=Number(e)),l===void 0)break;return i==X.UINT32||i==X.FIXED32?Zd(l):pc(l),l;case X.INT64:case X.SFIXED64:case X.SINT64:if(typeof e!="number"&&typeof e!="string")break;const u=Xe.parse(e);return n?u.toString():u;case X.FIXED64:case X.UINT64:if(typeof e!="number"&&typeof e!="string")break;const d=Xe.uParse(e);return n?d.toString():d;case X.BOOL:if(typeof e!="boolean")break;return e;case X.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case X.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Qy.dec(e)}throw new Error}function Od(i,e,n,r){if(e===null)return i.typeName=="google.protobuf.NullValue"?0:r?i.values[0].no:Mc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const o=i.findName(e);if(o!==void 0)return o.no;if(n)return vc;break}throw new Error("cannot decode enum ".concat(i.typeName," from JSON: ").concat(_n(e)))}function RC(i){return i.repeated||i.kind=="map"?!0:!(i.oneof||i.kind=="message"||i.opt||i.req)}function wv(i,e,n){if(i.kind=="map"){et(typeof e=="object"&&e!=null);const r={},o=Object.entries(e);switch(i.V.kind){case"scalar":for(const[u,d]of o)r[u.toString()]=yc(i.V.T,d);break;case"message":for(const[u,d]of o)r[u.toString()]=d.toJson(n);break;case"enum":const l=i.V.T;for(const[u,d]of o)r[u.toString()]=Ad(l,d,n.enumAsInteger);break}return n.emitDefaultValues||o.length>0?r:void 0}if(i.repeated){et(Array.isArray(e));const r=[];switch(i.kind){case"scalar":for(let o=0;o<e.length;o++)r.push(yc(i.T,e[o]));break;case"enum":for(let o=0;o<e.length;o++)r.push(Ad(i.T,e[o],n.enumAsInteger));break;case"message":for(let o=0;o<e.length;o++)r.push(e[o].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(i.kind){case"scalar":return yc(i.T,e);case"enum":return Ad(i.T,e,n.enumAsInteger);case"message":return Wy(i.T,e).toJson(n)}}function Ad(i,e,n){var r;if(et(typeof e=="number"),i.typeName=="google.protobuf.NullValue")return null;if(n)return e;const o=i.findNumber(e);return(r=o==null?void 0:o.name)!==null&&r!==void 0?r:e}function yc(i,e){switch(i){case X.INT32:case X.SFIXED32:case X.SINT32:case X.FIXED32:case X.UINT32:return et(typeof e=="number"),e;case X.FLOAT:case X.DOUBLE:return et(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case X.STRING:return et(typeof e=="string"),e;case X.BOOL:return et(typeof e=="boolean"),e;case X.UINT64:case X.FIXED64:case X.INT64:case X.SFIXED64:case X.SINT64:return et(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case X.BYTES:return et(e instanceof Uint8Array),Qy.enc(e)}}const ar=Symbol("@bufbuild/protobuf/unknown-fields"),Ov={readUnknownFields:!0,readerFactory:i=>new pC(i)},Av={writeUnknownFields:!0,writerFactory:()=>new mC};function _C(i){return i?Object.assign(Object.assign({},Ov),i):Ov}function wC(i){return i?Object.assign(Object.assign({},Av),i):Av}function OC(){return{makeReadOptions:_C,makeWriteOptions:wC,listUnknownFields(i){var e;return(e=i[ar])!==null&&e!==void 0?e:[]},discardUnknownFields(i){delete i[ar]},writeUnknownFields(i,e){const r=i[ar];if(r)for(const o of r)e.tag(o.no,o.wireType).raw(o.data)},onUnknownField(i,e,n,r){const o=i;Array.isArray(o[ar])||(o[ar]=[]),o[ar].push({no:e,wireType:n,data:r})},readMessage(i,e,n,r,o){const l=i.getType(),u=o?e.len:e.pos+n;let d,h;for(;e.pos<u&&([d,h]=e.tag(),!(o===!0&&h==at.EndGroup));){const m=l.fields.find(d);if(!m){const g=e.skip(h,d);r.readUnknownFields&&this.onUnknownField(i,d,h,g);continue}Dv(i,e,m,h,r)}if(o&&(h!=at.EndGroup||d!==n))throw new Error("invalid end group tag")},readField:Dv,writeMessage(i,e,n){const r=i.getType();for(const o of r.fields.byNumber()){if(!Jy(o,i)){if(o.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(o.name," to binary: required field not set"));continue}const l=o.oneof?i[o.oneof.localName].value:i[o.localName];Mv(o,l,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(i,e),e},writeField(i,e,n,r){e!==void 0&&Mv(i,e,n,r)}}}function Dv(i,e,n,r,o){let{repeated:l,localName:u}=n;switch(n.oneof&&(i=i[n.oneof.localName],i.case!=u&&delete i.value,i.case=u,u="value"),n.kind){case"scalar":case"enum":const d=n.kind=="enum"?X.INT32:n.T;let h=xc;if(n.kind=="scalar"&&n.L>0&&(h=DC),l){let b=i[u];if(r==at.LengthDelimited&&d!=X.STRING&&d!=X.BYTES){let C=e.uint32()+e.pos;for(;e.pos<C;)b.push(h(e,d))}else b.push(h(e,d))}else i[u]=h(e,d);break;case"message":const m=n.T;l?i[u].push(bc(e,new m,o,n)):sa(i[u])?bc(e,i[u],o,n):(i[u]=bc(e,new m,o,n),m.fieldWrapper&&!n.oneof&&!n.repeated&&(i[u]=m.fieldWrapper.unwrapField(i[u])));break;case"map":let[g,y]=AC(n,e,o);i[u][g]=y;break}}function bc(i,e,n,r){const o=e.getType().runtime.bin,l=r==null?void 0:r.delimited;return o.readMessage(e,i,l?r.no:i.uint32(),n,l),e}function AC(i,e,n){const r=e.uint32(),o=e.pos+r;let l,u;for(;e.pos<o;){const[d]=e.tag();switch(d){case 1:l=xc(e,i.K);break;case 2:switch(i.V.kind){case"scalar":u=xc(e,i.V.T);break;case"enum":u=e.int32();break;case"message":u=bc(e,new i.V.T,n,void 0);break}break}}if(l===void 0&&(l=vr(i.K,Ui.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),u===void 0)switch(i.V.kind){case"scalar":u=vr(i.V.T,Ui.BIGINT);break;case"enum":u=i.V.T.values[0].no;break;case"message":u=new i.V.T;break}return[l,u]}function DC(i,e){const n=xc(i,e);return typeof n=="bigint"?n.toString():n}function xc(i,e){switch(e){case X.STRING:return i.string();case X.BOOL:return i.bool();case X.DOUBLE:return i.double();case X.FLOAT:return i.float();case X.INT32:return i.int32();case X.INT64:return i.int64();case X.UINT64:return i.uint64();case X.FIXED64:return i.fixed64();case X.BYTES:return i.bytes();case X.FIXED32:return i.fixed32();case X.SFIXED32:return i.sfixed32();case X.SFIXED64:return i.sfixed64();case X.SINT64:return i.sint64();case X.UINT32:return i.uint32();case X.SINT32:return i.sint32()}}function Mv(i,e,n,r){et(e!==void 0);const o=i.repeated;switch(i.kind){case"scalar":case"enum":let l=i.kind=="enum"?X.INT32:i.T;if(o)if(et(Array.isArray(e)),i.packed)xC(n,l,i.no,e);else for(const u of e)Ns(n,l,i.no,u);else Ns(n,l,i.no,e);break;case"message":if(o){et(Array.isArray(e));for(const u of e)xv(n,r,i,u)}else xv(n,r,i,e);break;case"map":et(typeof e=="object"&&e!=null);for(const[u,d]of Object.entries(e))MC(n,r,i,u,d);break}}function MC(i,e,n,r,o){i.tag(n.no,at.LengthDelimited),i.fork();let l=r;switch(n.K){case X.INT32:case X.FIXED32:case X.UINT32:case X.SFIXED32:case X.SINT32:l=Number.parseInt(r);break;case X.BOOL:et(r=="true"||r=="false"),l=r=="true";break}switch(Ns(i,n.K,1,l),n.V.kind){case"scalar":Ns(i,n.V.T,2,o);break;case"enum":Ns(i,X.INT32,2,o);break;case"message":et(o!==void 0),i.tag(2,at.LengthDelimited).bytes(o.toBinary(e));break}i.join()}function xv(i,e,n,r){const o=Wy(n.T,r);n.delimited?i.tag(n.no,at.StartGroup).raw(o.toBinary(e)).tag(n.no,at.EndGroup):i.tag(n.no,at.LengthDelimited).bytes(o.toBinary(e))}function Ns(i,e,n,r){et(r!==void 0);let[o,l]=$y(e);i.tag(n,o)[l](r)}function xC(i,e,n,r){if(!r.length)return;i.tag(n,at.LengthDelimited).fork();let[,o]=$y(e);for(let l=0;l<r.length;l++)i[o](r[l]);i.join()}function $y(i){let e=at.Varint;switch(i){case X.BYTES:case X.STRING:e=at.LengthDelimited;break;case X.DOUBLE:case X.FIXED64:case X.SFIXED64:e=at.Bit64;break;case X.FIXED32:case X.SFIXED32:case X.FLOAT:e=at.Bit32;break}const n=X[i].toLowerCase();return[e,n]}function PC(){return{setEnumType:qy,initPartial(i,e){if(i===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const o=r.localName,l=e,u=i;if(u[o]!=null)switch(r.kind){case"oneof":const d=u[o].case;if(d===void 0)continue;const h=r.findField(d);let m=u[o].value;h&&h.kind=="message"&&!sa(m,h.T)?m=new h.T(m):h&&h.kind==="scalar"&&h.T===X.BYTES&&(m=_s(m)),l[o]={case:d,value:m};break;case"scalar":case"enum":let g=u[o];r.T===X.BYTES&&(g=r.repeated?g.map(_s):_s(g)),l[o]=g;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===X.BYTES)for(const[T,C]of Object.entries(u[o]))l[o][T]=_s(C);else Object.assign(l[o],u[o]);break;case"message":const b=r.V.T;for(const T of Object.keys(u[o])){let C=u[o][T];b.fieldWrapper||(C=new b(C)),l[o][T]=C}break}break;case"message":const y=r.T;if(r.repeated)l[o]=u[o].map(b=>sa(b,y)?b:new y(b));else{const b=u[o];y.fieldWrapper?y.typeName==="google.protobuf.BytesValue"?l[o]=_s(b):l[o]=b:l[o]=sa(b,y)?b:new y(b)}break}}},equals(i,e,n){return e===n?!0:!e||!n?!1:i.fields.byMember().every(r=>{const o=e[r.localName],l=n[r.localName];if(r.repeated){if(o.length!==l.length)return!1;switch(r.kind){case"message":return o.every((u,d)=>r.T.equals(u,l[d]));case"scalar":return o.every((u,d)=>wi(r.T,u,l[d]));case"enum":return o.every((u,d)=>wi(X.INT32,u,l[d]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(o,l);case"enum":return wi(X.INT32,o,l);case"scalar":return wi(r.T,o,l);case"oneof":if(o.case!==l.case)return!1;const u=r.findField(o.case);if(u===void 0)return!0;switch(u.kind){case"message":return u.T.equals(o.value,l.value);case"enum":return wi(X.INT32,o.value,l.value);case"scalar":return wi(u.T,o.value,l.value)}throw new Error("oneof cannot contain ".concat(u.kind));case"map":const d=Object.keys(o).concat(Object.keys(l));switch(r.V.kind){case"message":const h=r.V.T;return d.every(g=>h.equals(o[g],l[g]));case"enum":return d.every(g=>wi(X.INT32,o[g],l[g]));case"scalar":const m=r.V.T;return d.every(g=>wi(m,o[g],l[g]))}break}})},clone(i){const e=i.getType(),n=new e,r=n;for(const o of e.fields.byMember()){const l=i[o.localName];let u;if(o.repeated)u=l.map(lc);else if(o.kind=="map"){u=r[o.localName];for(const[d,h]of Object.entries(l))u[d]=lc(h)}else o.kind=="oneof"?u=o.findField(l.case)?{case:l.case,value:lc(l.value)}:{case:void 0}:u=lc(l);r[o.localName]=u}for(const o of e.runtime.bin.listUnknownFields(i))e.runtime.bin.onUnknownField(r,o.no,o.wireType,o.data);return n}}}function lc(i){if(i===void 0)return i;if(sa(i))return i.clone();if(i instanceof Uint8Array){const e=new Uint8Array(i.byteLength);return e.set(i),e}return i}function _s(i){return i instanceof Uint8Array?i:new Uint8Array(i)}function NC(i,e,n){return{syntax:i,json:CC(),bin:OC(),util:Object.assign(Object.assign({},PC()),{newFieldList:e,initFields:n}),makeMessageType(r,o,l){return cC(this,r,o,l)},makeEnum:oC,makeEnumType:Vy,getEnumType:sC,makeExtension(r,o,l){return gC(this,r,o,l)}}}class UC{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function e0(i,e){const n=t0(i);return e?n:qC(zC(n))}function LC(i){return e0(i,!1)}const IC=t0;function t0(i){let e=!1;const n=[];for(let r=0;r<i.length;r++){let o=i.charAt(r);switch(o){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(o),e=!1;break;default:e&&(e=!1,o=o.toUpperCase()),n.push(o);break}}return n.join("")}const jC=new Set(["constructor","toString","toJSON","valueOf"]),BC=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),n0=i=>"".concat(i,"$"),zC=i=>BC.has(i)?n0(i):i,qC=i=>jC.has(i)?n0(i):i;class VC{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=LC(e)}addField(e){et(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function HC(i,e){var n,r,o,l,u,d;const h=[];let m;for(const g of typeof i=="function"?i():i){const y=g;if(y.localName=e0(g.name,g.oneof!==void 0),y.jsonName=(n=g.jsonName)!==null&&n!==void 0?n:IC(g.name),y.repeated=(r=g.repeated)!==null&&r!==void 0?r:!1,g.kind=="scalar"&&(y.L=(o=g.L)!==null&&o!==void 0?o:Ui.BIGINT),y.delimited=(l=g.delimited)!==null&&l!==void 0?l:!1,y.req=(u=g.req)!==null&&u!==void 0?u:!1,y.opt=(d=g.opt)!==null&&d!==void 0?d:!1,g.packed===void 0&&(y.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=X.BYTES&&g.T!=X.STRING),g.oneof!==void 0){const b=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!m||m.name!=b)&&(m=new VC(b)),y.oneof=m,m.addField(y)}h.push(y)}return h}const j=NC("proto3",i=>new UC(i,e=>HC(e)),i=>{for(const e of i.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=i;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=vr(e.T,e.L);break}}});class Pt extends zf{constructor(e){super(),this.seconds=Xe.zero,this.nanos=0,j.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(j.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Xe.parse(o/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?r="."+o.substring(0,3)+"Z":o.substring(6)==="000"?r="."+o.substring(0,6)+"Z":r="."+o+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Pt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Pt({seconds:Xe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Pt().fromBinary(e,n)}static fromJson(e,n){return new Pt().fromJson(e,n)}static fromJsonString(e,n){return new Pt().fromJsonString(e,n)}static equals(e,n){return j.util.equals(Pt,e,n)}}Pt.runtime=j;Pt.typeName="google.protobuf.Timestamp";Pt.fields=j.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const GC=j.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Pt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:FC,repeated:!0},{no:5,name:"events",kind:"message",T:KC,repeated:!0}]),FC=j.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:YC,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),YC=j.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Pt},{no:3,name:"value",kind:"scalar",T:2}]),KC=j.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Pt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Pt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),i0=j.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),fn=j.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ot=j.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),lr=j.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),xs=j.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Is=j.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),mn=j.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),rr=j.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),QC=j.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),wn=j.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Vf=j.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Pc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:p0}]),Pc=j.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),XC=j.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:j.getEnumType(ot),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),js=j.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:j.getEnumType(Jd)},{no:4,name:"tracks",kind:"message",T:or,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:XC},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:j.getEnumType(Bs)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:j.getEnumType(mn)},{no:18,name:"kind_details",kind:"enum",T:j.getEnumType(ZC),repeated:!0}]),Jd=j.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Bs=j.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ZC=j.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Yt=j.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),JC=j.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:oa,repeated:!0}]),or=j.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:j.getEnumType(fn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:j.getEnumType(ot)},{no:10,name:"layers",kind:"message",T:oa,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:JC,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:j.getEnumType(Yt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:p0},{no:19,name:"audio_features",kind:"enum",T:j.getEnumType(wn),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:j.getEnumType(i0)}]),oa=j.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:j.getEnumType(lr)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),xt=j.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:j.getEnumType(Ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:r0,oneof:"value"},{no:3,name:"speaker",kind:"message",T:WC,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:s0,oneof:"value"},{no:7,name:"transcription",kind:"message",T:$C,oneof:"value"},{no:8,name:"metrics",kind:"message",T:GC,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Wd,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:o0,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:c0,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:l0,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ef,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:tf,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:nf,oneof:"value"}]),Ae=j.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),WC=j.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:a0,repeated:!0}]),a0=j.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),r0=j.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),s0=j.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),$C=j.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:eE,repeated:!0}]),eE=j.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Wd=j.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),o0=j.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),c0=j.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),l0=j.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:u0,oneof:"value"}]),u0=j.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),d0=j.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),tE=j.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:j.getEnumType(f0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),f0=j.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),nE=j.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:j.getEnumType(h0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),h0=j.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),m0=j.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Pv},{no:2,name:"screen",kind:"message",T:Pv},{no:3,name:"resume_connection",kind:"enum",T:j.getEnumType(Is)},{no:4,name:"disabled_codecs",kind:"message",T:iE},{no:5,name:"force_relay",kind:"enum",T:j.getEnumType(Is)}]),Pv=j.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:j.getEnumType(Is)}]),iE=j.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Pc,repeated:!0},{no:2,name:"publish",kind:"message",T:Pc,repeated:!0}]),p0=j.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),$d=j.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),g0=j.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:j.getEnumType($d)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),v0=j.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ef=j.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:j.getEnumType(Yt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:g0,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:v0,oneof:"content_header"}],{localName:"DataStream_Header"}),tf=j.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),nf=j.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),hn=j.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),af=j.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),aE=j.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),rE=j.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:ua,oneof:"message"},{no:2,name:"answer",kind:"message",T:ua,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Hf,oneof:"message"},{no:4,name:"add_track",kind:"message",T:sf,oneof:"message"},{no:5,name:"mute",kind:"message",T:Gf,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Kc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:y0,oneof:"message"},{no:8,name:"leave",kind:"message",T:Qc,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:S0,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:E0,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:R0,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Rn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:T0,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:w0,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:b0,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:uE,oneof:"message"}]),Nv=j.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:sE,oneof:"message"},{no:2,name:"answer",kind:"message",T:ua,oneof:"message"},{no:3,name:"offer",kind:"message",T:ua,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Hf,oneof:"message"},{no:5,name:"update",kind:"message",T:lE,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Ff,oneof:"message"},{no:8,name:"leave",kind:"message",T:Qc,oneof:"message"},{no:9,name:"mute",kind:"message",T:Gf,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:dE,oneof:"message"},{no:11,name:"room_update",kind:"message",T:fE,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:mE,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:gE,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:yE,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:bE,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:cE,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:oE,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:SE,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:CE,oneof:"message"},{no:22,name:"request_response",kind:"message",T:EE,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:RE,oneof:"message"}]),rf=j.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),sf=j.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:j.getEnumType(fn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:j.getEnumType(ot)},{no:9,name:"layers",kind:"message",T:oa,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:rf,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:j.getEnumType(Yt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:j.getEnumType(i0)}]),Hf=j.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:j.getEnumType(hn)},{no:3,name:"final",kind:"scalar",T:8}]),Gf=j.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),sE=j.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Vf},{no:2,name:"participant",kind:"message",T:js},{no:3,name:"other_participants",kind:"message",T:js,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:k0,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:m0},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:tE},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Pc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),oE=j.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:k0,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:m0}]),Ff=j.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:or}]),cE=j.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),ua=j.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),lE=j.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:js,repeated:!0}]),Kc=j.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:d0,repeated:!0}]),y0=j.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:j.getEnumType(lr)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),b0=j.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:j.getEnumType(wn),repeated:!0}]),uE=j.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Qc=j.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:j.getEnumType(mn)},{no:3,name:"action",kind:"enum",T:j.getEnumType(ur)},{no:4,name:"regions",kind:"message",T:TE}]),ur=j.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),S0=j.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:oa,repeated:!0}]),T0=j.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),k0=j.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),dE=j.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:a0,repeated:!0}]),fE=j.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Vf}]),hE=j.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:j.getEnumType(xs)},{no:3,name:"score",kind:"scalar",T:2}]),mE=j.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:hE,repeated:!0}]),pE=j.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:j.getEnumType(af)}]),gE=j.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:pE,repeated:!0}]),Yf=j.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:j.getEnumType(lr)},{no:2,name:"enabled",kind:"scalar",T:8}]),vE=j.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Yf,repeated:!0}]),yE=j.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Yf,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:vE,repeated:!0}]),C0=j.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),E0=j.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:C0,repeated:!0}]),bE=j.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),R0=j.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:ua},{no:2,name:"subscription",kind:"message",T:Kc},{no:3,name:"publish_tracks",kind:"message",T:Ff,repeated:!0},{no:4,name:"data_channels",kind:"message",T:_0,repeated:!0},{no:5,name:"offer",kind:"message",T:ua},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),_0=j.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:j.getEnumType(hn)}]),Rn=j.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:j.getEnumType(aE),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),w0=j.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),SE=j.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),TE=j.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:kE,repeated:!0}]),kE=j.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),CE=j.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:j.getEnumType(QC)}]),EE=j.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:j.getEnumType(Kf)},{no:3,name:"message",kind:"scalar",T:9}]),Kf=j.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),RE=j.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function _E(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Sc={exports:{}},wE=Sc.exports,Uv;function OE(){return Uv||(Uv=1,function(i){(function(e,n){i.exports?i.exports=n():e.log=n()})(wE,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},u=null;function d(k,O){var _=k[O];if(typeof _.bind=="function")return _.bind(k);try{return Function.prototype.bind.call(_,k)}catch{return function(){return Function.prototype.apply.apply(_,[k,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function m(k){return k==="debug"&&(k="log"),typeof console===n?!1:k==="trace"&&r?h:console[k]!==void 0?d(console,k):console.log!==void 0?d(console,"log"):e}function g(){for(var k=this.getLevel(),O=0;O<o.length;O++){var _=o[O];this[_]=O<k?e:this.methodFactory(_,k,this.name)}if(this.log=this.debug,typeof console===n&&k<this.levels.SILENT)return"No console available for logging"}function y(k){return function(){typeof console!==n&&(g.call(this),this[k].apply(this,arguments))}}function b(k,O,_){return m(k)||y.apply(this,arguments)}function T(k,O){var _=this,B,q,P,E="loglevel";typeof k=="string"?E+=":"+k:typeof k=="symbol"&&(E=void 0);function z($){var re=(o[$]||"silent").toUpperCase();if(!(typeof window===n||!E)){try{window.localStorage[E]=re;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+re+";"}catch{}}}function J(){var $;if(!(typeof window===n||!E)){try{$=window.localStorage[E]}catch{}if(typeof $===n)try{var re=window.document.cookie,Ue=encodeURIComponent(E),Le=re.indexOf(Ue+"=");Le!==-1&&($=/^([^;]+)/.exec(re.slice(Le+Ue.length+1))[1])}catch{}return _.levels[$]===void 0&&($=void 0),$}}function ne(){if(!(typeof window===n||!E)){try{window.localStorage.removeItem(E)}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function oe($){var re=$;if(typeof re=="string"&&_.levels[re.toUpperCase()]!==void 0&&(re=_.levels[re.toUpperCase()]),typeof re=="number"&&re>=0&&re<=_.levels.SILENT)return re;throw new TypeError("log.setLevel() called with invalid level: "+$)}_.name=k,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=O||b,_.getLevel=function(){return P??q??B},_.setLevel=function($,re){return P=oe($),re!==!1&&z(P),g.call(_)},_.setDefaultLevel=function($){q=oe($),J()||_.setLevel($,!1)},_.resetLevel=function(){P=null,ne(),g.call(_)},_.enableAll=function($){_.setLevel(_.levels.TRACE,$)},_.disableAll=function($){_.setLevel(_.levels.SILENT,$)},_.rebuild=function(){if(u!==_&&(B=oe(u.getLevel())),g.call(_),u===_)for(var $ in l)l[$].rebuild()},B=oe(u?u.getLevel():"WARN");var se=J();se!=null&&(P=oe(se)),g.call(_)}u=new T,u.getLogger=function(O){if(typeof O!="symbol"&&typeof O!="string"||O==="")throw new TypeError("You must supply a name when creating a logger.");var _=l[O];return _||(_=l[O]=new T(O,u.methodFactory)),_};var C=typeof window!==n?window.log:void 0;return u.noConflict=function(){return typeof window!==n&&window.log===u&&(window.log=C),u},u.getLoggers=function(){return l},u.default=u,u})}(Sc)),Sc.exports}var Xc=OE(),of;(function(i){i[i.trace=0]="trace",i[i.debug=1]="debug",i[i.info=2]="info",i[i.warn=3]="warn",i[i.error=4]="error",i[i.silent=5]="silent"})(of||(of={}));var pn;(function(i){i.Default="livekit",i.Room="livekit-room",i.Participant="livekit-participant",i.Track="livekit-track",i.Publication="livekit-track-publication",i.Engine="livekit-engine",i.Signal="livekit-signal",i.PCManager="livekit-pc-manager",i.PCTransport="livekit-pc-transport",i.E2EE="lk-e2ee"})(pn||(pn={}));let ke=Xc.getLogger("livekit");Object.values(pn).map(i=>Xc.getLogger(i));ke.setDefaultLevel(of.info);function $n(i){const e=Xc.getLogger(i);return e.setDefaultLevel(ke.getLevel()),e}const AE=Xc.getLogger("lk-e2ee"),ws=7e3,DE=[0,300,2*2*300,3*3*300,4*4*300,ws,ws,ws,ws,ws];class ME{constructor(e){this._retryDelays=e!==void 0?[...e]:DE}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function xE(i,e){var n={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(n[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(i);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(i,r[o])&&(n[r[o]]=i[r[o]]);return n}function w(i,e,n,r){function o(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function d(g){try{m(r.next(g))}catch(y){u(y)}}function h(g){try{m(r.throw(g))}catch(y){u(y)}}function m(g){g.done?l(g.value):o(g.value).then(d,h)}m((r=r.apply(i,e||[])).next())})}function Lv(i){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&i[e],r=0;if(n)return n.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Di(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],n;return e?e.call(i):(i=typeof Lv=="function"?Lv(i):i[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(l){n[l]=i[l]&&function(u){return new Promise(function(d,h){u=i[l](u),o(d,h,u.done,u.value)})}}function o(l,u,d,h){Promise.resolve(h).then(function(m){l({value:m,done:d})},u)}}var uc={exports:{}},Iv;function PE(){if(Iv)return uc.exports;Iv=1;var i=typeof Reflect=="object"?Reflect:null,e=i&&typeof i.apply=="function"?i.apply:function(E,z,J){return Function.prototype.apply.call(E,z,J)},n;i&&typeof i.ownKeys=="function"?n=i.ownKeys:Object.getOwnPropertySymbols?n=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:n=function(E){return Object.getOwnPropertyNames(E)};function r(P){console&&console.warn&&console.warn(P)}var o=Number.isNaN||function(E){return E!==E};function l(){l.init.call(this)}uc.exports=l,uc.exports.once=_,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function d(P){if(typeof P!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(P){if(typeof P!="number"||P<0||o(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");u=P}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||o(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function h(P){return P._maxListeners===void 0?l.defaultMaxListeners:P._maxListeners}l.prototype.getMaxListeners=function(){return h(this)},l.prototype.emit=function(E){for(var z=[],J=1;J<arguments.length;J++)z.push(arguments[J]);var ne=E==="error",oe=this._events;if(oe!==void 0)ne=ne&&oe.error===void 0;else if(!ne)return!1;if(ne){var se;if(z.length>0&&(se=z[0]),se instanceof Error)throw se;var $=new Error("Unhandled error."+(se?" ("+se.message+")":""));throw $.context=se,$}var re=oe[E];if(re===void 0)return!1;if(typeof re=="function")e(re,this,z);else for(var Ue=re.length,Le=C(re,Ue),J=0;J<Ue;++J)e(Le[J],this,z);return!0};function m(P,E,z,J){var ne,oe,se;if(d(z),oe=P._events,oe===void 0?(oe=P._events=Object.create(null),P._eventsCount=0):(oe.newListener!==void 0&&(P.emit("newListener",E,z.listener?z.listener:z),oe=P._events),se=oe[E]),se===void 0)se=oe[E]=z,++P._eventsCount;else if(typeof se=="function"?se=oe[E]=J?[z,se]:[se,z]:J?se.unshift(z):se.push(z),ne=h(P),ne>0&&se.length>ne&&!se.warned){se.warned=!0;var $=new Error("Possible EventEmitter memory leak detected. "+se.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");$.name="MaxListenersExceededWarning",$.emitter=P,$.type=E,$.count=se.length,r($)}return P}l.prototype.addListener=function(E,z){return m(this,E,z,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(E,z){return m(this,E,z,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(P,E,z){var J={fired:!1,wrapFn:void 0,target:P,type:E,listener:z},ne=g.bind(J);return ne.listener=z,J.wrapFn=ne,ne}l.prototype.once=function(E,z){return d(z),this.on(E,y(this,E,z)),this},l.prototype.prependOnceListener=function(E,z){return d(z),this.prependListener(E,y(this,E,z)),this},l.prototype.removeListener=function(E,z){var J,ne,oe,se,$;if(d(z),ne=this._events,ne===void 0)return this;if(J=ne[E],J===void 0)return this;if(J===z||J.listener===z)--this._eventsCount===0?this._events=Object.create(null):(delete ne[E],ne.removeListener&&this.emit("removeListener",E,J.listener||z));else if(typeof J!="function"){for(oe=-1,se=J.length-1;se>=0;se--)if(J[se]===z||J[se].listener===z){$=J[se].listener,oe=se;break}if(oe<0)return this;oe===0?J.shift():k(J,oe),J.length===1&&(ne[E]=J[0]),ne.removeListener!==void 0&&this.emit("removeListener",E,$||z)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(E){var z,J,ne;if(J=this._events,J===void 0)return this;if(J.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):J[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete J[E]),this;if(arguments.length===0){var oe=Object.keys(J),se;for(ne=0;ne<oe.length;++ne)se=oe[ne],se!=="removeListener"&&this.removeAllListeners(se);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(z=J[E],typeof z=="function")this.removeListener(E,z);else if(z!==void 0)for(ne=z.length-1;ne>=0;ne--)this.removeListener(E,z[ne]);return this};function b(P,E,z){var J=P._events;if(J===void 0)return[];var ne=J[E];return ne===void 0?[]:typeof ne=="function"?z?[ne.listener||ne]:[ne]:z?O(ne):C(ne,ne.length)}l.prototype.listeners=function(E){return b(this,E,!0)},l.prototype.rawListeners=function(E){return b(this,E,!1)},l.listenerCount=function(P,E){return typeof P.listenerCount=="function"?P.listenerCount(E):T.call(P,E)},l.prototype.listenerCount=T;function T(P){var E=this._events;if(E!==void 0){var z=E[P];if(typeof z=="function")return 1;if(z!==void 0)return z.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function C(P,E){for(var z=new Array(E),J=0;J<E;++J)z[J]=P[J];return z}function k(P,E){for(;E+1<P.length;E++)P[E]=P[E+1];P.pop()}function O(P){for(var E=new Array(P.length),z=0;z<E.length;++z)E[z]=P[z].listener||P[z];return E}function _(P,E){return new Promise(function(z,J){function ne(se){P.removeListener(E,oe),J(se)}function oe(){typeof P.removeListener=="function"&&P.removeListener("error",ne),z([].slice.call(arguments))}q(P,E,oe,{once:!0}),E!=="error"&&B(P,ne,{once:!0})})}function B(P,E,z){typeof P.on=="function"&&q(P,"error",E,z)}function q(P,E,z,J){if(typeof P.on=="function")J.once?P.once(E,z):P.on(E,z);else if(typeof P.addEventListener=="function")P.addEventListener(E,function ne(oe){J.once&&P.removeEventListener(E,ne),z(oe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P)}return uc.exports}var xn=PE();let O0=!0,A0=!0;function Tc(i,e,n){const r=i.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function ma(i,e,n){if(!i.RTCPeerConnection)return;const r=i.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(u,d){if(u!==e)return o.apply(this,arguments);const h=m=>{const g=n(m);g&&(d.handleEvent?d.handleEvent(g):d(g))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(d,h),o.apply(this,[u,h])};const l=r.removeEventListener;r.removeEventListener=function(u,d){if(u!==e||!this._eventMap||!this._eventMap[e])return l.apply(this,arguments);if(!this._eventMap[e].has(d))return l.apply(this,arguments);const h=this._eventMap[e].get(d);return this._eventMap[e].delete(d),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,h])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(u){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),u&&this.addEventListener(e,this["_on"+e]=u)},enumerable:!0,configurable:!0})}function NE(i){return typeof i!="boolean"?new Error("Argument type: "+typeof i+". Please use a boolean."):(O0=i,i?"adapter.js logging disabled":"adapter.js logging enabled")}function UE(i){return typeof i!="boolean"?new Error("Argument type: "+typeof i+". Please use a boolean."):(A0=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))}function D0(){if(typeof window=="object"){if(O0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Qf(i,e){A0&&console.warn(i+" is deprecated, please use "+e+" instead.")}function LE(i){const e={browser:null,version:null};if(typeof i>"u"||!i.navigator||!i.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=i;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(o=>o.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=Tc(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||i.isSecureContext===!1&&i.webkitRTCPeerConnection)e.browser="chrome",e.version=Tc(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Tc(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function jv(i){return Object.prototype.toString.call(i)==="[object Object]"}function M0(i){return jv(i)?Object.keys(i).reduce(function(e,n){const r=jv(i[n]),o=r?M0(i[n]):i[n],l=r&&!Object.keys(o).length;return o===void 0||l?e:Object.assign(e,{[n]:o})},{}):i}function cf(i,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?cf(i,i.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(o=>{cf(i,i.get(o),n)})}))}function Bv(i,e,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;const l=[];return i.forEach(u=>{u.type==="track"&&u.trackIdentifier===e.id&&l.push(u)}),l.forEach(u=>{i.forEach(d=>{d.type===r&&d.trackId===u.id&&cf(i,d,o)})}),o}const zv=D0;function x0(i,e){const n=i&&i.navigator;if(!n.mediaDevices)return;const r=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const h={};return Object.keys(d).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof d[m]=="object"?d[m]:{ideal:d[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const y=function(b,T){return b?b+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(g.ideal!==void 0){h.optional=h.optional||[];let b={};typeof g.ideal=="number"?(b[y("min",m)]=g.ideal,h.optional.push(b),b={},b[y("max",m)]=g.ideal,h.optional.push(b)):(b[y("",m)]=g.ideal,h.optional.push(b))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[y("",m)]=g.exact):["min","max"].forEach(b=>{g[b]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[y(b,m)]=g[b])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},o=function(d,h){if(e.version>=61)return h(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const m=function(g,y,b){y in g&&!(b in g)&&(g[b]=g[y],delete g[y])};d=JSON.parse(JSON.stringify(d)),m(d.audio,"autoGainControl","googAutoGainControl"),m(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=r(d.audio)}if(d&&typeof d.video=="object"){let m=d.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=e.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete d.video.facingMode;let y;if(m.exact==="environment"||m.ideal==="environment"?y=["back","rear"]:(m.exact==="user"||m.ideal==="user")&&(y=["front"]),y)return n.mediaDevices.enumerateDevices().then(b=>{b=b.filter(C=>C.kind==="videoinput");let T=b.find(C=>y.some(k=>C.label.toLowerCase().includes(k)));return!T&&b.length&&y.includes("back")&&(T=b[b.length-1]),T&&(d.video.deviceId=m.exact?{exact:T.deviceId}:{ideal:T.deviceId}),d.video=r(d.video),zv("chrome: "+JSON.stringify(d)),h(d)})}d.video=r(d.video)}return zv("chrome: "+JSON.stringify(d)),h(d)},l=function(d){return e.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(d,h,m){o(d,g=>{n.webkitGetUserMedia(g,h,y=>{m&&m(l(y))})})};if(n.getUserMedia=u.bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return o(h,m=>d(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(l(g))))}}}function P0(i){i.MediaStream=i.MediaStream||i.webkitMediaStream}function N0(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("ontrack"in i.RTCPeerConnection.prototype)){Object.defineProperty(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let l;i.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===o.track.id):l={track:o.track};const u=new Event("track");u.track=o.track,u.receiver=l,u.transceiver={receiver:l},u.streams=[r.stream],this.dispatchEvent(u)}),r.stream.getTracks().forEach(o=>{let l;i.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===o.id):l={track:o};const u=new Event("track");u.track=o,u.receiver=l,u.transceiver={receiver:l},u.streams=[r.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ma(i,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function U0(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("getSenders"in i.RTCPeerConnection.prototype)&&"createDTMFSender"in i.RTCPeerConnection.prototype){const e=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!i.RTCPeerConnection.prototype.getSenders){i.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(d,h){let m=o.apply(this,arguments);return m||(m=e(this,d),this._senders.push(m)),m};const l=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);const h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}const n=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],n.apply(this,[l]),l.getTracks().forEach(u=>{this._senders.push(e(this,u))})};const r=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],r.apply(this,[l]),l.getTracks().forEach(u=>{const d=this._senders.find(h=>h.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof i=="object"&&i.RTCPeerConnection&&"getSenders"in i.RTCPeerConnection.prototype&&"createDTMFSender"in i.RTCPeerConnection.prototype&&i.RTCRtpSender&&!("dtmf"in i.RTCRtpSender.prototype)){const e=i.RTCPeerConnection.prototype.getSenders;i.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function L0(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&i.RTCRtpReceiver))return;if(!("getStats"in i.RTCRtpSender.prototype)){const n=i.RTCPeerConnection.prototype.getSenders;n&&(i.RTCPeerConnection.prototype.getSenders=function(){const l=n.apply(this,[]);return l.forEach(u=>u._pc=this),l});const r=i.RTCPeerConnection.prototype.addTrack;r&&(i.RTCPeerConnection.prototype.addTrack=function(){const l=r.apply(this,arguments);return l._pc=this,l}),i.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(u=>Bv(u,l.track,!0))}}if(!("getStats"in i.RTCRtpReceiver.prototype)){const n=i.RTCPeerConnection.prototype.getReceivers;n&&(i.RTCPeerConnection.prototype.getReceivers=function(){const o=n.apply(this,[]);return o.forEach(l=>l._pc=this),o}),ma(i,"track",r=>(r.receiver._pc=r.srcElement,r)),i.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>Bv(l,o.track,!1))}}if(!("getStats"in i.RTCRtpSender.prototype&&"getStats"in i.RTCRtpReceiver.prototype))return;const e=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof i.MediaStreamTrack){const r=arguments[0];let o,l,u;return this.getSenders().forEach(d=>{d.track===r&&(o?u=!0:o=d)}),this.getReceivers().forEach(d=>(d.track===r&&(l?u=!0:l=d),d.track===r)),u||o&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function I0(i){i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const e=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=e.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};const n=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(m=>{if(this.getSenders().find(y=>y.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(m=>d.indexOf(m)===-1);this._shimmedLocalStreams[u.id]=[u].concat(h)};const r=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],r.apply(this,arguments)};const o=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const h=this._shimmedLocalStreams[d].indexOf(u);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function j0(i,e){if(!i.RTCPeerConnection)return;if(i.RTCPeerConnection.prototype.addTrack&&e.version>=65)return I0(i);const n=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){const g=n.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(y=>this._reverseStreams[y.id])};const r=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(y=>{if(this.getSenders().find(T=>T.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const y=new i.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}r.apply(this,[g])};const o=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},i.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(k=>k===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[y.id];if(C)C.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new i.MediaStream([g]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===g)};function l(m,g){let y=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const T=m._reverseStreams[b],C=m._streams[T.id];y=y.replace(new RegExp(C.id,"g"),T.id)}),new RTCSessionDescription({type:g.type,sdp:y})}function u(m,g){let y=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const T=m._reverseStreams[b],C=m._streams[T.id];y=y.replace(new RegExp(T.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:y})}["createOffer","createAnswer"].forEach(function(m){const g=i.RTCPeerConnection.prototype[m],y={[m](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[C=>{const k=l(this,C);b[0].apply(null,[k])},C=>{b[1]&&b[1].apply(null,C)},arguments[2]]):g.apply(this,arguments).then(C=>l(this,C))}};i.RTCPeerConnection.prototype[m]=y[m]});const d=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=u(this,arguments[0]),d.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(i.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(i.RTCPeerConnection.prototype,"localDescription",{get(){const m=h.get.apply(this);return m.type===""?m:l(this,m)}}),i.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(k=>g.track===k)&&(b=this._streams[T])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function lf(i,e){!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection),i.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=i.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};i.RTCPeerConnection.prototype[n]=o[n]})}function B0(i,e){ma(i,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var qv=Object.freeze({__proto__:null,fixNegotiationNeeded:B0,shimAddTrackRemoveTrack:j0,shimAddTrackRemoveTrackWithNative:I0,shimGetSendersWithDtmf:U0,shimGetUserMedia:x0,shimMediaStream:P0,shimOnTrack:N0,shimPeerConnection:lf,shimSenderReceiverGetStats:L0});function z0(i,e){const n=i&&i.navigator,r=i&&i.MediaStreamTrack;if(n.getUserMedia=function(o,l,u){Qf("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(l,u)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u.audio,"autoGainControl","mozAutoGainControl"),o(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},r&&r.prototype.getSettings){const u=r.prototype.getSettings;r.prototype.getSettings=function(){const d=u.apply(this,arguments);return o(d,"mozAutoGainControl","autoGainControl"),o(d,"mozNoiseSuppression","noiseSuppression"),d}}if(r&&r.prototype.applyConstraints){const u=r.prototype.applyConstraints;r.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d,"autoGainControl","mozAutoGainControl"),o(d,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[d])}}}}function IE(i,e){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,i.navigator.mediaDevices.getUserMedia(r)})}function q0(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uf(i,e){if(typeof i!="object"||!(i.RTCPeerConnection||i.mozRTCPeerConnection))return;!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=i.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};i.RTCPeerConnection.prototype[o]=u[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){const[l,u,d]=arguments;return r.apply(this,[l||null]).then(h=>{if(e.version<53&&!u)try{h.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;h.forEach((g,y)=>{h.set(y,Object.assign({},g,{type:n[g.type]||g.type}))})}return h}).then(u,d)}}function V0(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender)||i.RTCRtpSender&&"getStats"in i.RTCRtpSender.prototype)return;const e=i.RTCPeerConnection.prototype.getSenders;e&&(i.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return o.forEach(l=>l._pc=this),o});const n=i.RTCPeerConnection.prototype.addTrack;n&&(i.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),i.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function H0(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender)||i.RTCRtpSender&&"getStats"in i.RTCRtpReceiver.prototype)return;const e=i.RTCPeerConnection.prototype.getReceivers;e&&(i.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r}),ma(i,"track",n=>(n.receiver._pc=n.srcElement,n)),i.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function G0(i){!i.RTCPeerConnection||"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(n){Qf("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function F0(i){i.DataChannel&&!i.RTCDataChannel&&(i.RTCDataChannel=i.DataChannel)}function Y0(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.addTransceiver;e&&(i.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const o=r.length>0;o&&r.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=e.apply(this,arguments);if(o){const{sender:u}=l,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=r,u.sendEncodings=r,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return l})}function K0(i){if(!(typeof i=="object"&&i.RTCRtpSender))return;const e=i.RTCRtpSender.prototype.getParameters;e&&(i.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Q0(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function X0(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.createAnswer;i.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Vv=Object.freeze({__proto__:null,shimAddTransceiver:Y0,shimCreateAnswer:X0,shimCreateOffer:Q0,shimGetDisplayMedia:IE,shimGetParameters:K0,shimGetUserMedia:z0,shimOnTrack:q0,shimPeerConnection:uf,shimRTCDataChannel:F0,shimReceiverGetStats:H0,shimRemoveStream:G0,shimSenderGetStats:V0});function Z0(i){if(!(typeof i!="object"||!i.RTCPeerConnection)){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){const e=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(o=>e.call(this,o,r)),r.getVideoTracks().forEach(o=>e.call(this,o,r))},i.RTCPeerConnection.prototype.addTrack=function(r){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];return l&&l.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),e.apply(this,arguments)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const o=n.getTracks();this.getSenders().forEach(l=>{o.includes(l.track)&&this.removeTrack(l)})})}}function J0(i){if(!(typeof i!="object"||!i.RTCPeerConnection)&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){Object.defineProperty(i.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(l=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(l)>=0)return;r._remoteStreams.push(l);const u=new Event("addstream");u.stream=l,r.dispatchEvent(u)})}),e.apply(r,arguments)}}}function W0(i){if(typeof i!="object"||!i.RTCPeerConnection)return;const e=i.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,o=e.setLocalDescription,l=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(m,g){const y=arguments.length>=2?arguments[2]:arguments[0],b=n.apply(this,[y]);return g?(b.then(m,g),Promise.resolve()):b},e.createAnswer=function(m,g){const y=arguments.length>=2?arguments[2]:arguments[0],b=r.apply(this,[y]);return g?(b.then(m,g),Promise.resolve()):b};let d=function(h,m,g){const y=o.apply(this,[h]);return g?(y.then(m,g),Promise.resolve()):y};e.setLocalDescription=d,d=function(h,m,g){const y=l.apply(this,[h]);return g?(y.then(m,g),Promise.resolve()):y},e.setRemoteDescription=d,d=function(h,m,g){const y=u.apply(this,[h]);return g?(y.then(m,g),Promise.resolve()):y},e.addIceCandidate=d}function $0(i){const e=i&&i.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=o=>r(eb(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,o,l){e.mediaDevices.getUserMedia(r).then(o,l)}).bind(e))}function eb(i){return i&&i.video!==void 0?Object.assign({},i,{video:M0(i.video)}):i}function tb(i){if(!i.RTCPeerConnection)return;const e=i.RTCPeerConnection;i.RTCPeerConnection=function(r,o){if(r&&r.iceServers){const l=[];for(let u=0;u<r.iceServers.length;u++){let d=r.iceServers[u];d.urls===void 0&&d.url?(Qf("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,l.push(d)):l.push(r.iceServers[u])}r.iceServers=l}return new e(r,o)},i.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function nb(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ib(i){const e=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const l=this.getTransceivers().find(u=>u.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):r.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function ab(i){typeof i!="object"||i.AudioContext||(i.AudioContext=i.webkitAudioContext)}var Hv=Object.freeze({__proto__:null,shimAudioContext:ab,shimCallbacksAPI:W0,shimConstraints:eb,shimCreateOfferLegacy:ib,shimGetUserMedia:$0,shimLocalStreamsAPI:Z0,shimRTCIceServerUrls:tb,shimRemoteStreamsAPI:J0,shimTrackEventTransceiver:nb}),Dd={exports:{}},Gv;function jE(){return Gv||(Gv=1,function(i){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((o,l)=>(l>0?"m="+o:o).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(o=>o.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let l=8;l<r.length;l+=2)switch(r[l]){case"raddr":o.relatedAddress=r[l+1];break;case"rport":o.relatedPort=parseInt(r[l+1],10);break;case"tcptype":o.tcpType=r[l+1];break;case"ufrag":o.ufrag=r[l+1],o.usernameFragment=r[l+1];break;default:o[r[l]]===void 0&&(o[r[l]]=r[l+1]);break}return o},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const o=n.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const l=n.type;return r.push("typ"),r.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let o;const l=n.substring(n.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)o=l[u].trim().split("="),r[o[0].trim()]=o[1];return r},e.writeFmtp=function(n){let r="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(u=>{n.parameters[u]!==void 0?l.push(u+"="+n.parameters[u]):l.push(u)}),r+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{r+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,r),10)},l=n.indexOf(":",r);return l>-1?(o.attribute=n.substring(r+1,l),o.value=n.substring(l+1)):o.attribute=n.substring(r+1),o},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let o="a=setup:"+r+`\r
`;return n.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const o=e.matchPrefix(n+r,"a=ice-ufrag:")[0],l=e.matchPrefix(n+r,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=e.splitLines(n)[0].split(" ");r.profile=l[2];for(let d=3;d<l.length;d++){const h=l[d],m=e.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(m){const g=e.parseRtpMap(m),y=e.matchPrefix(n,"a=fmtp:"+h+" ");switch(g.parameters=y.length?e.parseFmtp(y[0]):{},g.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(e.parseRtcpFb),r.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(g.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(d=>{r.headerExtensions.push(e.parseExtmap(d))});const u=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(d=>{u.forEach(h=>{d.rtcpFeedback.find(g=>g.type===h.type&&g.parameter===h.parameter)||d.rtcpFeedback.push(h)})}),r},e.writeRtpDescription=function(n,r){let o="";o+="m="+n+" ",o+=r.codecs.length>0?"9":"0",o+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=r.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(u=>{o+=e.writeRtpMap(u),o+=e.writeFmtp(u),o+=e.writeRtcpFb(u)});let l=0;return r.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(u=>{o+=e.writeExtmap(u)}),o},e.parseRtpEncodingParameters=function(n){const r=[],o=e.parseRtpParameters(n),l=o.fecMechanisms.indexOf("RED")!==-1,u=o.fecMechanisms.indexOf("ULPFEC")!==-1,d=e.matchPrefix(n,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),h=d.length>0&&d[0].ssrc;let m;const g=e.matchPrefix(n,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));g.length>0&&g[0].length>1&&g[0][0]===h&&(m=g[0][1]),o.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let T={ssrc:h,codecPayloadType:parseInt(b.parameters.apt,10)};h&&m&&(T.rtx={ssrc:m}),r.push(T),l&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:h,mechanism:u?"red+ulpfec":"red"},r.push(T))}}),r.length===0&&h&&r.push({ssrc:h});let y=e.matchPrefix(n,"b=");return y.length&&(y[0].indexOf("b=TIAS:")===0?y=parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?y=parseInt(y[0].substring(5),10)*1e3*.95-50*40*8:y=void 0,r.forEach(b=>{b.maxBitrate=y})),r},e.parseRtcpParameters=function(n){const r={},o=e.matchPrefix(n,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const l=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=l.length>0,r.compound=l.length===0;const u=e.matchPrefix(n,"a=rtcp-mux");return r.mux=u.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const o=e.matchPrefix(n,"a=msid:");if(o.length===1)return r=o[0].substring(7).split(" "),{stream:r[0],track:r[1]};const l=e.matchPrefix(n,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(l.length>0)return r=l[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),o=e.matchPrefix(n,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const u=e.matchPrefix(n,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:r.fmt,maxMessageSize:l};const d=e.matchPrefix(n,"a=sctpmap:");if(d.length>0){const h=d[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:l}}},e.writeSctpDescription=function(n,r){let o=[];return n.protocol!=="DTLS/SCTP"?o=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:o=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,o){let l;const u=r!==void 0?r:2;return n?l=n:l=e.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const o=e.splitLines(n);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const o=e.splitLines(n)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},e.parseOLine=function(n){const o=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},i.exports=e}(Dd)),Dd.exports}var rb=jE(),dr=_E(rb),BE=Wk({__proto__:null,default:dr},[rb]);function kc(i){if(!i.RTCIceCandidate||i.RTCIceCandidate&&"foundation"in i.RTCIceCandidate.prototype)return;const e=i.RTCIceCandidate;i.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const o=new e(r),l=dr.parseCandidate(r.candidate);for(const u in l)u in o||Object.defineProperty(o,u,{value:l[u]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(r)},i.RTCIceCandidate.prototype=e.prototype,ma(i,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new i.RTCIceCandidate(n.candidate),writable:"false"}),n))}function df(i){!i.RTCIceCandidate||i.RTCIceCandidate&&"relayProtocol"in i.RTCIceCandidate.prototype||ma(i,"icecandidate",e=>{if(e.candidate){const n=dr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Cc(i,e){if(!i.RTCPeerConnection)return;"sctp"in i.RTCPeerConnection.prototype||Object.defineProperty(i.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const h=dr.splitSections(d.sdp);return h.shift(),h.some(m=>{const g=dr.parseMLine(m);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},r=function(d){const h=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const m=parseInt(h[1],10);return m!==m?-1:m},o=function(d){let h=65536;return e.browser==="firefox"&&(e.version<57?d===-1?h=16384:h=2147483637:e.version<60?h=e.version===57?65535:65536:h=2147483637),h},l=function(d,h){let m=65536;e.browser==="firefox"&&e.version===57&&(m=65535);const g=dr.matchPrefix(d.sdp,"a=max-message-size:");return g.length>0?m=parseInt(g[0].substring(19),10):e.browser==="firefox"&&h!==-1&&(m=2147483637),m},u=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=r(arguments[0]),m=o(h),g=l(arguments[0],h);let y;m===0&&g===0?y=Number.POSITIVE_INFINITY:m===0||g===0?y=Math.max(m,g):y=Math.min(m,g);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return y}}),this._sctp=b}return u.apply(this,arguments)}}function Ec(i){if(!(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype))return;function e(r,o){const l=r.send;r.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(r.readyState==="open"&&o.sctp&&h>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(r,arguments)}}const n=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){const o=n.apply(this,arguments);return e(o,this),o},ma(i,"datachannel",r=>(e(r.channel,r.target),r))}function ff(i){if(!i.RTCPeerConnection||"connectionState"in i.RTCPeerConnection.prototype)return;const e=i.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",o);l.dispatchEvent(u)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function hf(i,e){if(!i.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=o.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);i.RTCSessionDescription&&o instanceof i.RTCSessionDescription?arguments[0]=new i.RTCSessionDescription({type:o.type,sdp:l}):o.sdp=l}return n.apply(this,arguments)}}function Rc(i,e){if(!(i.RTCPeerConnection&&i.RTCPeerConnection.prototype))return;const n=i.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function _c(i,e){if(!(i.RTCPeerConnection&&i.RTCPeerConnection.prototype))return;const n=i.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(i.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return n.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?n.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>n.apply(this,[u]))})}var zE=Object.freeze({__proto__:null,removeExtmapAllowMixed:hf,shimAddIceCandidateNullOrEmpty:Rc,shimConnectionState:ff,shimMaxMessageSize:Cc,shimParameterlessSetLocalDescription:_c,shimRTCIceCandidate:kc,shimRTCIceCandidateRelayProtocol:df,shimSendThrowTypeError:Ec});function qE(){let{window:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=D0,r=LE(i),o={browserDetails:r,commonShim:zE,extractVersion:Tc,disableLog:NE,disableWarnings:UE,sdp:BE};switch(r.browser){case"chrome":if(!qv||!lf||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=qv,Rc(i,r),_c(i),x0(i,r),P0(i),lf(i,r),N0(i),j0(i,r),U0(i),L0(i),B0(i,r),kc(i),df(i),ff(i),Cc(i,r),Ec(i),hf(i,r);break;case"firefox":if(!Vv||!uf||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=Vv,Rc(i,r),_c(i),z0(i,r),uf(i,r),q0(i),G0(i),V0(i),H0(i),F0(i),Y0(i),K0(i),Q0(i),X0(i),kc(i),ff(i),Cc(i,r),Ec(i);break;case"safari":if(!Hv||!e.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Hv,Rc(i,r),_c(i),tb(i),ib(i),W0(i),Z0(i),J0(i),nb(i),$0(i),ab(i),kc(i),df(i),Cc(i,r),Ec(i),hf(i,r);break;default:n("Unsupported browser!");break}return o}qE({window:typeof window>"u"?void 0:window});const VE=10,dc="lk_e2ee",HE="LKFrameEncryptionKey",GE={sharedKey:!1,ratchetSalt:HE,ratchetWindowSize:8,failureTolerance:VE,keyringSize:16};var Pi;(function(i){i.SetKey="setKey",i.RatchetRequest="ratchetRequest",i.KeyRatcheted="keyRatcheted"})(Pi||(Pi={}));var Fv;(function(i){i.KeyRatcheted="keyRatcheted"})(Fv||(Fv={}));var xi;(function(i){i.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",i.EncryptionError="encryptionError"})(xi||(xi={}));var Yv;(function(i){i.Error="cryptorError"})(Yv||(Yv={}));function FE(){return YE()||mf()}function mf(){return typeof window.RTCRtpScriptTransform<"u"}function YE(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class YO extends xn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r)=>{ke.debug("key ratcheted event received",{material:n,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},GE),e),this.on(Pi.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const o={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),o),this.emit(Pi.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Pi.RatchetRequest,e,n)}}class ji extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var _e;(function(i){i[i.NotAllowed=0]="NotAllowed",i[i.ServerUnreachable=1]="ServerUnreachable",i[i.InternalError=2]="InternalError",i[i.Cancelled=3]="Cancelled",i[i.LeaveRequest=4]="LeaveRequest"})(_e||(_e={}));class Ge extends ji{constructor(e,n,r,o){super(1,e),this.name="ConnectionError",this.status=r,this.reason=n,this.context=o,this.reasonName=_e[n]}}class Xf extends ji{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Wn extends ji{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class KE extends ji{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class ut extends ji{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class pf extends ji{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Md extends ji{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Kv extends ji{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Kf[n]}}var zs;(function(i){i.PermissionDenied="PermissionDenied",i.NotFound="NotFound",i.DeviceInUse="DeviceInUse",i.Other="Other"})(zs||(zs={}));(function(i){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?i.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?i.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?i.DeviceInUse:i.Other}i.getFailure=e})(zs||(zs={}));var Qv;(function(i){i[i.InvalidKey=0]="InvalidKey",i[i.MissingKey=1]="MissingKey",i[i.InternalError=2]="InternalError"})(Qv||(Qv={}));var H;(function(i){i.Connected="connected",i.Reconnecting="reconnecting",i.SignalReconnecting="signalReconnecting",i.Reconnected="reconnected",i.Disconnected="disconnected",i.ConnectionStateChanged="connectionStateChanged",i.MediaDevicesChanged="mediaDevicesChanged",i.ParticipantConnected="participantConnected",i.ParticipantDisconnected="participantDisconnected",i.TrackPublished="trackPublished",i.TrackSubscribed="trackSubscribed",i.TrackSubscriptionFailed="trackSubscriptionFailed",i.TrackUnpublished="trackUnpublished",i.TrackUnsubscribed="trackUnsubscribed",i.TrackMuted="trackMuted",i.TrackUnmuted="trackUnmuted",i.LocalTrackPublished="localTrackPublished",i.LocalTrackUnpublished="localTrackUnpublished",i.LocalAudioSilenceDetected="localAudioSilenceDetected",i.ActiveSpeakersChanged="activeSpeakersChanged",i.ParticipantMetadataChanged="participantMetadataChanged",i.ParticipantNameChanged="participantNameChanged",i.ParticipantAttributesChanged="participantAttributesChanged",i.RoomMetadataChanged="roomMetadataChanged",i.DataReceived="dataReceived",i.SipDTMFReceived="sipDTMFReceived",i.TranscriptionReceived="transcriptionReceived",i.ConnectionQualityChanged="connectionQualityChanged",i.TrackStreamStateChanged="trackStreamStateChanged",i.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",i.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",i.AudioPlaybackStatusChanged="audioPlaybackChanged",i.VideoPlaybackStatusChanged="videoPlaybackChanged",i.MediaDevicesError="mediaDevicesError",i.ParticipantPermissionsChanged="participantPermissionsChanged",i.SignalConnected="signalConnected",i.RecordingStatusChanged="recordingStatusChanged",i.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",i.EncryptionError="encryptionError",i.DCBufferStatusChanged="dcBufferStatusChanged",i.ActiveDeviceChanged="activeDeviceChanged",i.ChatMessage="chatMessage",i.LocalTrackSubscribed="localTrackSubscribed",i.MetricsReceived="metricsReceived"})(H||(H={}));var Q;(function(i){i.TrackPublished="trackPublished",i.TrackSubscribed="trackSubscribed",i.TrackSubscriptionFailed="trackSubscriptionFailed",i.TrackUnpublished="trackUnpublished",i.TrackUnsubscribed="trackUnsubscribed",i.TrackMuted="trackMuted",i.TrackUnmuted="trackUnmuted",i.LocalTrackPublished="localTrackPublished",i.LocalTrackUnpublished="localTrackUnpublished",i.ParticipantMetadataChanged="participantMetadataChanged",i.ParticipantNameChanged="participantNameChanged",i.DataReceived="dataReceived",i.SipDTMFReceived="sipDTMFReceived",i.TranscriptionReceived="transcriptionReceived",i.IsSpeakingChanged="isSpeakingChanged",i.ConnectionQualityChanged="connectionQualityChanged",i.TrackStreamStateChanged="trackStreamStateChanged",i.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",i.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",i.MediaDevicesError="mediaDevicesError",i.AudioStreamAcquired="audioStreamAcquired",i.ParticipantPermissionsChanged="participantPermissionsChanged",i.PCTrackAdded="pcTrackAdded",i.AttributesChanged="attributesChanged",i.LocalTrackSubscribed="localTrackSubscribed",i.ChatMessage="chatMessage"})(Q||(Q={}));var te;(function(i){i.TransportsCreated="transportsCreated",i.Connected="connected",i.Disconnected="disconnected",i.Resuming="resuming",i.Resumed="resumed",i.Restarting="restarting",i.Restarted="restarted",i.SignalResumed="signalResumed",i.SignalRestarted="signalRestarted",i.Closing="closing",i.MediaTrackAdded="mediaTrackAdded",i.ActiveSpeakersUpdate="activeSpeakersUpdate",i.DataPacketReceived="dataPacketReceived",i.RTPVideoMapUpdate="rtpVideoMapUpdate",i.DCBufferStatusChanged="dcBufferStatusChanged",i.ParticipantUpdate="participantUpdate",i.RoomUpdate="roomUpdate",i.SpeakersChanged="speakersChanged",i.StreamStateChanged="streamStateChanged",i.ConnectionQualityUpdate="connectionQualityUpdate",i.SubscriptionError="subscriptionError",i.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",i.RemoteMute="remoteMute",i.SubscribedQualityUpdate="subscribedQualityUpdate",i.LocalTrackUnpublished="localTrackUnpublished",i.LocalTrackSubscribed="localTrackSubscribed",i.Offline="offline",i.SignalRequestResponse="signalRequestResponse",i.SignalConnected="signalConnected"})(te||(te={}));var W;(function(i){i.Message="message",i.Muted="muted",i.Unmuted="unmuted",i.Restarted="restarted",i.Ended="ended",i.Subscribed="subscribed",i.Unsubscribed="unsubscribed",i.UpdateSettings="updateSettings",i.UpdateSubscription="updateSubscription",i.AudioPlaybackStarted="audioPlaybackStarted",i.AudioPlaybackFailed="audioPlaybackFailed",i.AudioSilenceDetected="audioSilenceDetected",i.VisibilityChanged="visibilityChanged",i.VideoDimensionsChanged="videoDimensionsChanged",i.VideoPlaybackStarted="videoPlaybackStarted",i.VideoPlaybackFailed="videoPlaybackFailed",i.ElementAttached="elementAttached",i.ElementDetached="elementDetached",i.UpstreamPaused="upstreamPaused",i.UpstreamResumed="upstreamResumed",i.SubscriptionPermissionChanged="subscriptionPermissionChanged",i.SubscriptionStatusChanged="subscriptionStatusChanged",i.SubscriptionFailed="subscriptionFailed",i.TrackProcessorUpdate="trackProcessorUpdate",i.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",i.TranscriptionReceived="transcriptionReceived",i.TimeSyncUpdate="timeSyncUpdate"})(W||(W={}));function QE(i){if(!(typeof i>"u"))return typeof structuredClone=="function"?structuredClone(i):JSON.parse(JSON.stringify(i))}const XE=/version\/(\d+(\.?_?\d+)+)/i;let xd;function gn(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(xd===void 0||e){const r=ZE.find(o=>{let{test:l}=o;return l.test(n)});xd=r==null?void 0:r.describe(n)}return xd}const ZE=[{test:/firefox|iceweasel|fxios/i,describe(i){return{name:"Firefox",version:wc(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,i),os:i.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Pd(i)}}},{test:/chrom|crios|crmo/i,describe(i){return{name:"Chrome",version:wc(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,i),os:i.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Pd(i)}}},{test:/safari|applewebkit/i,describe(i){return{name:"Safari",version:wc(XE,i),os:i.includes("mobile/")?"iOS":"macOS",osVersion:Pd(i)}}}];function wc(i,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(i);return r&&r.length>=n&&r[n]||""}function Pd(i){return i.includes("mac os")?wc(/\(.+?(\d+_\d+(:?_\d+)?)/,i,1).replace(/_/g,"."):void 0}var JE="2.11.2";const WE=JE,$E=15;class Tt{}Tt.setTimeout=function(){return setTimeout(...arguments)};Tt.setInterval=function(){return setInterval(...arguments)};Tt.clearTimeout=function(){return clearTimeout(...arguments)};Tt.clearInterval=function(){return clearInterval(...arguments)};const e1=5e3,Os=[];var rn;(function(i){i[i.LOW=0]="LOW",i[i.MEDIUM=1]="MEDIUM",i[i.HIGH=2]="HIGH"})(rn||(rn={}));class G extends xn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=G.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ke,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),e1):this.handleAppVisibilityChanged()},this.log=$n((o=r.loggerName)!==null&&o!==void 0?o:pn.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=G.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Pe(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===G.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===G.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Os.forEach(l=>{l.parentElement===null&&!e&&(e=l)}),e&&Os.splice(Os.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),cr(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),o=r.some(l=>l.kind==="audio");return e.play().then(()=>{this.emit(o?W.AudioPlaybackStarted:W.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(o?W.AudioPlaybackFailed:W.VideoPlaybackFailed,l):l.name==="AbortError"?ke.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):ke.warn("could not playback ".concat(o?"audio":"video"),l),o&&e&&r.some(u=>u.kind==="video")&&l.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(W.ElementAttached,e),e}detach(e){try{if(e){fr(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(W.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{fr(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(W.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=$n(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Os.forEach(r=>{r.parentElement||(n=!1)}),n&&Os.push(e)}}handleAppVisibilityChanged(){return w(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===G.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ut()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ut()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function cr(i,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;i.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(i)||(r.forEach(o=>{n.removeTrack(o)}),n.addTrack(i)),(!Li()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Li()||yr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function fr(i,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(i),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(i){let e;(function(m){m.Audio="audio",m.Video="video",m.Unknown="unknown"})(e=i.Kind||(i.Kind={}));let n;(function(m){m.Camera="camera",m.Microphone="microphone",m.ScreenShare="screen_share",m.ScreenShareAudio="screen_share_audio",m.Unknown="unknown"})(n=i.Source||(i.Source={}));let r;(function(m){m.Active="active",m.Paused="paused",m.Unknown="unknown"})(r=i.StreamState||(i.StreamState={}));function o(m){switch(m){case e.Audio:return fn.AUDIO;case e.Video:return fn.VIDEO;default:return fn.DATA}}i.kindToProto=o;function l(m){switch(m){case fn.AUDIO:return e.Audio;case fn.VIDEO:return e.Video;default:return e.Unknown}}i.kindFromProto=l;function u(m){switch(m){case n.Camera:return ot.CAMERA;case n.Microphone:return ot.MICROPHONE;case n.ScreenShare:return ot.SCREEN_SHARE;case n.ScreenShareAudio:return ot.SCREEN_SHARE_AUDIO;default:return ot.UNKNOWN}}i.sourceToProto=u;function d(m){switch(m){case ot.CAMERA:return n.Camera;case ot.MICROPHONE:return n.Microphone;case ot.SCREEN_SHARE:return n.ScreenShare;case ot.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}i.sourceFromProto=d;function h(m){switch(m){case af.ACTIVE:return r.Active;case af.PAUSED:return r.Paused;default:return r.Unknown}}i.streamStateFromProto=h})(G||(G={}));class Ve{constructor(e,n,r,o,l){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:o,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const t1=["vp8","h264"],n1=["vp8","h264","vp9","av1"];function i1(i){return!!t1.find(e=>e===i)}var Xv;(function(i){i[i.PREFER_REGRESSION=0]="PREFER_REGRESSION",i[i.SIMULCAST=1]="SIMULCAST",i[i.REGRESSION=2]="REGRESSION"})(Xv||(Xv={}));var gf;(function(i){i.telephone={maxBitrate:12e3},i.speech={maxBitrate:24e3},i.music={maxBitrate:48e3},i.musicStereo={maxBitrate:64e3},i.musicHighQuality={maxBitrate:96e3},i.musicHighQualityStereo={maxBitrate:128e3}})(gf||(gf={}));const qs={h90:new Ve(160,90,9e4,20),h180:new Ve(320,180,16e4,20),h216:new Ve(384,216,18e4,20),h360:new Ve(640,360,45e4,20),h540:new Ve(960,540,8e5,25),h720:new Ve(1280,720,17e5,30),h1080:new Ve(1920,1080,3e6,30),h1440:new Ve(2560,1440,5e6,30),h2160:new Ve(3840,2160,8e6,30)},vf={h120:new Ve(160,120,7e4,20),h180:new Ve(240,180,125e3,20),h240:new Ve(320,240,14e4,20),h360:new Ve(480,360,33e4,20),h480:new Ve(640,480,5e5,20),h540:new Ve(720,540,6e5,25),h720:new Ve(960,720,13e5,30),h1080:new Ve(1440,1080,23e5,30),h1440:new Ve(1920,1440,38e5,30)},Zf={h360fps3:new Ve(640,360,2e5,3,"medium"),h360fps15:new Ve(640,360,4e5,15,"medium"),h720fps5:new Ve(1280,720,8e5,5,"medium"),h720fps15:new Ve(1280,720,15e5,15,"medium"),h720fps30:new Ve(1280,720,2e6,30,"medium"),h1080fps15:new Ve(1920,1080,25e5,15,"medium"),h1080fps30:new Ve(1920,1080,5e6,30,"medium"),original:new Ve(0,0,7e6,30,"medium")},a1="|",Zv="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function r1(i){const e=i.split(a1);return e.length>1?[e[0],i.substr(e[0].length+1)]:[i,""]}function Lt(i){return w(this,void 0,void 0,function*(){return new Promise(e=>Tt.setTimeout(e,i))})}function yf(){return"addTransceiver"in RTCPeerConnection.prototype}function bf(){return"addTrack"in RTCPeerConnection.prototype}function s1(){if(!("getCapabilities"in RTCRtpSender)||Li())return!1;const i=RTCRtpSender.getCapabilities("video");let e=!1;if(i){for(const n of i.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function o1(){if(!("getCapabilities"in RTCRtpSender)||yr())return!1;if(Li()){const n=gn();if(n!=null&&n.version&&da(n.version,"16")<0)return!1}const i=RTCRtpSender.getCapabilities("video");let e=!1;if(i){for(const n of i.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function Us(i){return i==="av1"||i==="vp9"}function Sf(i){return document?(i||(i=document.createElement("audio")),"setSinkId"in i):!1}function c1(){return typeof RTCPeerConnection>"u"?!1:yf()||bf()}function yr(){var i;return((i=gn())===null||i===void 0?void 0:i.name)==="Firefox"}function Li(){var i;return((i=gn())===null||i===void 0?void 0:i.name)==="Safari"}function l1(){const i=gn();return(i==null?void 0:i.name)==="Safari"&&i.version.startsWith("17.")}function sb(){var i,e;return Ut()?(e=(i=navigator.userAgentData)===null||i===void 0?void 0:i.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function u1(){const i=gn(),e="17.2";if(i)return i.name!=="Safari"&&i.os!=="iOS"||i.os==="iOS"&&i.osVersion&&da(e,i.osVersion)>=0?!0:i.name==="Safari"&&da(e,i.version)>=0}function Ut(){return typeof document<"u"}function An(){return navigator.product=="ReactNative"}function Tf(i){return i.hostname.endsWith(".livekit.cloud")||i.hostname.endsWith(".livekit.run")}function ob(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function cb(){if(!An())return;let i=ob();if(i)return i.platform}function Jv(){if(Ut())return window.devicePixelRatio;if(An()){let i=ob();if(i)return i.devicePixelRatio}return 1}function da(i,e){const n=i.split("."),r=e.split("."),o=Math.min(n.length,r.length);for(let l=0;l<o;++l){const u=parseInt(n[l],10),d=parseInt(r[l],10);if(u>d)return 1;if(u<d)return-1;if(l===o-1&&u===d)return 0}return i===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function d1(i){for(const e of i)e.target.handleResize(e)}function f1(i){for(const e of i)e.target.handleVisibilityChanged(e)}let Nd=null;const Wv=()=>(Nd||(Nd=new ResizeObserver(d1)),Nd);let Ud=null;const $v=()=>(Ud||(Ud=new IntersectionObserver(f1,{root:null,rootMargin:"0px"})),Ud);function h1(){var i;const e=new nE({sdk:h0.JS,protocol:$E,version:WE});return An()&&(e.os=(i=cb())!==null&&i!==void 0?i:""),e}function ey(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=i,o.height=e;const l=o.getContext("2d");l==null||l.fillRect(0,0,o.width,o.height),r&&l&&(l.beginPath(),l.arc(i/2,e/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const u=o.captureStream(),[d]=u.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=n,d}let As;function Ld(){if(!As){const i=new AudioContext,e=i.createOscillator(),n=i.createGain();n.gain.setValueAtTime(0,0);const r=i.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[As]=r.stream.getAudioTracks(),!As)throw Error("Could not get empty media stream audio track");As.enabled=!1}return As.clone()}class lb{constructor(e,n){this.onFinally=n,this.promise=new Promise((r,o)=>w(this,void 0,void 0,function*(){this.resolve=r,this.reject=o,e&&(yield e(r,o))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}function m1(i,e){const n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},e),r=Wf();if(!r)throw new Error("Audio Context not supported on this browser");const o=n.cloneTrack?i.mediaStreamTrack.clone():i.mediaStreamTrack,l=r.createMediaStreamSource(new MediaStream([o])),u=r.createAnalyser();u.minDecibels=n.minDecibels,u.maxDecibels=n.maxDecibels,u.fftSize=n.fftSize,u.smoothingTimeConstant=n.smoothingTimeConstant,l.connect(u);const d=new Uint8Array(u.frequencyBinCount);return{calculateVolume:()=>{u.getByteFrequencyData(d);let g=0;for(const b of d)g+=Math.pow(b/255,2);return Math.sqrt(g/d.length)},analyser:u,cleanup:()=>w(this,void 0,void 0,function*(){yield r.close(),n.cloneTrack&&o.stop()})}}function p1(i){return n1.includes(i)}function Ni(i){if(typeof i=="string"||typeof i=="number")return i;if(Array.isArray(i))return i[0];if(i.exact)return Array.isArray(i.exact)?i.exact[0]:i.exact;if(i.ideal)return Array.isArray(i.ideal)?i.ideal[0]:i.ideal;throw Error("could not unwrap constraint")}function kf(i){return i.startsWith("ws")?i.replace(/^(ws)/,"http"):i}function g1(i,e){return i.segments.map(n=>{let{id:r,text:o,language:l,startTime:u,endTime:d,final:h}=n;var m;const g=(m=e.get(r))!==null&&m!==void 0?m:Date.now(),y=Date.now();return h?e.delete(r):e.set(r,g),{id:r,text:o,startTime:Number.parseInt(u.toString()),endTime:Number.parseInt(d.toString()),final:h,language:l,firstReceivedTime:g,lastReceivedTime:y}})}function v1(i){const{id:e,timestamp:n,message:r,editTimestamp:o}=i;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:r}}function ty(i){switch(i.reason){case _e.LeaveRequest:return i.context;case _e.Cancelled:return mn.CLIENT_INITIATED;case _e.NotAllowed:return mn.USER_REJECTED;case _e.ServerUnreachable:return mn.JOIN_FAILURE;default:return mn.UNKNOWN_REASON}}function Oc(i){return i!==void 0?Number(i):void 0}function aa(i){return i!==void 0?BigInt(i):void 0}function hr(i){return!!i&&!(i instanceof MediaStreamTrack)&&i.isLocal}function ei(i){return!!i&&i.kind==G.Kind.Audio}function Cr(i){return!!i&&i.kind==G.Kind.Video}function Oi(i){return hr(i)&&Cr(i)}function ra(i){return hr(i)&&ei(i)}function Cf(i){return!!i&&!i.isLocal}function y1(i){return!!i&&!i.isLocal}function Id(i){return Cf(i)&&Cr(i)}function b1(i){return i.isLocal}function S1(i,e){const n=[];let r=new TextEncoder().encode(i);for(;r.length>e;){let o=e;for(;o>0;){const l=r[o];if(l!==void 0&&(l&192)!==128)break;o--}n.push(r.slice(0,o)),r=r.slice(o)}return r.length>0&&n.push(r),n}function ub(i,e,n){var r,o,l,u,d;const{optionsWithoutProcessor:h,audioProcessor:m,videoProcessor:g}=fb(i??{}),y=e==null?void 0:e.processor,b=n==null?void 0:n.processor,T=(r=QE(h))!==null&&r!==void 0?r:{};return T.audio===!0&&(T.audio={}),T.video===!0&&(T.video={}),T.audio&&(Ef(T.audio,e),(o=(u=T.audio).deviceId)!==null&&o!==void 0||(u.deviceId={ideal:"default"}),(m||y)&&(T.audio.processor=m??y)),T.video&&(Ef(T.video,n),(l=(d=T.video).deviceId)!==null&&l!==void 0||(d.deviceId={ideal:"default"}),(g||b)&&(T.video.processor=g??b)),T}function Ef(i,e){return Object.keys(e).forEach(n=>{i[n]===void 0&&(i[n]=e[n])}),i}function Jf(i){var e,n,r,o;const l={};if(i.video)if(typeof i.video=="object"){const u={},d=u,h=i.video;Object.keys(h).forEach(m=>{switch(m){case"resolution":Ef(d,h.resolution);break;default:d[m]=h[m]}}),l.video=u,(e=(r=l.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else l.video=i.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return i.audio?typeof i.audio=="object"?(l.audio=i.audio,(n=(o=l.audio).deviceId)!==null&&n!==void 0||(o.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function db(i){return w(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const r=Wf();if(r){const o=r.createAnalyser();o.fftSize=2048;const l=o.frequencyBinCount,u=new Uint8Array(l);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(o),yield Lt(n),o.getByteTimeDomainData(u);const h=u.some(m=>m!==128&&m!==0);return r.close(),!h}return!1}()})}function Wf(){var i;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((i=window.document)===null||i===void 0)&&i.body)){const r=()=>w(this,void 0,void 0,function*(){var o;try{n.state==="suspended"&&(yield n.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}(o=window.document.body)===null||o===void 0||o.removeEventListener("click",r)});window.document.body.addEventListener("click",r)}return n}}function ny(i){return i===G.Source.Microphone?"audioinput":i===G.Source.Camera?"videoinput":void 0}function T1(i){var e,n;let r=(e=i.video)!==null&&e!==void 0?e:!0;return i.resolution&&i.resolution.width>0&&i.resolution.height>0&&(r=typeof r=="boolean"?{}:r,Li()?r=Object.assign(Object.assign({},r),{width:{max:i.resolution.width},height:{max:i.resolution.height},frameRate:i.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:i.resolution.width},height:{ideal:i.resolution.height},frameRate:i.resolution.frameRate})),{audio:(n=i.audio)!==null&&n!==void 0?n:!1,video:r,controller:i.controller,selfBrowserSurface:i.selfBrowserSurface,surfaceSwitching:i.surfaceSwitching,systemAudio:i.systemAudio,preferCurrentTab:i.preferCurrentTab}}function Ac(i){return i.split("/")[1].toLowerCase()}function k1(i){const e=[];return i.forEach(n=>{n.track!==void 0&&e.push(new Ff({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Pe(i){return"mediaStreamTrack"in i?{trackID:i.sid,source:i.source,muted:i.isMuted,enabled:i.mediaStreamTrack.enabled,kind:i.kind,streamID:i.mediaStreamID,streamTrackID:i.mediaStreamTrack.id}:{trackID:i.trackSid,enabled:i.isEnabled,muted:i.isMuted,trackInfo:Object.assign({mimeType:i.mimeType,name:i.trackName,encrypted:i.isEncrypted,kind:i.kind,source:i.source},i.track?Pe(i.track):{})}}function C1(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function E1(i,e){var n;i===void 0&&(i={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(i)],o={};for(const l of r)i[l]!==e[l]&&(o[l]=(n=e[l])!==null&&n!==void 0?n:"");return o}function fb(i){const e=Object.assign({},i);let n,r;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:e}}function R1(i){switch(i){case ot.CAMERA:return G.Source.Camera;case ot.MICROPHONE:return G.Source.Microphone;case ot.SCREEN_SHARE:return G.Source.ScreenShare;case ot.SCREEN_SHARE_AUDIO:return G.Source.ScreenShareAudio;default:return G.Source.Unknown}}class _1 extends xn.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var r,o;const{kind:l,data:u}=n.data;switch(l){case"error":ke.error(u.error.message),this.emit(xi.EncryptionError,u.error);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"enable":if(u.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)}),this.encryptionEnabled!==u.enabled&&u.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(xi.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const d=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(u.participantIdentity);if(!d)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(xi.ParticipantEncryptionStatusChanged,u.enabled,d)}break;case"ratchetKey":this.keyProvider.emit(Pi.KeyRatcheted,u.material,u.keyIndex);break}},this.onWorkerError=n=>{ke.error("e2ee worker encountered an error:",{error:n.error}),this.emit(xi.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!FE())throw new Xf("tried to setup end-to-end encryption on an unsupported browser");if(ke.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:AE.getLevel()}};this.worker&&(ke.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ke.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ke.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(te.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(H.TrackPublished,(r,o)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==Yt.NONE,o.identity)),e.on(H.ConnectionStateChanged,r=>{r===Re.Connected&&e.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==Yt.NONE,o.identity)})})}).on(H.TrackUnsubscribed,(r,o,l)=>{var u;const d={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:r.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(d)}).on(H.TrackSubscribed,(r,o,l)=>{this.setupE2EEReceiver(r,l.identity,o.trackInfo)}).on(H.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Q.LocalTrackPublished,r=>w(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),n.on(Pi.SetKey,r=>this.postKey(r)).on(Pi.RatchetRequest,(r,o)=>this.postRatchetRequest(r,o))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:o}=e;var l;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:n,keyIndex:o}};this.worker.postMessage(u)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Ac(r.mimeType):void 0)}}setupE2EESender(e,n){if(!hr(e)||!n){n||ke.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,o){return w(this,void 0,void 0,function*(){if(this.worker){if(mf()){const l={kind:"decode",participantIdentity:r,trackId:n,codec:o};e.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(dc in e&&o){const h={kind:"updateCodec",data:{trackId:n,codec:o,participantIdentity:r}};this.worker.postMessage(h);return}let l=e.writableStream,u=e.readableStream;if(!l||!u){const h=e.createEncodedStreams();e.writableStream=h.writable,l=h.writable,e.readableStream=h.readable,u=h.readable}const d={kind:"decode",data:{readableStream:u,writableStream:l,trackId:n,codec:o,participantIdentity:r}};this.worker.postMessage(d,[u,l])}e[dc]=!0}})}handleSender(e,n,r){var o;if(!(dc in e||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(mf()){ke.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,l)}else{ke.info("initialize encoded streams");const l=e.createEncodedStreams(),u={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(u,[l.readable,l.writable])}e[dc]=!0}}}const jd="default";class gt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new gt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return w(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var l;if(((l=gt.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){ke.debug("awaiting getUserMedia promise");try{n?yield gt.userMediaPromiseMap.get(n):yield Promise.all(gt.userMediaPromiseMap.values())}catch{ke.warn("error waiting for media permissons")}}let u=yield navigator.mediaDevices.enumerateDevices();if(o&&!(Li()&&r.hasDeviceInUse(n))&&(u.filter(h=>h.kind===n).length===0||u.some(h=>{const m=h.label==="",g=n?h.kind===n:!0;return m&&g}))){const h={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},m=yield navigator.mediaDevices.getUserMedia(h);u=yield navigator.mediaDevices.enumerateDevices(),m.getTracks().forEach(g=>{g.stop()})}return r._previousDevices=u,n&&(u=u.filter(d=>d.kind===n)),u}()})}normalizeDeviceId(e,n,r){return w(this,void 0,void 0,function*(){if(n!==jd)return n;const o=yield this.getDevices(e),l=o.find(d=>d.deviceId===jd);if(!l){ke.warn("could not reliably determine default device");return}const u=o.find(d=>d.deviceId!==jd&&d.groupId===(r??l.groupId));if(!u){ke.warn("could not reliably determine default device");return}return u==null?void 0:u.deviceId})}hasDeviceInUse(e){return e?gt.userMediaPromiseMap.has(e):gt.userMediaPromiseMap.size>0}}gt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];gt.userMediaPromiseMap=new Map;var Ls;(function(i){i[i.WAITING=0]="WAITING",i[i.RUNNING=1]="RUNNING",i[i.COMPLETED=2]="COMPLETED"})(Ls||(Ls={}));class w1{constructor(){this.pendingTasks=new Map,this.taskMutex=new Nt,this.nextTaskIndex=0}run(e){return w(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ls.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Ls.RUNNING,yield e()}finally{n.status=Ls.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return w(this,void 0,void 0,function*(){return this.run(()=>w(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function O1(i,e){const n=new URL(i);return e.forEach((r,o)=>{n.searchParams.set(o,r)}),hb(n,"rtc")}function A1(i){const e=new URL(kf(i));return hb(e,"validate")}function D1(i){return i.endsWith("/")?i:"".concat(i,"/")}function hb(i,e){return i.pathname="".concat(D1(i.pathname)).concat(e),i.toString()}const M1=["syncState","trickle","offer","answer","simulate","leave"];function x1(i){const e=M1.indexOf(i.case)>=0;return ke.trace("request allowed to bypass queue:",{canPass:e,req:i}),e}var Ye;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.CONNECTED=1]="CONNECTED",i[i.RECONNECTING=2]="RECONNECTING",i[i.DISCONNECTING=3]="DISCONNECTING",i[i.DISCONNECTED=4]="DISCONNECTED"})(Ye||(Ye={}));class $f{get currentState(){return this.state}get isDisconnected(){return this.state===Ye.DISCONNECTING||this.state===Ye.DISCONNECTED}get isEstablishingConnection(){return this.state===Ye.CONNECTING||this.state===Ye.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=Ye.DISCONNECTED,this.log=ke,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=$n((r=n.loggerName)!==null&&r!==void 0?r:pn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new w1,this.queuedRequests=[],this.closingLock=new Nt,this.connectionLock=new Nt,this.state=Ye.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,o){return w(this,void 0,void 0,function*(){return this.state=Ye.CONNECTING,this.options=r,yield this.connect(e,n,r,o)})}reconnect(e,n,r,o){return w(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ye.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:o}))})}connect(e,n,r,o){this.connectOptions=r;const l=h1(),u=P1(n,l,r),d=O1(e,u),h=A1(d);return new Promise((m,g)=>w(this,void 0,void 0,function*(){const y=yield this.connectionLock.lock();try{const b=()=>w(this,void 0,void 0,function*(){this.close(),clearTimeout(T),g(new Ge("room connection has been cancelled (signal)",_e.Cancelled))}),T=setTimeout(()=>{this.close(),g(new Ge("room connection has timed out (signal)",_e.ServerUnreachable))},r.websocketTimeout);o!=null&&o.aborted&&b(),o==null||o.addEventListener("abort",b);const C=new URL(d);C.searchParams.has("access_token")&&C.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(C),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(d),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(T)},this.ws.onerror=k=>w(this,void 0,void 0,function*(){if(this.state!==Ye.CONNECTED){this.state=Ye.DISCONNECTED,clearTimeout(T);try{const O=yield fetch(h);if(O.status.toFixed(0).startsWith("4")){const _=yield O.text();g(new Ge(_,_e.NotAllowed,O.status))}else g(new Ge("Encountered unknown websocket error during connection: ".concat(k.toString()),_e.InternalError,O.status))}catch(O){g(new Ge(O instanceof Error?O.message:"server was not reachable",_e.ServerUnreachable))}return}this.handleWSError(k)}),this.ws.onmessage=k=>w(this,void 0,void 0,function*(){var O,_,B;let q;if(typeof k.data=="string"){const P=JSON.parse(k.data);q=Nv.fromJson(P,{ignoreUnknownFields:!0})}else if(k.data instanceof ArrayBuffer)q=Nv.fromBinary(new Uint8Array(k.data));else{this.log.error("could not decode websocket message: ".concat(typeof k.data),this.logContext);return}if(this.state!==Ye.CONNECTED){let P=!1;if(((O=q.message)===null||O===void 0?void 0:O.case)==="join"?(this.state=Ye.CONNECTED,o==null||o.removeEventListener("abort",b),this.pingTimeoutDuration=q.message.value.pingTimeout,this.pingIntervalDuration=q.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),m(q.message.value)):this.state===Ye.RECONNECTING&&q.message.case!=="leave"?(this.state=Ye.CONNECTED,o==null||o.removeEventListener("abort",b),this.startPingInterval(),((_=q.message)===null||_===void 0?void 0:_.case)==="reconnect"?m(q.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),m(void 0),P=!0)):this.isEstablishingConnection&&q.message.case==="leave"?g(new Ge("Received leave request while trying to (re)connect",_e.LeaveRequest,void 0,q.message.value.reason)):r.reconnect||g(new Ge("did not receive join response, got ".concat((B=q.message)===null||B===void 0?void 0:B.case," instead"),_e.InternalError)),!P)return}this.signalLatency&&(yield Lt(this.signalLatency)),this.handleSignalResponse(q)}),this.ws.onclose=k=>{this.isEstablishingConnection&&g(new Ge("Websocket got closed during a (re)connection attempt",_e.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:k.reason,code:k.code,wasClean:k.wasClean,state:this.state})),this.handleOnClose(k.reason)}}finally{y()}}))}close(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Ye.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const o=new Promise(l=>{e.ws?e.ws.onclose=()=>{l()}:l()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([o,Lt(250)])),e.ws=void 0}}finally{n&&(e.state=Ye.DISCONNECTED),r()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Nc(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Nc(e)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Hf({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Gf({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return w(this,arguments,void 0,function(r,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const d=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new T0({requestId:d,metadata:r,name:o,attributes:u})}),d}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new S0({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new E0({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Xe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new w0({timestamp:Xe.parse(Date.now()),rtt:Xe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new b0({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Qc({reason:mn.CLIENT_INITIATED,action:ur.DISCONNECT})})}sendRequest(e){return w(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!o&&!x1(n)&&r.state===Ye.RECONNECTING){r.queuedRequests.push(()=>w(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(o||(yield r.requestQueue.flush()),r.signalLatency&&(yield Lt(r.signalLatency)),!r.ws||r.ws.readyState!==r.ws.OPEN){r.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),r.logContext);return}const u=new rE({message:n});try{r.useJSON?r.ws.send(u.toJsonString()):r.ws.send(u.toBinary())}catch(d){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:d}))}}()})}handleSignalResponse(e){var n,r;const o=e.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(o.case==="answer"){const u=iy(o.value);this.onAnswer&&this.onAnswer(u)}else if(o.case==="offer"){const u=iy(o.value);this.onOffer&&this.onOffer(u)}else if(o.case==="trickle"){const u=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(u,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=o.value.participants)!==null&&n!==void 0?n:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=o.value.speakers)!==null&&r!==void 0?r:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return w(this,void 0,void 0,function*(){if(this.state===Ye.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Tt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Tt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Tt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Tt.clearInterval(this.pingInterval)}}function iy(i){const e={type:"offer",sdp:i.sdp};switch(i.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=i.type;break}return e}function Nc(i){return new ua({sdp:i.sdp,type:i.type})}function P1(i,e,n){var r;const o=new URLSearchParams;return o.set("access_token",i),n.reconnect&&(o.set("reconnect","1"),n.sid&&o.set("sid",n.sid)),o.set("auto_subscribe",n.autoSubscribe?"1":"0"),o.set("sdk",An()?"reactnative":"js"),o.set("version",e.version),o.set("protocol",e.protocol.toString()),e.deviceModel&&o.set("device_model",e.deviceModel),e.os&&o.set("os",e.os),e.osVersion&&o.set("os_version",e.osVersion),e.browser&&o.set("browser",e.browser),e.browserVersion&&o.set("browser_version",e.browserVersion),n.adaptiveStream&&o.set("adaptive_stream","1"),n.reconnectReason&&o.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&o.set("network",navigator.connection.type),o}var ln={},Bd={},zd={exports:{}},ay;function eh(){if(ay)return zd.exports;ay=1;var i=zd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(i).forEach(function(e){var n=i[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),zd.exports}var ry;function N1(){return ry||(ry=1,function(i){var e=function(d){return String(Number(d))===d?Number(d):d},n=function(d,h,m,g){if(g&&!m)h[g]=e(d[1]);else for(var y=0;y<m.length;y+=1)d[y+1]!=null&&(h[m[y]]=e(d[y+1]))},r=function(d,h,m){var g=d.name&&d.names;d.push&&!h[d.push]?h[d.push]=[]:g&&!h[d.name]&&(h[d.name]={});var y=d.push?{}:g?h[d.name]:h;n(m.match(d.reg),y,d.names,d.name),d.push&&h[d.push].push(y)},o=eh(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);i.parse=function(d){var h={},m=[],g=h;return d.split(/(\r\n|\r|\n)/).filter(l).forEach(function(y){var b=y[0],T=y.slice(2);b==="m"&&(m.push({rtp:[],fmtp:[]}),g=m[m.length-1]);for(var C=0;C<(o[b]||[]).length;C+=1){var k=o[b][C];if(k.reg.test(T))return r(k,g,T)}}),h.media=m,h};var u=function(d,h){var m=h.split(/=(.+)/,2);return m.length===2?d[m[0]]=e(m[1]):m.length===1&&h.length>1&&(d[m[0]]=void 0),d};i.parseParams=function(d){return d.split(/;\s?/).reduce(u,{})},i.parseFmtpConfig=i.parseParams,i.parsePayloads=function(d){return d.toString().split(" ").map(Number)},i.parseRemoteCandidates=function(d){for(var h=[],m=d.split(" ").map(e),g=0;g<m.length;g+=3)h.push({component:m[g],ip:m[g+1],port:m[g+2]});return h},i.parseImageAttributes=function(d){return d.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(u,{})})},i.parseSimulcastStreamList=function(d){return d.split(";").map(function(h){return h.split(",").map(function(m){var g,y=!1;return m[0]!=="~"?g=e(m):(g=e(m.substring(1,m.length)),y=!0),{scid:g,paused:y}})})}}(Bd)),Bd}var qd,sy;function U1(){if(sy)return qd;sy=1;var i=eh(),e=/%[sdv%]/g,n=function(u){var d=1,h=arguments,m=h.length;return u.replace(e,function(g){if(d>=m)return g;var y=h[d];switch(d+=1,g){case"%%":return"%";case"%s":return String(y);case"%d":return Number(y);case"%v":return""}})},r=function(u,d,h){var m=d.format instanceof Function?d.format(d.push?h:h[d.name]):d.format,g=[u+"="+m];if(d.names)for(var y=0;y<d.names.length;y+=1){var b=d.names[y];d.name?g.push(h[d.name][b]):g.push(h[d.names[y]])}else g.push(h[d.name]);return n.apply(null,g)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return qd=function(u,d){d=d||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(y){y.payloads==null&&(y.payloads="")});var h=d.outerOrder||o,m=d.innerOrder||l,g=[];return h.forEach(function(y){i[y].forEach(function(b){b.name in u&&u[b.name]!=null?g.push(r(y,b,u)):b.push in u&&u[b.push]!=null&&u[b.push].forEach(function(T){g.push(r(y,b,T))})})}),u.media.forEach(function(y){g.push(r("m",i.m[0],y)),m.forEach(function(b){i[b].forEach(function(T){T.name in y&&y[T.name]!=null?g.push(r(b,T,y)):T.push in y&&y[T.push]!=null&&y[T.push].forEach(function(C){g.push(r(b,T,C))})})})}),g.join(`\r
`)+`\r
`},qd}var oy;function L1(){if(oy)return ln;oy=1;var i=N1(),e=U1(),n=eh();return ln.grammar=n,ln.write=e,ln.parse=i.parse,ln.parseParams=i.parseParams,ln.parseFmtpConfig=i.parseFmtpConfig,ln.parsePayloads=i.parsePayloads,ln.parseRemoteCandidates=i.parseRemoteCandidates,ln.parseImageAttributes=i.parseImageAttributes,ln.parseSimulcastStreamList=i.parseSimulcastStreamList,ln}var Ai=L1();function th(i,e,n){var r,o,l;e===void 0&&(e=50),n===void 0&&(n={});var u=(r=n.isImmediate)!=null&&r,d=(o=n.callback)!=null&&o,h=n.maxWait,m=Date.now(),g=[];function y(){if(h!==void 0){var T=Date.now()-m;if(T+e>=h)return h-T}return e}var b=function(){var T=[].slice.call(arguments),C=this;return new Promise(function(k,O){var _=u&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,m=Date.now(),!u){var q=i.apply(C,T);d&&d(q),g.forEach(function(P){return(0,P.resolve)(q)}),g=[]}},y()),_){var B=i.apply(C,T);return d&&d(B),k(B)}g.push({resolve:k,reject:O})})};return b.cancel=function(T){l!==void 0&&clearTimeout(l),g.forEach(function(C){return(0,C.reject)(T)}),g=[]},b}const I1=.7,j1=20,mr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class cy extends xn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=ke,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=th(o=>w(this,void 0,void 0,function*(){this.emit(mr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(o)o(l);else throw l}}),j1),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=$n((r=n.loggerName)!==null&&r!==void 0?r:pn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return w(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return w(this,void 0,void 0,function*(){var n;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:l}=B1(e);this.remoteStereoMids=o,this.remoteNackMids=l}else if(e.type==="answer"){const o=Ai.parse((n=e.sdp)!==null&&n!==void 0?n:"");o.media.forEach(l=>{l.type==="audio"&&this.trackBitrates.some(u=>{if(!u.transceiver||l.mid!=u.transceiver.mid)return!1;let d=0;if(l.rtp.some(m=>m.codec.toUpperCase()===u.codec.toUpperCase()?(d=m.payload,!0):!1),d===0)return!0;let h=!1;for(const m of l.fmtp)if(m.payload===d){m.config=m.config.split(";").filter(g=>!g.includes("maxaveragebitrate")).join(";"),u.maxbr>0&&(m.config+=";maxaveragebitrate=".concat(u.maxbr*1e3)),h=!0;break}return h||u.maxbr>0&&l.fmtp.push({payload:d,config:"maxaveragebitrate=".concat(u.maxbr*1e3)}),!0})}),r=Ai.write(o)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(mr.NegotiationComplete),e.sdp&&Ai.parse(e.sdp).media.forEach(l=>{l.type==="video"&&this.emit(mr.RTPVideoPayloadTypes,l.rtp)}))})}createAndSendOffer(e){return w(this,void 0,void 0,function*(){var n;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const o=Ai.parse((n=r.sdp)!==null&&n!==void 0?n:"");o.media.forEach(l=>{uy(l),l.type==="audio"?ly(l,[],[]):l.type==="video"&&this.trackBitrates.some(u=>{if(!l.msid||!u.cid||!l.msid.includes(u.cid))return!1;let d=0;if(l.rtp.some(m=>m.codec.toUpperCase()===u.codec.toUpperCase()?(d=m.payload,!0):!1),d===0||(Us(u.codec)&&this.ensureVideoDDExtensionForSVC(l,o),u.codec!=="av1"))return!0;const h=Math.round(u.maxbr*I1);for(const m of l.fmtp)if(m.payload===d){m.config.includes("x-google-start-bitrate")||(m.config+=";x-google-start-bitrate=".concat(h));break}return!0})}),yield this.setMungedSDP(r,Ai.write(o)),this.onOffer(r)})}createAndSetAnswer(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=Ai.parse((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(o=>{uy(o),o.type==="audio"&&ly(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Ai.write(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new ut("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new ut("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return w(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,o=new Map;if((yield this._pc.getStats()).forEach(d=>{switch(d.type){case"transport":n=d.selectedCandidatePairId;break;case"candidate-pair":n===""&&d.selected&&(n=d.id),r.set(d.id,d);break;case"remote-candidate":o.set(d.id,"".concat(d.address,":").concat(d.port));break}}),n==="")return;const u=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(u!==void 0)return o.get(u)})}setMungedSDP(e,n,r){return w(this,void 0,void 0,function*(){if(n){const o=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(l){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:n})),e.sdp=o}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(o){let l="unknown error";o instanceof Error?l=o.message:typeof o=="string"&&(l=o);const u={error:l,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new pf(l)}})}ensureVideoDDExtensionForSVC(e,n){var r,o;if(!((r=e.ext)===null||r===void 0?void 0:r.some(u=>u.uri===Zv))){if(this.ddExtID===0){let u=0;n.media.forEach(d=>{var h;d.type==="video"&&((h=d.ext)===null||h===void 0||h.forEach(m=>{m.value>u&&(u=m.value)}))}),this.ddExtID=u+1}(o=e.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:Zv})}}}function ly(i,e,n){let r=0;i.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(i.rtcpFb||(i.rtcpFb=[]),n.includes(i.mid)&&!i.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&i.rtcpFb.push({payload:r,type:"nack"}),e.includes(i.mid)&&i.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function B1(i){var e;const n=[],r=[],o=Ai.parse((e=i.sdp)!==null&&e!==void 0?e:"");let l=0;return o.media.forEach(u=>{var d;u.type==="audio"&&(u.rtp.some(h=>h.codec==="opus"?(l=h.payload,!0):!1),!((d=u.rtcpFb)===null||d===void 0)&&d.some(h=>h.payload===l&&h.type==="nack")&&r.push(u.mid),u.fmtp.some(h=>h.payload===l?(h.config.includes("sprop-stereo=1")&&n.push(u.mid),!0):!1))}),{stereoMids:n,nackMids:r}}function uy(i){if(i.connection){const e=i.connection.ip.indexOf(":")>=0;(i.connection.version===4&&e||i.connection.version===6&&!e)&&(i.connection.ip="0.0.0.0",i.connection.version=4)}}const Rf="vp8",z1={audioPreset:gf.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Zf.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Rf,backupCodec:!0},mb={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},pb={deviceId:{ideal:"default"},resolution:qs.h720.resolution},q1={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new ME,disconnectOnPageLeave:!0,webAudioMix:!1},nh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var $e;(function(i){i[i.NEW=0]="NEW",i[i.CONNECTING=1]="CONNECTING",i[i.CONNECTED=2]="CONNECTED",i[i.FAILED=3]="FAILED",i[i.CLOSING=4]="CLOSING",i[i.CLOSED=5]="CLOSED"})($e||($e={}));class V1{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var o;this.peerConnectionTimeout=nh.peerConnectionTimeout,this.log=ke,this.updateState=()=>{var l;const u=this.state,d=this.requiredTransports.map(h=>h.getConnectionState());d.every(h=>h==="connected")?this.state=$e.CONNECTED:d.some(h=>h==="failed")?this.state=$e.FAILED:d.some(h=>h==="connecting")?this.state=$e.CONNECTING:d.every(h=>h==="closed")?this.state=$e.CLOSED:d.some(h=>h==="closed")?this.state=$e.CLOSING:d.every(h=>h==="new")&&(this.state=$e.NEW),u!==this.state&&(this.log.debug("pc state change: from ".concat($e[u]," to ").concat($e[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=$n((o=r.loggerName)!==null&&o!==void 0?o:pn.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new cy(e,r),this.subscriber=new cy(e,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,hn.PUBLISHER)},this.subscriber.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,hn.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var u;(u=this.onDataChannel)===null||u===void 0||u.call(this,l)},this.subscriber.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)},this.publisher.onOffer=l=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,l)},this.state=$e.NEW,this.connectionLock=new Nt,this.remoteOfferLock=new Nt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return w(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return w(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return w(this,void 0,void 0,function*(){n===hn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return w(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return w(this,void 0,void 0,function*(){var r;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(l=>this.ensureTransportConnected(l,e,n)))}finally{o()}})}negotiate(e){return w(this,void 0,void 0,function*(){return new Promise((n,r)=>w(this,void 0,void 0,function*(){const o=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),l=()=>{clearTimeout(o),r("negotiation aborted")};e.signal.addEventListener("abort",l),this.publisher.once(mr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(mr.NegotiationComplete,()=>{clearTimeout(o),n()})}),yield this.publisher.negotiate(u=>{clearTimeout(o),r(u)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===hn.PUBLISHER?this.publisher.getConnectedAddress():e===hn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return w(this,arguments,void 0,function(r,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(r.getConnectionState()!=="connected")return new Promise((h,m)=>w(l,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),Tt.clearTimeout(y),m(new Ge("room connection has been cancelled",_e.Cancelled))};o!=null&&o.signal.aborted&&g(),o==null||o.signal.addEventListener("abort",g);const y=Tt.setTimeout(()=>{o==null||o.signal.removeEventListener("abort",g),m(new Ge("could not establish pc connection",_e.InternalError))},u);for(;this.state!==$e.CONNECTED;)if(yield Lt(50),o!=null&&o.signal.aborted){m(new Ge("room connection has been cancelled",_e.Cancelled));return}Tt.clearTimeout(y),o==null||o.signal.removeEventListener("abort",g),h()}))}()})}}class tt extends Error{constructor(e,n,r){super(n),this.code=e,this.message=dy(n,tt.MAX_MESSAGE_BYTES),this.data=r?dy(r,tt.MAX_DATA_BYTES):void 0}static fromProto(e){return new tt(e.code,e.message,e.data)}toProto(){return new u0({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new tt(tt.ErrorCode[e],tt.ErrorMessage[e],n)}}tt.MAX_MESSAGE_BYTES=256;tt.MAX_DATA_BYTES=15360;tt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};tt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const gb=15360;function ih(i){return new TextEncoder().encode(i).length}function dy(i,e){if(ih(i)<=e)return i;let n=0,r=i.length;const o=new TextEncoder;for(;n<r;){const l=Math.floor((n+r+1)/2);o.encode(i.slice(0,l)).length<=e?n=l:r=l-1}return i.slice(0,n)}const ah=2e3;function Zc(i,e){if(!e)return 0;let n,r;return"bytesReceived"in i?(n=i.bytesReceived,r=e.bytesReceived):"bytesSent"in i&&(n=i.bytesSent,r=e.bytesSent),n===void 0||r===void 0||i.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(i.timestamp-e.timestamp)}const H1=1e3;class vb extends G{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,n,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(e,n,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=th(()=>w(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>w(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(W.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new Nt,this.pauseUpstreamLock=new Nt,this.processorLock=new Nt,this.restartLock=new Nt,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==G.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return w(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{fr(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let o;if(this.processor&&e){const l=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(cr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}finally{l()}}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(o??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{cr(o??e,l)}))})}waitForDimensions(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:H1;return function*(){var r;if(e.kind===G.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=gn())===null||r===void 0?void 0:r.os)==="iOS"&&(yield Lt(10));const o=Date.now();for(;Date.now()-o<n;){const l=e.dimensions;if(l)return l;yield Lt(50)}throw new Wn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return w(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ni(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Ni(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===G.Source.ScreenShare)return;const{deviceId:r,groupId:o}=e._mediaStreamTrack.getSettings(),l=e.kind===G.Kind.Audio?"audioinput":"videoinput";return n?gt.getInstance().normalizeDeviceId(l,r,o):r}()})}mute(){return w(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return w(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return w(this,void 0,void 0,function*(){if(!this.sender)throw new Wn("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return w(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:o}=e,l=xE(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const u={audio:!1,video:!1};this.kind===G.Kind.Video?u.video=r||o?{deviceId:r,facingMode:o}:!0:u.audio=r?{deviceId:r}:!0,this.attachedElements.forEach(m=>{fr(this.mediaStreamTrack,m)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const h=(yield navigator.mediaDevices.getUserMedia(u)).getTracks()[0];return yield h.applyConstraints(l),h.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(h),this._constraints=e,this.emit(W.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?W.Muted:W.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),sb()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(W.UpstreamPaused,this);const r=gn();if((r==null?void 0:r.name)==="Safari"&&da(r.version,"12.0")<0)throw new Xf("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return w(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(W.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return w(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return w(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var l;const u=yield r.processorLock.lock();try{r.log.debug("setting up processor",r.logContext);const d=document.createElement(r.kind),h={kind:r.kind,track:r._mediaStreamTrack,element:d,audioContext:r.audioContext};if(yield n.init(h),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.stopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(cr(r._mediaStreamTrack,d),d.muted=!0,d.play().catch(m=>r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:m}))),r.processor=n,r.processorElement=d,r.processor.processedTrack){for(const m of r.attachedElements)m!==r.processorElement&&o&&(fr(r._mediaStreamTrack,m),cr(r.processor.processedTrack,m));yield(l=r.sender)===null||l===void 0?void 0:l.replaceTrack(r.processor.processedTrack)}r.emit(W.TrackProcessorUpdate,r.processor)}finally{u()}}()})}getProcessor(){return this.processor}stopProcessor(){return w(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var r,o;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((o=e.processorElement)===null||o===void 0||o.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(W.TrackProcessorUpdate))}()})}}class Uc extends vb{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(e,G.Kind.Audio,n,r,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>w(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}u&&this.prevStats&&(this._currentBitrate=Zc(u,this.prevStats)),this.prevStats=u}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(W.AudioTrackFeatureUpdate,this,wn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(W.AudioTrackFeatureUpdate,this,wn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===G.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ni(this._constraints.deviceId);return this.source===G.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return w(this,void 0,void 0,function*(){let n;if(e){const r=Jf({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return w(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){Ut()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},ah)))}setProcessor(e){return w(this,void 0,void 0,function*(){var n;const r=yield this.processorLock.lock();try{if(!An()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(o),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(W.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return w(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(o=>{o.type==="outbound-rtp"&&(r={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),r})}checkForSilence(){return w(this,void 0,void 0,function*(){const e=yield db(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(W.AudioSilenceDetected)),e})}}function G1(i,e,n){switch(i.kind){case"audio":return new Uc(i,e,!1,void 0,n);case"video":return new Ic(i,e,!1,n);default:throw new Wn("unsupported track type: ".concat(i.kind))}}const F1=Object.values(qs),Y1=Object.values(vf),K1=Object.values(Zf),Q1=[qs.h180,qs.h360],X1=[vf.h180,vf.h360],Z1=i=>[{scaleResolutionDownBy:2,fps:i.encoding.maxFramerate}].map(n=>{var r,o;return new Ve(Math.floor(i.width/n.scaleResolutionDownBy),Math.floor(i.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(i.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=i.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((o=n.fps)!==null&&o!==void 0?o:30))))),n.fps,i.encoding.priority)}),_f=["q","h","f"];function wf(i,e,n,r){var o,l;let u=r==null?void 0:r.videoEncoding;i&&(u=r==null?void 0:r.screenShareEncoding);const d=r==null?void 0:r.simulcast,h=r==null?void 0:r.scalabilityMode,m=r==null?void 0:r.videoCodec;if(!u&&!d&&!h||!e||!n)return[{}];u||(u=W1(i,e,n,m),ke.debug("using video encoding",u));const g=u.maxFramerate,y=new Ve(e,n,u.maxBitrate,u.maxFramerate,u.priority);if(h&&Us(m)){const C=new Lc(h),k=[];if(C.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(h));const O=gn();if(Li()||An()||(O==null?void 0:O.name)==="Chrome"&&da(O==null?void 0:O.version,"113")<0){const _=C.suffix=="h"?2:3;for(let B=0;B<C.spatial;B+=1)k.push({rid:_f[2-B],maxBitrate:u.maxBitrate/Math.pow(_,B),maxFramerate:y.encoding.maxFramerate});k[0].scalabilityMode=h}else k.push({maxBitrate:u.maxBitrate,maxFramerate:y.encoding.maxFramerate,scalabilityMode:h});return y.encoding.priority&&(k[0].priority=y.encoding.priority,k[0].networkPriority=y.encoding.priority),ke.debug("using svc encoding",{encodings:k}),k}if(!d)return[u];let b=[];i?b=(o=hy(r==null?void 0:r.screenShareSimulcastLayers))!==null&&o!==void 0?o:fy(i,y):b=(l=hy(r==null?void 0:r.videoSimulcastLayers))!==null&&l!==void 0?l:fy(i,y);let T;if(b.length>0){const C=b[0];b.length>1&&([,T]=b);const k=Math.max(e,n);if(k>=960&&T)return Vd(e,n,[C,T,y],g);if(k>=480)return Vd(e,n,[C,y],g)}return Vd(e,n,[y])}function J1(i,e,n){var r,o,l,u;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ke.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const d=i.mediaStreamTrack.getSettings(),h=(r=d.width)!==null&&r!==void 0?r:(o=i.dimensions)===null||o===void 0?void 0:o.width,m=(l=d.height)!==null&&l!==void 0?l:(u=i.dimensions)===null||u===void 0?void 0:u.height;return i.source===G.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),wf(i.source===G.Source.ScreenShare,h,m,n)}function W1(i,e,n,r){const o=$1(i,e,n);let{encoding:l}=o[0];const u=Math.max(e,n);for(let d=0;d<o.length;d+=1){const h=o[d];if(l=h.encoding,h.width>=u)break}if(r)switch(r){case"av1":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function $1(i,e,n){if(i)return K1;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?F1:Y1}function fy(i,e){if(i)return Z1(e);const{width:n,height:r}=e,o=n>r?n/r:r/n;return Math.abs(o-16/9)<Math.abs(o-4/3)?Q1:X1}function Vd(i,e,n,r){const o=[];if(n.forEach((l,u)=>{if(u>=_f.length)return;const d=Math.min(i,e),m={rid:_f[u],scaleResolutionDownBy:Math.max(1,d/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},g=r&&l.encoding.maxFramerate?Math.min(r,l.encoding.maxFramerate):l.encoding.maxFramerate;g&&(m.maxFramerate=g);const y=yr()||u===0;l.encoding.priority&&y&&(m.priority=l.encoding.priority,m.networkPriority=l.encoding.priority),o.push(m)}),An()&&cb()==="ios"){let l;o.forEach(d=>{l?d.maxFramerate&&d.maxFramerate>l&&(l=d.maxFramerate):l=d.maxFramerate});let u=!0;o.forEach(d=>{var h;d.maxFramerate!=l&&(u&&(u=!1,ke.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ke.info('Setting framerate of encoding "'.concat((h=d.rid)!==null&&h!==void 0?h:"",'" to ').concat(l)),d.maxFramerate=l)})}return o}function hy(i){if(i)return i.sort((e,n)=>{const{encoding:r}=e,{encoding:o}=n;return r.maxBitrate>o.maxBitrate?1:r.maxBitrate<o.maxBitrate?-1:r.maxBitrate===o.maxBitrate&&r.maxFramerate&&o.maxFramerate?r.maxFramerate>o.maxFramerate?1:-1:0})}class Lc{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function eR(i){return i.source===G.Source.ScreenShare||i.constraints.height&&Ni(i.constraints.height)>=1080?"maintain-resolution":"balanced"}const tR=5e3;class Ic extends vb{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(e,G.Kind.Video,n,r,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>w(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}const u=new Map(l.map(d=>[d.rid,d]));if(this.prevStats){let d=0;u.forEach((h,m)=>{var g;const y=(g=this.prevStats)===null||g===void 0?void 0:g.get(m);d+=Zc(h,y)}),this._currentBitrate=d}this.prevStats=u}),this.senderLock=new Nt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Ut())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},ah))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return w(this,void 0,void 0,function*(){var n,r,o,l,u;yield e.pauseUpstream.call(this);try{for(var d=!0,h=Di(this.simulcastCodecs.values()),m;m=yield h.next(),n=m.done,!n;d=!0)l=m.value,d=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(g){r={error:g}}finally{try{!d&&!n&&(o=h.return)&&(yield o.call(h))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return w(this,void 0,void 0,function*(){var n,r,o,l,u;yield e.resumeUpstream.call(this);try{for(var d=!0,h=Di(this.simulcastCodecs.values()),m;m=yield h.next(),n=m.done,!n;d=!0){l=m.value,d=!1;const g=l;yield(u=g.sender)===null||u===void 0?void 0:u.replaceTrack(g.mediaStreamTrack)}}catch(g){r={error:g}}finally{try{!d&&!n&&(o=h.return)&&(yield o.call(h))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===G.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return w(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===G.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return w(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(o=>{var l;if(o.type==="outbound-rtp"){const u={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(l=o.rid)!==null&&l!==void 0?l:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},d=r.get(o.remoteId);d&&(u.jitter=d.jitter,u.packetsLost=d.packetsLost,u.roundTripTime=d.roundTripTime),n.push(u)}}),n.sort((o,l)=>{var u,d;return((u=l.frameWidth)!==null&&u!==void 0?u:0)-((d=o.frameWidth)!==null&&d!==void 0?d:0)}),n})}setPublishingQuality(e){const n=[];for(let r=rn.LOW;r<=rn.HIGH;r+=1)n.push(new Yf({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}restartTrack(e){return w(this,void 0,void 0,function*(){var n,r,o,l,u;let d;if(e){const y=Jf({video:e});typeof y.video!="boolean"&&(d=y.video)}yield this.restart(d);try{for(var h=!0,m=Di(this.simulcastCodecs.values()),g;g=yield m.next(),n=g.done,!n;h=!0){l=g.value,h=!1;const y=l;y.sender&&((u=y.sender.transport)===null||u===void 0?void 0:u.state)!=="closed"&&(y.mediaStreamTrack=this.mediaStreamTrack.clone(),yield y.sender.replaceTrack(y.mediaStreamTrack))}}catch(y){r={error:y}}finally{try{!h&&!n&&(o=m.return)&&(yield o.call(m))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return w(this,arguments,void 0,function(r){var o=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var u,d,h,m,g,y;if(yield n.setProcessor.call(o,r,l),!((g=o.processor)===null||g===void 0)&&g.processedTrack)try{for(var b=!0,T=Di(o.simulcastCodecs.values()),C;C=yield T.next(),u=C.done,!u;b=!0)m=C.value,b=!1,yield(y=m.sender)===null||y===void 0?void 0:y.replaceTrack(o.processor.processedTrack)}catch(k){d={error:k}}finally{try{!b&&!u&&(h=T.return)&&(yield h.call(T))}finally{if(d)throw d.error}}}()})}setDegradationPreference(e){return w(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},tR))}setPublishingCodecs(e){return w(this,void 0,void 0,function*(){var n,r,o,l,u,d,h;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const m=[];try{for(n=!0,r=Di(e);o=yield r.next(),l=o.done,!l;n=!0){h=o.value,n=!1;const g=h;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(g.qualities);else{const y=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:y})),!y||!y.sender){for(const b of g.qualities)if(b.enabled){m.push(g.codec);break}}else y.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield my(y.sender,y.encodings,g.qualities,this.senderLock,this.log,this.logContext))}}}catch(g){u={error:g}}finally{try{!n&&!l&&(d=r.return)&&(yield d.call(r))}finally{if(u)throw u.error}}return m})}setPublishingLayers(e){return w(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield my(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),sb()&&this.isInBackground&&this.source===G.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function my(i,e,n,r,o,l){return w(this,void 0,void 0,function*(){const u=yield r.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},l),{sender:i,qualities:n,senderEncodings:e}));try{const d=i.getParameters(),{encodings:h}=d;if(!h)return;if(h.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},l),{encodings:h,senderEncodings:e}));return}let m=!1;const g=gn();if((g==null?void 0:g.name)==="Chrome"&&da(g==null?void 0:g.version,"133")>0&&h[0].scalabilityMode){const b=h[0],T=new Lc(b.scalabilityMode);let C=lr.OFF;if(n.forEach(k=>{k.enabled&&(C===lr.OFF||k.quality>C)&&(C=k.quality)}),C===lr.OFF)b.active&&(b.active=!1,m=!0);else if(!b.active||T.spatial!==C+1){m=!0,b.active=!0;const k=new Lc(e[0].scalabilityMode);T.spatial=C+1,T.suffix=k.suffix,T.spatial===1&&(T.suffix=void 0),b.scalabilityMode=T.toString(),b.scaleResolutionDownBy=Math.pow(2,2-C),e[0].maxBitrate&&(b.maxBitrate=e[0].maxBitrate/(b.scaleResolutionDownBy*b.scaleResolutionDownBy))}}else h.forEach((b,T)=>{var C;let k=(C=b.rid)!==null&&C!==void 0?C:"";k===""&&(k="q");const O=yb(k),_=n.find(B=>B.quality===O);_&&b.active!==_.enabled&&(m=!0,b.active=_.enabled,o.debug("setting layer ".concat(_.quality," to ").concat(b.active?"enabled":"disabled"),l),yr()&&(_.enabled?(b.scaleResolutionDownBy=e[T].scaleResolutionDownBy,b.maxBitrate=e[T].maxBitrate,b.maxFrameRate=e[T].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))});m&&(d.encodings=h,o.debug("setting encodings",Object.assign(Object.assign({},l),{encodings:d.encodings})),yield i.setParameters(d))}finally{u()}})}function yb(i){switch(i){case"f":return rn.HIGH;case"h":return rn.MEDIUM;case"q":return rn.LOW;default:return rn.HIGH}}function py(i,e,n,r){if(!n)return[new oa({quality:rn.HIGH,width:i,height:e,bitrate:0,ssrc:0})];if(r){const o=n[0].scalabilityMode,l=new Lc(o),u=[],d=l.suffix=="h"?1.5:2,h=l.suffix=="h"?2:3;for(let m=0;m<l.spatial;m+=1)u.push(new oa({quality:Math.min(rn.HIGH,l.spatial-1)-m,width:Math.ceil(i/Math.pow(d,m)),height:Math.ceil(e/Math.pow(d,m)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(h,m)):0,ssrc:0}));return u}return n.map(o=>{var l,u,d;const h=(l=o.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let m=yb((u=o.rid)!==null&&u!==void 0?u:"");return new oa({quality:m,width:Math.ceil(i/h),height:Math.ceil(e/h),bitrate:(d=o.maxBitrate)!==null&&d!==void 0?d:0,ssrc:0})})}const gy="_lossy",vy="_reliable",nR=2*1e3,Hd="leave-reconnect";var un;(function(i){i[i.New=0]="New",i[i.Connected=1]="Connected",i[i.Disconnected=2]="Disconnected",i[i.Reconnecting=3]="Reconnecting",i[i.Closed=4]="Closed"})(un||(un={}));class iR extends xn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=nh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=un.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ke,this.handleDataChannel=r=>w(this,[r],void 0,function(o){var l=this;let{channel:u}=o;return function*(){if(u){if(u.label===vy)l.reliableDCSub=u;else if(u.label===gy)l.lossyDCSub=u;else return;l.log.debug("on data channel ".concat(u.id,", ").concat(u.label),l.logContext),u.onmessage=l.handleDataMessage}}()}),this.handleDataMessage=r=>w(this,void 0,void 0,function*(){var o,l;const u=yield this.dataProcessLock.lock();try{let d;if(r.data instanceof ArrayBuffer)d=r.data;else if(r.data instanceof Blob)d=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const h=xt.fromBinary(new Uint8Array(d));((o=h.value)===null||o===void 0?void 0:o.case)==="speaker"?this.emit(te.ActiveSpeakersUpdate,h.value.value.speakers):(((l=h.value)===null||l===void 0?void 0:l.case)==="user"&&rR(h,h.value.value),this.emit(te.DataPacketReceived,h))}finally{u()}}),this.handleDataError=r=>{const l=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:u}=r.error;this.log.error("DataChannel error on ".concat(l,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const l=r.currentTarget.maxRetransmits===0?Ae.LOSSY:Ae.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(r,o)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=h=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(h,"ms. giving up"),this.logContext),this.emit(te.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let d=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(d===null){l(u);return}r===Hd&&(d=0),this.log.debug("reconnecting in ".concat(d,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Tt.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),d)},this.waitForRestarted=()=>new Promise((r,o)=>{this.pcState===un.Connected&&r();const l=()=>{this.off(te.Disconnected,u),r()},u=()=>{this.off(te.Restarted,l),o()};this.once(te.Restarted,l),this.once(te.Disconnected,u)}),this.updateAndEmitDCBufferStatus=r=>{const o=this.isBufferStatusLow(r);typeof o<"u"&&o!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,o),this.emit(te.DCBufferStatusChanged,o,r))},this.isBufferStatusLow=r=>{const o=this.dataChannelForKind(r);if(o)return o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Ye.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(rr.RR_SIGNAL_DISCONNECTED))},this.log=$n((n=e.loggerName)!==null&&n!==void 0?n:pn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new $f(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Nt,this.dataProcessLock=new Nt,this.dcBufferStatus=new Map([[Ae.LOSSY,!0],[Ae.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(te.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(te.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(te.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(te.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(te.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(te.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(te.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(te.SignalRequestResponse,r)}get logContext(){var e,n,r,o,l,u,d,h;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(o=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||o===void 0?void 0:o.sid,participant:(u=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||u===void 0?void 0:u.identity,pID:(h=(d=this.latestJoinResponse)===null||d===void 0?void 0:d.participant)===null||h===void 0?void 0:h.sid}}join(e,n,r,o){return w(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const l=yield this.client.join(e,n,r,o);return this._isClosed=!1,this.latestJoinResponse=l,this.subscriberPrimary=l.subscriberPrimary,this.pcManager||(yield this.configure(l)),(!this.subscriberPrimary||l.fastPublish)&&this.negotiate(),this.clientConfiguration=l.clientConfiguration,setTimeout(()=>{this.emit(te.SignalConnected)},10),l}catch(l){if(l instanceof Ge&&l.reason===_e.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,o);throw l}})}close(){return w(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(te.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return w(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return w(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Wn("a track with the same ID has already been published");return new Promise((n,r)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new Ge("publication of local track timed out, no response from server",_e.InternalError))},1e4);this.pendingTrackResolvers[e.cid]={resolve:l=>{clearTimeout(o),n(l)},reject:()=>{clearTimeout(o),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return w(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return w(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==$e.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const o=this.makeRTCConfiguration(e);this.pcManager=new V1(o,e.subscriberPrimary,this.loggerOptions),this.emit(te.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(l,u)=>{this.client.sendIceCandidate(l,u)},this.pcManager.onPublisherOffer=l=>{this.client.sendOffer(l)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(l,u,d)=>w(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),l===$e.CONNECTED){const g=this.pcState===un.New;this.pcState=un.Connected,g&&this.emit(te.Connected,e)}else l===$e.FAILED&&this.pcState===un.Connected&&(this.pcState=un.Disconnected,this.handleDisconnect("peerconnection failed",d==="failed"?rr.RR_SUBSCRIBER_FAILED:rr.RR_PUBLISHER_FAILED));const h=this.client.isDisconnected||this.client.currentState===Ye.RECONNECTING,m=[$e.FAILED,$e.CLOSING,$e.CLOSED].includes(l);h&&m&&!this._isClosed&&this.emit(te.Offline)}),this.pcManager.onTrack=l=>{this.emit(te.MediaTrackAdded,l.track,l.streams[0],l.receiver)},aR((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>w(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=e=>w(this,void 0,void 0,function*(){if(!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(te.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(te.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(te.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(te.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",rr.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case ur.DISCONNECT:this.emit(te.Disconnected,e==null?void 0:e.reason),this.close();break;case ur.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Hd);break;case ur.RESUME:this.handleDisconnect(Hd)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const o=[];e.iceServers.forEach(l=>{const u={urls:l.urls};l.username&&(u.username=l.username),l.credential&&(u.credential=l.credential),o.push(u)}),r.iceServers=o}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Is.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(gy,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(vy,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,r){return w(this,void 0,void 0,function*(){if(yf())return yield this.createTransceiverRTCRtpSender(e,n,r);if(bf())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new ut("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,o){return w(this,void 0,void 0,function*(){if(yf())return this.createSimulcastTransceiverSender(e,n,r,o);if(bf())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new ut("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("publisher is closed");const o=[];e.mediaStream&&o.push(e.mediaStream),Cr(e)&&(e.codec=n.videoCodec);const l={direction:"sendonly",streams:o};return r&&(l.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(e,n,r,o){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("publisher is closed");const l={direction:"sendonly"};o&&(l.sendEncodings=o);const u=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,l);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,u.sender),u.sender})}createRTCRtpSender(e){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return w(this,void 0,void 0,function*(){var n,r,o;if(!this._isClosed){if(this.attemptingReconnect){ke.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Is.DISABLED||((o=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&o!==void 0?o:$e.NEW)===$e.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let u=!0;l instanceof ut?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),u=!1):l instanceof sr||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",rr.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(te.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return w(this,void 0,void 0,function*(){var n,r,o;try{if(!this.url||!this.token)throw new ut("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(te.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new sr;l=yield this.join(e??this.url,this.token,this.signalOpts)}catch(u){throw u instanceof Ge&&u.reason===_e.NotAllowed?new ut("could not reconnect, token might be expired"):new sr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(te.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==Ye.CONNECTED)throw new sr("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(te.Restarted)}catch(l){const u=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),l}})}resumeConnection(e){return w(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new ut("could not reconnect, url or token not saved");if(!this.pcManager)throw new ut("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(te.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(o){let l="";throw o instanceof Error&&(l=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof Ge&&o.reason===_e.NotAllowed?new ut("could not reconnect, token might be expired"):o instanceof Ge&&o.reason===_e.LeaveRequest?o:new sr(l)}if(this.emit(te.SignalResumed),r){const o=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(o)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ye.CONNECTED)throw new sr("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(te.Resumed)})}waitForPCInitialConnection(e,n){return w(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return w(this,void 0,void 0,function*(){this.pcState=un.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Lt(nR),!this.pcManager)throw new ut("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=un.Connected}catch(e){throw this.pcState=un.Disconnected,new Ge("could not establish PC connection, ".concat(e.message),_e.InternalError)}})}publishRpcResponse(e,n,r,o){return w(this,void 0,void 0,function*(){const l=new xt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcResponse",value:new l0({requestId:n,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(l,Ae.RELIABLE)})}publishRpcAck(e,n){return w(this,void 0,void 0,function*(){const r=new xt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcAck",value:new c0({requestId:n})}});yield this.sendDataPacket(r,Ae.RELIABLE)})}sendDataPacket(e,n){return w(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(n);const o=this.dataChannelForKind(n);o&&o.send(r),this.updateAndEmitDCBufferStatus(n)})}waitForBufferStatusLow(e){return new Promise((n,r)=>w(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const o=()=>r("Engine closed");for(this.once(te.Closing,o);!this.dcBufferStatus.get(e);)yield Lt(10);this.off(te.Closing,o),n()}}))}ensureDataTransportConnected(e){return w(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var l;if(!r.pcManager)throw new ut("PC manager is closed");const u=o?r.pcManager.subscriber:r.pcManager.publisher,d=o?"Subscriber":"Publisher";if(!u)throw new Ge("".concat(d," connection not set"),_e.InternalError);let h=!1;!o&&!r.dataChannelForKind(n,o)&&(r.createDataChannels(),h=!0),!h&&!o&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(h=!0),h&&r.negotiate();const m=r.dataChannelForKind(n,o);if((m==null?void 0:m.readyState)==="open")return;const g=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<g;){if(u.isICEConnected&&((l=r.dataChannelForKind(n,o))===null||l===void 0?void 0:l.readyState)==="open")return;yield Lt(50)}throw new Ge("could not establish ".concat(d," connection, state: ").concat(u.getICEConnectionState()),_e.InternalError)}()})}ensurePublisherConnected(e){return w(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==$e.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return w(this,void 0,void 0,function*(){return new Promise((e,n)=>w(this,void 0,void 0,function*(){if(!this.pcManager){n(new pf("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,o=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(te.Closing,o),this.pcManager.publisher.once(mr.RTPVideoPayloadTypes,l=>{const u=new Map;l.forEach(d=>{const h=d.codec.toLowerCase();p1(h)&&u.set(d.payload,h)}),this.emit(te.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(r),e()}catch(l){l instanceof pf&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",rr.RR_UNKNOWN),n(l)}finally{this.off(te.Closing,o)}}))})}dataChannelForKind(e,n){if(n){if(e===Ae.LOSSY)return this.lossyDCSub;if(e===Ae.RELIABLE)return this.reliableDCSub}else{if(e===Ae.LOSSY)return this.lossyDC;if(e===Ae.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.subscriber.getLocalDescription(),u=this.pcManager.subscriber.getRemoteDescription(),d=(o=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,m=new Array;e.forEach(g=>{g.isDesired!==d&&h.push(g.trackSid),g.isEnabled||m.push(g.trackSid)}),this.client.sendSyncState(new R0({answer:l?Nc({sdp:l.sdp,type:l.type}):void 0,offer:u?Nc({sdp:u.sdp,type:u.type}):void 0,subscription:new Kc({trackSids:h,subscribe:!d,participantTracks:[]}),publishTracks:k1(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,o)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new _0({label:r.label,id:r.id,target:o}))};return n(this.dataChannelForKind(Ae.LOSSY),hn.PUBLISHER),n(this.dataChannelForKind(Ae.RELIABLE),hn.PUBLISHER),n(this.dataChannelForKind(Ae.LOSSY,!0),hn.SUBSCRIBER),n(this.dataChannelForKind(Ae.RELIABLE,!0),hn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Tt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ut()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Ut()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class sr extends Error{}function aR(i){return i!==void 0&&i>13}function rR(i,e){const n=i.participantIdentity?i.participantIdentity:e.participantIdentity;i.participantIdentity=n,e.participantIdentity=n;const r=i.destinationIdentities.length!==0?i.destinationIdentities:e.destinationIdentities;i.destinationIdentities=r,e.destinationIdentities=r}class Of{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Tf(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return w(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(n.length>0){const r=n[0];return this.attemptedRegions.push(r),ke.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return w(this,void 0,void 0,function*(){const n=yield fetch("".concat(sR(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const r=yield n.json();return this.lastUpdateAt=Date.now(),r}else throw new Ge("Could not fetch region settings: ".concat(n.statusText),n.status===401?_e.NotAllowed:_e.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function sR(i){return"".concat(i.protocol.replace("ws","http"),"//").concat(i.host,"/settings")}class bb{get info(){return this._info}constructor(e,n,r){this.reader=n,this.totalByteSize=r,this._info=e,this.bytesReceived=0}}class oR extends bb{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>w(this,void 0,void 0,function*(){try{const{done:n,value:r}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:r.content})}catch{return{done:!0,value:void 0}}}),return(){return w(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return w(this,void 0,void 0,function*(){var e,n,r,o;let l=new Set;try{for(var u=!0,d=Di(this),h;h=yield d.next(),e=h.done,!e;u=!0){o=h.value,u=!1;const m=o;l.add(m)}}catch(m){n={error:m}}finally{try{!u&&!e&&(r=d.return)&&(yield r.call(d))}finally{if(n)throw n.error}}return Array.from(l)})}}class cR extends bb{constructor(e,n,r){super(e,n,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const r=Oc(e.chunkIndex),o=this.receivedChunks.get(r);if(o&&o.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength;const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,l)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>w(this,void 0,void 0,function*(){try{const{done:r,value:o}=yield e.read();return r?{done:!0,value:void 0}:(this.handleChunkReceived(o),{done:!1,value:n.decode(o.content)})}catch{return{done:!0,value:void 0}}}),return(){return w(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return w(this,void 0,void 0,function*(){var e,n,r,o;let l="";try{for(var u=!0,d=Di(this),h;h=yield d.next(),e=h.done,!e;u=!0)o=h.value,u=!1,l+=o}catch(m){n={error:m}}finally{try{!u&&!e&&(r=d.return)&&(yield r.call(d))}finally{if(n)throw n.error}}return l})}}class Sb{constructor(e,n,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return w(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class lR extends Sb{}class uR extends Sb{}class Tb extends G{constructor(e,n,r,o,l){super(e,r,l),this.sid=n,this.receiver=o}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?W.Muted:W.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(W.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return w(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),ah)),C1()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:o,rtpTimestamp:l}=r;l&&this.rtpTimestamp!==l&&(this.emit(W.TimeSyncUpdate,{timestamp:o,rtpTimestamp:l}),this.rtpTimestamp=l)}};e()}}class kb extends Tb{constructor(e,n,r,o,l,u){super(e,n,G.Kind.Audio,r,u),this.monitorReceiver=()=>w(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const d=yield this.getReceiverStats();d&&this.prevStats&&this.receiver&&(this._currentBitrate=Zc(d,this.prevStats)),this.prevStats=d}),this.audioContext=o,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;An()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(An())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return w(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(Sf(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Sf(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{r.connect(o),r=o}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(W.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(W.AudioPlaybackFailed,o)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return w(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const Gd=100;class dR extends Tb{constructor(e,n,r,o,l){super(e,n,G.Kind.Video,r,l),this.elementInfos=[],this.monitorReceiver=()=>w(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Zc(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=th(()=>{this.updateDimensions()},Gd),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?fr(this._mediaStreamTrack,n):cr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new fR(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return w(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",o=new Map;return e.forEach(l=>{l.type==="inbound-rtp"?(r=l.codecId,n={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&o.set(l.id,l)}),n&&r!==""&&o.get(r)&&(n.mimeType=o.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return w(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const r=this.elementInfos.reduce((d,h)=>Math.max(d,h.visibilityChangedAt||0),0),o=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,l=this.elementInfos.some(d=>d.pictureInPicture),u=this.elementInfos.some(d=>d.visible)&&!o||l;if(this.lastVisible!==u){if(!u&&Date.now()-r<Gd){Tt.setTimeout(()=>{this.updateVisibility()},Gd);return}this.lastVisible=u,this.emit(W.VisibilityChanged,u,this)}}updateDimensions(){var e,n;let r=0,o=0;const l=this.getPixelDensity();for(const u of this.elementInfos){const d=u.width()*l,h=u.height()*l;d+h>r+o&&(r=d,o=h)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===o||(this.lastDimensions={width:r,height:o},this.emit(W.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Jv():n||(Jv()>2?2:1)}}class fR{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var o;const{target:l,isIntersecting:u}=r;l===this.element&&(this.isIntersecting=u,this.isPiP=Ds(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var r,o,l;(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Ds(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=Ds(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??Af(e),this.isPiP=Ut()&&Ds(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,r;this.isIntersecting=Af(this.element),this.isPiP=Ds(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,$v().observe(this.element),Wv().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,r,o,l;(e=$v())===null||e===void 0||e.unobserve(this.element),(n=Wv())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(l=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function Ds(i){var e,n;return document.pictureInPictureElement===i?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Af(i,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Af(i,e){const n=e||window;let r=i.offsetTop,o=i.offsetLeft;const l=i.offsetWidth,u=i.offsetHeight,{hidden:d}=i,{display:h}=getComputedStyle(i);for(;i.offsetParent;)i=i.offsetParent,r+=i.offsetTop,o+=i.offsetLeft;return r<n.pageYOffset+n.innerHeight&&o<n.pageXOffset+n.innerWidth&&r+u>n.pageYOffset&&o+l>n.pageXOffset&&!d&&h!=="none"}class Zn extends xn.EventEmitter{constructor(e,n,r,o){var l;super(),this.metadataMuted=!1,this.encryption=Yt.NONE,this.log=ke,this.handleMuted=()=>{this.emit(W.Muted)},this.handleUnmuted=()=>{this.emit(W.Unmuted)},this.log=$n((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:pn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=G.Source.Unknown}setTrack(e){this.track&&(this.track.off(W.Muted,this.handleMuted),this.track.off(W.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(W.Muted,this.handleMuted),e.on(W.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Pe(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Yt.NONE}get audioTrack(){if(ei(this.track))return this.track}get videoTrack(){if(Cr(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=G.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===G.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(i){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(i.SubscriptionStatus||(i.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(i.PermissionStatus||(i.PermissionStatus={}))})(Zn||(Zn={}));class Df extends Zn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,o){super(e,n.sid,n.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(W.Ended)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&this.track.off(W.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(W.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return w(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return w(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return w(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return w(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ei(this.track)){const n=this.track.getSourceTrackSettings(),r=new Set;return n.autoGainControl&&r.add(wn.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(wn.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(wn.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(wn.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(wn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(wn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function Jc(i,e){return w(this,void 0,void 0,function*(){const n=Object.assign({},i??{});let r=!1,o=i==null?void 0:i.audio,l=i==null?void 0:i.video;if(n.audio&&typeof n.audio=="object"&&typeof n.audio.deviceId=="string"){const y=n.audio.deviceId;n.audio.deviceId={exact:y},r=!0,o=Object.assign(Object.assign({},n.audio),{deviceId:{ideal:y}})}if(n.video&&typeof n.video=="object"&&typeof n.video.deviceId=="string"){const y=n.video.deviceId;n.video.deviceId={exact:y},r=!0,l=Object.assign(Object.assign({},n.video),{deviceId:{ideal:y}})}(n.audio===!0||typeof n.audio=="object"&&!n.audio.deviceId)&&(n.audio={deviceId:"default"}),(n.video===!0||typeof n.video=="object"&&!n.video.deviceId)&&(n.video={deviceId:"default"});const{audioProcessor:u,videoProcessor:d}=fb(n),h=ub(n,mb,pb),m=Jf(h),g=navigator.mediaDevices.getUserMedia(m);n.audio&&(gt.userMediaPromiseMap.set("audioinput",g),g.catch(()=>gt.userMediaPromiseMap.delete("audioinput"))),n.video&&(gt.userMediaPromiseMap.set("videoinput",g),g.catch(()=>gt.userMediaPromiseMap.delete("videoinput")));try{const y=yield g;return yield Promise.all(y.getTracks().map(b=>w(this,void 0,void 0,function*(){const T=b.kind==="audio";let C=T?h.audio:h.video;(typeof C=="boolean"||!C)&&(C={});let k;const O=T?m.audio:m.video;typeof O!="boolean"&&(k=O);const _=b.getSettings().deviceId;k!=null&&k.deviceId&&Ni(k.deviceId)!==_?k.deviceId=_:k||(k={deviceId:_});const B=G1(b,k,e);return B.kind===G.Kind.Video?B.source=G.Source.Camera:B.kind===G.Kind.Audio&&(B.source=G.Source.Microphone),B.mediaStream=y,ei(B)&&u?yield B.setProcessor(u):Cr(B)&&d&&(yield B.setProcessor(d)),B})))}catch(y){if(!r)throw y;return Jc(Object.assign(Object.assign({},i),{audio:o,video:l}),e)}})}function hR(i){return w(this,void 0,void 0,function*(){return(yield Jc({audio:!1,video:!0}))[0]})}function mR(i){return w(this,void 0,void 0,function*(){return(yield Jc({audio:!0,video:!1}))[0]})}var Mi;(function(i){i.Excellent="excellent",i.Good="good",i.Poor="poor",i.Lost="lost",i.Unknown="unknown"})(Mi||(Mi={}));function pR(i){switch(i){case xs.EXCELLENT:return Mi.Excellent;case xs.GOOD:return Mi.Good;case xs.POOR:return Mi.Poor;case xs.LOST:return Mi.Lost;default:return Mi.Unknown}}class Cb extends xn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Bs.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,o,l,u){let d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Bs.STANDARD;var h;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Mi.Unknown,this.log=ke,this.log=$n((h=u==null?void 0:u.loggerName)!==null&&h!==void 0?h:pn.Participant),this.loggerOptions=u,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=d,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(G.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(G.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(G.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(Q.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(Q.ParticipantNameChanged,e)}_setAttributes(e){const n=E1(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(Q.AttributesChanged,n)}setPermissions(e){var n,r,o,l,u,d;const h=this.permissions,m=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||e.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||e.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((g,y)=>{var b;return g!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[y])})||e.canSubscribeMetrics!==((d=this.permissions)===null||d===void 0?void 0:d.canSubscribeMetrics);return this.permissions=e,m&&this.emit(Q.ParticipantPermissionsChanged,h),m}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Q.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=pR(e),n!==this._connectionQuality&&this.emit(Q.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ei(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(W.Muted,()=>{this.emit(Q.TrackMuted,e)}),e.on(W.Unmuted,()=>{this.emit(Q.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case G.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case G.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function gR(i){var e,n,r;if(!i.participantSid&&!i.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new C0({participantIdentity:(e=i.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=i.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=i.allowAll)!==null&&r!==void 0?r:!1,trackSids:i.allowedTrackSids||[]})}const yy=15e3;class vR extends Cb{constructor(e,n,r,o,l){super(e,n,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Yt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new lb)},this.handleReconnected=()=>{var u,d;(d=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||d===void 0||d.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var u,d;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(d=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||d===void 0||d.call(u,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=u=>{const{requestId:d,reason:h,message:m}=u,g=this.pendingSignalRequests.get(d);g&&(h!==Kf.OK&&g.reject(new Kv(m,h)),this.pendingSignalRequests.delete(d))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let d=u.value.value,h=null,m=null;d.value.case==="payload"?h=d.value.value:d.value.case==="error"&&(m=tt.fromProto(d.value.value)),this.handleIncomingRpcResponse(d.requestId,h,m);break;case"rpcAck":let g=u.value.value;this.handleIncomingRpcAck(g.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>gR(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,d)=>{if(d===void 0&&(d=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Pe(u)));return}this.engine.updateMuteStatus(u.sid,d)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Pe(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Pe(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const d=this.audioTrackPublications.get(u.sid);if(!d){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(d.trackSid,d.getTrackFeatures())},this.handleSubscribedQualityUpdate=u=>w(this,void 0,void 0,function*(){var d,h,m,g,y,b;if(!(!((y=this.roomOptions)===null||y===void 0)&&y.dynacast))return;const T=this.videoTrackPublications.get(u.trackSid);if(!T){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(u.subscribedCodecs.length>0){if(!T.videoTrack)return;const _=yield T.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var C=!0,k=Di(_),O;O=yield k.next(),d=O.done,!d;C=!0){g=O.value,C=!1;const B=g;i1(B)&&(this.log.debug("publish ".concat(B," for ").concat(T.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Pe(T))),yield this.publishAdditionalCodecForTrack(T.videoTrack,B,T.options))}}catch(B){h={error:B}}finally{try{!C&&!d&&(m=k.return)&&(yield m.call(k))}finally{if(h)throw h.error}}}else u.subscribedQualities.length>0&&(yield(b=T.videoTrack)===null||b===void 0?void 0:b.setPublishingLayers(u.subscribedQualities))}),this.handleLocalTrackUnpublished=u=>{const d=this.trackPublications.get(u.trackSid);if(!d){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(d.track)},this.handleTrackEnded=u=>w(this,void 0,void 0,function*(){if(u.source===G.Source.ScreenShare||u.source===G.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Pe(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(ra(u)||Oi(u))try{if(Ut())try{const d=yield navigator==null?void 0:navigator.permissions.query({name:u.source===G.Source.Camera?"camera":"microphone"});if(d&&d.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Pe(u))),d.onchange=()=>{d.state!=="denied"&&(u.isMuted||u.restartTrack(),d.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Pe(u))),ra(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Pe(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=o,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Yt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on(te.RemoteMute,(n,r)=>{const o=this.trackPublications.get(n);!o||!o.track||(r?o.mute():o.unmute())}),this.engine.on(te.Connected,this.handleReconnected).on(te.SignalRestarted,this.handleReconnected).on(te.SignalResumed,this.handleReconnected).on(te.Restarting,this.handleReconnecting).on(te.Resuming,this.handleReconnecting).on(te.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(te.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(te.Disconnected,this.handleDisconnected).on(te.SignalRequestResponse,this.handleSignalRequestResponse).on(te.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return w(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return w(this,arguments,void 0,function(n){var r=this;let{metadata:o,name:l,attributes:u}=n;return function*(){return new Promise((d,h)=>w(r,void 0,void 0,function*(){var m,g;try{let y=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((m=o??this.metadata)!==null&&m!==void 0?m:"",(g=l??this.name)!==null&&g!==void 0?g:"",u),T=performance.now();for(this.pendingSignalRequests.set(b,{resolve:d,reject:C=>{h(C),y=!0},values:{name:l,metadata:o,attributes:u}});performance.now()-T<5e3&&!y;){if((!l||this.name===l)&&(!o||this.metadata===o)&&(!u||Object.entries(u).every(C=>{let[k,O]=C;return this.attributes[k]===O||O===""&&!this.attributes[k]}))){this.pendingSignalRequests.delete(b),d();return}yield Lt(50)}h(new Kv("Request to update local metadata timed out","TimeoutError"))}catch(y){y instanceof Error&&h(y)}}))}()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(G.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(G.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(G.Source.ScreenShare,e,n,r)}setPermissions(e){const n=this.permissions,r=super.setPermissions(e);return r&&n&&this.emit(Q.ParticipantPermissionsChanged,n),r}setE2EEEnabled(e){return w(this,void 0,void 0,function*(){this.encryptionType=e?Yt.GCM:Yt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,o){return w(this,void 0,void 0,function*(){var l,u;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let d=this.getTrackPublication(e);if(n)if(d)yield d.unmute();else{let h;if(this.pendingPublishing.has(e)){const m=yield this.waitForPendingPublicationOfSource(e);return m||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield m==null?void 0:m.unmute(),m}this.pendingPublishing.add(e);try{switch(e){case G.Source.Camera:h=yield this.createTracks({video:(l=r)!==null&&l!==void 0?l:!0});break;case G.Source.Microphone:h=yield this.createTracks({audio:(u=r)!==null&&u!==void 0?u:!0});break;case G.Source.ScreenShare:h=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Wn(e)}}catch(m){throw h==null||h.forEach(g=>{g.stop()}),m instanceof Error&&this.emit(Q.MediaDevicesError,m),this.pendingPublishing.delete(e),m}try{const m=[];for(const y of h)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Pe(y))),m.push(this.publishTrack(y,o));[d]=yield Promise.all(m)}catch(m){throw h==null||h.forEach(g=>{g.stop()}),m}finally{this.pendingPublishing.delete(e)}}else if(!(d!=null&&d.track)&&this.pendingPublishing.has(e)&&(d=yield this.waitForPendingPublicationOfSource(e),d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),d&&d.track)if(e===G.Source.ScreenShare){d=yield this.unpublishTrack(d.track);const h=this.getTrackPublication(G.Source.ScreenShareAudio);h&&h.track&&this.unpublishTrack(h.track)}else yield d.mute();return d})}enableCameraAndMicrophone(){return w(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(G.Source.Camera)||this.pendingPublishing.has(G.Source.Microphone))){this.pendingPublishing.add(G.Source.Camera),this.pendingPublishing.add(G.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(G.Source.Camera),this.pendingPublishing.delete(G.Source.Microphone)}}})}createTracks(e){return w(this,void 0,void 0,function*(){var n,r;e??(e={});const o=ub(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield Jc(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(d=>(ei(d)&&(this.microphoneError=void 0,d.setAudioContext(this.audioContext),d.source=G.Source.Microphone,this.emit(Q.AudioStreamAcquired)),Cr(d)&&(this.cameraError=void 0,d.source=G.Source.Camera),d))}catch(l){throw l instanceof Error&&(e.audio&&(this.microphoneError=l),e.video&&(this.cameraError=l)),l}})}createScreenTracks(e){return w(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Xf("getDisplayMedia not supported");e.resolution===void 0&&!l1()&&(e.resolution=Zf.h1080fps30.resolution);const n=T1(e),r=yield navigator.mediaDevices.getDisplayMedia(n),o=r.getVideoTracks();if(o.length===0)throw new Wn("no video track found");const l=new Ic(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=G.Source.ScreenShare,e.contentHint&&(l.mediaStreamTrack.contentHint=e.contentHint);const u=[l];if(r.getAudioTracks().length>0){this.emit(Q.AudioStreamAcquired);const d=new Uc(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});d.source=G.Source.ScreenShareAudio,u.push(d)}return u})}publishTrack(e,n){return w(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return w(this,arguments,void 0,function(r,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var d,h,m,g;ra(r)&&r.setAudioContext(l.audioContext),yield(d=l.reconnectFuture)===null||d===void 0?void 0:d.promise,l.republishPromise&&!u&&(yield l.republishPromise),hr(r)&&l.pendingPublishPromises.has(r)&&(yield l.pendingPublishPromises.get(r));let y;if(r instanceof MediaStreamTrack)y=r.getConstraints();else{y=r.constraints;let _;switch(r.source){case G.Source.Microphone:_="audioinput";break;case G.Source.Camera:_="videoinput"}_&&l.activeDeviceMap.has(_)&&(y=Object.assign(Object.assign({},y),{deviceId:l.activeDeviceMap.get(_)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new Uc(r,y,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":r=new Ic(r,y,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new Wn("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let b;if(l.trackPublications.forEach(_=>{_.track&&_.track===r&&(b=_)}),b)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),Pe(b))),b;const T="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,C=(h=o==null?void 0:o.forceStereo)!==null&&h!==void 0?h:T;C&&(o||(o={}),o.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),Pe(r))),o.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(m=o.dtx)!==null&&m!==void 0||(o.dtx=!1),(g=o.red)!==null&&g!==void 0||(o.red=!1));const k=Object.assign(Object.assign({},l.roomOptions.publishDefaults),o);!u1()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),k.simulcast=!1),k.source&&(r.source=k.source);const O=new Promise((_,B)=>w(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ye.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Pe(r)}));const q=()=>w(this,void 0,void 0,function*(){try{const P=yield this.publish(r,k,C);_(P)}catch(P){B(P)}});setTimeout(()=>{this.engine.off(te.SignalConnected,q),B(new Md("publishing rejected as engine not connected within timeout",408))},15e3),this.engine.once(te.SignalConnected,q),this.engine.on(te.Closing,()=>{this.engine.off(te.SignalConnected,q),B(new Md("publishing rejected as engine closed",499))})}else try{const q=yield this.publish(r,k,C);_(q)}catch(q){B(q)}}catch(q){B(q)}}));l.pendingPublishPromises.set(r,O);try{return yield O}catch(_){throw _}finally{l.pendingPublishPromises.delete(r)}}()})}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Pe(e))),!1;const{canPublish:n,canPublishSources:r}=this.permissions;return n&&(r.length===0||r.map(o=>R1(o)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Pe(e))),!1)}publish(e,n,r){return w(this,void 0,void 0,function*(){var o,l,u,d,h,m,g,y,b,T;if(!this.hasPermissionsToPublish(e))throw new Md("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(E=>hr(e)&&E.source===e.source)&&e.source!==G.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Pe(e))),n.stopMicTrackOnMute&&ei(e)&&(e.stopOnMute=!0),e.source===G.Source.ScreenShare&&yr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!s1()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!o1()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Rf),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(E=>n.videoCodec===Ac(E.mime))||(n.videoCodec=Ac(this.enabledPublishVideoCodecs[0].mime)));const k=n.videoCodec;e.on(W.Muted,this.onTrackMuted),e.on(W.Unmuted,this.onTrackUnmuted),e.on(W.Ended,this.handleTrackEnded),e.on(W.UpstreamPaused,this.onTrackUpstreamPaused),e.on(W.UpstreamResumed,this.onTrackUpstreamResumed),e.on(W.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const O=new sf({cid:e.mediaStreamTrack.id,name:n.name,type:G.kindToProto(e.kind),muted:e.isMuted,source:G.sourceToProto(e.source),disableDtx:!(!((o=n.dtx)!==null&&o!==void 0)||o),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((l=n.red)!==null&&l!==void 0)||l),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy});let _;if(e.kind===G.Kind.Video){let E={width:0,height:0};try{E=yield e.waitForDimensions()}catch{const J=(d=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&d!==void 0?d:qs.h720.resolution;E={width:J.width,height:J.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{dims:E}))}O.width=E.width,O.height=E.height,Oi(e)&&(Us(k)&&(e.source===G.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Pe(e))))),n.scalabilityMode=(h=n.scalabilityMode)!==null&&h!==void 0?h:"L3T3_KEY"),O.simulcastCodecs=[new rf({codec:k,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Rf}),n.backupCodec&&k!==n.backupCodec.codec&&O.encryption===Yt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),O.simulcastCodecs.push(new rf({codec:n.backupCodec.codec,cid:""})))),_=wf(e.source===G.Source.ScreenShare,O.width,O.height,n),O.layers=py(O.width,O.height,_,Us(n.videoCodec))}else e.kind===G.Kind.Audio&&(_=[{maxBitrate:(m=n.audioPreset)===null||m===void 0?void 0:m.maxBitrate,priority:(y=(g=n.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&y!==void 0?y:"high",networkPriority:(T=(b=n.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&T!==void 0?T:"high"}]);if(!this.engine||this.engine.isClosed)throw new ut("cannot publish track when not connected");const B=()=>w(this,void 0,void 0,function*(){var E,z,J;if(!this.engine.pcManager)throw new ut("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,_),Oi(e)&&((E=n.degradationPreference)!==null&&E!==void 0||(n.degradationPreference=eR(e)),e.setDegradationPreference(n.degradationPreference)),_)if(yr()&&e.kind===G.Kind.Audio){let ne;for(const oe of this.engine.pcManager.publisher.getTransceivers())if(oe.sender===e.sender){ne=oe;break}ne&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ne,codec:"opus",maxbr:!((z=_[0])===null||z===void 0)&&z.maxBitrate?_[0].maxBitrate/1e3:0})}else e.codec&&Us(e.codec)&&(!((J=_[0])===null||J===void 0)&&J.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:O.cid,codec:e.codec,maxbr:_[0].maxBitrate/1e3});yield this.engine.negotiate()});let q;if(this.enabledPublishVideoCodecs.length>0)q=(yield Promise.all([this.engine.addTrack(O),B()]))[0];else{q=yield this.engine.addTrack(O);let E;if(q.codecs.forEach(z=>{E===void 0&&(E=z.mimeType)}),E&&e.kind===G.Kind.Video){const z=Ac(E);z!==k&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(e)),{codec:z})),n.videoCodec=z,_=wf(e.source===G.Source.ScreenShare,O.width,O.height,n))}yield B()}const P=new Df(e.kind,q,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return P.options=n,e.sid=q.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:_,trackInfo:q})),Oi(e)?e.startMonitor(this.engine.client):ra(e)&&e.startMonitor(),this.addTrackPublication(P),this.emit(Q.LocalTrackPublished,P),P})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return w(this,void 0,void 0,function*(){var o;if(this.encryptionType!==Yt.NONE)return;let l;if(this.trackPublications.forEach(T=>{T.track&&T.track===e&&(l=T)}),!l)throw new Wn("track is not published");if(!Oi(e))throw new Wn("track is not a video track");const u=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),r),d=J1(e,n,u);if(!d){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Pe(e)));return}const h=e.addSimulcastTrack(n,d);if(!h)return;const m=new sf({cid:h.mediaStreamTrack.id,type:G.kindToProto(e.kind),muted:e.isMuted,source:G.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:u.videoCodec,cid:h.mediaStreamTrack.id}]});if(m.layers=py(m.width,m.height,d),!this.engine||this.engine.isClosed)throw new ut("cannot publish track when not connected");const g=()=>w(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,h,u,d),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(m),g()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:b}))})}unpublishTrack(e,n){return w(this,void 0,void 0,function*(){var r,o;if(hr(e)){const m=this.pendingPublishPromises.get(e);m&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Pe(e))),yield m)}const l=this.getPublicationForTrack(e),u=l?Pe(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}e=l.track,e.off(W.Muted,this.onTrackMuted),e.off(W.Unmuted,this.onTrackUnmuted),e.off(W.Ended,this.handleTrackEnded),e.off(W.UpstreamPaused,this.onTrackUpstreamPaused),e.off(W.UpstreamResumed,this.onTrackUpstreamResumed),e.off(W.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(o=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),n?e.stop():e.stopMonitor();let d=!1;const h=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<$e.FAILED&&h)try{for(const m of this.engine.pcManager.publisher.getTransceivers())m.sender===h&&(m.direction="inactive",d=!0);if(this.engine.removeTrack(h)&&(d=!0),Oi(e)){for(const[,m]of e.simulcastCodecs)m.sender&&(this.engine.removeTrack(m.sender)&&(d=!0),m.sender=void 0);e.simulcastCodecs.clear()}}catch(m){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:m}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case G.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case G.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(Q.LocalTrackUnpublished,l),l.setTrack(void 0),d&&(yield this.engine.negotiate()),l})}unpublishTracks(e){return w(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return w(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((l,u)=>w(r,void 0,void 0,function*(){try{const d=[];this.trackPublications.forEach(h=>{h.track&&(n&&(h.options=Object.assign(Object.assign({},h.options),n)),d.push(h))}),yield Promise.all(d.map(h=>w(this,void 0,void 0,function*(){const m=h.track;yield this.unpublishTrack(m,!1),o&&!m.isMuted&&m.source!==G.Source.ScreenShare&&m.source!==G.Source.ScreenShareAudio&&(ra(m)||Oi(m))&&!m.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:h.trackSid})),yield m.restartTrack()),yield this.publishOrRepublishTrack(m,h.options,!0)}))),l()}catch(d){u(d)}finally{this.republishPromise=void 0}})),yield r.republishPromise}()})}publishData(e){return w(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const l=o.reliable?Ae.RELIABLE:Ae.LOSSY,u=o.destinationIdentities,d=o.topic,h=new xt({kind:l,value:{case:"user",value:new r0({participantIdentity:r.identity,payload:n,destinationIdentities:u,topic:d})}});yield r.engine.sendDataPacket(h,l)}()})}publishDtmf(e,n){return w(this,void 0,void 0,function*(){const r=new xt({kind:Ae.RELIABLE,value:{case:"sipDtmf",value:new s0({code:e,digit:n})}});yield this.engine.sendDataPacket(r,Ae.RELIABLE)})}sendChatMessage(e,n){return w(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},o=new xt({value:{case:"chatMessage",value:new Wd(Object.assign(Object.assign({},r),{timestamp:Xe.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(o,Ae.RELIABLE),this.emit(Q.ChatMessage,r),r})}editChatMessage(e,n){return w(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),o=new xt({value:{case:"chatMessage",value:new Wd(Object.assign(Object.assign({},r),{timestamp:Xe.parse(r.timestamp),editTimestamp:Xe.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,Ae.RELIABLE),this.emit(Q.ChatMessage,r),r})}sendText(e,n){return w(this,void 0,void 0,function*(){var r;const o=crypto.randomUUID(),u=new TextEncoder().encode(e).byteLength,d=(r=n==null?void 0:n.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),h=new Array(d?d.length+1:1).fill(0),m=(y,b)=>{var T;h[b]=y;const C=h.reduce((k,O)=>k+O,0);(T=n==null?void 0:n.onProgress)===null||T===void 0||T.call(n,C)},g=yield this.streamText({streamId:o,totalSize:u,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:d,attributes:n==null?void 0:n.attributes});return yield g.write(e),m(1,0),yield g.close(),n!=null&&n.attachments&&d&&(yield Promise.all(n.attachments.map((y,b)=>w(this,void 0,void 0,function*(){return this._sendFile(d[b],y,{topic:n.topic,mimeType:y.type,onProgress:T=>{m(T,b+1)}})})))),g.info})}streamText(e){return w(this,void 0,void 0,function*(){var n,r;const o=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},u=new ef({streamId:o,mimeType:l.mimeType,topic:l.topic,timestamp:aa(l.timestamp),totalLength:aa(e==null?void 0:e.totalSize),attributes:l.attributes,contentHeader:{case:"textHeader",value:new g0({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?$d.UPDATE:$d.CREATE})}}),d=e==null?void 0:e.destinationIdentities,h=new xt({destinationIdentities:d,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(h,Ae.RELIABLE);let m=0;const g=this,y=new WritableStream({write(C){return w(this,void 0,void 0,function*(){for(const k of S1(C,yy)){yield g.engine.waitForBufferStatusLow(Ae.RELIABLE);const O=new tf({content:k,streamId:o,chunkIndex:aa(m)}),_=new xt({destinationIdentities:d,value:{case:"streamChunk",value:O}});yield g.engine.sendDataPacket(_,Ae.RELIABLE),m+=1}})},close(){return w(this,void 0,void 0,function*(){const C=new nf({streamId:o}),k=new xt({destinationIdentities:d,value:{case:"streamTrailer",value:C}});yield g.engine.sendDataPacket(k,Ae.RELIABLE)})},abort(C){console.log("Sink error:",C)}});let b=()=>w(this,void 0,void 0,function*(){yield T.close()});g.engine.once(te.Closing,b);const T=new lR(y,l,()=>this.engine.off(te.Closing,b));return T})}sendFile(e,n){return w(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,n),{id:r}})}_sendFile(e,n,r){return w(this,void 0,void 0,function*(){var o;const l=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(o=r==null?void 0:r.mimeType)!==null&&o!==void 0?o:n.type,topic:r==null?void 0:r.topic,destinationIdentities:r==null?void 0:r.destinationIdentities}),u=n.stream().getReader();for(;;){const{done:d,value:h}=yield u.read();if(d)break;yield l.write(h)}return yield l.close(),l.info})}streamBytes(e){return w(this,void 0,void 0,function*(){var n,r,o,l,u;const d=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),h=e==null?void 0:e.destinationIdentities,m={id:d,mimeType:(r=e==null?void 0:e.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(o=e==null?void 0:e.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(l=e==null?void 0:e.name)!==null&&l!==void 0?l:"unknown"},g=new ef({totalLength:aa((u=m.size)!==null&&u!==void 0?u:0),mimeType:m.mimeType,streamId:d,topic:m.topic,timestamp:aa(Date.now()),contentHeader:{case:"byteHeader",value:new v0({name:m.name})}}),y=new xt({destinationIdentities:h,value:{case:"streamHeader",value:g}});yield this.engine.sendDataPacket(y,Ae.RELIABLE);let b=0;const T=new Nt,C=this.engine,k=this.log,O=new WritableStream({write(B){return w(this,void 0,void 0,function*(){const q=yield T.lock();let P=0;try{for(;P<B.byteLength;){const E=B.slice(P,P+yy);yield C.waitForBufferStatusLow(Ae.RELIABLE);const z=new xt({destinationIdentities:h,value:{case:"streamChunk",value:new tf({content:E,streamId:d,chunkIndex:aa(b)})}});yield C.sendDataPacket(z,Ae.RELIABLE),b+=1,P+=E.byteLength}}finally{q()}})},close(){return w(this,void 0,void 0,function*(){const B=new nf({streamId:d}),q=new xt({destinationIdentities:h,value:{case:"streamTrailer",value:B}});yield C.sendDataPacket(q,Ae.RELIABLE)})},abort(B){k.error("Sink error:",B)}});return new uR(O,m)})}performRpc(e){return w(this,arguments,void 0,function(n){var r=this;let{destinationIdentity:o,method:l,payload:u,responseTimeout:d=1e4}=n;return function*(){return new Promise((m,g)=>w(r,void 0,void 0,function*(){var y,b,T,C;if(ih(u)>gb){g(tt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((b=(y=this.engine.latestJoinResponse)===null||y===void 0?void 0:y.serverInfo)===null||b===void 0)&&b.version&&da((C=(T=this.engine.latestJoinResponse)===null||T===void 0?void 0:T.serverInfo)===null||C===void 0?void 0:C.version,"1.8.0")<0){g(tt.builtIn("UNSUPPORTED_SERVER"));return}const k=crypto.randomUUID();yield this.publishRpcRequest(o,k,l,u,d-2e3);const O=setTimeout(()=>{this.pendingAcks.delete(k),g(tt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(k),clearTimeout(_)},2e3);this.pendingAcks.set(k,{resolve:()=>{clearTimeout(O)},participantIdentity:o});const _=setTimeout(()=>{this.pendingResponses.delete(k),g(tt.builtIn("RESPONSE_TIMEOUT"))},d);this.pendingResponses.set(k,{resolve:(B,q)=>{clearTimeout(_),this.pendingAcks.has(k)&&(console.warn("RPC response received before ack",k),this.pendingAcks.delete(k),clearTimeout(O)),q?g(q):m(B??"")},participantIdentity:o})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,r){const o=this.pendingResponses.get(e);o?(o.resolve(n,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,r,o,l){return w(this,void 0,void 0,function*(){const u=new xt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcRequest",value:new o0({id:n,method:r,payload:o,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(u,Ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:r,resolve:o}]of this.pendingResponses)r===e&&(o(null,tt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(n=>{var r,o;const l=this.trackPublications.get(n.sid);if(l){const u=l.isMuted||((o=(r=l.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&o!==void 0?o:!1);u!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Pe(l)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(n.sid,u))}}),!0)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const o=r.track;o&&(e instanceof MediaStreamTrack?(ra(o)||Oi(o))&&o.mediaStreamTrack===e&&(n=r):e===o&&(n=r))}),n}waitForPendingPublicationOfSource(e){return w(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[u]=l;return u.source===e});if(o)return o[1];yield Lt(20)}})}}class Eb extends Zn{constructor(e,n,r,o){super(e,n.sid,n.name,o),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=rn.HIGH,this.handleEnded=l=>{this.setTrack(void 0),this.emit(W.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.disabled=!l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensions=l,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const o=new Kc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new d0({participantSid:"",trackSids:[this.trackSid]})]});this.emit(W.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Zn.SubscriptionStatus.Unsubscribed:super.isSubscribed?Zn.SubscriptionStatus.Subscribed:Zn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Zn.PermissionStatus.Allowed:Zn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(Id(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Id(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,o=this.track;o!==e&&(o&&(o.off(W.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(W.VisibilityChanged,this.handleVisibilityChange),o.off(W.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(W.Unsubscribed,o)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(W.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(W.VisibilityChanged,this.handleVisibilityChange),e.on(W.Ended,this.handleEnded),this.emit(W.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(W.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?W.Muted:W.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(W.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(W.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===G.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Id(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new y0({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=rn.HIGH,this.emit(W.UpdateSettings,e)}}class jc extends Cb{static fromParticipantInfo(e,n,r){return new jc(e,n.sid,n.identity,n.name,n.metadata,n.attributes,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,o,l,u,d){let h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Bs.STANDARD;super(n,r||"",o,l,u,d,h),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(W.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Pe(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(W.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(W.SubscriptionPermissionChanged,n=>{this.emit(Q.TrackSubscriptionPermissionChanged,e,n)}),e.on(W.SubscriptionStatusChanged,n=>{this.emit(Q.TrackSubscriptionStatusChanged,e,n)}),e.on(W.Subscribed,n=>{this.emit(Q.TrackSubscribed,n,e)}),e.on(W.Unsubscribed,n=>{this.emit(Q.TrackUnsubscribed,n,e)}),e.on(W.SubscriptionFailed,n=>{this.emit(Q.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:G.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,o,l,u){let d=this.getTrackPublicationBySid(n);if(d||n.startsWith("TR")||this.trackPublications.forEach(g=>{!d&&e.kind===g.kind.toString()&&(d=g)}),!d){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Q.TrackSubscriptionFailed,n);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,o,l,u-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Pe(d))),this.emit(Q.TrackSubscriptionFailed,n);return}const h=e.kind==="video";let m;return h?m=new dR(e,n,o,l):m=new kb(e,n,o,this.audioContext,this.audioOutput),m.source=d.source,m.isMuted=d.isMuted,m.setMediaStream(r),m.start(),d.setTrack(m),this.volumeMap.has(d.source)&&Cf(m)&&ei(m)&&m.setVolume(this.volumeMap.get(d.source)),d}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(o=>{var l,u;let d=this.getTrackPublicationBySid(o.sid);if(d)d.updateInfo(o);else{const h=G.kindFromProto(o.type);if(!h)return;d=new Eb(h,o,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),d.updateInfo(o),r.set(o.sid,d);const m=Array.from(this.trackPublications.values()).find(g=>g.source===(d==null?void 0:d.source));m&&d.source!==G.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(d.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Pe(m),newTrack:Pe(d)})),this.addTrackPublication(d)}n.set(o.sid,d)}),this.trackPublications.forEach(o=>{n.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Pe(o))),this.unpublishTrack(o.trackSid,!0))}),r.forEach(o=>{this.emit(Q.TrackPublished,o)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:o}=r;switch(o&&(o.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case G.Kind.Audio:this.audioTrackPublications.delete(e);break;case G.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(Q.TrackUnpublished,r)}setAudioOutput(e){return w(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var o;ei(r.track)&&Cf(r.track)&&n.push(r.track.setSinkId((o=e.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Re;(function(i){i.Disconnected="disconnected",i.Connecting="connecting",i.Connected="connected",i.Reconnecting="reconnecting",i.SignalReconnecting="signalReconnecting"})(Re||(Re={}));const yR=4*1e3;class ti extends xn.EventEmitter{constructor(e){var n,r,o,l;if(super(),n=this,this.state=Re.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ke,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(u,d,h)=>w(this,void 0,void 0,function*(){var m;if(!c1())throw An()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const g=yield this.disconnectLock.lock();if(this.state===Re.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),Promise.resolve();if(this.connectFuture)return g(),this.connectFuture.promise;this.setAndEmitConnectionState(Re.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==u&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Tf(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Of(u,d):this.regionUrlProvider.updateToken(d),this.regionUrlProvider.fetchRegionSettings().then(T=>{var C;(C=this.regionUrlProvider)===null||C===void 0||C.setServerReportedRegions(T)}).catch(T=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:T}))}));const y=(T,C,k)=>w(this,void 0,void 0,function*(){var O,_;this.abortController&&this.abortController.abort();const B=new AbortController;this.abortController=B,g==null||g();try{yield this.attemptConnection(k??u,d,h,B),this.abortController=void 0,T()}catch(q){if(this.regionUrlProvider&&q instanceof Ge&&q.reason!==_e.Cancelled&&q.reason!==_e.NotAllowed){let P=null;try{P=yield this.regionUrlProvider.getNextBestRegionUrl((O=this.abortController)===null||O===void 0?void 0:O.signal)}catch(E){if(E instanceof Ge&&(E.status===401||E.reason===_e.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),C(E);return}}P&&!(!((_=this.abortController)===null||_===void 0)&&_.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(q.message,". Retrying with another region: ").concat(P),this.logContext),this.recreateEngine(),yield y(T,C,P)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ty(q)),C(q))}else{let P=mn.UNKNOWN_REASON;q instanceof Ge&&(P=ty(q)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,P),C(q)}}}),b=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new lb((T,C)=>{y(T,C,b)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,d,h,m,g,y)=>w(this,void 0,void 0,function*(){var b,T,C;const k=yield h.join(u,d,{autoSubscribe:m.autoSubscribe,adaptiveStream:typeof g.adaptiveStream=="object"?!0:g.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout},y.signal);let O=k.serverInfo;if(O||(O={version:k.serverVersion,region:k.serverRegion}),this.serverInfo=O,this.log.debug("connected to Livekit Server ".concat(Object.entries(O).map(_=>{let[B,q]=_;return"".concat(B,": ").concat(q)}).join(", ")),{room:(b=k.room)===null||b===void 0?void 0:b.name,roomSid:(T=k.room)===null||T===void 0?void 0:T.sid,identity:(C=k.participant)===null||C===void 0?void 0:C.identity}),!O.version)throw new KE("unknown server version");return O.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),g.dynacast=!1),k}),this.applyJoinResponse=u=>{const d=u.participant;if(this.localParticipant.sid=d.sid,this.localParticipant.identity=d.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(h){this.log.error(h instanceof Error?h.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:h}))}this.handleParticipantUpdates([d,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,d,h,m)=>w(this,void 0,void 0,function*(){var g,y;this.state===Re.Reconnecting||this.isResuming||!((g=this.engine)===null||g===void 0)&&g.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((y=this.regionUrlProvider)===null||y===void 0)&&y.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},nh),h),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const b=yield this.connectSignal(u,d,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(b),this.setupLocalParticipantEvents(),this.emit(H.SignalConnected)}catch(b){yield this.engine.close(),this.recreateEngine();const T=new Ge("could not establish signal connection",_e.ServerUnreachable);throw b instanceof Error&&(T.message="".concat(T.message,": ").concat(b.message)),b instanceof Ge&&(T.reason=b.reason,T.status=b.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:b})),T}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Ge("Connection attempt aborted",_e.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(b){throw yield this.engine.close(),this.recreateEngine(),b}Ut()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ut()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Re.Connected),this.emit(H.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var u=arguments.length,d=new Array(u),h=0;h<u;h++)d[h]=arguments[h];return w(n,[...d],void 0,function(){var m=this;let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var y,b,T,C;const k=yield m.disconnectLock.lock();try{if(m.state===Re.Disconnected){m.log.debug("already disconnected",m.logContext);return}m.log.info("disconnect from room",Object.assign({},m.logContext)),(m.state===Re.Connecting||m.state===Re.Reconnecting||m.isResuming)&&(m.log.warn("abort connection attempt",m.logContext),(y=m.abortController)===null||y===void 0||y.abort(),(T=(b=m.connectFuture)===null||b===void 0?void 0:b.reject)===null||T===void 0||T.call(b,new Ge("Client initiated disconnect",_e.Cancelled)),m.connectFuture=void 0),!((C=m.engine)===null||C===void 0)&&C.client.isDisconnected||(yield m.engine.client.sendLeave()),m.engine&&(yield m.engine.close()),m.handleDisconnect(g,mn.CLIENT_INITIATED),m.engine=void 0}finally{k()}}()})},this.onPageLeave=()=>w(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>w(this,void 0,void 0,function*(){const u=[],d=gn();if(d&&d.os==="iOS"){const h="livekit-dummy-audio-el";let m=document.getElementById(h);if(!m){m=document.createElement("audio"),m.id=h,m.autoplay=!0,m.hidden=!0;const g=Ld();g.enabled=!0;const y=new MediaStream([g]);m.srcObject=y,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:y,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(m),this.once(H.Disconnected,()=>{m==null||m.remove(),m=null})}u.push(m)}this.remoteParticipants.forEach(h=>{h.audioTrackPublications.forEach(m=>{m.track&&m.track.attachedElements.forEach(g=>{u.push(g)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(h=>(h.muted=!1,h.play()))]),this.handleAudioPlaybackStarted()}catch(h){throw this.handleAudioPlaybackFailed(h),h}}),this.startVideo=()=>w(this,void 0,void 0,function*(){const u=[];for(const d of this.remoteParticipants.values())d.videoTrackPublications.forEach(h=>{var m;(m=h.track)===null||m===void 0||m.attachedElements.forEach(g=>{u.includes(g)||u.push(g)})});yield Promise.all(u.map(d=>d.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(d=>{d.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Re.Reconnecting)&&this.emit(H.Reconnecting)},this.handleSignalRestarted=u=>w(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(d){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:d}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Re.Connected),this.emit(H.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(d=>{var h;if(d.identity===this.localParticipant.identity){this.localParticipant.updateInfo(d);return}d.identity===""&&(d.identity=(h=this.sidToIdentity.get(d.sid))!==null&&h!==void 0?h:"");let m=this.remoteParticipants.get(d.identity);d.state===Jd.DISCONNECTED?this.handleParticipantDisconnected(d.identity,m):m=this.getOrCreateParticipant(d.identity,d)})},this.handleActiveSpeakersUpdate=u=>{const d=[],h={};u.forEach(m=>{if(h[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),d.push(this.localParticipant);else{const g=this.getRemoteParticipantBySid(m.sid);g&&(g.audioLevel=m.level,g.setIsSpeaking(!0),d.push(g))}}),h[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(m=>{h[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=d,this.emitWhenConnected(H.ActiveSpeakersChanged,d)},this.handleSpeakersChanged=u=>{const d=new Map;this.activeSpeakers.forEach(m=>{const g=this.remoteParticipants.get(m.identity);g&&g.sid!==m.sid||d.set(m.sid,m)}),u.forEach(m=>{let g=this.getRemoteParticipantBySid(m.sid);m.sid===this.localParticipant.sid&&(g=this.localParticipant),g&&(g.audioLevel=m.level,g.setIsSpeaking(m.active),m.active?d.set(m.sid,g):d.delete(m.sid))});const h=Array.from(d.values());h.sort((m,g)=>g.audioLevel-m.audioLevel),this.activeSpeakers=h,this.emitWhenConnected(H.ActiveSpeakersChanged,h)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(d=>{const h=this.getRemoteParticipantBySid(d.participantSid);if(!h)return;const m=h.getTrackPublicationBySid(d.trackSid);if(!m||!m.track)return;const g=G.streamStateFromProto(d.state);g!==m.track.streamState&&(m.track.streamState=g,h.emit(Q.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(H.TrackStreamStateChanged,m,m.track.streamState,h))})},this.handleSubscriptionPermissionUpdate=u=>{const d=this.getRemoteParticipantBySid(u.participantSid);if(!d)return;const h=d.getTrackPublicationBySid(u.trackSid);h&&h.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const d=Array.from(this.remoteParticipants.values()).find(m=>m.trackPublications.has(u.trackSid));if(!d)return;const h=d.getTrackPublicationBySid(u.trackSid);h&&h.setSubscriptionError(u.err)},this.handleDataPacket=u=>{const d=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(d,u.value.value,u.kind);else if(u.value.case==="transcription")this.handleTranscription(d,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(d,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(d,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,d);else if(u.value.case==="streamHeader")this.handleStreamHeader(u.value.value,u.participantIdentity);else if(u.value.case==="streamChunk")this.handleStreamChunk(u.value.value);else if(u.value.case==="streamTrailer")this.handleStreamTrailer(u.value.value);else if(u.value.case==="rpcRequest"){const h=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,h.id,h.method,h.payload,h.responseTimeoutMs,h.version)}},this.handleUserPacket=(u,d,h)=>{this.emit(H.DataReceived,d.payload,u,h,d.topic),u==null||u.emit(Q.DataReceived,d.payload,h)},this.handleSipDtmf=(u,d)=>{this.emit(H.SipDTMFReceived,d,u),u==null||u.emit(Q.SipDTMFReceived,d)},this.bufferedSegments=new Map,this.handleTranscription=(u,d)=>{const h=d.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(d.transcribedParticipantIdentity),m=h==null?void 0:h.trackPublications.get(d.trackId),g=g1(d,this.transcriptionReceivedTimes);m==null||m.emit(W.TranscriptionReceived,g),h==null||h.emit(Q.TranscriptionReceived,g,m),this.emit(H.TranscriptionReceived,g,h,m)},this.handleChatMessage=(u,d)=>{const h=v1(d);this.emit(H.ChatMessage,h,u)},this.handleMetrics=(u,d)=>{this.emit(H.MetricsReceived,u,d)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(H.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(H.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(H.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(H.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>w(this,void 0,void 0,function*(){var u,d;const h=gt.getInstance().previousDevices,m=yield gt.getInstance().getDevices(void 0,!1),g=gn();if((g==null?void 0:g.name)==="Chrome"&&g.os!=="iOS")for(let b of m){const T=h.find(C=>C.deviceId===b.deviceId);T&&T.label!==""&&T.kind===b.kind&&T.label!==b.label&&this.getActiveDevice(b.kind)==="default"&&this.emit(H.ActiveDeviceChanged,b.kind,b.deviceId)}const y=["audiooutput","audioinput","videoinput"];for(let b of y){const T=m.filter(k=>k.kind===b),C=this.getActiveDevice(b);if(C===((u=h.filter(k=>k.kind===b)[0])===null||u===void 0?void 0:u.deviceId)&&T.length>0&&((d=T[0])===null||d===void 0?void 0:d.deviceId)!==C){yield this.switchActiveDevice(b,T[0].deviceId);continue}b==="audioinput"&&!Li()||b==="videoinput"||T.length>0&&!T.find(k=>k.deviceId===this.getActiveDevice(b))&&(yield this.switchActiveDevice(b,T[0].deviceId))}this.emit(H.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const d=this.roomInfo;this.roomInfo=u,d&&d.metadata!==u.metadata&&this.emitWhenConnected(H.RoomMetadataChanged,u.metadata),(d==null?void 0:d.activeRecording)!==u.activeRecording&&this.emitWhenConnected(H.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(d=>{if(d.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(d.quality);return}const h=this.getRemoteParticipantBySid(d.participantSid);h&&h.setConnectionQuality(d.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(H.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(H.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(H.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(H.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(H.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var d;(d=u==null?void 0:u.onPublish)===null||d===void 0||d.call(u,this)},this.onLocalTrackPublished=u=>w(this,void 0,void 0,function*(){var d,h,m,g,y,b;(d=u.track)===null||d===void 0||d.on(W.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=u.track)===null||h===void 0||h.on(W.Restarted,this.onLocalTrackRestarted),(y=(g=(m=u.track)===null||m===void 0?void 0:m.getProcessor())===null||g===void 0?void 0:g.onPublish)===null||y===void 0||y.call(g,this),this.emit(H.LocalTrackPublished,u,this.localParticipant),ra(u.track)&&(yield u.track.checkForSilence())&&this.emit(H.LocalAudioSilenceDetected,u);const T=yield(b=u.track)===null||b===void 0?void 0:b.getDeviceId(!1),C=ny(u.source);C&&T&&T!==this.localParticipant.activeDeviceMap.get(C)&&(this.localParticipant.activeDeviceMap.set(C,T),this.emit(H.ActiveDeviceChanged,C,T))}),this.onLocalTrackUnpublished=u=>{var d,h;(d=u.track)===null||d===void 0||d.off(W.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=u.track)===null||h===void 0||h.off(W.Restarted,this.onLocalTrackRestarted),this.emit(H.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>w(this,void 0,void 0,function*(){const d=yield u.getDeviceId(!1),h=ny(u.source);h&&d&&d!==this.localParticipant.activeDeviceMap.get(h)&&(this.log.debug("local track restarted, setting ".concat(h," ").concat(d," active"),this.logContext),this.localParticipant.activeDeviceMap.set(h,d),this.emit(H.ActiveDeviceChanged,h,d))}),this.onLocalConnectionQualityChanged=u=>{this.emit(H.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=u=>{this.emit(H.MediaDevicesError,u)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(H.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(H.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},q1),e),this.log=$n((r=this.options.loggerName)!==null&&r!==void 0?r:pn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},mb),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},pb),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},z1),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Nt,this.localParticipant=new vR("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ni(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ni(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",Ni(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),Ut()){const u=new AbortController;(l=navigator.mediaDevices)===null||l===void 0||l.addEventListener("devicechange",this.handleDeviceChange,{signal:u.signal}),ti.cleanupRegistry&&ti.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,r,o,l,u){return w(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),u!==1){yield this.engine.publishRpcResponse(e,n,null,tt.builtIn("UNSUPPORTED_VERSION"));return}const d=this.rpcHandlers.get(r);if(!d){yield this.engine.publishRpcResponse(e,n,null,tt.builtIn("UNSUPPORTED_METHOD"));return}let h=null,m=null;try{const g=yield d({requestId:n,callerIdentity:e,payload:o,responseTimeout:l});ih(g)>gb?(h=tt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):m=g}catch(g){g instanceof tt?h=g:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),g),h=tt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,m,h)})}setE2EEEnabled(e){return w(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new _1(this.options.e2ee),this.e2eeManager.on(xi.ParticipantEncryptionStatusChanged,(n,r)=>{b1(r)&&(this.isE2EEEnabled=n),this.emit(H.ParticipantEncryptionStatusChanged,n,r)}),this.e2eeManager.on(xi.EncryptionError,n=>this.emit(H.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return w(this,void 0,void 0,function*(){return this.state===Re.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=o=>{o.sid!==""&&(this.engine.off(te.RoomUpdate,r),e(o.sid))};this.engine.on(te.RoomUpdate,r),this.once(H.Disconnected,()=>{this.engine.off(te.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new iR(this.options),this.engine.on(te.ParticipantUpdate,this.handleParticipantUpdates).on(te.RoomUpdate,this.handleRoomUpdate).on(te.SpeakersChanged,this.handleSpeakersChanged).on(te.StreamStateChanged,this.handleStreamStateUpdate).on(te.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(te.SubscriptionError,this.handleSubscriptionError).on(te.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(te.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on(te.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(te.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(te.DataPacketReceived,this.handleDataPacket).on(te.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Re.SignalReconnecting)&&this.emit(H.SignalReconnecting)}).on(te.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Re.Connected)&&this.emit(H.Reconnected)}).on(te.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Re.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(te.Restarting,this.handleRestarting).on(te.SignalRestarted,this.handleSignalRestarted).on(te.Offline,()=>{this.setAndEmitConnectionState(Re.Reconnecting)&&this.emit(H.Reconnecting)}).on(te.DCBufferStatusChanged,(e,n)=>{this.emit(H.DCBufferStatusChanged,e,n)}).on(te.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:o}=r;return o===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Q.LocalTrackSubscribed,n),this.emitWhenConnected(H.LocalTrackSubscribed,n,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return gt.getInstance().getDevices(e,n)}prepareConnection(e,n){return w(this,void 0,void 0,function*(){if(this.state===Re.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Tf(new URL(e))&&n){this.regionUrlProvider=new Of(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Re.Disconnected&&(this.regionUrl=r,yield fetch(kf(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(kf(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return w(this,void 0,void 0,function*(){let r=()=>{},o;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new Rn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new Rn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new Rn({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new Rn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>w(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new Rn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>w(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new Rn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new Rn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>w(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new Qc({reason:mn.CLIENT_INITIATED,action:ur.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new Rn({scenario:{case:"subscriberBandwidth",value:aa(n)}});break;case"leave-full-reconnect":o=new Rn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return w(this,arguments,void 0,function(r,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var d,h,m,g,y,b,T,C;let k=!0,O=!1;const _=u?{exact:o}:o;if(r==="audioinput"){O=l.localParticipant.audioTrackPublications.size===0;const B=(d=l.getActiveDevice(r))!==null&&d!==void 0?d:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=_;const q=Array.from(l.localParticipant.audioTrackPublications.values()).filter(P=>P.source===G.Source.Microphone);try{k=(yield Promise.all(q.map(P=>{var E;return(E=P.audioTrack)===null||E===void 0?void 0:E.setDeviceId(_)}))).every(P=>P===!0)}catch(P){throw l.options.audioCaptureDefaults.deviceId=B,P}}else if(r==="videoinput"){O=l.localParticipant.videoTrackPublications.size===0;const B=(h=l.getActiveDevice(r))!==null&&h!==void 0?h:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=_;const q=Array.from(l.localParticipant.videoTrackPublications.values()).filter(P=>P.source===G.Source.Camera);try{k=(yield Promise.all(q.map(P=>{var E;return(E=P.videoTrack)===null||E===void 0?void 0:E.setDeviceId(_)}))).every(P=>P===!0)}catch(P){throw l.options.videoCaptureDefaults.deviceId=B,P}}else if(r==="audiooutput"){if(!Sf()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");l.options.webAudioMix&&(o=(m=yield gt.getInstance().normalizeDeviceId("audiooutput",o))!==null&&m!==void 0?m:""),(g=(C=l.options).audioOutput)!==null&&g!==void 0||(C.audioOutput={});const B=(y=l.getActiveDevice(r))!==null&&y!==void 0?y:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=o;try{l.options.webAudioMix&&((b=l.audioContext)===null||b===void 0||b.setSinkId(o)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(q=>q.setAudioOutput({deviceId:o})))}catch(q){throw l.options.audioOutput.deviceId=B,q}}return(O||r==="audiooutput")&&(l.localParticipant.activeDeviceMap.set(r,r==="audiooutput"&&((T=l.options.audioOutput)===null||T===void 0?void 0:T.deviceId)||o),l.emit(H.ActiveDeviceChanged,r,o)),k}()})}setupLocalParticipantEvents(){this.localParticipant.on(Q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Q.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Q.AttributesChanged,this.onLocalAttributesChanged).on(Q.TrackMuted,this.onLocalTrackMuted).on(Q.TrackUnmuted,this.onLocalTrackUnmuted).on(Q.LocalTrackPublished,this.onLocalTrackPublished).on(Q.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Q.MediaDevicesError,this.onMediaDevicesError).on(Q.AudioStreamAcquired,this.startAudio).on(Q.ChatMessage,this.onLocalChatMessageSent).on(Q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===Re.Connecting||this.state===Re.Reconnecting){const g=()=>{this.onTrackAdded(e,n,r),y()},y=()=>{this.off(H.Reconnected,g),this.off(H.Connected,g),this.off(H.Disconnected,y)};this.once(H.Reconnected,g),this.once(H.Connected,g),this.once(H.Disconnected,y);return}if(this.state===Re.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=r1(n.id),l=o[0];let u=o[1],d=e.id;if(u&&u.startsWith("TR")&&(d=u),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const h=Array.from(this.remoteParticipants.values()).find(g=>g.sid===l);if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}let m;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?m=this.options.adaptiveStream:m={}),h.addSubscribedMediaTrack(e,d,n,r,m)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Re.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{o.unpublishTrack(l.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var l,u,d;o.track&&this.localParticipant.unpublishTrack(o.track,e),e?((l=o.track)===null||l===void 0||l.detach(),(u=o.track)===null||u===void 0||u.stop()):(d=o.track)===null||d===void 0||d.stopMonitor()}),this.localParticipant.off(Q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Q.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Q.AttributesChanged,this.onLocalAttributesChanged).off(Q.TrackMuted,this.onLocalTrackMuted).off(Q.TrackUnmuted,this.onLocalTrackUnmuted).off(Q.LocalTrackPublished,this.onLocalTrackPublished).off(Q.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Q.MediaDevicesError,this.onMediaDevicesError).off(Q.AudioStreamAcquired,this.startAudio).off(Q.ChatMessage,this.onLocalChatMessageSent).off(Q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ut()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Re.Disconnected),this.emit(H.Disconnected,n)}}}handleParticipantDisconnected(e,n){var r;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(o=>{n.unpublishTrack(o.trackSid,!0)}),this.emit(H.ParticipantDisconnected,n),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return w(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let l;const u={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Oc(e.timestamp),attributes:e.attributes},d=new ReadableStream({start:h=>{l=h,this.byteStreamControllers.set(e.streamId,{info:u,controller:l,startTime:Date.now()})}});o(new oR(u,d,Oc(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let l;const u={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},d=new ReadableStream({start:h=>{l=h,this.textStreamControllers.set(e.streamId,{info:u,controller:l,startTime:Date.now()})}});o(new cR(u,d,Oc(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const r=this.textStreamControllers.get(e.streamId);r&&e.content.length>0&&r.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return w(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Wf())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Lt(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(H.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let o;return n?o=jc.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new jc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),o}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const o=this.remoteParticipants.get(e);return n&&o.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),o}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(H.ParticipantConnected,r),r.on(Q.TrackPublished,o=>{this.emitWhenConnected(H.TrackPublished,o,r)}).on(Q.TrackSubscribed,(o,l)=>{o.kind===G.Kind.Audio?(o.on(W.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(W.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===G.Kind.Video&&(o.on(W.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(W.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(H.TrackSubscribed,o,l,r)}).on(Q.TrackUnpublished,o=>{this.emit(H.TrackUnpublished,o,r)}).on(Q.TrackUnsubscribed,(o,l)=>{this.emit(H.TrackUnsubscribed,o,l,r)}).on(Q.TrackMuted,o=>{this.emitWhenConnected(H.TrackMuted,o,r)}).on(Q.TrackUnmuted,o=>{this.emitWhenConnected(H.TrackUnmuted,o,r)}).on(Q.ParticipantMetadataChanged,o=>{this.emitWhenConnected(H.ParticipantMetadataChanged,o,r)}).on(Q.ParticipantNameChanged,o=>{this.emitWhenConnected(H.ParticipantNameChanged,o,r)}).on(Q.AttributesChanged,o=>{this.emitWhenConnected(H.ParticipantAttributesChanged,o,r)}).on(Q.ConnectionQualityChanged,o=>{this.emitWhenConnected(H.ConnectionQualityChanged,o,r)}).on(Q.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(H.ParticipantPermissionsChanged,o,r)}).on(Q.TrackSubscriptionStatusChanged,(o,l)=>{this.emitWhenConnected(H.TrackSubscriptionStatusChanged,o,l,r)}).on(Q.TrackSubscriptionFailed,(o,l)=>{this.emit(H.TrackSubscriptionFailed,o,r,l)}).on(Q.TrackSubscriptionPermissionChanged,(o,l)=>{this.emitWhenConnected(H.TrackSubscriptionPermissionChanged,o,l,r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,o)=>(r.push(...o.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&y1(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Tt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,mn.STATE_MISMATCH))):e=0},yR)}clearConnectionReconcile(){this.connectionReconcileInterval&&Tt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(H.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(this.state===Re.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Re.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return w(this,void 0,void 0,function*(){var n,r;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),l=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Vf({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Xe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new js({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(H.SignalConnected),this.emit(H.Connected),this.setAndEmitConnectionState(Re.Connected),o.video){const u=new Df(G.Kind.Video,new or({source:ot.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO,name:"video-dummy"}),new Ic(o.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ey(160*((n=l.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(Q.LocalTrackPublished,u)}if(o.audio){const u=new Df(G.Kind.Audio,new or({source:ot.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO}),new Uc(o.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Ld(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(Q.LocalTrackPublished,u)}for(let u=0;u<l.count-1;u+=1){let d=new js({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(u),state:Jd.ACTIVE,tracks:[],joinedAt:Xe.parse(Date.now())});const h=this.getOrCreateParticipant(d.identity,d);if(l.video){const m=ey(160*((r=l.aspectRatios[u%l.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),g=new or({source:ot.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO});h.addSubscribedMediaTrack(m,g.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}if(l.audio){const m=Ld(),g=new or({source:ot.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO});h.addSubscribedMediaTrack(m,g.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}h.updateInfo(d)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(e!==H.ActiveSpeakersChanged&&e!==H.TranscriptionReceived){const l=Rb(r).filter(u=>u!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:l}))}return super.emit(e,...r)}}ti.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(i=>{i()});function Rb(i){return i.map(e=>{if(e)return Array.isArray(e)?Rb(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var dn;(function(i){i[i.IDLE=0]="IDLE",i[i.RUNNING=1]="RUNNING",i[i.SKIPPED=2]="SKIPPED",i[i.SUCCESS=3]="SUCCESS",i[i.FAILED=4]="FAILED"})(dn||(dn={}));class Bi extends xn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=dn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new ti(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return w(this,void 0,void 0,function*(){if(this.status!==dn.IDLE)throw Error("check is running already");this.setStatus(dn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==dn.SKIPPED&&this.setStatus(this.isSuccess()?dn.SUCCESS:dn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return w(this,void 0,void 0,function*(){return this.room.state===Re.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return w(this,void 0,void 0,function*(){this.room&&this.room.state!==Re.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(dn.SKIPPED)}switchProtocol(e){return w(this,void 0,void 0,function*(){let n=!1,r=!1;if(this.room.on(H.Reconnecting,()=>{n=!0}),this.room.once(H.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(l=>setTimeout(l,1e3)),!n)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(r)return;yield Lt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class bR extends Bi{get description(){return"Cloud regions"}perform(){return w(this,void 0,void 0,function*(){const e=new Of(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],r=new Set;for(let l=0;l<3;l++){const u=yield e.getNextBestRegionUrl();if(!u)break;if(r.has(u))continue;r.add(u);const d=yield this.checkCloudRegion(u);this.appendMessage("".concat(d.region," RTT: ").concat(d.rtt,"ms, duration: ").concat(d.duration,"ms")),n.push(d)}n.sort((l,u)=>(l.duration-u.duration)*.5+(l.rtt-u.rtt)*.5);const o=n[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return w(this,void 0,void 0,function*(){var n,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!o)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),u=1e3,h=1e6/u,m="A".repeat(u),g=Date.now();for(let C=0;C<h;C++)yield l.write(m);yield l.close();const y=Date.now(),b=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),T={region:o,rtt:1e4,duration:y-g};return b==null||b.forEach(C=>{C.type==="candidate-pair"&&C.nominated&&(T.rtt=C.currentRoundTripTime*1e3)}),yield this.disconnect(),T})}}const Fd=1e4;class SR extends Bi{get description(){return"Connection via UDP vs TCP"}perform(){return w(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(Fd/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(Fd/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return w(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const r=n.getContext("2d");if(!r)throw new Error("Could not get canvas context");let o=0;const l=()=>{o=(o+1)%360,r.fillStyle="hsl(".concat(o,", 100%, 50%)"),r.fillRect(0,0,n.width,n.height),requestAnimationFrame(l)};l();const d=n.captureStream(30).getVideoTracks()[0],m=(yield this.room.localParticipant.publishTrack(d,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},y=setInterval(()=>w(this,void 0,void 0,function*(){const b=yield m.getRTCStatsReport();b==null||b.forEach(T=>{T.type==="outbound-rtp"?(g.packetsSent=T.packetsSent,g.qualityLimitationDurations=T.qualityLimitationDurations,g.bitrateTotal+=T.targetBitrate,g.count++):T.type==="remote-inbound-rtp"&&(g.packetsLost=T.packetsLost,g.rttTotal+=T.roundTripTime,g.jitterTotal+=T.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,Fd)),clearInterval(y),d.stop(),n.remove(),yield this.disconnect(),g})}}class TR extends Bi{get description(){return"Can publish audio"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield mR();if(yield db(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(r),yield new Promise(d=>setTimeout(d,3e3));const l=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!l)throw new Error("Could not get RTCStats");let u=0;if(l.forEach(d=>{d.type==="outbound-rtp"&&(d.kind==="audio"||!d.kind&&d.mediaType==="audio")&&(u=d.packetsSent)}),u===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(u," audio packets"))})}}class kR extends Bi{get description(){return"Can publish video"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield hR();yield this.checkForVideo(r.mediaStreamTrack),n.localParticipant.publishTrack(r),yield new Promise(u=>setTimeout(u,5e3));const o=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="video"||!u.kind&&u.mediaType==="video")&&(l+=u.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(e){return w(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const r=document.createElement("video");r.srcObject=n,r.muted=!0,yield new Promise(o=>{r.onplay=()=>{setTimeout(()=>{var l,u,d,h;const m=document.createElement("canvas"),g=e.getSettings(),y=(u=(l=g.width)!==null&&l!==void 0?l:r.videoWidth)!==null&&u!==void 0?u:1280,b=(h=(d=g.height)!==null&&d!==void 0?d:r.videoHeight)!==null&&h!==void 0?h:720;m.width=y,m.height=b;const T=m.getContext("2d");T.drawImage(r,0,0);const k=T.getImageData(0,0,m.width,m.height).data;let O=!0;for(let _=0;_<k.length;_+=4)if(k[_]!==0||k[_+1]!==0||k[_+2]!==0){O=!1;break}O?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},r.play()}),r.remove()})}}class CR extends Bi{get description(){return"Resuming connection after interruption"}perform(){return w(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,o=!1,l;const u=new Promise(m=>{setTimeout(m,5e3),l=m}),d=()=>{r=!0};n.on(H.SignalReconnecting,d).on(H.Reconnecting,d).on(H.Reconnected,()=>{o=!0,l(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const h=n.engine.client.onClose;if(h&&h(""),yield u,r){if(!o||n.state!==Re.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class ER extends Bi{get description(){return"Can connect via TURN"}perform(){return w(this,void 0,void 0,function*(){var e,n;const r=new $f,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let l=!1,u=!1,d=!1;for(let h of o.iceServers)for(let m of h.urls)m.startsWith("turn:")?(u=!0,d=!0):m.startsWith("turns:")&&(u=!0,d=!0,l=!0),m.startsWith("stun:")&&(d=!0);d?u&&!l&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(h=>setTimeout(h,0)))})}}class RR extends Bi{get description(){return"Establishing WebRTC connection"}perform(){return w(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(H.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,l)=>{if(o.candidate){const u=new RTCIceCandidate(o);let d="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(_R(u.address)?d+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(e=!0,d+=" (passive)"):u.protocol==="udp"&&(n=!0)),this.appendMessage(d)}r&&r(o,l)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),ke.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function _R(i){const e=i.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class wR extends Bi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return w(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new $f;const l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((e=l.serverInfo)===null||e===void 0?void 0:e.edition)===f0.Cloud&&(!((n=l.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=l.serverInfo)===null||r===void 0?void 0:r.region)),yield o.close()})}}class KO extends xn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:dn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==dn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return w(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),o=u=>{this.updateCheck(n,u)};r.on("update",o);const l=yield r.run();return r.off("update",o),l})}checkWebsocket(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(wR)})}checkWebRTC(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(RR)})}checkTURN(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(ER)})}checkReconnect(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(CR)})}checkPublishAudio(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(TR)})}checkPublishVideo(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(kR)})}checkConnectionProtocol(){return w(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(SR);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return w(this,void 0,void 0,function*(){return this.createAndRunCheck(bR)})}}const Bc=Math.min,ca=Math.max,zc=Math.round,fc=Math.floor,On=i=>({x:i,y:i}),OR={left:"right",right:"left",bottom:"top",top:"bottom"},AR={start:"end",end:"start"};function by(i,e,n){return ca(i,Bc(e,n))}function Wc(i,e){return typeof i=="function"?i(e):i}function fa(i){return i.split("-")[0]}function $c(i){return i.split("-")[1]}function _b(i){return i==="x"?"y":"x"}function wb(i){return i==="y"?"height":"width"}function br(i){return["top","bottom"].includes(fa(i))?"y":"x"}function Ob(i){return _b(br(i))}function DR(i,e,n){n===void 0&&(n=!1);const r=$c(i),o=Ob(i),l=wb(o);let u=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[l]>e.floating[l]&&(u=qc(u)),[u,qc(u)]}function MR(i){const e=qc(i);return[Mf(i),e,Mf(e)]}function Mf(i){return i.replace(/start|end/g,e=>AR[e])}function xR(i,e,n){const r=["left","right"],o=["right","left"],l=["top","bottom"],u=["bottom","top"];switch(i){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?l:u;default:return[]}}function PR(i,e,n,r){const o=$c(i);let l=xR(fa(i),n==="start",r);return o&&(l=l.map(u=>u+"-"+o),e&&(l=l.concat(l.map(Mf)))),l}function qc(i){return i.replace(/left|right|bottom|top/g,e=>OR[e])}function NR(i){return{top:0,right:0,bottom:0,left:0,...i}}function UR(i){return typeof i!="number"?NR(i):{top:i,right:i,bottom:i,left:i}}function Vc(i){const{x:e,y:n,width:r,height:o}=i;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function Sy(i,e,n){let{reference:r,floating:o}=i;const l=br(e),u=Ob(e),d=wb(u),h=fa(e),m=l==="y",g=r.x+r.width/2-o.width/2,y=r.y+r.height/2-o.height/2,b=r[d]/2-o[d]/2;let T;switch(h){case"top":T={x:g,y:r.y-o.height};break;case"bottom":T={x:g,y:r.y+r.height};break;case"right":T={x:r.x+r.width,y};break;case"left":T={x:r.x-o.width,y};break;default:T={x:r.x,y:r.y}}switch($c(e)){case"start":T[u]-=b*(n&&m?-1:1);break;case"end":T[u]+=b*(n&&m?-1:1);break}return T}const LR=async(i,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:l=[],platform:u}=n,d=l.filter(Boolean),h=await(u.isRTL==null?void 0:u.isRTL(e));let m=await u.getElementRects({reference:i,floating:e,strategy:o}),{x:g,y}=Sy(m,r,h),b=r,T={},C=0;for(let k=0;k<d.length;k++){const{name:O,fn:_}=d[k],{x:B,y:q,data:P,reset:E}=await _({x:g,y,initialPlacement:r,placement:b,strategy:o,middlewareData:T,rects:m,platform:u,elements:{reference:i,floating:e}});g=B??g,y=q??y,T={...T,[O]:{...T[O],...P}},E&&C<=50&&(C++,typeof E=="object"&&(E.placement&&(b=E.placement),E.rects&&(m=E.rects===!0?await u.getElementRects({reference:i,floating:e,strategy:o}):E.rects),{x:g,y}=Sy(m,b,h)),k=-1)}return{x:g,y,placement:b,strategy:o,middlewareData:T}};async function Ab(i,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:l,rects:u,elements:d,strategy:h}=i,{boundary:m="clippingAncestors",rootBoundary:g="viewport",elementContext:y="floating",altBoundary:b=!1,padding:T=0}=Wc(e,i),C=UR(T),k=d[b?y==="floating"?"reference":"floating":y],O=Vc(await l.getClippingRect({element:(n=await(l.isElement==null?void 0:l.isElement(k)))==null||n?k:k.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(d.floating)),boundary:m,rootBoundary:g,strategy:h})),_=y==="floating"?{x:r,y:o,width:u.floating.width,height:u.floating.height}:u.reference,B=await(l.getOffsetParent==null?void 0:l.getOffsetParent(d.floating)),q=await(l.isElement==null?void 0:l.isElement(B))?await(l.getScale==null?void 0:l.getScale(B))||{x:1,y:1}:{x:1,y:1},P=Vc(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:d,rect:_,offsetParent:B,strategy:h}):_);return{top:(O.top-P.top+C.top)/q.y,bottom:(P.bottom-O.bottom+C.bottom)/q.y,left:(O.left-P.left+C.left)/q.x,right:(P.right-O.right+C.right)/q.x}}const IR=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var n,r;const{placement:o,middlewareData:l,rects:u,initialPlacement:d,platform:h,elements:m}=e,{mainAxis:g=!0,crossAxis:y=!0,fallbackPlacements:b,fallbackStrategy:T="bestFit",fallbackAxisSideDirection:C="none",flipAlignment:k=!0,...O}=Wc(i,e);if((n=l.arrow)!=null&&n.alignmentOffset)return{};const _=fa(o),B=br(d),q=fa(d)===d,P=await(h.isRTL==null?void 0:h.isRTL(m.floating)),E=b||(q||!k?[qc(d)]:MR(d)),z=C!=="none";!b&&z&&E.push(...PR(d,k,C,P));const J=[d,...E],ne=await Ab(e,O),oe=[];let se=((r=l.flip)==null?void 0:r.overflows)||[];if(g&&oe.push(ne[_]),y){const Le=DR(o,u,P);oe.push(ne[Le[0]],ne[Le[1]])}if(se=[...se,{placement:o,overflows:oe}],!oe.every(Le=>Le<=0)){var $,re;const Le=((($=l.flip)==null?void 0:$.index)||0)+1,Ke=J[Le];if(Ke)return{data:{index:Le,overflows:se},reset:{placement:Ke}};let V=(re=se.filter(ee=>ee.overflows[0]<=0).sort((ee,le)=>ee.overflows[1]-le.overflows[1])[0])==null?void 0:re.placement;if(!V)switch(T){case"bestFit":{var Ue;const ee=(Ue=se.filter(le=>{if(z){const ye=br(le.placement);return ye===B||ye==="y"}return!0}).map(le=>[le.placement,le.overflows.filter(ye=>ye>0).reduce((ye,A)=>ye+A,0)]).sort((le,ye)=>le[1]-ye[1])[0])==null?void 0:Ue[0];ee&&(V=ee);break}case"initialPlacement":V=d;break}if(o!==V)return{reset:{placement:V}}}return{}}}};async function jR(i,e){const{placement:n,platform:r,elements:o}=i,l=await(r.isRTL==null?void 0:r.isRTL(o.floating)),u=fa(n),d=$c(n),h=br(n)==="y",m=["left","top"].includes(u)?-1:1,g=l&&h?-1:1,y=Wc(e,i);let{mainAxis:b,crossAxis:T,alignmentAxis:C}=typeof y=="number"?{mainAxis:y,crossAxis:0,alignmentAxis:null}:{mainAxis:y.mainAxis||0,crossAxis:y.crossAxis||0,alignmentAxis:y.alignmentAxis};return d&&typeof C=="number"&&(T=d==="end"?C*-1:C),h?{x:T*g,y:b*m}:{x:b*m,y:T*g}}const BR=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var n,r;const{x:o,y:l,placement:u,middlewareData:d}=e,h=await jR(e,i);return u===((n=d.offset)==null?void 0:n.placement)&&(r=d.arrow)!=null&&r.alignmentOffset?{}:{x:o+h.x,y:l+h.y,data:{...h,placement:u}}}}},zR=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:l=!0,crossAxis:u=!1,limiter:d={fn:O=>{let{x:_,y:B}=O;return{x:_,y:B}}},...h}=Wc(i,e),m={x:n,y:r},g=await Ab(e,h),y=br(fa(o)),b=_b(y);let T=m[b],C=m[y];if(l){const O=b==="y"?"top":"left",_=b==="y"?"bottom":"right",B=T+g[O],q=T-g[_];T=by(B,T,q)}if(u){const O=y==="y"?"top":"left",_=y==="y"?"bottom":"right",B=C+g[O],q=C-g[_];C=by(B,C,q)}const k=d.fn({...e,[b]:T,[y]:C});return{...k,data:{x:k.x-n,y:k.y-r,enabled:{[b]:l,[y]:u}}}}}};function el(){return typeof window<"u"}function Er(i){return Db(i)?(i.nodeName||"").toLowerCase():"#document"}function Kt(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function Pn(i){var e;return(e=(Db(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function Db(i){return el()?i instanceof Node||i instanceof Kt(i).Node:!1}function vn(i){return el()?i instanceof Element||i instanceof Kt(i).Element:!1}function Dn(i){return el()?i instanceof HTMLElement||i instanceof Kt(i).HTMLElement:!1}function Ty(i){return!el()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Kt(i).ShadowRoot}function Gs(i){const{overflow:e,overflowX:n,overflowY:r,display:o}=yn(i);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function qR(i){return["table","td","th"].includes(Er(i))}function tl(i){return[":popover-open",":modal"].some(e=>{try{return i.matches(e)}catch{return!1}})}function rh(i){const e=sh(),n=vn(i)?yn(i):i;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function VR(i){let e=Ii(i);for(;Dn(e)&&!Sr(e);){if(rh(e))return e;if(tl(e))return null;e=Ii(e)}return null}function sh(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Sr(i){return["html","body","#document"].includes(Er(i))}function yn(i){return Kt(i).getComputedStyle(i)}function nl(i){return vn(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function Ii(i){if(Er(i)==="html")return i;const e=i.assignedSlot||i.parentNode||Ty(i)&&i.host||Pn(i);return Ty(e)?e.host:e}function Mb(i){const e=Ii(i);return Sr(e)?i.ownerDocument?i.ownerDocument.body:i.body:Dn(e)&&Gs(e)?e:Mb(e)}function Vs(i,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=Mb(i),l=o===((r=i.ownerDocument)==null?void 0:r.body),u=Kt(o);if(l){const d=xf(u);return e.concat(u,u.visualViewport||[],Gs(o)?o:[],d&&n?Vs(d):[])}return e.concat(o,Vs(o,[],n))}function xf(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function xb(i){const e=yn(i);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=Dn(i),l=o?i.offsetWidth:n,u=o?i.offsetHeight:r,d=zc(n)!==l||zc(r)!==u;return d&&(n=l,r=u),{width:n,height:r,$:d}}function oh(i){return vn(i)?i:i.contextElement}function pr(i){const e=oh(i);if(!Dn(e))return On(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:l}=xb(e);let u=(l?zc(n.width):n.width)/r,d=(l?zc(n.height):n.height)/o;return(!u||!Number.isFinite(u))&&(u=1),(!d||!Number.isFinite(d))&&(d=1),{x:u,y:d}}const HR=On(0);function Pb(i){const e=Kt(i);return!sh()||!e.visualViewport?HR:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function GR(i,e,n){return e===void 0&&(e=!1),!n||e&&n!==Kt(i)?!1:e}function ha(i,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=i.getBoundingClientRect(),l=oh(i);let u=On(1);e&&(r?vn(r)&&(u=pr(r)):u=pr(i));const d=GR(l,n,r)?Pb(l):On(0);let h=(o.left+d.x)/u.x,m=(o.top+d.y)/u.y,g=o.width/u.x,y=o.height/u.y;if(l){const b=Kt(l),T=r&&vn(r)?Kt(r):r;let C=b,k=xf(C);for(;k&&r&&T!==C;){const O=pr(k),_=k.getBoundingClientRect(),B=yn(k),q=_.left+(k.clientLeft+parseFloat(B.paddingLeft))*O.x,P=_.top+(k.clientTop+parseFloat(B.paddingTop))*O.y;h*=O.x,m*=O.y,g*=O.x,y*=O.y,h+=q,m+=P,C=Kt(k),k=xf(C)}}return Vc({width:g,height:y,x:h,y:m})}function ch(i,e){const n=nl(i).scrollLeft;return e?e.left+n:ha(Pn(i)).left+n}function Nb(i,e,n){n===void 0&&(n=!1);const r=i.getBoundingClientRect(),o=r.left+e.scrollLeft-(n?0:ch(i,r)),l=r.top+e.scrollTop;return{x:o,y:l}}function FR(i){let{elements:e,rect:n,offsetParent:r,strategy:o}=i;const l=o==="fixed",u=Pn(r),d=e?tl(e.floating):!1;if(r===u||d&&l)return n;let h={scrollLeft:0,scrollTop:0},m=On(1);const g=On(0),y=Dn(r);if((y||!y&&!l)&&((Er(r)!=="body"||Gs(u))&&(h=nl(r)),Dn(r))){const T=ha(r);m=pr(r),g.x=T.x+r.clientLeft,g.y=T.y+r.clientTop}const b=u&&!y&&!l?Nb(u,h,!0):On(0);return{width:n.width*m.x,height:n.height*m.y,x:n.x*m.x-h.scrollLeft*m.x+g.x+b.x,y:n.y*m.y-h.scrollTop*m.y+g.y+b.y}}function YR(i){return Array.from(i.getClientRects())}function KR(i){const e=Pn(i),n=nl(i),r=i.ownerDocument.body,o=ca(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),l=ca(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let u=-n.scrollLeft+ch(i);const d=-n.scrollTop;return yn(r).direction==="rtl"&&(u+=ca(e.clientWidth,r.clientWidth)-o),{width:o,height:l,x:u,y:d}}function QR(i,e){const n=Kt(i),r=Pn(i),o=n.visualViewport;let l=r.clientWidth,u=r.clientHeight,d=0,h=0;if(o){l=o.width,u=o.height;const m=sh();(!m||m&&e==="fixed")&&(d=o.offsetLeft,h=o.offsetTop)}return{width:l,height:u,x:d,y:h}}function XR(i,e){const n=ha(i,!0,e==="fixed"),r=n.top+i.clientTop,o=n.left+i.clientLeft,l=Dn(i)?pr(i):On(1),u=i.clientWidth*l.x,d=i.clientHeight*l.y,h=o*l.x,m=r*l.y;return{width:u,height:d,x:h,y:m}}function ky(i,e,n){let r;if(e==="viewport")r=QR(i,n);else if(e==="document")r=KR(Pn(i));else if(vn(e))r=XR(e,n);else{const o=Pb(i);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return Vc(r)}function Ub(i,e){const n=Ii(i);return n===e||!vn(n)||Sr(n)?!1:yn(n).position==="fixed"||Ub(n,e)}function ZR(i,e){const n=e.get(i);if(n)return n;let r=Vs(i,[],!1).filter(d=>vn(d)&&Er(d)!=="body"),o=null;const l=yn(i).position==="fixed";let u=l?Ii(i):i;for(;vn(u)&&!Sr(u);){const d=yn(u),h=rh(u);!h&&d.position==="fixed"&&(o=null),(l?!h&&!o:!h&&d.position==="static"&&o&&["absolute","fixed"].includes(o.position)||Gs(u)&&!h&&Ub(i,u))?r=r.filter(m=>m!==u):o=d,u=Ii(u)}return e.set(i,r),r}function JR(i){let{element:e,boundary:n,rootBoundary:r,strategy:o}=i;const l=[...n==="clippingAncestors"?tl(e)?[]:ZR(e,this._c):[].concat(n),r],u=l[0],d=l.reduce((h,m)=>{const g=ky(e,m,o);return h.top=ca(g.top,h.top),h.right=Bc(g.right,h.right),h.bottom=Bc(g.bottom,h.bottom),h.left=ca(g.left,h.left),h},ky(e,u,o));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function WR(i){const{width:e,height:n}=xb(i);return{width:e,height:n}}function $R(i,e,n){const r=Dn(e),o=Pn(e),l=n==="fixed",u=ha(i,!0,l,e);let d={scrollLeft:0,scrollTop:0};const h=On(0);if(r||!r&&!l)if((Er(e)!=="body"||Gs(o))&&(d=nl(e)),r){const b=ha(e,!0,l,e);h.x=b.x+e.clientLeft,h.y=b.y+e.clientTop}else o&&(h.x=ch(o));const m=o&&!r&&!l?Nb(o,d):On(0),g=u.left+d.scrollLeft-h.x-m.x,y=u.top+d.scrollTop-h.y-m.y;return{x:g,y,width:u.width,height:u.height}}function Yd(i){return yn(i).position==="static"}function Cy(i,e){if(!Dn(i)||yn(i).position==="fixed")return null;if(e)return e(i);let n=i.offsetParent;return Pn(i)===n&&(n=n.ownerDocument.body),n}function Lb(i,e){const n=Kt(i);if(tl(i))return n;if(!Dn(i)){let o=Ii(i);for(;o&&!Sr(o);){if(vn(o)&&!Yd(o))return o;o=Ii(o)}return n}let r=Cy(i,e);for(;r&&qR(r)&&Yd(r);)r=Cy(r,e);return r&&Sr(r)&&Yd(r)&&!rh(r)?n:r||VR(i)||n}const e_=async function(i){const e=this.getOffsetParent||Lb,n=this.getDimensions,r=await n(i.floating);return{reference:$R(i.reference,await e(i.floating),i.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function t_(i){return yn(i).direction==="rtl"}const n_={convertOffsetParentRelativeRectToViewportRelativeRect:FR,getDocumentElement:Pn,getClippingRect:JR,getOffsetParent:Lb,getElementRects:e_,getClientRects:YR,getDimensions:WR,getScale:pr,isElement:vn,isRTL:t_};function Ib(i,e){return i.x===e.x&&i.y===e.y&&i.width===e.width&&i.height===e.height}function i_(i,e){let n=null,r;const o=Pn(i);function l(){var d;clearTimeout(r),(d=n)==null||d.disconnect(),n=null}function u(d,h){d===void 0&&(d=!1),h===void 0&&(h=1),l();const m=i.getBoundingClientRect(),{left:g,top:y,width:b,height:T}=m;if(d||e(),!b||!T)return;const C=fc(y),k=fc(o.clientWidth-(g+b)),O=fc(o.clientHeight-(y+T)),_=fc(g),B={rootMargin:-C+"px "+-k+"px "+-O+"px "+-_+"px",threshold:ca(0,Bc(1,h))||1};let q=!0;function P(E){const z=E[0].intersectionRatio;if(z!==h){if(!q)return u();z?u(!1,z):r=setTimeout(()=>{u(!1,1e-7)},1e3)}z===1&&!Ib(m,i.getBoundingClientRect())&&u(),q=!1}try{n=new IntersectionObserver(P,{...B,root:o.ownerDocument})}catch{n=new IntersectionObserver(P,B)}n.observe(i)}return u(!0),l}function a_(i,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:l=!0,elementResize:u=typeof ResizeObserver=="function",layoutShift:d=typeof IntersectionObserver=="function",animationFrame:h=!1}=r,m=oh(i),g=o||l?[...m?Vs(m):[],...Vs(e)]:[];g.forEach(_=>{o&&_.addEventListener("scroll",n,{passive:!0}),l&&_.addEventListener("resize",n)});const y=m&&d?i_(m,n):null;let b=-1,T=null;u&&(T=new ResizeObserver(_=>{let[B]=_;B&&B.target===m&&T&&(T.unobserve(e),cancelAnimationFrame(b),b=requestAnimationFrame(()=>{var q;(q=T)==null||q.observe(e)})),n()}),m&&!h&&T.observe(m),T.observe(e));let C,k=h?ha(i):null;h&&O();function O(){const _=ha(i);k&&!Ib(k,_)&&n(),k=_,C=requestAnimationFrame(O)}return n(),()=>{var _;g.forEach(B=>{o&&B.removeEventListener("scroll",n),l&&B.removeEventListener("resize",n)}),y==null||y(),(_=T)==null||_.disconnect(),T=null,h&&cancelAnimationFrame(C)}}const r_=BR,s_=zR,o_=IR,c_=(i,e,n)=>{const r=new Map,o={platform:n_,...n},l={...o.platform,_c:r};return LR(i,e,{...o,platform:l})};var hc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function l_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Pf={exports:{}},u_=Pf.exports,Ey;function d_(){return Ey||(Ey=1,function(i){(function(e,n){i.exports?i.exports=n():e.log=n()})(u_,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},u=null;function d(k,O){var _=k[O];if(typeof _.bind=="function")return _.bind(k);try{return Function.prototype.bind.call(_,k)}catch{return function(){return Function.prototype.apply.apply(_,[k,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function m(k){return k==="debug"&&(k="log"),typeof console===n?!1:k==="trace"&&r?h:console[k]!==void 0?d(console,k):console.log!==void 0?d(console,"log"):e}function g(){for(var k=this.getLevel(),O=0;O<o.length;O++){var _=o[O];this[_]=O<k?e:this.methodFactory(_,k,this.name)}if(this.log=this.debug,typeof console===n&&k<this.levels.SILENT)return"No console available for logging"}function y(k){return function(){typeof console!==n&&(g.call(this),this[k].apply(this,arguments))}}function b(k,O,_){return m(k)||y.apply(this,arguments)}function T(k,O){var _=this,B,q,P,E="loglevel";typeof k=="string"?E+=":"+k:typeof k=="symbol"&&(E=void 0);function z($){var re=(o[$]||"silent").toUpperCase();if(!(typeof window===n||!E)){try{window.localStorage[E]=re;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+re+";"}catch{}}}function J(){var $;if(!(typeof window===n||!E)){try{$=window.localStorage[E]}catch{}if(typeof $===n)try{var re=window.document.cookie,Ue=encodeURIComponent(E),Le=re.indexOf(Ue+"=");Le!==-1&&($=/^([^;]+)/.exec(re.slice(Le+Ue.length+1))[1])}catch{}return _.levels[$]===void 0&&($=void 0),$}}function ne(){if(!(typeof window===n||!E)){try{window.localStorage.removeItem(E)}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function oe($){var re=$;if(typeof re=="string"&&_.levels[re.toUpperCase()]!==void 0&&(re=_.levels[re.toUpperCase()]),typeof re=="number"&&re>=0&&re<=_.levels.SILENT)return re;throw new TypeError("log.setLevel() called with invalid level: "+$)}_.name=k,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=O||b,_.getLevel=function(){return P??q??B},_.setLevel=function($,re){return P=oe($),re!==!1&&z(P),g.call(_)},_.setDefaultLevel=function($){q=oe($),J()||_.setLevel($,!1)},_.resetLevel=function(){P=null,ne(),g.call(_)},_.enableAll=function($){_.setLevel(_.levels.TRACE,$)},_.disableAll=function($){_.setLevel(_.levels.SILENT,$)},_.rebuild=function(){if(u!==_&&(B=oe(u.getLevel())),g.call(_),u===_)for(var $ in l)l[$].rebuild()},B=oe(u?u.getLevel():"WARN");var se=J();se!=null&&(P=oe(se)),g.call(_)}u=new T,u.getLogger=function(k){if(typeof k!="symbol"&&typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");var O=l[k];return O||(O=l[k]=new T(k,u.methodFactory)),O};var C=typeof window!==n?window.log:void 0;return u.noConflict=function(){return typeof window!==n&&window.log===u&&(window.log=C),u},u.getLoggers=function(){return l},u.default=u,u})}(Pf)),Pf.exports}var f_=d_();const h_=l_(f_);var Nf=function(i,e){return Nf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},Nf(i,e)};function ni(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nf(i,e);function n(){this.constructor=i}i.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function m_(i,e,n,r){function o(l){return l instanceof n?l:new n(function(u){u(l)})}return new(n||(n=Promise))(function(l,u){function d(g){try{m(r.next(g))}catch(y){u(y)}}function h(g){try{m(r.throw(g))}catch(y){u(y)}}function m(g){g.done?l(g.value):o(g.value).then(d,h)}m((r=r.apply(i,[])).next())})}function jb(i,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,o,l,u=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return u.next=d(0),u.throw=d(1),u.return=d(2),typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function d(m){return function(g){return h([m,g])}}function h(m){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,m[0]&&(n=0)),n;)try{if(r=1,o&&(l=m[0]&2?o.return:m[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,m[1])).done)return l;switch(o=0,l&&(m=[m[0]&2,l.value]),m[0]){case 0:case 1:l=m;break;case 4:return n.label++,{value:m[1],done:!1};case 5:n.label++,o=m[1],m=[0];continue;case 7:m=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(m[0]===6||m[0]===2)){n=0;continue}if(m[0]===3&&(!l||m[1]>l[0]&&m[1]<l[3])){n.label=m[1];break}if(m[0]===6&&n.label<l[1]){n.label=l[1],l=m;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(m);break}l[2]&&n.ops.pop(),n.trys.pop();continue}m=e.call(i,n)}catch(g){m=[6,g],o=0}finally{r=l=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function Tr(i){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&i[e],r=0;if(n)return n.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Hc(i,e){var n=typeof Symbol=="function"&&i[Symbol.iterator];if(!n)return i;var r=n.call(i),o,l=[],u;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)l.push(o.value)}catch(d){u={error:d}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(u)throw u.error}}return l}function Gc(i,e,n){if(arguments.length===2)for(var r=0,o=e.length,l;r<o;r++)(l||!(r in e))&&(l||(l=Array.prototype.slice.call(e,0,r)),l[r]=e[r]);return i.concat(l||Array.prototype.slice.call(e))}function gr(i){return this instanceof gr?(this.v=i,this):new gr(i)}function p_(i,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(i,e||[]),o,l=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",u),o[Symbol.asyncIterator]=function(){return this},o;function u(T){return function(C){return Promise.resolve(C).then(T,y)}}function d(T,C){r[T]&&(o[T]=function(k){return new Promise(function(O,_){l.push([T,k,O,_])>1||h(T,k)})},C&&(o[T]=C(o[T])))}function h(T,C){try{m(r[T](C))}catch(k){b(l[0][3],k)}}function m(T){T.value instanceof gr?Promise.resolve(T.value.v).then(g,y):b(l[0][2],T)}function g(T){h("next",T)}function y(T){h("throw",T)}function b(T,C){T(C),l.shift(),l.length&&h(l[0][0],l[0][1])}}function g_(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],n;return e?e.call(i):(i=typeof Tr=="function"?Tr(i):i[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(l){n[l]=i[l]&&function(u){return new Promise(function(d,h){u=i[l](u),o(d,h,u.done,u.value)})}}function o(l,u,d,h){Promise.resolve(h).then(function(m){l({value:m,done:d})},u)}}function dt(i){return typeof i=="function"}function lh(i){var e=function(r){Error.call(r),r.stack=new Error().stack},n=i(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Kd=lh(function(i){return function(e){i(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Fc(i,e){if(i){var n=i.indexOf(e);0<=n&&i.splice(n,1)}}var Fs=function(){function i(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return i.prototype.unsubscribe=function(){var e,n,r,o,l;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var d=Tr(u),h=d.next();!h.done;h=d.next()){var m=h.value;m.remove(this)}}catch(k){e={error:k}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}else u.remove(this);var g=this.initialTeardown;if(dt(g))try{g()}catch(k){l=k instanceof Kd?k.errors:[k]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var b=Tr(y),T=b.next();!T.done;T=b.next()){var C=T.value;try{Ry(C)}catch(k){l=l??[],k instanceof Kd?l=Gc(Gc([],Hc(l)),Hc(k.errors)):l.push(k)}}}catch(k){r={error:k}}finally{try{T&&!T.done&&(o=b.return)&&o.call(b)}finally{if(r)throw r.error}}}if(l)throw new Kd(l)}},i.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Ry(e);else{if(e instanceof i){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},i.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},i.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},i.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Fc(n,e)},i.prototype.remove=function(e){var n=this._finalizers;n&&Fc(n,e),e instanceof i&&e._removeParent(this)},i.EMPTY=function(){var e=new i;return e.closed=!0,e}(),i}(),Bb=Fs.EMPTY;function zb(i){return i instanceof Fs||i&&"closed"in i&&dt(i.remove)&&dt(i.add)&&dt(i.unsubscribe)}function Ry(i){dt(i)?i():i.unsubscribe()}var v_={Promise:void 0},y_={setTimeout:function(i,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Gc([i,e],Hc(n)))},clearTimeout:function(i){return clearTimeout(i)},delegate:void 0};function qb(i){y_.setTimeout(function(){throw i})}function _y(){}function Dc(i){i()}var uh=function(i){ni(e,i);function e(n){var r=i.call(this)||this;return r.isStopped=!1,n?(r.destination=n,zb(n)&&n.add(r)):r.destination=T_,r}return e.create=function(n,r,o){return new Uf(n,r,o)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Fs),b_=function(){function i(e){this.partialObserver=e}return i.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){mc(r)}},i.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){mc(r)}else mc(e)},i.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){mc(n)}},i}(),Uf=function(i){ni(e,i);function e(n,r,o){var l=i.call(this)||this,u;return dt(n)||!n?u={next:n??void 0,error:r??void 0,complete:o??void 0}:u=n,l.destination=new b_(u),l}return e}(uh);function mc(i){qb(i)}function S_(i){throw i}var T_={closed:!0,next:_y,error:S_,complete:_y},dh=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Vb(i){return i}function k_(i){return i.length===0?Vb:i.length===1?i[0]:function(e){return i.reduce(function(n,r){return r(n)},e)}}var vt=function(){function i(e){e&&(this._subscribe=e)}return i.prototype.lift=function(e){var n=new i;return n.source=this,n.operator=e,n},i.prototype.subscribe=function(e,n,r){var o=this,l=E_(e)?e:new Uf(e,n,r);return Dc(function(){var u=o,d=u.operator,h=u.source;l.add(d?d.call(l,h):h?o._subscribe(l):o._trySubscribe(l))}),l},i.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},i.prototype.forEach=function(e,n){var r=this;return n=wy(n),new n(function(o,l){var u=new Uf({next:function(d){try{e(d)}catch(h){l(h),u.unsubscribe()}},error:l,complete:o});r.subscribe(u)})},i.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},i.prototype[dh]=function(){return this},i.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return k_(e)(this)},i.prototype.toPromise=function(e){var n=this;return e=wy(e),new e(function(r,o){var l;n.subscribe(function(u){return l=u},function(u){return o(u)},function(){return r(l)})})},i.create=function(e){return new i(e)},i}();function wy(i){var e;return(e=i??v_.Promise)!==null&&e!==void 0?e:Promise}function C_(i){return i&&dt(i.next)&&dt(i.error)&&dt(i.complete)}function E_(i){return i&&i instanceof uh||C_(i)&&zb(i)}function R_(i){return dt(i==null?void 0:i.lift)}function pa(i){return function(e){if(R_(e))return e.lift(function(n){try{return i(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Hs(i,e,n,r,o){return new __(i,e,n,r,o)}var __=function(i){ni(e,i);function e(n,r,o,l,u,d){var h=i.call(this,n)||this;return h.onFinalize=u,h.shouldUnsubscribe=d,h._next=r?function(m){try{r(m)}catch(g){n.error(g)}}:i.prototype._next,h._error=l?function(m){try{l(m)}catch(g){n.error(g)}finally{this.unsubscribe()}}:i.prototype._error,h._complete=o?function(){try{o()}catch(m){n.error(m)}finally{this.unsubscribe()}}:i.prototype._complete,h}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;i.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(uh),w_=lh(function(i){return function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),kr=function(i){ni(e,i);function e(){var n=i.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Oy(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new w_},e.prototype.next=function(n){var r=this;Dc(function(){var o,l;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var u=Tr(r.currentObservers),d=u.next();!d.done;d=u.next()){var h=d.value;h.next(n)}}catch(m){o={error:m}}finally{try{d&&!d.done&&(l=u.return)&&l.call(u)}finally{if(o)throw o.error}}}})},e.prototype.error=function(n){var r=this;Dc(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var o=r.observers;o.length;)o.shift().error(n)}})},e.prototype.complete=function(){var n=this;Dc(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),i.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,o=this,l=o.hasError,u=o.isStopped,d=o.observers;return l||u?Bb:(this.currentObservers=null,d.push(n),new Fs(function(){r.currentObservers=null,Fc(d,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,o=r.hasError,l=r.thrownError,u=r.isStopped;o?n.error(l):u&&n.complete()},e.prototype.asObservable=function(){var n=new vt;return n.source=this,n},e.create=function(n,r){return new Oy(n,r)},e}(vt),Oy=function(i){ni(e,i);function e(n,r){var o=i.call(this)||this;return o.destination=n,o.source=r,o}return e.prototype.next=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,n)},e.prototype.error=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&o!==void 0?o:Bb},e}(kr),O_=function(i){ni(e,i);function e(n){var r=i.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=i.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,o=n.thrownError,l=n._value;if(r)throw o;return this._throwIfClosed(),l},e.prototype.next=function(n){i.prototype.next.call(this,this._value=n)},e}(kr),A_={now:function(){return Date.now()}},D_=function(i){ni(e,i);function e(n,r){return i.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Fs),Ay={setInterval:function(i,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,Gc([i,e],Hc(n)))},clearInterval:function(i){return clearInterval(i)},delegate:void 0},M_=function(i){ni(e,i);function e(n,r){var o=i.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var l=this.id,u=this.scheduler;return l!=null&&(this.id=this.recycleAsyncId(u,l,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(u,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),Ay.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&Ay.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,l;try{this.work(n)}catch(u){o=!0,l=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),l},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,l=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Fc(l,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,i.prototype.unsubscribe.call(this)}},e}(D_),Dy=function(){function i(e,n){n===void 0&&(n=i.now),this.schedulerActionCtor=e,this.now=n}return i.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},i.now=A_.now,i}(),x_=function(i){ni(e,i);function e(n,r){r===void 0&&(r=Dy.now);var o=i.call(this,n,r)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(Dy);new x_(M_);function P_(i){return i&&dt(i.schedule)}function N_(i){return i[i.length-1]}function Hb(i){return P_(N_(i))?i.pop():void 0}var Gb=function(i){return i&&typeof i.length=="number"&&typeof i!="function"};function Fb(i){return dt(i==null?void 0:i.then)}function Yb(i){return dt(i[dh])}function Kb(i){return Symbol.asyncIterator&&dt(i==null?void 0:i[Symbol.asyncIterator])}function Qb(i){return new TypeError("You provided "+(i!==null&&typeof i=="object"?"an invalid object":"'"+i+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function U_(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Xb=U_();function Zb(i){return dt(i==null?void 0:i[Xb])}function Jb(i){return p_(this,arguments,function(){var e,n,r,o;return jb(this,function(l){switch(l.label){case 0:e=i.getReader(),l.label=1;case 1:l.trys.push([1,,9,10]),l.label=2;case 2:return[4,gr(e.read())];case 3:return n=l.sent(),r=n.value,o=n.done,o?[4,gr(void 0)]:[3,5];case 4:return[2,l.sent()];case 5:return[4,gr(r)];case 6:return[4,l.sent()];case 7:return l.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Wb(i){return dt(i==null?void 0:i.getReader)}function Ys(i){if(i instanceof vt)return i;if(i!=null){if(Yb(i))return L_(i);if(Gb(i))return I_(i);if(Fb(i))return j_(i);if(Kb(i))return $b(i);if(Zb(i))return B_(i);if(Wb(i))return z_(i)}throw Qb(i)}function L_(i){return new vt(function(e){var n=i[dh]();if(dt(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function I_(i){return new vt(function(e){for(var n=0;n<i.length&&!e.closed;n++)e.next(i[n]);e.complete()})}function j_(i){return new vt(function(e){i.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,qb)})}function B_(i){return new vt(function(e){var n,r;try{for(var o=Tr(i),l=o.next();!l.done;l=o.next()){var u=l.value;if(e.next(u),e.closed)return}}catch(d){n={error:d}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()})}function $b(i){return new vt(function(e){q_(i,e).catch(function(n){return e.error(n)})})}function z_(i){return $b(Jb(i))}function q_(i,e){var n,r,o,l;return m_(this,void 0,void 0,function(){var u,d;return jb(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),n=g_(i),h.label=1;case 1:return[4,n.next()];case 2:if(r=h.sent(),!!r.done)return[3,4];if(u=r.value,e.next(u),e.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return d=h.sent(),o={error:d},[3,11];case 6:return h.trys.push([6,,9,10]),r&&!r.done&&(l=n.return)?[4,l.call(n)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function la(i,e,n,r,o){r===void 0&&(r=0),o===void 0&&(o=!1);var l=e.schedule(function(){n(),o?i.add(this.schedule(null,r)):this.unsubscribe()},r);if(i.add(l),!o)return l}function eS(i,e){return e===void 0&&(e=0),pa(function(n,r){n.subscribe(Hs(r,function(o){return la(r,i,function(){return r.next(o)},e)},function(){return la(r,i,function(){return r.complete()},e)},function(o){return la(r,i,function(){return r.error(o)},e)}))})}function tS(i,e){return e===void 0&&(e=0),pa(function(n,r){r.add(i.schedule(function(){return n.subscribe(r)},e))})}function V_(i,e){return Ys(i).pipe(tS(e),eS(e))}function H_(i,e){return Ys(i).pipe(tS(e),eS(e))}function G_(i,e){return new vt(function(n){var r=0;return e.schedule(function(){r===i.length?n.complete():(n.next(i[r++]),n.closed||this.schedule())})})}function F_(i,e){return new vt(function(n){var r;return la(n,e,function(){r=i[Xb](),la(n,e,function(){var o,l,u;try{o=r.next(),l=o.value,u=o.done}catch(d){n.error(d);return}u?n.complete():n.next(l)},0,!0)}),function(){return dt(r==null?void 0:r.return)&&r.return()}})}function nS(i,e){if(!i)throw new Error("Iterable cannot be null");return new vt(function(n){la(n,e,function(){var r=i[Symbol.asyncIterator]();la(n,e,function(){r.next().then(function(o){o.done?n.complete():n.next(o.value)})},0,!0)})})}function Y_(i,e){return nS(Jb(i),e)}function K_(i,e){if(i!=null){if(Yb(i))return V_(i,e);if(Gb(i))return G_(i,e);if(Fb(i))return H_(i,e);if(Kb(i))return nS(i,e);if(Zb(i))return F_(i,e);if(Wb(i))return Y_(i,e)}throw Qb(i)}function Q_(i,e){return e?K_(i,e):Ys(i)}lh(function(i){return function(e){e===void 0&&(e=null),i(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Qt(i,e){return pa(function(n,r){var o=0;n.subscribe(Hs(r,function(l){r.next(i.call(e,l,o++))}))})}function X_(i,e,n,r,o,l,u,d){var h=[],m=0,g=0,y=!1,b=function(){y&&!h.length&&!m&&e.complete()},T=function(k){return m<r?C(k):h.push(k)},C=function(k){m++;var O=!1;Ys(n(k,g++)).subscribe(Hs(e,function(_){e.next(_)},function(){O=!0},void 0,function(){if(O)try{m--;for(var _=function(){var B=h.shift();u||C(B)};h.length&&m<r;)_();b()}catch(B){e.error(B)}}))};return i.subscribe(Hs(e,T,function(){y=!0,b()})),function(){}}function iS(i,e,n){return n===void 0&&(n=1/0),dt(e)?iS(function(r,o){return Qt(function(l,u){return e(r,l,o,u)})(Ys(i(r,o)))},n):(typeof e=="number"&&(n=e),pa(function(r,o){return X_(r,o,i,n)}))}function Z_(i){return iS(Vb,i)}function J_(){return Z_(1)}function Lf(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return J_()(Q_(i,Hb(i)))}function W_(i,e){return pa(function(n,r){var o=0;n.subscribe(Hs(r,function(l){return i.call(e,l,o++)&&r.next(l)}))})}function $_(i){return pa(function(e,n){try{e.subscribe(n)}finally{n.add(i)}})}function Nn(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var n=Hb(i);return pa(function(r,o){(n?Lf(i,r,n):Lf(i,r)).subscribe(o)})}var ew=Object.defineProperty,tw=Object.defineProperties,nw=Object.getOwnPropertyDescriptors,My=Object.getOwnPropertySymbols,iw=Object.prototype.hasOwnProperty,aw=Object.prototype.propertyIsEnumerable,xy=(i,e,n)=>e in i?ew(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,If=(i,e)=>{for(var n in e||(e={}))iw.call(e,n)&&xy(i,n,e[n]);if(My)for(var n of My(e))aw.call(e,n)&&xy(i,n,e[n]);return i},rw=(i,e)=>tw(i,nw(e)),ga=(i,e,n)=>new Promise((r,o)=>{var l=h=>{try{d(n.next(h))}catch(m){o(m)}},u=h=>{try{d(n.throw(h))}catch(m){o(m)}},d=h=>h.done?r(h.value):Promise.resolve(h.value).then(l,u);d((n=n.apply(i,e)).next())}),aS="lk";function fh(i){return typeof i>"u"?!1:sw(i)||ow(i)}function sw(i){var e;return i?i.hasOwnProperty("participant")&&i.hasOwnProperty("source")&&i.hasOwnProperty("track")&&typeof((e=i.publication)==null?void 0:e.track)<"u":!1}function ow(i){return i?i.hasOwnProperty("participant")&&i.hasOwnProperty("source")&&i.hasOwnProperty("publication")&&typeof i.publication<"u":!1}function cw(i){return i?i.hasOwnProperty("participant")&&i.hasOwnProperty("source")&&typeof i.publication>"u":!1}function rS(i){if(typeof i=="string"||typeof i=="number")return`${i}`;if(cw(i))return`${i.participant.identity}_${i.source}_placeholder`;if(fh(i))return`${i.participant.identity}_${i.publication.source}_${i.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${i}`)}function lw(i,e,n){return a_(i,e,()=>ga(this,null,function*(){const{x:r,y:o}=yield c_(i,e,{placement:"top",middleware:[r_(6),o_(),s_({padding:5})]});n==null||n(r,o)}))}function uw(i,e){return!i.contains(e.target)}var dw=[H.ConnectionStateChanged,H.RoomMetadataChanged,H.ActiveSpeakersChanged,H.ConnectionQualityChanged,H.ParticipantConnected,H.ParticipantDisconnected,H.ParticipantPermissionsChanged,H.ParticipantMetadataChanged,H.ParticipantNameChanged,H.ParticipantAttributesChanged,H.TrackMuted,H.TrackUnmuted,H.TrackPublished,H.TrackUnpublished,H.TrackStreamStateChanged,H.TrackSubscriptionFailed,H.TrackSubscriptionPermissionChanged,H.TrackSubscriptionStatusChanged],sS=[...dw,H.LocalTrackPublished,H.LocalTrackUnpublished],fw=[Q.TrackPublished,Q.TrackUnpublished,Q.TrackMuted,Q.TrackUnmuted,Q.TrackStreamStateChanged,Q.TrackSubscribed,Q.TrackUnsubscribed,Q.TrackSubscriptionPermissionChanged,Q.TrackSubscriptionFailed,Q.LocalTrackPublished,Q.LocalTrackUnpublished],hw=[Q.ConnectionQualityChanged,Q.IsSpeakingChanged,Q.ParticipantMetadataChanged,Q.ParticipantPermissionsChanged,Q.TrackMuted,Q.TrackUnmuted,Q.TrackPublished,Q.TrackUnpublished,Q.TrackStreamStateChanged,Q.TrackSubscriptionFailed,Q.TrackSubscriptionPermissionChanged,Q.TrackSubscriptionStatusChanged];[...hw,Q.LocalTrackPublished,Q.LocalTrackUnpublished];var Ne=h_.getLogger("lk-components-js");Ne.setDefaultLevel("WARN");function mw(i,e){var n;return rw(If({},i),{receivedAtMediaTimestamp:(n=e.rtpTimestamp)!=null?n:0,receivedAt:e.timestamp})}function pw(i,e,n){return[...i,...e].reduceRight((r,o)=>(r.find(l=>l.id===o.id)||r.unshift(o),r),[]).slice(0-n)}function oS(i){return typeof i=="object"}function cS(i){return Array.isArray(i)&&i.filter(oS).length>0}function va(i){return`${aS}-${i}`}function gw(i){const e=jf(i),n=hh(i.participant).pipe(Qt(()=>jf(i)),Nn(e));return{className:va(i.source===G.Source.Camera||i.source===G.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function jf(i){if(fh(i))return i.publication;{const{source:e,name:n,participant:r}=i;if(e&&n)return r.getTrackPublications().find(o=>o.source===e&&o.trackName===n);if(n)return r.getTrackPublicationByName(n);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function il(i,...e){return new vt(n=>{const r=()=>{n.next(i)};return e.forEach(o=>{i.on(o,r)}),()=>{e.forEach(o=>{i.off(o,r)})}}).pipe(Nn(i))}function lS(i,e){return new vt(n=>{const r=(...o)=>{n.next(o)};return i.on(e,r),()=>{i.off(e,r)}})}function vw(i){return lS(i,H.ConnectionStateChanged).pipe(Qt(([e])=>e),Nn(i.state))}function yw(i,e,n=!0){var r;const o=()=>ga(this,null,function*(){try{const d=yield ti.getLocalDevices(i,n);l.next(d)}catch(d){e==null||e(d)}}),l=new kr,u=l.pipe($_(()=>{var d;(d=navigator==null?void 0:navigator.mediaDevices)==null||d.removeEventListener("devicechange",o)}));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(r=navigator==null?void 0:navigator.mediaDevices)==null||r.addEventListener("devicechange",o)}return Lf(ti.getLocalDevices(i,n).catch(d=>(e==null||e(d),[])),u)}function bw(i){return il(i,H.AudioPlaybackStatusChanged).pipe(Qt(e=>({canPlayAudio:e.canPlaybackAudio})))}function Sw(i){return il(i,H.VideoPlaybackStatusChanged).pipe(Qt(e=>({canPlayVideo:e.canPlaybackVideo})))}function Tw(i,e){return lS(i,H.ActiveDeviceChanged).pipe(W_(([n])=>n===e),Qt(([n,r])=>(Ne.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:n,deviceId:r}),r)))}function uS(i,...e){return new vt(n=>{const r=()=>{n.next(i)};return e.forEach(o=>{i.on(o,r)}),()=>{e.forEach(o=>{i.off(o,r)})}}).pipe(Nn(i))}function hh(i){return uS(i,Q.TrackMuted,Q.TrackUnmuted,Q.ParticipantPermissionsChanged,Q.TrackPublished,Q.TrackUnpublished,Q.LocalTrackPublished,Q.LocalTrackUnpublished,Q.MediaDevicesError,Q.TrackSubscriptionStatusChanged).pipe(Qt(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:r,isScreenShareEnabled:o}=e,l=e.getTrackPublication(G.Source.Microphone),u=e.getTrackPublication(G.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:n,isScreenShareEnabled:o,cameraTrack:u,microphoneTrack:l,participant:e}}))}function dS(i,e){return new vt(n=>{const r=(...o)=>{n.next(o)};return i.on(e,r),()=>{i.off(e,r)}})}function kw(i,e={}){var n;let r;const o=new vt(h=>(r=h,()=>d.unsubscribe())).pipe(Nn(Array.from(i.remoteParticipants.values()))),l=(n=e.additionalRoomEvents)!=null?n:sS,u=Array.from(new Set([H.ParticipantConnected,H.ParticipantDisconnected,H.ConnectionStateChanged,...l])),d=il(i,...u).subscribe(h=>r==null?void 0:r.next(Array.from(h.remoteParticipants.values())));return i.remoteParticipants.size>0&&(r==null||r.next(Array.from(i.remoteParticipants.values()))),o}function Cw(i){return dS(i,Q.ParticipantPermissionsChanged).pipe(Qt(()=>i.permissions),Nn(i.permissions))}function Py(i){return typeof i>"u"?new vt:dS(i,Q.AttributesChanged).pipe(Qt(([e])=>({changed:e,attributes:i.attributes})),Nn({changed:i.attributes,attributes:i.attributes}))}function Ew(i,e,n,r,o){const{localParticipant:l}=e,u=(g,y)=>{let b=!1;switch(g){case G.Source.Camera:b=y.isCameraEnabled;break;case G.Source.Microphone:b=y.isMicrophoneEnabled;break;case G.Source.ScreenShare:b=y.isScreenShareEnabled;break}return b},d=hh(l).pipe(Qt(g=>u(i,g.participant)),Nn(u(i,l))),h=new kr,m=(g,y)=>ga(this,null,function*(){try{switch(y??(y=n),h.next(!0),i){case G.Source.Camera:return yield l.setCameraEnabled(g??!l.isCameraEnabled,y,r),l.isCameraEnabled;case G.Source.Microphone:return yield l.setMicrophoneEnabled(g??!l.isMicrophoneEnabled,y,r),l.isMicrophoneEnabled;case G.Source.ScreenShare:return yield l.setScreenShareEnabled(g??!l.isScreenShareEnabled,y,r),l.isScreenShareEnabled;default:throw new TypeError("Tried to toggle unsupported source")}}catch(b){if(o&&b instanceof Error){o==null||o(b);return}else throw b}finally{h.next(!1)}});return{className:va("button"),toggle:m,enabledObserver:d,pendingObserver:h.asObservable()}}function Rw(){let i=!1;const e=new kr,n=new kr,r=o=>ga(this,null,function*(){n.next(!0),i=o??!i,e.next(i),n.next(!1)});return{className:va("button"),toggle:r,enabledObserver:e.asObservable(),pendingObserver:n.asObservable()}}function _w(i,e,n){const r=new O_(void 0),o=Tw(e,i),l=(u,...d)=>ga(this,[u,...d],function*(h,m={}){var g,y,b;if(e){Ne.debug(`Switching active device of kind "${i}" with id ${h}.`),yield e.switchActiveDevice(i,h,m.exact);const T=(g=e.getActiveDevice(i))!=null?g:h;T!==h&&h!=="default"&&Ne.info(`We tried to select the device with id (${h}), but the browser decided to select the device with id (${T}) instead.`);let C;i==="audioinput"?C=(y=e.localParticipant.getTrackPublication(G.Source.Microphone))==null?void 0:y.track:i==="videoinput"&&(C=(b=e.localParticipant.getTrackPublication(G.Source.Camera))==null?void 0:b.track);const k=h==="default"&&!C||h==="default"&&(C==null?void 0:C.mediaStreamTrack.label.startsWith("Default"));r.next(k?h:T)}});return{className:va("media-device-select"),activeDeviceObservable:o,setActiveMediaDevice:l}}function ww(i){const e=n=>{i.disconnect(n)};return{className:va("disconnect-button"),disconnect:e}}function Ow(){const i=e=>ga(this,null,function*(){Ne.info("Start Audio for room: ",e),yield e.startAudio()});return{className:va("start-audio-button"),roomAudioPlaybackAllowedObservable:bw,handleStartAudioPlayback:i}}function Aw(){const i=e=>ga(this,null,function*(){Ne.info("Start Video for room: ",e),yield e.startVideo()});return{className:va("start-audio-button"),roomVideoPlaybackAllowedObservable:Sw,handleStartVideoPlayback:i}}function Dw(){return{className:"lk-room-container"}}function Ny(i,e,n=!0){const r=[i.localParticipant,...Array.from(i.remoteParticipants.values())],o=[];return r.forEach(l=>{e.forEach(u=>{const d=Array.from(l.trackPublications.values()).filter(h=>h.source===u&&(!n||h.track)).map(h=>({participant:l,publication:h,source:h.source}));o.push(...d)})}),{trackReferences:o,participants:r}}function Uy(i,e,n=!1){const{sources:r,kind:o,name:l}=e;return Array.from(i.trackPublications.values()).filter(u=>(!r||r.includes(u.source))&&(!o||u.kind===o)&&(!l||u.trackName===l)&&(!n||u.track)).map(u=>({participant:i,publication:u,source:u.source}))}function Mw(i,e,n){var r,o;const l=(r=n.additionalRoomEvents)!=null?r:sS,u=(o=n.onlySubscribed)!=null?o:!0,d=Array.from(new Set([H.ParticipantConnected,H.ParticipantDisconnected,H.ConnectionStateChanged,H.LocalTrackPublished,H.LocalTrackUnpublished,H.TrackPublished,H.TrackUnpublished,H.TrackSubscriptionStatusChanged,...l]).values());return il(i,...d).pipe(Qt(h=>{const m=Ny(h,e,u);return Ne.debug(`TrackReference[] was updated. (length ${m.trackReferences.length})`,m),m}),Nn(Ny(i,e,u)))}function xw(i,e){return uS(i,...fw).pipe(Qt(n=>{const r=Uy(n,e);return Ne.debug(`TrackReference[] was updated. (length ${r.length})`,r),r}),Nn(Uy(i,e)))}function fS(i,e){return new vt(n=>{const r=(...o)=>{n.next(o)};return i.on(e,r),()=>{i.off(e,r)}})}function Pw(i){return fS(i,W.TranscriptionReceived)}function Nw(i){return fS(i,W.TimeSyncUpdate).pipe(Qt(([e])=>e))}function Uw(i,e){if(typeof localStorage>"u"){Ne.error("Local storage is not available.");return}try{if(e){const n=Object.fromEntries(Object.entries(e).filter(([,r])=>r!==""));localStorage.setItem(i,JSON.stringify(n))}}catch(n){Ne.error(`Error setting item to local storage: ${n}`)}}function Lw(i){if(typeof localStorage>"u"){Ne.error("Local storage is not available.");return}try{const e=localStorage.getItem(i);if(!e){Ne.warn(`Item with key ${i} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){Ne.error(`Error getting item from local storage: ${e}`);return}}function Iw(i){return{load:()=>Lw(i),save:e=>Uw(i,e)}}var jw=`${aS}-user-choices`,Ms={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"default",audioDeviceId:"default",username:""},{load:Bw,save:zw}=Iw(jw);function qw(i,e=!1){e!==!0&&zw(i)}function Vw(i,e=!1){var n,r,o,l,u;const d={videoEnabled:(n=i==null?void 0:i.videoEnabled)!=null?n:Ms.videoEnabled,audioEnabled:(r=i==null?void 0:i.audioEnabled)!=null?r:Ms.audioEnabled,videoDeviceId:(o=i==null?void 0:i.videoDeviceId)!=null?o:Ms.videoDeviceId,audioDeviceId:(l=i==null?void 0:i.audioDeviceId)!=null?l:Ms.audioDeviceId,username:(u=i==null?void 0:i.username)!=null?u:Ms.username};if(e)return d;{const h=Bw();return If(If({},d),h??{})}}M.createContext(void 0);const Hw=M.createContext(void 0);function hS(){return M.useContext(Hw)}function Gw(i){const e=hS(),n=i??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}const Fw=M.createContext(void 0);function mS(){return M.useContext(Fw)}const mh=M.createContext(void 0);function al(){const i=M.useContext(mh);if(!i)throw Error("tried to access room context outside of livekit room component");return i}function rl(){return M.useContext(mh)}function Rr(i){const e=rl(),n=i??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}const Yw=M.createContext(void 0);function pS(i){var e,n,r="";if(typeof i=="string"||typeof i=="number")r+=i;else if(typeof i=="object")if(Array.isArray(i)){var o=i.length;for(e=0;e<o;e++)i[e]&&(n=pS(i[e]))&&(r&&(r+=" "),r+=n)}else for(n in i)i[n]&&(r&&(r+=" "),r+=n);return r}function gS(){for(var i,e,n=0,r="",o=arguments.length;n<o;n++)(i=arguments[n])&&(e=pS(i))&&(r&&(r+=" "),r+=e);return r}function Kw(...i){return(...e)=>{for(const n of i)if(typeof n=="function")try{n(...e)}catch(r){console.error(r)}}}function _r(...i){const e={...i[0]};for(let n=1;n<i.length;n++){const r=i[n];for(const o in r){const l=e[o],u=r[o];typeof l=="function"&&typeof u=="function"&&o[0]==="o"&&o[1]==="n"&&o.charCodeAt(2)>=65&&o.charCodeAt(2)<=90?e[o]=Kw(l,u):(o==="className"||o==="UNSAFE_className")&&typeof l=="string"&&typeof u=="string"?e[o]=gS(l,u):e[o]=u!==void 0?u:l}}return e}function Qw(i){return i!==void 0}function sl(...i){return _r(...i.filter(Qw))}function Xw(i,e,n){return M.Children.map(i,r=>M.isValidElement(r)&&M.Children.only(i)?(r.props.class&&(e??(e={}),e.class=gS(r.props.class,e.class),e.style={...r.props.style,...e.style}),M.cloneElement(r,{...e,key:n})):r)}function Zw(i,e){return i==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:i==="e2ee"&&e?"e2ee-enabled":e}const Jw={connect:!0,audio:!1,video:!1};function Ww(i){const{token:e,serverUrl:n,options:r,room:o,connectOptions:l,connect:u,audio:d,video:h,screen:m,onConnected:g,onDisconnected:y,onError:b,onMediaDeviceFailure:T,onEncryptionError:C,simulateParticipants:k,...O}={...Jw,...i};r&&o&&Ne.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[_,B]=M.useState(),q=M.useRef(u);M.useEffect(()=>{B(o??new ti(r))},[o,JSON.stringify(r,Zw)]);const P=M.useMemo(()=>{const{className:E}=Dw();return _r(O,{className:E})},[O]);return M.useEffect(()=>{if(!_)return;const E=()=>{const se=_.localParticipant;Ne.debug("trying to publish local tracks"),Promise.all([se.setMicrophoneEnabled(!!d,typeof d!="boolean"?d:void 0),se.setCameraEnabled(!!h,typeof h!="boolean"?h:void 0),se.setScreenShareEnabled(!!m,typeof m!="boolean"?m:void 0)]).catch($=>{Ne.warn($),b==null||b($)})},z=se=>{const $=zs.getFailure(se);T==null||T($)},J=se=>{C==null||C(se)},ne=se=>{y==null||y(se)},oe=()=>{g==null||g()};return _.on(H.SignalConnected,E).on(H.MediaDevicesError,z).on(H.EncryptionError,J).on(H.Disconnected,ne).on(H.Connected,oe),()=>{_.off(H.SignalConnected,E).off(H.MediaDevicesError,z).off(H.EncryptionError,J).off(H.Disconnected,ne).off(H.Connected,oe)}},[_,d,h,m,b,C,T,g,y]),M.useEffect(()=>{if(_){if(k){_.simulateParticipants({participants:{count:k},publish:{audio:!0,useRealTracks:!0}});return}if(u){if(q.current=!0,Ne.debug("connecting"),!e){Ne.debug("no token yet");return}if(!n){Ne.warn("no livekit url provided"),b==null||b(Error("no livekit url provided"));return}_.connect(n,e,l).catch(E=>{Ne.warn(E),q.current===!0&&(b==null||b(E))})}else Ne.debug("disconnecting because connect is false"),q.current=!1,_.disconnect()}},[u,e,JSON.stringify(l),_,b,n,k]),M.useEffect(()=>{if(_)return()=>{Ne.info("disconnecting on onmount"),_.disconnect()}},[_]),{room:_,htmlProps:P}}const $w=M.forwardRef(function(i,e){const{room:n,htmlProps:r}=Ww(i);return M.createElement("div",{ref:e,...r},n&&M.createElement(mh.Provider,{value:n},M.createElement(Yw.Provider,{value:i.featureFlags},i.children)))});function Mn(i,e,n=!0){const[r,o]=M.useState(e);return M.useEffect(()=>{if(n&&o(e),typeof window>"u"||!i)return;const l=i.subscribe(o);return()=>l.unsubscribe()},[i,n]),r}function ph(i){const e=Rr(i),n=M.useMemo(()=>vw(e),[e]);return Mn(n,e.state)}function eO(i){const e=al(),n=ph(e);return{buttonProps:M.useMemo(()=>{const{className:r,disconnect:o}=ww(e);return _r(i,{className:r,onClick:()=>o(i.stopTracks??!0),disabled:n===Re.Disconnected})},[e,i,n])}}function vS(i={}){const e=Rr(i.room),[n,r]=M.useState(e.localParticipant),[o,l]=M.useState(n.isMicrophoneEnabled),[u,d]=M.useState(n.isMicrophoneEnabled),[h,m]=M.useState(n.lastMicrophoneError),[g,y]=M.useState(n.lastCameraError),[b,T]=M.useState(n.isMicrophoneEnabled),[C,k]=M.useState(void 0),[O,_]=M.useState(void 0),B=q=>{d(q.isCameraEnabled),l(q.isMicrophoneEnabled),T(q.isScreenShareEnabled),_(q.cameraTrack),k(q.microphoneTrack),m(q.participant.lastMicrophoneError),y(q.participant.lastCameraError),r(q.participant)};return M.useEffect(()=>{const q=hh(e.localParticipant).subscribe(B);return()=>q.unsubscribe()},[e]),{isMicrophoneEnabled:o,isScreenShareEnabled:b,isCameraEnabled:u,microphoneTrack:C,cameraTrack:O,lastMicrophoneError:h,lastCameraError:g,localParticipant:n}}function tO(){const i=al(),e=M.useMemo(()=>Cw(i.localParticipant),[i]);return Mn(e,i.localParticipant.permissions)}function nO({kind:i,room:e,track:n,requestPermissions:r,onError:o}){const l=rl(),u=M.useMemo(()=>e??l??new ti,[e,l]),d=M.useMemo(()=>yw(i,o,r),[i,r,o]),h=Mn(d,[]),[m,g]=M.useState((u==null?void 0:u.getActiveDevice(i))??"default"),{className:y,activeDeviceObservable:b,setActiveMediaDevice:T}=M.useMemo(()=>_w(i,u),[i,u,n]);return M.useEffect(()=>{const C=b.subscribe(k=>{k&&(Ne.info("setCurrentDeviceId",k),g(k))});return()=>{C==null||C.unsubscribe()}},[b]),{devices:h,className:y,activeDeviceId:m,setActiveMediaDevice:T}}function iO(i={}){const e=Rr(i.room),[n,r]=M.useState([]);return M.useEffect(()=>{const o=kw(e,{additionalRoomEvents:i.updateOnlyOn}).subscribe(r);return()=>o.unsubscribe()},[e,JSON.stringify(i.updateOnlyOn)]),n}function aO({room:i,props:e}){const n=Rr(i),{className:r,roomAudioPlaybackAllowedObservable:o,handleStartAudioPlayback:l}=M.useMemo(()=>Ow(),[]),u=M.useMemo(()=>o(n),[n,o]),{canPlayAudio:d}=Mn(u,{canPlayAudio:n.canPlaybackAudio});return{mergedProps:M.useMemo(()=>_r(e,{className:r,onClick:()=>{l(n)},style:{display:d?"none":"block"}}),[e,r,d,l,n]),canPlayAudio:d}}function rO({room:i,props:e}){const n=Rr(i),{className:r,roomVideoPlaybackAllowedObservable:o,handleStartVideoPlayback:l}=M.useMemo(()=>Aw(),[]),u=M.useMemo(()=>o(n),[n,o]),{canPlayVideo:d}=Mn(u,{canPlayVideo:n.canPlaybackVideo});return{mergedProps:M.useMemo(()=>_r(e,{className:r,onClick:()=>{l(n)},style:{display:d?"none":"block"}}),[e,r,d,l,n]),canPlayVideo:d}}function sO({source:i,onChange:e,initialState:n,captureOptions:r,publishOptions:o,onDeviceError:l,...u}){var d;const h=rl(),m=(d=h==null?void 0:h.localParticipant)==null?void 0:d.getTrackPublication(i),g=M.useRef(!1),{toggle:y,className:b,pendingObserver:T,enabledObserver:C}=M.useMemo(()=>h?Ew(i,h,r,o,l):Rw(),[h,i,JSON.stringify(r),o]),k=Mn(T,!1),O=Mn(C,n??!!(m!=null&&m.isEnabled));M.useEffect(()=>{e==null||e(O,g.current),g.current=!1},[O,e]),M.useEffect(()=>{n!==void 0&&(Ne.debug("forcing initial toggle state",i,n),y(n))},[]);const _=M.useMemo(()=>_r(u,{className:b}),[u,b]),B=M.useCallback(q=>{var P;g.current=!0,y().catch(()=>g.current=!1),(P=u.onClick)==null||P.call(u,q)},[u,y]);return{toggle:y,enabled:O,pending:k,track:m,buttonProps:{..._,"aria-pressed":O,"data-lk-source":i,"data-lk-enabled":O,disabled:k,onClick:B}}}function oO(i=[G.Source.Camera,G.Source.Microphone,G.Source.ScreenShare,G.Source.ScreenShareAudio,G.Source.Unknown],e={}){const n=Rr(e.room),[r,o]=M.useState([]),[l,u]=M.useState([]),d=M.useMemo(()=>i.map(h=>oS(h)?h.source:h),[JSON.stringify(i)]);return M.useEffect(()=>{const h=Mw(n,d,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:m,participants:g})=>{Ne.debug("setting track bundles",m,g),o(m),u(g)});return()=>h.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(i)]),M.useMemo(()=>{if(cS(i)){const h=lO(i,l),m=Array.from(r);return l.forEach(g=>{h.has(g.identity)&&(h.get(g.identity)??[]).forEach(y=>{if(r.find(({participant:T,publication:C})=>g.identity===T.identity&&C.source===y))return;Ne.debug(`Add ${y} placeholder for participant ${g.identity}.`);const b={participant:g,source:y};m.push(b)})}),m}else return r},[r,l,i])}function cO(i,e){const n=new Set(i);for(const r of e)n.delete(r);return n}function lO(i,e){const n=new Map;if(cS(i)){const r=i.filter(o=>o.withPlaceholder).map(o=>o.source);e.forEach(o=>{const l=o.getTrackPublications().map(d=>{var h;return(h=d.track)==null?void 0:h.source}).filter(d=>d!==void 0),u=Array.from(cO(new Set(r),new Set(l)));u.length>0&&n.set(o.identity,u)})}return n}function uO(i={}){const[e,n]=M.useState(Vw(i.defaults,i.preventLoad??!1)),r=M.useCallback(h=>{n(m=>({...m,audioEnabled:h}))},[]),o=M.useCallback(h=>{n(m=>({...m,videoEnabled:h}))},[]),l=M.useCallback(h=>{n(m=>({...m,audioDeviceId:h}))},[]),u=M.useCallback(h=>{n(m=>({...m,videoDeviceId:h}))},[]),d=M.useCallback(h=>{n(m=>({...m,username:h}))},[]);return M.useEffect(()=>{qw(e,i.preventSave??!1)},[e,i.preventSave]),{userChoices:e,saveAudioInputEnabled:r,saveVideoInputEnabled:o,saveAudioInputDeviceId:l,saveVideoInputDeviceId:u,saveUsername:d}}const dO=i=>{const e=n=>{let r=1-Math.max(-100,Math.min(-10,n))*-1/100;return r=Math.sqrt(r),r};return i.map(n=>n===-1/0?0:e(n))},fO={bands:5,loPass:100,hiPass:600,updateInterval:32,analyserOptions:{fftSize:2048}};function hO(i,e={}){var n;const r=i instanceof G?i:(n=i==null?void 0:i.publication)==null?void 0:n.track,o={...fO,...e},[l,u]=M.useState(new Array(o.bands).fill(0));return M.useEffect(()=>{if(!r||!(r!=null&&r.mediaStream))return;const{analyser:d,cleanup:h}=m1(r,o.analyserOptions),m=d.frequencyBinCount,g=new Float32Array(m),y=setInterval(()=>{d.getFloatFrequencyData(g);let b=new Float32Array(g.length);for(let O=0;O<g.length;O++)b[O]=g[O];b=b.slice(e.loPass,e.hiPass);const T=dO(b),C=Math.ceil(T.length/o.bands),k=[];for(let O=0;O<o.bands;O++){const _=T.slice(O*C,(O+1)*C).reduce((B,q)=>B+=q,0);k.push(_/C)}u(k)},o.updateInterval);return()=>{h(),clearInterval(y)}},[r,r==null?void 0:r.mediaStream,JSON.stringify(e)]),l}function mO(i,e){const n=al(),r=mS(),o=e?n.getParticipantByIdentity(e):r,l=M.useMemo(()=>o?xw(o,{sources:i}):void 0,[o==null?void 0:o.sid,o==null?void 0:o.identity,JSON.stringify(i)]);return Mn(l,[])}function pO(i){var e,n,r;const o=M.useMemo(()=>{var l;return(l=i==null?void 0:i.publication)!=null&&l.track?Nw(i==null?void 0:i.publication.track):void 0},[(e=i==null?void 0:i.publication)==null?void 0:e.track]);return Mn(o,{timestamp:Date.now(),rtpTimestamp:(r=(n=i==null?void 0:i.publication)==null?void 0:n.track)==null?void 0:r.rtpTimestamp})}const gO={bufferSize:100};function yS(i,e){const n={...gO,...e},[r,o]=M.useState([]),l=pO(i),u=d=>{var h;(h=n.onTranscription)==null||h.call(n,d),o(m=>pw(m,d.map(g=>mw(g,l)),n.bufferSize))};return M.useEffect(()=>{if(!(i!=null&&i.publication))return;const d=Pw(i.publication).subscribe(h=>{u(...h)});return()=>{d.unsubscribe()}},[i&&rS(i),u]),{segments:r}}function vO(i={}){const e=mS(),n=i.participant??e,r=M.useMemo(()=>Py(n),[n]);return Mn(r,{attributes:n==null?void 0:n.attributes})}const Ly="lk.agent.state";function yO(){const i=iO().find(u=>u.kind===Bs.AGENT),e=mO([G.Source.Microphone],i==null?void 0:i.identity)[0],{segments:n}=yS(e),r=ph(),{attributes:o}=vO({participant:i}),l=M.useMemo(()=>r===Re.Disconnected?"disconnected":r===Re.Connecting||!i||!(o!=null&&o[Ly])?"connecting":o[Ly],[o,i,r]);return{agent:i,state:l,audioTrack:e,agentTranscriptions:n,agentAttributes:o}}const bO=M.forwardRef(function(i,e){const{buttonProps:n}=eO(i);return M.createElement("button",{ref:e,...n},i.children)}),SO=i=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...i},M.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),M.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),TO=i=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...i},M.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),kO=i=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...i},M.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),M.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),CO=i=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...i},M.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),M.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),EO=i=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...i},M.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),M.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),RO=i=>M.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...i},M.createElement("g",{fill:"currentColor"},M.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),M.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),Qd=M.forwardRef(function({kind:i,initialSelection:e,onActiveDeviceChange:n,onDeviceListChange:r,onDeviceSelectError:o,exactMatch:l,track:u,requestPermissions:d,onError:h,...m},g){const y=rl(),b=M.useCallback(E=>{y&&y.emit(H.MediaDevicesError,E),h==null||h(E)},[y,h]),{devices:T,activeDeviceId:C,setActiveMediaDevice:k,className:O}=nO({kind:i,room:y,track:u,requestPermissions:d,onError:b});M.useEffect(()=>{e!==void 0&&k(e)},[k]),M.useEffect(()=>{typeof r=="function"&&r(T)},[r,T]),M.useEffect(()=>{C&&C!==""&&(n==null||n(C))},[C]);const _=async E=>{try{await k(E,{exact:l??!0})}catch(z){if(z instanceof Error)o==null||o(z);else throw z}},B=M.useMemo(()=>sl(m,{className:O},{className:"lk-list"}),[O,m]),q=!!T.find(E=>E.label.toLowerCase().startsWith("default"));function P(E,z,J){return E===z||!q&&J===0&&z==="default"}return M.createElement("ul",{ref:g,...B},T.map((E,z)=>M.createElement("li",{key:E.deviceId,id:E.deviceId,"data-lk-active":P(E.deviceId,C,z),"aria-selected":P(E.deviceId,C,z),role:"option"},M.createElement("button",{className:"lk-button",onClick:()=>_(E.deviceId)},E.label))))}),_O=M.forwardRef(function({label:i,...e},n){const r=al(),{mergedProps:o,canPlayAudio:l}=aO({room:r,props:e}),{mergedProps:u,canPlayVideo:d}=rO({room:r,props:o}),{style:h,...m}=u;return h.display=l&&d?"none":"block",M.createElement("button",{ref:n,style:h,...m},i??`Start ${l?"Video":"Audio"}`)});function wO(i,e){switch(i){case G.Source.Microphone:return e?M.createElement(CO,null):M.createElement(kO,null);case G.Source.Camera:return e?M.createElement(TO,null):M.createElement(SO,null);case G.Source.ScreenShare:return e?M.createElement(RO,null):M.createElement(EO,null);default:return}}const OO=M.forwardRef(function({showIcon:i,...e},n){const{buttonProps:r,enabled:o}=sO(e),[l,u]=M.useState(!1);return M.useEffect(()=>{u(!0)},[]),l&&M.createElement("button",{ref:n,...r},(i??!0)&&wO(e.source,o),e.children)});function AO(i,e={}){const[n,r]=M.useState(jf(i)),[o,l]=M.useState(n==null?void 0:n.isMuted),[u,d]=M.useState(n==null?void 0:n.isSubscribed),[h,m]=M.useState(n==null?void 0:n.track),[g,y]=M.useState("landscape"),b=M.useRef(),{className:T,trackObserver:C}=M.useMemo(()=>gw(i),[i.participant.sid??i.participant.identity,i.source,fh(i)&&i.publication.trackSid]);return M.useEffect(()=>{const k=C.subscribe(O=>{Ne.debug("update track",O),r(O),l(O==null?void 0:O.isMuted),d(O==null?void 0:O.isSubscribed),m(O==null?void 0:O.track)});return()=>k==null?void 0:k.unsubscribe()},[C]),M.useEffect(()=>{var k,O;return h&&(b.current&&h.detach(b.current),(k=e.element)!=null&&k.current&&!(i.participant.isLocal&&(h==null?void 0:h.kind)==="audio")&&h.attach(e.element.current)),b.current=(O=e.element)==null?void 0:O.current,()=>{b.current&&(h==null||h.detach(b.current))}},[h,e.element]),M.useEffect(()=>{var k,O;if(typeof((k=n==null?void 0:n.dimensions)==null?void 0:k.width)=="number"&&typeof((O=n==null?void 0:n.dimensions)==null?void 0:O.height)=="number"){const _=n.dimensions.width>n.dimensions.height?"landscape":"portrait";y(_)}},[n]),{publication:n,isMuted:o,isSubscribed:u,track:h,elementProps:sl(e.props,{className:T,"data-lk-local-participant":i.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":g}})}}var Xd,Iy;function DO(){if(Iy)return Xd;Iy=1;var i="Expected a function",e=NaN,n="[object Symbol]",r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,d=parseInt,h=typeof hc=="object"&&hc&&hc.Object===Object&&hc,m=typeof self=="object"&&self&&self.Object===Object&&self,g=h||m||Function("return this")(),y=Object.prototype,b=y.toString,T=Math.max,C=Math.min,k=function(){return g.Date.now()};function O(E,z,J){var ne,oe,se,$,re,Ue,Le=0,Ke=!1,V=!1,ee=!0;if(typeof E!="function")throw new TypeError(i);z=P(z)||0,_(J)&&(Ke=!!J.leading,V="maxWait"in J,se=V?T(P(J.maxWait)||0,z):se,ee="trailing"in J?!!J.trailing:ee);function le(we){var Oe=ne,_t=oe;return ne=oe=void 0,Le=we,$=E.apply(_t,Oe),$}function ye(we){return Le=we,re=setTimeout(ae,z),Ke?le(we):$}function A(we){var Oe=we-Ue,_t=we-Le,ya=z-Oe;return V?C(ya,se-_t):ya}function Z(we){var Oe=we-Ue,_t=we-Le;return Ue===void 0||Oe>=z||Oe<0||V&&_t>=se}function ae(){var we=k();if(Z(we))return ie(we);re=setTimeout(ae,A(we))}function ie(we){return re=void 0,ee&&ne?le(we):(ne=oe=void 0,$)}function de(){re!==void 0&&clearTimeout(re),Le=0,ne=Ue=oe=re=void 0}function Ce(){return re===void 0?$:ie(k())}function me(){var we=k(),Oe=Z(we);if(ne=arguments,oe=this,Ue=we,Oe){if(re===void 0)return ye(Ue);if(V)return re=setTimeout(ae,z),le(Ue)}return re===void 0&&(re=setTimeout(ae,z)),$}return me.cancel=de,me.flush=Ce,me}function _(E){var z=typeof E;return!!E&&(z=="object"||z=="function")}function B(E){return!!E&&typeof E=="object"}function q(E){return typeof E=="symbol"||B(E)&&b.call(E)==n}function P(E){if(typeof E=="number")return E;if(q(E))return e;if(_(E)){var z=typeof E.valueOf=="function"?E.valueOf():E;E=_(z)?z+"":z}if(typeof E!="string")return E===0?E:+E;E=E.replace(r,"");var J=l.test(E);return J||u.test(E)?d(E.slice(2),J?2:8):o.test(E)?e:+E}return Xd=O,Xd}DO();const MO=M.forwardRef(function({trackRef:i,onSubscriptionStatusChanged:e,volume:n,...r},o){const l=Gw(i),u=M.useRef(null);M.useImperativeHandle(o,()=>u.current);const{elementProps:d,isSubscribed:h,track:m,publication:g}=AO(l,{element:u,props:r});return M.useEffect(()=>{e==null||e(!!h)},[h,e]),M.useEffect(()=>{m===void 0||n===void 0||(m instanceof kb?m.setVolume(n):Ne.warn("Volume can only be set on remote audio tracks."))},[n,m]),M.useEffect(()=>{g===void 0||r.muted===void 0||(g instanceof Eb?g.setEnabled(!r.muted):Ne.warn("Can only call setEnabled on remote track publications."))},[r.muted,g,m]),M.createElement("audio",{ref:u,...d})});function xO({volume:i,muted:e}){const n=oO([G.Source.Microphone,G.Source.ScreenShareAudio,G.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(r=>!r.participant.isLocal&&r.publication.kind===G.Kind.Audio);return M.createElement("div",{style:{display:"none"}},n.map(r=>M.createElement(MO,{key:rS(r),trackRef:r,volume:i,muted:e})))}const PO=i=>{const e=[];for(let n=0;n<i;n++)e.push([n,i-1-n]);return e},jy=i=>[[Math.floor(i/2)],[-1]],NO=(i,e,n)=>{const[r,o]=M.useState(0),[l,u]=M.useState([[]]);M.useEffect(()=>{if(i==="thinking")u(jy(e));else if(i==="connecting"||i==="initializing"){const h=[...PO(e)];u(h)}else u(i==="listening"?jy(e):i===void 0?[new Array(e).fill(0).map((h,m)=>m)]:[[]]);o(0)},[i,e]);const d=M.useRef(null);return M.useEffect(()=>{let h=performance.now();const m=g=>{g-h>=n&&(o(y=>y+1),h=g),d.current=requestAnimationFrame(m)};return d.current=requestAnimationFrame(m),()=>{d.current!==null&&cancelAnimationFrame(d.current)}},[n,e,i,l.length]),l[r%l.length]},UO=new Map([["connecting",2e3],["initializing",2e3],["listening",500],["thinking",150]]),LO=(i,e)=>{if(i===void 0)return 1e3;let n=UO.get(i);if(n)switch(i){case"connecting":n/=e;break}return n},bS=M.forwardRef(function({state:i,options:e,barCount:n=15,trackRef:r,children:o,...l},u){const d=sl(l,{className:"lk-audio-bar-visualizer"});let h=hS();r&&(h=r);const m=hO(h,{bands:n,loPass:100,hiPass:200}),g=(e==null?void 0:e.minHeight)??20,y=(e==null?void 0:e.maxHeight)??100,b=NO(i,n,LO(i,n)??100);return M.createElement("div",{ref:u,...d,"data-lk-va-state":i},m.map((T,C)=>o?Xw(o,{"data-lk-highlighted":b.includes(C),"data-lk-bar-index":C,className:"lk-audio-bar",style:{height:`${Math.min(y,Math.max(g,T*100+5))}%`}}):M.createElement("span",{key:C,"data-lk-highlighted":b.includes(C),"data-lk-bar-index":C,className:`lk-audio-bar ${b.includes(C)&&"lk-highlighted"}`,style:{height:`${Math.min(y,Math.max(g,T*100+5))}%`}})))});function IO({kind:i,initialSelection:e,onActiveDeviceChange:n,tracks:r,requestPermissions:o=!1,...l}){const[u,d]=M.useState(!1),[h,m]=M.useState([]),[g,y]=M.useState(!0),[b,T]=M.useState(o),C=(B,q)=>{Ne.debug("handle device change"),d(!1),n==null||n(B,q)},k=M.useRef(null),O=M.useRef(null);M.useLayoutEffect(()=>{u&&T(!0)},[u]),M.useLayoutEffect(()=>{let B;return k.current&&O.current&&(h||g)&&(B=lw(k.current,O.current,(q,P)=>{O.current&&Object.assign(O.current.style,{left:`${q}px`,top:`${P}px`})})),y(!1),()=>{B==null||B()}},[k,O,h,g]);const _=M.useCallback(B=>{O.current&&B.target!==k.current&&u&&uw(O.current,B)&&d(!1)},[u,O,k]);return M.useEffect(()=>(document.addEventListener("click",_),()=>{document.removeEventListener("click",_)}),[_]),M.createElement(M.Fragment,null,M.createElement("button",{className:"lk-button lk-button-menu","aria-pressed":u,...l,onClick:()=>d(!u),ref:k},l.children),!l.disabled&&M.createElement("div",{className:"lk-device-menu",ref:O,style:{visibility:u?"visible":"hidden"}},i?M.createElement(Qd,{initialSelection:e,onActiveDeviceChange:B=>C(i,B),onDeviceListChange:m,kind:i,track:r==null?void 0:r[i],requestPermissions:b}):M.createElement(M.Fragment,null,M.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),M.createElement(Qd,{kind:"audioinput",onActiveDeviceChange:B=>C("audioinput",B),onDeviceListChange:m,track:r==null?void 0:r.audioinput,requestPermissions:b}),M.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),M.createElement(Qd,{kind:"videoinput",onActiveDeviceChange:B=>C("videoinput",B),onDeviceListChange:m,track:r==null?void 0:r.videoinput,requestPermissions:b}))))}function jO({controls:i,saveUserChoices:e=!0,onDeviceError:n,...r}){const o={leave:!0,microphone:!0,...i},l=tO(),{microphoneTrack:u,localParticipant:d}=vS(),h=M.useMemo(()=>({participant:d,source:G.Source.Microphone,publication:u}),[d,u]);l?o.microphone??(o.microphone=l.canPublish):o.microphone=!1;const m=sl({className:"lk-agent-control-bar"},r),{saveAudioInputEnabled:g,saveAudioInputDeviceId:y}=uO({preventSave:!e}),b=M.useCallback((T,C)=>{C&&g(T)},[g]);return M.createElement("div",{...m},o.microphone&&M.createElement("div",{className:"lk-button-group"},M.createElement(OO,{source:G.Source.Microphone,showIcon:!0,onChange:b,onDeviceError:T=>n==null?void 0:n({source:G.Source.Microphone,error:T})},M.createElement(bS,{trackRef:h,barCount:7,options:{minHeight:5}})),M.createElement("div",{className:"lk-button-group-menu"},M.createElement(IO,{kind:"audioinput",onActiveDeviceChange:(T,C)=>y(C??"default")}))),o.leave&&M.createElement(bO,null,"Disconnect"),M.createElement(_O,null))}const BO=({type:i,text:e})=>xe.jsx("div",{className:`message ${i}-message`,children:xe.jsx("div",{className:"message-content",children:xe.jsx("span",{className:"message-text",children:e})})}),zO=()=>{const{state:i,audioTrack:e,agentTranscriptions:n}=yO(),r=vS(),{segments:o}=yS({publication:r.microphoneTrack,source:G.Source.Microphone,participant:r.localParticipant}),[l,u]=M.useState([]);return M.useEffect(()=>{const d=[...(n==null?void 0:n.map(h=>({...h,type:"agent"})))??[],...(o==null?void 0:o.map(h=>({...h,type:"user"})))??[]].sort((h,m)=>h.firstReceivedTime-m.firstReceivedTime);u(d)},[n,o]),xe.jsxs("div",{className:"voice-assistant-container",children:[xe.jsx("div",{className:"visualizer-container",children:xe.jsx(bS,{state:i,barCount:7,trackRef:e})}),xe.jsxs("div",{className:"control-section",children:[xe.jsx(jO,{}),xe.jsxs("div",{className:"conversation",children:[xe.jsx("div",{className:"date-divider",children:"Today"}),l.map((d,h)=>xe.jsx(BO,{type:d.type,text:d.text},d.id||h))]})]})]})},qO=({setShowSupport:i})=>{const[e,n]=M.useState(!0),[r,o]=M.useState(null),[l,u]=M.useState(!1),[d,h]=M.useState(!0),m=()=>{const b="abcdefghijklmnopqrstuvwxyz";let T="";for(let C=0;C<6;C++)T+=b.charAt(Math.floor(Math.random()*b.length));return T},g=M.useCallback(async b=>{try{console.log("Getting token for user:",b);const C=await(await fetch(`/api/getToken?name=${encodeURIComponent(b)}`)).text();o(C),n(!1)}catch(T){console.error("Error getting token:",T),n(!1)}},[]);M.useEffect(()=>{const b=m();g(b)},[g]);const y=()=>{u(!0),h(!1)};return xe.jsxs(xe.Fragment,{children:[d&&xe.jsx("div",{className:"modal-overlay",children:xe.jsx("div",{className:"modal-content",children:xe.jsx("div",{className:"support-room",children:e?xe.jsx("div",{className:"loading",children:"Connecting to support..."}):r?xe.jsx("div",{className:"loading",children:"Connecting to support..."}):xe.jsx("div",{className:"loading",children:"Failed to connect. Please try again."})})})}),r&&xe.jsxs($w,{serverUrl:"wss://shopbilis-ufjgld4q.livekit.cloud",token:r,connect:!0,video:!1,audio:!0,onDisconnected:()=>{i(!1)},children:[xe.jsx(VO,{onConnected:y}),xe.jsx(xO,{}),xe.jsx("div",{className:`voice-assistant-wrapper ${l?"visible":"hidden"}`,children:xe.jsx(zO,{})})]})]})},VO=({onConnected:i})=>{const e=ph(),[n,r]=M.useState(!1);return M.useEffect(()=>{e==="connected"&&!n&&(r(!0),setTimeout(()=>{typeof i=="function"&&i()},1e3))},[e,n,i]),null};function HO(){const[i,e]=M.useState(!1),n=()=>{e(!0)};return xe.jsxs("div",{className:"app",children:[xe.jsx("main",{children:xe.jsx("button",{className:"support-button",onClick:n,children:xe.jsx("img",{src:"src/assets/mic.png",width:"40"})})}),i&&xe.jsx(qO,{setShowSupport:e})]})}Jk.createRoot(document.getElementById("root")).render(xe.jsx(M.StrictMode,{children:xe.jsx(HO,{})}));
